(this.webpackJsonpjournal=this.webpackJsonpjournal||[]).push([[0],{461:function(e,t,a){},795:function(e,t,a){"use strict";a.r(t);a(456);var n=a(0),r=a.n(n),c=a(26),o=a.n(c),i=(a(461),a(4)),s=a(72);s.a.initializeApp({apiKey:"AIzaSyBfzhQOCtbcUk_tWjPDnjYtHwoouCEkclg",authDomain:"journal-bb5e3.firebaseapp.com",databaseURL:"https://journal-bb5e3.firebaseio.com",projectId:"journal-bb5e3",storageBucket:"journal-bb5e3.appspot.com",messagingSenderId:"918752509407",appId:"1:918752509407:web:77670a68ff906f13e5d86a"});var l=new s.a.auth.GoogleAuthProvider;s.a.firestore().settings({ignoreUndefinedProperties:!0});var u=function(){l.setCustomParameters({prompt:"select_account"}),s.a.auth().signInWithPopup(l)},d=s.a,f=r.a.createContext(),m=function(e){var t=e.children,a=Object(n.useState)(null),c=Object(i.a)(a,2),o=c[0],s=c[1],l=Object(n.useState)(!0),u=Object(i.a)(l,2),m=(u[0],u[1]);return Object(n.useEffect)((function(){d.auth().onAuthStateChanged((function(e){s(e),m(!1);var t=d.firestore().collection("users");if(e){var a=t.doc(e.uid);a.get().then((function(t){t&&t.exists?console.log("User Exist"):(console.log("Creating user"),a.set({username:e.displayName,email:e.email,created_date:d.firestore.FieldValue.serverTimestamp()}))}))}}))}),[]),r.a.createElement(f.Provider,{value:{currentUser:o}},t)},p=a(61),b=a(23),h=a(887),g=a(9),j=a(19),O=a(885),E=a(884),v=a(882),y=a(917),k=a(912),_=a(797),w=a(382),S=a.n(w),x=a(410),C=a(886),q=a(891),I=a(207),D=a(880),F=a(32),T=a.p+"static/media/kloop_transparent_site.f6fb098e.png",U=a(383),P=a.n(U),R=a(888),B=240,W=Object(D.a)((function(e){return{root:{display:"flex"},drawer:Object(j.a)({},e.breakpoints.up("sm"),{width:B,flexShrink:0}),appBar:Object(j.a)({background:"white",boxShadow:"none"},e.breakpoints.up("sm"),{width:"calc(100% - ".concat(B,"px)"),marginLeft:B}),menuButton:Object(j.a)({color:"black",marginRight:e.spacing(2)},e.breakpoints.up("sm"),{display:"none"}),toolbar:e.mixins.toolbar,drawerPaper:{width:B},content:{flexGrow:1,padding:e.spacing(3)}}}));var A=function(e){var t=e.window,a=W(),c=Object(F.a)(),o=r.a.useState(!1),s=Object(i.a)(o,2),l=s[0],m=s[1],b=Object(n.useContext)(f).currentUser,w=r.a.useState(null),D=Object(i.a)(w,2),U=D[0],B=D[1],A=Boolean(U),N=function(){m(!l)},z=Object(n.useState)(!1),L=Object(i.a)(z,2),M=L[0],G=L[1],V=Object(n.useState)(0),H=Object(i.a)(V,2),K=H[0],Q=H[1],J=Object(n.useState)([]),X=Object(i.a)(J,2),Y=X[0],Z=X[1],$=Object(n.useState)([]),ee=Object(i.a)($,2),te=ee[0],ae=ee[1],ne=Object(n.useState)({}),re=Object(i.a)(ne,2),ce=re[0],oe=re[1],ie=Object(n.useState)([]),se=Object(i.a)(ie,2),le=se[0],ue=se[1];Object(n.useEffect)((function(){b&&d.firestore().collection("editors").get().then((function(e){e.forEach((function(e){e.id===b.uid&&(console.log("moderator"),G(!0))}))})).catch((function(){return G(!1)}))}),[b]),Object(n.useEffect)((function(){b&&d.firestore().collection("users").doc(b.uid).collection("user_private").doc("private").onSnapshot((function(e){e.data()&&ae(e.data().ranks)}))}),[b]),Object(n.useEffect)((function(){b&&d.firestore().collection("schema").doc("structure").collection("ranks").where("assign_without_moderator","==",!0).get().then((function(e){var t=[];return e.forEach((function(e){t.push(e.id)})),console.log("Assignable",t),t})).then((function(e){return ue(e)}))}),[b]),Object(n.useEffect)((function(){te&&te.length>0&&d.firestore().collection("pages").onSnapshot((function(e){var t={};e.forEach((function(e){e.data().ranks&&(e.data().ranks.some((function(e){return te.includes(e)}))&&(t[e.id]=e.data()))})),oe(t)}))}),[te]),Object(n.useEffect)((function(){le&&le.length>0&&d.firestore().collection("pages").where("ranks","array-contains-any",le).onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||(oe((function(t){return Object(g.a)(Object(g.a)({},t),{},Object(j.a)({},e.doc.id,e.doc.data()))})),console.log("User pages assign: ",e.doc.id)),"removed"===e.type&&oe((function(t){var a=Object.assign({},t);return delete a[e.doc.id],a}))}))}))}),[le]),Object(n.useEffect)((function(){var e=function(){};return b&&d.firestore().collection("notifications").where("user_id","array-contains",b.uid).where("shown","!=",!0).onSnapshot((function(e){console.log(e.size);var t=[],a=0;e.forEach((function(e){t.push(Object(g.a)({id:e.id},e.data())),a++})),t.sort((function(e,t){return t.created_date.toDate()-e.created_date.toDate()})),Q(a),Z(t)})),function(){return e}}),[b]);var de=r.a.createElement("div",null,r.a.createElement("div",{className:a.toolbar}),r.a.createElement(v.a,null),r.a.createElement("nav",null,r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(p.b,{to:"/"},"\u0413\u043b\u0430\u0432\u043d\u0430\u044f")),r.a.createElement("li",null,r.a.createElement(p.b,{to:"/profile"},"\u041f\u0440\u043e\u0444\u0438\u043b\u044c")),r.a.createElement("li",null,r.a.createElement(p.b,{to:"/notifications"},"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f")),r.a.createElement("li",null,r.a.createElement(p.b,{to:"/mybadges"},"\u0411\u044d\u0439\u0434\u0436\u0438\u043a")),M?r.a.createElement("li",null,r.a.createElement(p.b,{to:"/tasksObserver"},"\u041c\u043e\u0434\u0435\u0440\u0430\u0442\u043e\u0440")):null),r.a.createElement("ul",null,Object.keys(ce).map((function(e){return r.a.createElement("li",{key:e}," ",r.a.createElement(p.b,{to:"/p/"+e},ce[e].name)," ")}))))),fe=void 0!==t?function(){return t().document.body}:void 0;return r.a.createElement("div",{className:a.root},r.a.createElement(E.a,null),r.a.createElement(O.a,{position:"fixed",className:a.appBar},r.a.createElement(C.a,null,r.a.createElement(_.a,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:N,className:a.menuButton},r.a.createElement(S.a,null)),r.a.createElement(h.a,{container:!0,style:{flexGrow:1}},r.a.createElement("img",{src:T,alt:"Kloop.kg - \u041d\u043e\u0432\u043e\u0441\u0442\u0438 \u041a\u044b\u0440\u0433\u044b\u0437\u0441\u0442\u0430\u043d\u0430",style:{width:150,height:"auto"}})),b&&r.a.createElement("div",null,r.a.createElement(_.a,{"aria-label":"account of current user","aria-controls":"menu-appbar","aria-haspopup":"true",onClick:function(e){B(e.currentTarget)},color:"inherit",size:"small"},r.a.createElement(R.a,{badgeContent:K,color:"secondary",overlap:"circle"},r.a.createElement(P.a,{style:{fill:"grey",fontSize:"28px"}}))),r.a.createElement(x.a,{id:"menu-appbar",anchorEl:U,anchorOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:A,onClose:function(){B(null)}},r.a.createElement(h.a,{container:!0,direction:"column",alignItems:"center"},Y.length>0?Y.map((function(e,t){return r.a.createElement(h.a,{container:!0,key:e.id,className:a.message,justify:"flex-start",style:{padding:0}},r.a.createElement(I.a,{style:{flex:1,padding:10}},e.title),r.a.createElement(q.a,{style:{padding:10},onClick:function(){return t=e.id,void d.firestore().collection("notifications").doc(t).update({shown:!0});var t},size:"small"},"\u0441\u043a\u0440\u044b\u0442\u044c"))})):r.a.createElement(I.a,{className:a.message,align:"center",style:{padding:10}},"\u041d\u0435\u0442 \u043d\u043e\u0432\u044b\u0445 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0439")))),b?r.a.createElement("div",null,r.a.createElement("span",{style:{color:"black",fontSize:12,marginLeft:7}},b.email),r.a.createElement(q.a,{style:{borderColor:"black",color:"black",marginLeft:10,fontSize:12},variant:"outlined",size:"small",onClick:function(){return d.auth().signOut()}},"\u0412\u044b\u0445\u043e\u0434")):r.a.createElement(q.a,{style:{borderColor:"black",color:"black",marginLeft:10,fontSize:12},size:"small",variant:"outlined",onClick:u},"\u0432\u0445\u043e\u0434"))),r.a.createElement("nav",{className:a.drawer,"aria-label":"mailbox folders"},r.a.createElement(k.a,{smUp:!0,implementation:"css"},r.a.createElement(y.a,{container:fe,variant:"temporary",anchor:"rtl"===c.direction?"right":"left",open:l,onClose:N,classes:{paper:a.drawerPaper},ModalProps:{keepMounted:!0}},de)),r.a.createElement(k.a,{xsDown:!0,implementation:"css"},r.a.createElement(y.a,{classes:{paper:a.drawerPaper},variant:"permanent",open:!0},de))),r.a.createElement("main",{className:a.content},r.a.createElement("div",{className:a.toolbar}),e.children))},N=a(894),z=a(909),L=a(268),M=a.n(L),G=a(895),V=a(899),H=a(897),K=a(898),Q=a(896),J=a(913),X=a(892),Y=a(893),Z=a(799),$=function(e){var t=Object(n.useState)(null),a=Object(i.a)(t,2),c=a[0],o=a[1],s=Object(n.useState)(""),l=Object(i.a)(s,2),u=l[0],d=l[1],f=e.returnAnswer;return r.a.createElement("div",null,r.a.createElement("h4",null,e.title),r.a.createElement(Z.a,{const:"fieldset",style:{paddingBottom:15}},r.a.createElement(X.a,{"aria-label":e.title,name:e.title,value:c,onChange:function(e){o(e.target.value),f({reason:e.target.value,text:u})}},e.answers.map((function(t,a){return r.a.createElement(Y.a,{key:a,value:t,control:r.a.createElement(J.a,{color:"primary"}),label:t,disabled:!!e.locked})})))),r.a.createElement(N.a,{id:"feedback_input",label:"\u041f\u0440\u0438\u043c\u0435\u0447\u0430\u043d\u0438\u0435",value:u,onChange:function(e){d(e.target.value),f({reason:c,text:e.target.value})},multiline:!0,rows:5,variant:"outlined",fullWidth:!0}))};function ee(e){return r.a.createElement("div",null,r.a.createElement(G.a,{open:e.state,onClose:e.handleClose,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},r.a.createElement(Q.a,{id:"alert-dialog-title"},e.title),r.a.createElement(H.a,null,r.a.createElement(K.a,{id:"alert-dialog-description"},r.a.createElement(I.a,null,e.description),r.a.createElement($,{answers:e.answers,returnAnswer:e.returnFeedback}))),r.a.createElement(V.a,null,r.a.createElement(q.a,{onClick:e.handleClose,color:"primary"},"\u041e\u0442\u043c\u0435\u043d\u0430"),r.a.createElement(q.a,{onClick:e.dialogFunction,disabled:!e.feedbackValue.reason,color:"primary",autoFocus:!0},"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"))))}var te=a(11),ae=a.n(te),ne=a(15),re=a(901),ce=(a(385),a(386),a(900)),oe=function(e){return r.a.createElement(z.a,{display:"flex",alignItems:"center"},r.a.createElement(z.a,{width:"100%",mr:1},r.a.createElement(ce.a,Object.assign({variant:"determinate"},e))),r.a.createElement(z.a,{minWidth:35},r.a.createElement(I.a,{variant:"body2",color:"textSecondary"},"".concat(Math.round(e.value),"%"))))},ie=Object(D.a)((function(e){return{root:{"& > *":{width:"40ch"}}}})),se=function(e){ie();var t=r.a.useState(""),a=Object(i.a)(t,2),c=(a[0],a[1],Object(n.useState)(!1)),o=Object(i.a)(c,2),s=(o[0],o[1],Object(n.useState)({})),l=Object(i.a)(s,2),u=(l[0],l[1],Object(n.useState)({})),f=Object(i.a)(u,2),m=(f[0],f[1]),p=Object(n.useState)(!1),b=Object(i.a)(p,2),h=(b[0],b[1]),g=e.returnFile,j=(e.locked,e.id),O=e.feedbackType,E=e.askFeedback;e.saveQuestionFeedback,e.prevTaskId;Object(n.useEffect)((function(){console.log(O),O&&E?(console.log(O),d.firestore().collection("schema").doc("structure").collection("feedbacks").doc(O).get().then((function(e){m(e.data())})),h(!0)):h(!1)}),[O]);return r.a.createElement("div",null,r.a.createElement("input",{type:"file",onChange:function(e){g(e.target.files,j)},multiple:!0}))},le=Object(D.a)((function(e){return{root:{"& > *":{width:"40ch"}}}})),ue=Object(n.forwardRef)((function(e,t){le();var a=r.a.useState(""),c=Object(i.a)(a,2),o=c[0],s=c[1],l=Object(n.useState)(!1),u=Object(i.a)(l,2),f=u[0],m=u[1],p=Object(n.useState)(null),b=Object(i.a)(p,2),h=(b[0],b[1],Object(n.useState)({})),g=Object(i.a)(h,2),j=g[0],O=g[1],E=Object(n.useState)({}),v=Object(i.a)(E,2),y=v[0],k=v[1],w=Object(n.useState)(!1),S=Object(i.a)(w,2),x=S[0],C=S[1],q=e.index,D=e.response,F=e.returnFile,T=e.locked,U=e.id,P=e.feedbackType,R=e.askFeedback,B=e.saveQuestionFeedback,W=e.prevTaskId,A=(e.uploadFilesData,e.attachMaterials);Object(n.useEffect)((function(){D&&s(D)}),[D]),Object(n.useEffect)((function(){P&&R?(console.log(P),d.firestore().collection("schema").doc("structure").collection("feedbacks").doc(P).get().then((function(e){k(e.data())})),C(!0)):C(!1)}),[P]);var L=function(){m(!1)};return r.a.createElement("div",null,r.a.createElement(ee,{title:y.title,dialogFunction:function(){B(j,U,W),L()},state:f,handleClose:L,feedbackValue:j,answers:y.answers,description:y.description,returnFeedback:function(e){O(e)}}),r.a.createElement(z.a,{display:"flex",style:{marginBottom:10,marginTop:20}},r.a.createElement(I.a,{variant:"h6",style:{paddingRight:8}},e.title),x&&r.a.createElement(_.a,{size:"small",onClick:function(){return m(!0)}},r.a.createElement(M.a,{color:"primary"}))),r.a.createElement(N.a,{id:"inputBox"+q,label:"\u041c\u043e\u0439 \u043e\u0442\u0432\u0435\u0442",value:o,onChange:function(t){s(t.target.value),e.returnAnswer(t.target.value,e.index)},multiline:!0,rows:5,disabled:T,variant:"outlined",fullWidth:!0}),!T&&A&&r.a.createElement(se,{returnFile:F,locked:T,id:U}))})),de=a(802),fe=a(918),me=a(808),pe=Object(D.a)((function(e){return{formControl:{minWidth:100,maxWidth:300}}}));function be(e){var t=pe(),a=r.a.useState(""),c=Object(i.a)(a,2),o=c[0],s=c[1],l=r.a.useState(!1),u=Object(i.a)(l,2),d=u[0],f=u[1],m=e.index,p=e.response,b=(e.required,e.locked);Object(n.useEffect)((function(){p&&s(p)}),[p]);return r.a.createElement("div",null,r.a.createElement(I.a,{variant:"h6",style:{marginBottom:5,marginTop:20}},e.title),r.a.createElement(Z.a,{className:t.formControl,disabled:b},r.a.createElement(de.a,{id:"controlled-open-select-label"},"\u0412\u044b\u0431\u0440\u0430\u0442\u044c"),r.a.createElement(me.a,{labelId:"controlled-open-select-label",id:"select"+m,open:d,onClose:function(e){f(!1)},onOpen:function(e){f(!0)},value:o,onChange:function(t){s(t.target.value);e.answers.indexOf(t.target.value);e.returnAnswer(t.target.value,m)}},r.a.createElement(fe.a,{value:""},r.a.createElement("em",null,"None")),e.answers.map((function(e,t){return r.a.createElement(fe.a,{key:t,value:e},e)})))))}function he(e){var t=r.a.useState(""),a=Object(i.a)(t,2),c=a[0],o=a[1],s=e.index,l=e.response;Object(n.useEffect)((function(){l&&o(l)}),[l]);return r.a.createElement("div",null,r.a.createElement("h4",null,e.title),r.a.createElement(Z.a,{const:"fieldset"},r.a.createElement(X.a,{"aria-label":e.title,name:e.title,value:c,onChange:function(t){o(t.target.value);var a=e.answers.indexOf(t.target.value);e.returnAnswer(t.target.value,s,a)}},e.answers.map((function(t,a){return r.a.createElement(Y.a,{key:a,value:t,control:r.a.createElement(J.a,{color:"primary"}),label:t,disabled:!!e.locked})})))))}var ge=Object(D.a)((function(e){return{container:{display:"flex",flexWrap:"wrap"},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:"auto"}}}));function je(e){var t=ge(),a=r.a.useState(""),c=Object(i.a)(a,2),o=c[0],s=c[1],l=e.index,u=e.response;Object(n.useEffect)((function(){u&&s(u)}),[l,u]);return r.a.createElement("div",null,r.a.createElement("h4",null,e.title),r.a.createElement("form",{className:t.container,noValidate:!0},r.a.createElement(N.a,{id:"time"+l,label:"\u0412\u0440\u0435\u043c\u044f",type:"time",value:o,onChange:function(t){s(t.target.value),e.returnAnswer(t.target.value,l,t.target.value)},className:t.textField,InputLabelProps:{shrink:!0},InputProps:{disableUnderline:!0},disabled:!!e.locked})))}var Oe=a(803),Ee=a(800),ve=a(915);function ye(e){var t=r.a.useState({}),a=Object(i.a)(t,2),c=a[0],o=a[1],s=Object(n.useState)(!1),l=Object(i.a)(s,2),u=l[0],d=l[1],f=e.index,m=e.answers,p=(e.required,e.response),b=e.locked;Object(n.useEffect)((function(){if(p){o(p);var t={};m.forEach((function(e,a){p[e]?t[e]=p[e]:t[e]=!1})),o(t),e.returnAnswer(t,f)}else{var a={};m.forEach((function(e,t){return a[e]=!1})),e.returnAnswer(a,f)}d(!0),console.log(c)}),[p,m]);var h=function(t){o(Object(g.a)(Object(g.a)({},c),{},Object(j.a)({},t.target.name,t.target.checked))),e.returnAnswer(Object(g.a)(Object(g.a)({},c),{},Object(j.a)({},t.target.name,t.target.checked)),f)};return u?r.a.createElement("div",null,r.a.createElement(I.a,{variant:"h6",style:{marginBottom:0,marginTop:20}},e.title),r.a.createElement(Z.a,{component:"fieldset",disabled:b},r.a.createElement(Oe.a,{component:"legend"},"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u0438\u043d \u0438\u043b\u0438 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u043e\u0432"),r.a.createElement(Ee.a,null,m.map((function(e,t){return r.a.createElement(Y.a,{key:t,control:r.a.createElement(ve.a,{checked:c[e],onChange:h,name:e}),label:e})}))))):null}var ke=function(){var e=Object(n.useState)([]),t=Object(i.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)({}),s=Object(i.a)(o,2),l=s[0],m=s[1],p=Object(n.useState)([]),j=Object(i.a)(p,2),O=j[0],E=j[1],v=Object(n.useState)(!1),y=Object(i.a)(v,2),k=y[0],_=y[1],w=Object(n.useState)(!1),S=Object(i.a)(w,2),x=S[0],C=S[1],D=Object(n.useState)({}),F=Object(i.a)(D,2),T=(F[0],F[1]),U=Object(n.useContext)(f).currentUser;Object(n.useEffect)((function(){var e={};U&&d.firestore().collection("users").doc(U.uid).get().then((function(t){T(t.data()),e=t.data()})).then((function(){d.firestore().collection("profileTemplate").doc("Template").get().then((function(t){console.log(JSON.stringify(t.data())),c(t.data().questions),console.log(t.data().questions);var a=t.data().questions.map((function(t,a){var n=null;return e[t.key]&&(console.log(e[t.key]),n=e[t.key]),"input"===t.type?r.a.createElement(ue,{key:"profile_"+a,index:a,title:t.question,response:n,returnAnswer:P,required:t.required}):"select"===t.type?r.a.createElement(be,{key:"profile_"+a,index:a,title:t.question,response:n,answers:t.answers,returnAnswer:P,required:t.required}):"radio"===t.type?r.a.createElement(he,{key:"profile_"+a,index:a,title:t.question,response:n,answers:t.answers,returnAnswer:P,required:t.required}):"time"===t.type?r.a.createElement(je,{key:"profile_"+a,index:a,title:t.question,response:n,returnAnswer:P,required:t.required}):"checkbox"===t.type?r.a.createElement(ye,{key:"profile_"+a,index:a,title:t.question,response:n,answers:t.answers,returnAnswer:P,required:t.required}):null}));E(a)}))}))}),[U]);var P=function(e,t){var a=l;a[t]=e,m(a),console.log(l)};return U?r.a.createElement(h.a,{style:{padding:30}},x&&r.a.createElement(b.a,{to:"/"}),O,r.a.createElement(h.a,{container:!0,style:{padding:20},justify:"center"},r.a.createElement(q.a,{variant:"outlined",style:{borderWidth:2,borderColor:"#003366",color:"#003366",margin:10},onClick:function(){var e={};a.forEach((function(t,a){l[a]&&(e[t.key]=l[a])})),d.firestore().collection("users").doc(U.uid).update(Object(g.a)({},e)).then((function(){return _(!0)}))}},"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"),k&&r.a.createElement(q.a,{variant:"outlined",style:{borderWidth:2,borderColor:"red",color:"red",margin:10},onClick:function(){return C(!0)}},"\u041d\u0430 \u0433\u043b\u0430\u0432\u043d\u0443\u044e"))):r.a.createElement(h.a,{container:!0,direction:"column",style:{padding:20},justify:"center"},r.a.createElement(I.a,{align:"center",variant:"h3"},"\u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044c"),r.a.createElement("br",null),r.a.createElement(q.a,{variant:"contained",onClick:u},"\u0412\u043e\u0439\u0442\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google"))},_e=a(122),we=a(278),Se=a(911),xe=a(905),Ce=a(902),qe=a(904),Ie=a(903),De=Object(D.a)({root:{minWidth:250},bullet:{display:"inline-block",margin:"0 2px"},title:{fontSize:14},pos:{marginBottom:12}}),Fe=function(e){var t=De(),a=e.title,c=e.complete,o=e.type,s=(e.language,e.description),l=e.id,u=e.cardColor,d=e.sendRequest,f=e.disabled,m=Object(n.useState)(!1),p=Object(i.a)(m,2),h=p[0],g=p[1];return r.a.createElement("div",null,h&&r.a.createElement(b.a,{to:"/tasks/"+l}),r.a.createElement(Ce.a,{className:t.root,style:{background:u}},r.a.createElement(Ie.a,null,r.a.createElement(z.a,{display:"flex",justifyContent:"space-between",alignItems:"center"},r.a.createElement(I.a,{variant:"h6"},a),c&&r.a.createElement(I.a,{color:"error"},"\u0421\u0434\u0430\u043d\u043e")),r.a.createElement(I.a,{variant:"subtitle1",className:t.pos,color:"textSecondary"},"#",o),r.a.createElement(I.a,{variant:"body2",component:"p"},"\u0417\u0430\u0434\u0430\u043d\u0438\u0435: ",s)),r.a.createElement(qe.a,null,d?r.a.createElement(q.a,{variant:"contained",disabled:f,color:"primary",size:"small",onClick:function(){return d(o,l)}},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435"):r.a.createElement(q.a,{size:"small",onClick:function(){return g(!0)}},"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"))))};function Te(e){var t=e.children,a=e.value,n=e.index,c=Object(_e.a)(e,["children","value","index"]);return r.a.createElement("div",Object.assign({role:"tabpanel",hidden:a!==n,id:"full-width-tabpanel-".concat(n),"aria-labelledby":"full-width-tab-".concat(n)},c),a===n&&r.a.createElement(z.a,{p:3},r.a.createElement(I.a,null,t)))}function Ue(e){return{id:"full-width-tab-".concat(e),"aria-controls":"full-width-tabpanel-".concat(e)}}var Pe=Object(D.a)({root:{paddingTop:30,flexGrow:1}}),Re=function(e){var t=Pe(),a=Object(n.useState)(null),c=Object(i.a)(a,2),o=c[0],s=c[1],l=Object(n.useState)(null),u=Object(i.a)(l,2),m=u[0],p=u[1],b=Object(n.useState)(null),j=Object(i.a)(b,2),O=(j[0],j[1],Object(n.useContext)(f).currentUser),E=Object(n.useState)(0),v=Object(i.a)(E,2),y=v[0],k=v[1];Object(n.useEffect)((function(){if(O){var e=[],t=[];console.log("Fired"),d.firestore().collection("tasks").where("assigned_users","array-contains",O.uid).get().then((function(a){a.forEach((function(a){console.log(a.id," => ",a.data()),a.data().is_complete?t.push(Object(g.a)({id:a.id},a.data())):e.push(Object(g.a)({id:a.id},a.data()))}))})).then((function(){s(e),p(t)})).catch((function(e){console.log("Error getting documents: ",e)}))}}),[O]);return r.a.createElement(h.a,{container:!0,justify:"center",alignItems:"center",direction:"column"},r.a.createElement("div",{className:t.root},r.a.createElement(we.a,{position:"static",color:"default"},r.a.createElement(Se.a,{value:y,onChange:function(e,t){k(t)},variant:"fullWidth",centered:!0,"aria-label":"simple tabs example"},r.a.createElement(xe.a,Object.assign({label:"\u041d\u0435\u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435"},Ue(0))),r.a.createElement(xe.a,Object.assign({label:"\u0412\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435"},Ue(1)))))),r.a.createElement(Te,{value:y,index:0},o&&o.map((function(e,t){return r.a.createElement(h.a,{key:"active_task_"+t,style:{padding:10}},r.a.createElement(Fe,{title:e.title,complete:e.is_complete,description:e.description,type:e.type,id:e.id}))}))),r.a.createElement(Te,{value:y,index:1},m&&m.map((function(e,t){return r.a.createElement(h.a,{key:"submitted_task_"+t,style:{padding:10}},r.a.createElement(Fe,{title:e.title,complete:e.is_complete,description:e.description,type:e.type,id:e.id}))}))))},Be=a(27);var We=function(e){var t=e.title;return r.a.createElement("div",null,r.a.createElement(I.a,{variant:"h6",style:{marginBottom:0,marginTop:20}},t))},Ae=Object(n.forwardRef)((function(e,t){var a=e.question,n=e.index,c=e.response,o=e.uploadsRef,i=e.returnAnswer,s=e.locked,l=e.askFeedback,u=e.saveQuestionFeedback,d=e.id,f=e.prevTaskId,m=e.returnFile,p=e.uploadFilesData;return"input"===a.type?r.a.createElement(ue,{key:n,index:n,title:a.title,response:c,returnAnswer:i,required:a.required,locked:s,askFeedback:l,feedbackType:a.feedback_type,saveQuestionFeedback:u,id:d,prevTaskId:f,uploadFilesData:p,uploadsRef:o,returnFile:m,attachMaterials:a.attachMaterials}):"select"===a.type?r.a.createElement(be,{key:n,index:n,title:a.title,response:c,answers:a.answers,returnAnswer:i,required:a.required,locked:s}):"radio"===a.type?r.a.createElement(he,{key:n,index:n,title:a.title,response:c,answers:a.answers,returnAnswer:i,required:a.required,locked:s}):"time"===a.type?r.a.createElement(je,{key:n,index:n,title:a.title,response:c,returnAnswer:i,required:a.required,locked:s}):"checkbox"===a.type?r.a.createElement(ye,{key:n,index:n,title:a.title,response:c,answers:a.answers,returnAnswer:i,required:a.required,locked:s}):"text"===a.type?r.a.createElement(We,{key:n,title:a.title}):"file"===a.type?r.a.createElement(se,{key:n,index:n,id:d,title:a.title,returnFile:m,locked:s,askFeedback:l,feedbackType:a.feedback_type,saveQuestionFeedback:u,prevTaskId:f}):null}));function Ne(e){return r.a.createElement("div",null,r.a.createElement(G.a,{open:e.state,onClose:e.handleClose,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},r.a.createElement(Q.a,{id:"alert-dialog-title"},e.title),r.a.createElement(H.a,null,r.a.createElement(K.a,{id:"alert-dialog-description"},e.content)),e.hideActions?"":e.showOk?r.a.createElement(V.a,null,r.a.createElement(q.a,{onClick:e.handleOk,color:"primary"},"Ok")):r.a.createElement(V.a,null,r.a.createElement(q.a,{onClick:e.handleClose,color:"primary"},"\u041e\u0442\u043c\u0435\u043d\u0430"),r.a.createElement(q.a,{onClick:e.dialogFunction,color:"primary",autoFocus:!0},"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"))))}var ze=a(916),Le=a(198),Me=a.n(Le),Ge=function(){var e=Object(n.useState)([]),t=Object(i.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)([]),s=Object(i.a)(o,2),l=(s[0],s[1]),m=Object(n.useState)({}),p=Object(i.a)(m,2),j=p[0],O=p[1],E=Object(n.useState)([]),v=Object(i.a)(E,2),y=v[0],k=v[1],w=Object(n.useState)(!1),S=Object(i.a)(w,2),x=S[0],C=S[1],D=Object(n.useState)(!1),F=Object(i.a)(D,2),T=F[0],U=(F[1],Object(n.useState)({})),P=Object(i.a)(U,2),R=(P[0],P[1],Object(n.useState)(!1)),B=Object(i.a)(R,2),W=B[0],A=B[1],N=Object(n.useState)([]),z=Object(i.a)(N,2),L=(z[0],z[1]),M=Object(n.useState)(!1),G=Object(i.a)(M,2),V=G[0],H=G[1],K=Object(n.useState)(null),Q=Object(i.a)(K,2),J=Q[0],X=Q[1],Y=Object(n.useState)({}),Z=Object(i.a)(Y,2),$=Z[0],te=Z[1],ce=Object(n.useState)({}),oe=Object(i.a)(ce,2),ie=oe[0],se=oe[1],le=Object(n.useState)(!1),ue=Object(i.a)(le,2),de=ue[0],fe=ue[1],me=Object(n.useState)({}),pe=Object(i.a)(me,2),be=pe[0],he=pe[1],ge=Object(n.useState)(!1),je=Object(i.a)(ge,2),Oe=je[0],Ee=je[1],ve=Object(n.useContext)(f).currentUser,ye=Object(b.h)().id,ke=Object(b.g)(),_e=function(e,t){"clickaway"!==t&&fe(!1)};Object(n.useEffect)((function(){var e=function(){var e=Object(ne.a)(ae.a.mark((function e(t){var a;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],e.next=3,d.firestore().collection("tasks").doc(t).collection("questions").get().then((function(e){e.forEach((function(e){a.push({questionId:e.id,data:e.data()})}))})).catch((function(e){console.log("Error getting documents: ",e)}));case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t=function(){var e=Object(ne.a)(ae.a.mark((function e(t){var a;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],e.next=3,d.firestore().collection("tasks").doc(t).collection("responses").get().then((function(e){e.forEach((function(e){a.push({responseId:e.id,data:e.data()})}))})).catch((function(e){console.log("Error getting documents: ",e)}));case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a=function(){var e=Object(ne.a)(ae.a.mark((function e(){var t;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,d.firestore().collection("tasks").doc(ye).get().then((function(e){return e.data()})).then(function(){var e=Object(ne.a)(ae.a.mark((function e(a){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.firestore().collection("tasks").where("case_id","==",a.case_id).get().then((function(e){e.forEach((function(e){e.id!==ye&&t.push(Object(g.a)({id:e.id},e.data()))}))}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();ve&&function(){var n=Object(ne.a)(ae.a.mark((function n(){var o,i,s,u,f,m,p,b,h,g,j;return ae.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=[],i=!0,k(null),n.next=5,d.firestore().collection("tasks").doc(ye).collection("user_editable").doc("user_editable").get().then((function(e){"complete"===e.data().status?(i=!0,A(!0)):i=!1}));case 5:return s=[],u=[],n.next=9,a();case 9:if(f=n.sent,L(f),!(f.length>0)){n.next=21;break}return m=f.map((function(t){return e(t.id)})),p=f.map((function(e){return t(e.id)})),console.log(m),n.next=17,Promise.all(m).then((function(e){return e.forEach((function(e){return s.push.apply(s,Object(Be.a)(e))}))}));case 17:return n.next=19,Promise.all(p).then((function(e){return e.forEach((function(e){return u.push.apply(u,Object(Be.a)(e))}))}));case 19:console.log(s),console.log(u);case 21:return(b=s.map((function(e,t){var a=null;return u.forEach((function(n){e.questionId===n.responseId&&(a=n.data.answer,we(n.data.answer,t))})),r.a.createElement(Ae,{key:e.questionId+"_"+t,question:e.data,index:t,response:a,returnAnswer:we,locked:!0,askFeedback:!0,saveQuestionFeedback:Ce,id:e.questionId,prevTaskId:f[0].id})}))).push(r.a.createElement("div",{key:"div_divider_stripped",style:{height:25,margin:"20px 0",background:"repeating-linear-gradient( 45deg, white, white 10px, grey 10px, grey 25px)"}},r.a.createElement("br",null))),n.next=25,e(ye);case 25:return h=n.sent,n.next=28,t(ye);case 28:g=n.sent,c(h),l(g),o=h.map((function(e,t){var a=null;return g.forEach((function(n){e.questionId===n.responseId&&(a=n.data.answer,we(n.data.answer,t))})),r.a.createElement(Ae,{key:e.questionId+"_"+t,question:e.data,index:t,response:a,returnFile:Se,returnAnswer:we,id:e.questionId,locked:i,uploadFilesData:Ie})})),j=b.concat(o),k(j);case 34:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}()()}),[ve,ye,W]);var we=function(e,t){var a=j;a[t]=e,O(a)},Se=function(e,t){var a=Object(Be.a)(e),n=be;n[t]=a,he(n),console.log(Object(Be.a)(e),t)},xe=function(){var e=Object(ne.a)(ae.a.mark((function e(){var t,a,n;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Object.keys(be).length>0)){e.next=12;break}console.log("files"),Ee(!0),t=ae.a.mark((function e(){var t,r,c,o;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(i.a)(n[a],2),r=t[0],c=t[1],o=d.storage().ref(ye).child(r).child(ve.uid),e.next=4,Promise.all(c.map(function(){var e=Object(ne.a)(ae.a.mark((function e(t){var a,n,c;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.child(t.name).put(t);case 2:return a=e.sent,e.next=5,a.ref.getDownloadURL();case 5:return n=e.sent,c=n.split("?")[0],e.next=9,Ie(t.name,c,r);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:case"end":return e.stop()}}),e)})),a=0,n=Object.entries(be);case 5:if(!(a<n.length)){e.next=10;break}return e.delegateYield(t(),"t0",7);case 7:a++,e.next=5;break;case 10:C(!0),Ee(!1);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ce=function(e,t,a){a?d.firestore().collection("tasks").doc(a).collection("feedbacks").doc(t).collection("messages").add({answer:e.reason,text:e.text,user_id:ve.uid,timestamp:d.firestore.FieldValue.serverTimestamp()}).then((function(){return fe(!0)})):alert("\u041e\u0448\u0438\u0431\u043a\u0430: \u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a \u043f\u0440\u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0438 \u0444\u0438\u0434\u0431\u0435\u043a\u0430. \u0421\u043e\u043e\u0431\u0449\u0438\u0442\u0435 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0441\u0442\u0443!")},qe=function(){var e=Object(ne.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xe();case 2:if(a.forEach(function(){var e=Object(ne.a)(ae.a.mark((function e(t,a){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!j[a]&&""!==j[a]){e.next=3;break}return e.next=3,d.firestore().collection("tasks").doc(ye).collection("responses").doc(t.questionId).set({answer:j[a]},{merge:!0});case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),!t){e.next=9;break}return e.next=6,d.firestore().collection("tasks").doc(ye).collection("user_editable").doc("user_editable").update({status:"complete"});case 6:A(!0),console.log("Task Locked"),H(!1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ie=function(){var e=Object(ne.a)(ae.a.mark((function e(t,a,n){var r;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=d.firestore().collection("tasks").doc(ye).collection("responses").doc(n),console.log("\u0424\u0430\u0439\u043b \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d"),t&&a&&r.set({files:d.firestore.FieldValue.arrayUnion({public_url:a,filename:t})},{merge:!0}).then((function(){return console.log("super")}));case 3:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),De=function(){H(!1),te({})},Fe=function(e){"send"===e&&(X("send"),H(!0)),"release"===e&&(X("release"),H(!0))};Object(n.useEffect)((function(){d.firestore().collection("schema").doc("structure").collection("feedbacks").doc("release").get().then((function(e){se(e.data())}))}),[]);return ve?r.a.createElement(h.a,{style:{padding:30}},"send"===J&&r.a.createElement(Ne,{state:V,handleClose:De,hideActions:Oe||x,title:Oe?"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0444\u0430\u0439\u043b\u043e\u0432":x?"\u0424\u0430\u0439\u043b\u044b \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u044b":"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435?",content:Oe?r.a.createElement(re.a,null):x?"\u0421\u043f\u0430\u0441\u0438\u0431\u043e":"\u0412\u044b \u0441\u043e\u0431\u0438\u0440\u0430\u0435\u0442\u0435\u0441\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435. \u042d\u0442\u043e \u0437\u043d\u0430\u0447\u0438\u0442, \u0447\u0442\u043e \u0432\u044b \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u0441\u043c\u043e\u0436\u0435\u0442\u0435 \u0438\u0437\u043c\u0435\u043d\u044f\u0442\u044c \u043e\u0442\u0432\u0435\u0442\u044b.",dialogFunction:function(){return qe(!0)}}),"release"===J&&r.a.createElement(ee,{state:V,feedbackValue:$,handleClose:De,title:ie.title,dialogFunction:function(){d.firestore().collection("tasks").doc(ye).collection("user_editable").doc("user_editable").update({status:"open"}).then((function(){return d.firestore().collection("tasks").doc(ye).collection("user_editable").doc("user_editable").update({status:"released",release_status:$.reason,release_description:$.text}).then((function(){H(!1),A(!0)}))}))},answers:ie.answers,description:ie.description,returnFeedback:function(e){te(e)}}),T&&r.a.createElement(b.a,{to:"/tasks"}),r.a.createElement(ze.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:de,autoHideDuration:6e3,onClose:_e,message:"\u0424\u0438\u0434\u0431\u0435\u043a \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d",action:r.a.createElement(r.a.Fragment,null,r.a.createElement(_.a,{size:"small","aria-label":"close",color:"inherit",onClick:_e},r.a.createElement(Me.a,{fontSize:"small"})))}),y,r.a.createElement(h.a,{container:!0,style:{padding:20},justify:"center"},r.a.createElement(q.a,{variant:"outlined",style:{borderWidth:2,borderColor:"grey",color:"grey",margin:5},onClick:function(){return ke.goBack()}},"\u041d\u0430\u0437\u0430\u0434"),!W&&r.a.createElement("div",null,r.a.createElement(q.a,{variant:"outlined",disabled:W,style:{borderWidth:2,borderColor:"#003366",color:"#003366",margin:5},onClick:function(){return qe(!1)}},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"),r.a.createElement(q.a,{variant:"outlined",disabled:W,style:{borderWidth:2,borderColor:"red",color:"red",margin:5},onClick:function(){return Fe("send")}},"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"),r.a.createElement(q.a,{variant:"outlined",disabled:W,style:{borderWidth:2,borderColor:"red",color:"red",margin:5},onClick:function(){return Fe("release")}},"\u041e\u0441\u0432\u043e\u0431\u043e\u0434\u0438\u0442\u044c")))):r.a.createElement(h.a,{container:!0,direction:"column",style:{padding:20},justify:"center"},r.a.createElement(I.a,{align:"center",variant:"h3"},"\u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044c"),r.a.createElement("br",null),r.a.createElement(q.a,{variant:"contained",onClick:u},"\u0412\u043e\u0439\u0442\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google"))},Ve=a(269),He=function(e){var t=e.caseId,a=e.userRanks,c=Object(n.useState)(null),o=Object(i.a)(c,2),s=o[0],l=o[1],u=Object(n.useState)(!1),m=Object(i.a)(u,2),p=m[0],b=m[1],j=Object(n.useContext)(f).currentUser,O=r.a.useState(!1),E=Object(i.a)(O,2),v=E[0],y=E[1],k=Object(n.useState)(!1),w=Object(i.a)(k,2),S=w[0],x=w[1],C=Object(n.useState)(""),q=Object(i.a)(C,2),D=q[0],F=q[1],T=function(e,t){"clickaway"!==t&&y(!1)};Object(n.useEffect)((function(){if(j){var e=[];console.log("Fired"),d.firestore().collection("schema").doc("structure").collection("cases").doc(t).collection("stages").get().then((function(t){t.forEach((function(t){var n=t.data().ranks;console.log("RANKS"),console.log(n),console.log(a),e.push(Object(g.a)(Object(g.a)({id:t.id},t.data()),{},{disabled:!1}))}))})).then((function(){e.sort((function(e,t){return parseInt(e.order)-parseInt(t.order)})),l(e),b(!0)})).catch((function(e){console.log("Error getting documents: ",e)}))}}),[j]),Object(n.useEffect)((function(){j&&d.firestore().collection("tasks").where("assigned_users","array-contains",j.uid).where("is_complete","==",!1).get().then((function(e){e.size<3?(console.log("SIZE",e.size),x(!1)):(x(!0),F(r.a.createElement(I.a,{color:"error"},"\u0423 \u0432\u0430\u0441 \u0435\u0441\u0442\u044c \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0435 \u0437\u0430\u0434\u0430\u043d\u0438\u044f. \u0421\u0434\u0430\u0439\u0442\u0435 \u0438\u043b\u0438 \u043e\u0441\u0432\u043e\u0431\u043e\u0434\u0438\u0442\u0435 \u0438\u0445, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043d\u043e\u0432\u044b\u0435.")))}))}),[j,S,v]);var U=function(e,a){d.firestore().collection("task_requests").doc(j.uid).collection("requests").add({taskType:e,status:"pending",user:j.uid,case_type:t,case_stage_id:a}).then((function(e){y(!0),console.log("sending request")}))};return r.a.createElement("div",null,r.a.createElement(ze.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:v,autoHideDuration:6e3,onClose:T,message:"\u0417\u0430\u043f\u0440\u043e\u0441 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d",action:r.a.createElement(r.a.Fragment,null,r.a.createElement(_.a,{size:"small","aria-label":"close",color:"inherit",onClick:T},r.a.createElement(Me.a,{fontSize:"small"})))}),r.a.createElement(we.a,{style:{margin:"20px 5px",border:"1px grey solid"}},r.a.createElement(z.a,{style:{padding:"10px 20px 0px"}},r.a.createElement(z.a,{style:{padding:"5px 10px 10px"}},r.a.createElement(I.a,{variant:"h6"},e.title)),r.a.createElement(z.a,{style:{padding:"10px 10px 5px"}},r.a.createElement(I.a,{variant:"body2"},e.description)),r.a.createElement(z.a,{style:{padding:"10px 10px 0px"}},D)),r.a.createElement(h.a,{container:!0,justify:"center",style:{padding:10}},p&&s.map((function(e,t){return r.a.createElement(h.a,{item:!0,key:t,style:{padding:10}},r.a.createElement(Fe,{title:e.title,description:e.description,type:e.type,id:e.id,cardColor:"#F5F5F5",sendRequest:U,disabled:S||e.disabled}))})))))},Ke=function(){var e=Object(n.useContext)(f).currentUser,t=Object(n.useState)([]),a=Object(i.a)(t,2),c=a[0],o=a[1],s=Object(n.useState)(!1),l=Object(i.a)(s,2),u=l[0],m=l[1],p=Object(n.useState)([]),b=Object(i.a)(p,2),h=b[0],j=b[1];Object(n.useEffect)((function(){e&&d.firestore().collection("users").doc(e.uid).collection("user_private").doc("private").get().then((function(e){if(e&&e.exists){var t=e.data().ranks;console.log(t),j(t),O(t)}}))}),[e]);var O=function(e){var t=[];console.log("Fired"),d.firestore().collection("schema").doc("structure").collection("cases").where("ranks","array-contains-any",e).get().then((function(e){e.forEach((function(e){console.log(e.data()),t.push(Object(g.a)({id:e.id},e.data()))}))})).then((function(){o(t),m(!0)})).catch((function(e){console.log("Error getting documents: ",e)}))};return r.a.createElement("div",null,u&&c.map((function(e,t){return e.hide?null:r.a.createElement(He,{key:t,title:e.title,description:e.description,caseId:e.id,userRanks:h})})))},Qe=Object(D.a)((function(e){return{root:Object(j.a)({margin:20,width:500},e.breakpoints.down("sm"),{maxWidth:300}),bullet:{display:"inline-block",margin:"0 2px"},title:{fontSize:14},pos:{marginBottom:12}}})),Je=function(e){var t,a=Qe(),n=e.title,c=e.description,o=e.id,i=e.setShown,s=e.shown,l=e.date;return r.a.createElement(h.a,{container:!0,justify:"center"},r.a.createElement(Ce.a,{className:a.root,style:s?{background:"grey",opacity:.25}:{background:"lightblue"}},r.a.createElement(Ie.a,null,r.a.createElement(I.a,{variant:"h6"},n),r.a.createElement(I.a,{variant:"body2",component:"p"},c)),r.a.createElement(qe.a,{style:{justifyContent:"space-between"}},r.a.createElement(I.a,{style:{paddingLeft:8},variant:"subtitle2"},(t=l.toDate(),"".concat(t.getDate().toString().padStart(2,"0"),"/").concat((t.getMonth()+1).toString().padStart(2,"0"),"/").concat(t.getFullYear().toString().padStart(4,"0")," ").concat(t.getHours().toString().padStart(2,"0"),":").concat(t.getMinutes().toString().padStart(2,"0"),":").concat(t.getSeconds().toString().padStart(2,"0")))),r.a.createElement(q.a,{size:"small",onClick:function(){return i(o)}},"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u043d\u043e"))))},Xe=function(){var e=Object(n.useContext)(f).currentUser,t=Object(n.useState)([]),a=Object(i.a)(t,2),c=a[0],o=a[1],s=function(e){d.firestore().collection("notifications").doc(e).update({shown:!0})};return Object(n.useEffect)((function(){if(e){var t=d.firestore().collection("notifications").where("user_id","array-contains",e.uid).onSnapshot(function(){var e=Object(ne.a)(ae.a.mark((function e(t){var a;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],t.forEach((function(e,t){a.push(Object(g.a)({id:e.id},e.data()))})),console.log(a[0].created_date.toDate()),a.sort((function(e,t){return t.created_date.toDate()-e.created_date.toDate()})),o(a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());return function(){return t()}}}),[e]),r.a.createElement("div",null,r.a.createElement(I.a,{variant:"h5",align:"center"},"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f"),c.map((function(e,t){return r.a.createElement(Je,{key:t,id:e.id,index:t,date:e.created_date,title:e.title,setShown:s,shown:e.shown,description:e.description})})))},Ye=a(387),Ze=a.n(Ye),$e=a(906),et=a(907),tt=a(476),at=Object(D.a)((function(e){return{root:Object(j.a)({marginTop:20,background:"lightgreen",width:500},e.breakpoints.down("sm"),{maxWidth:300}),message:Object(j.a)({background:"lightgreen",width:500,margin:10,padding:10},e.breakpoints.down("sm"),{maxWidth:300})}})),nt=function(e){var t=at(),a=Object(n.useState)(null),c=Object(i.a)(a,2),o=c[0],s=c[1],l=Object(n.useContext)(f).currentUser,m=Object(n.useState)(""),p=Object(i.a)(m,2),b=p[0],g=p[1],j=r.a.useState(!1),O=Object(i.a)(j,2),E=O[0],v=O[1];return Object(n.useEffect)((function(){var e=function(){return Object($e.a)().toString()+"_"+Date.now()},t=function(){},a=function(){};return l&&(t=d.firestore().collection("users").doc(l.uid).onSnapshot((function(t){var a;if(a=!(!t.exists||!t.data().tg_token)&&t.data().tg_token,console.log(a),a){console.log(a);var n=parseInt(a.substring(a.indexOf("_")+1)),r=Ze()().diff(n,"hours");if(console.log(r),r>0){var c=e();d.firestore().collection("users").doc(l.uid).update({tg_token:c}),s(c)}else s(a)}else{console.log("no token");var o=e();d.firestore().collection("users").doc(l.uid).update({tg_token:o}),s(o)}})),a=d.firestore().collection("users").doc(l.uid).collection("user_private").doc("private").onSnapshot((function(e){e.exists&&e.data().tg_id?(console.log("TGID: ",e.data().tg_id),g(e.data().tg_id)):v(!0)}))),function(){t(),a()}}),[l]),Object(n.useEffect)((function(){if(l){var e=tt.parse(window.location.search);e.rank&&(console.log(e.rank),d.firestore().collection("schema").doc("structure").collection("ranks").doc(e.rank).get().then((function(e){e.exists?(console.log("creating request"),d.firestore().collection("rank_requests").add({timestamp:d.firestore.FieldValue.serverTimestamp(),user_id:l.uid,processed:!1,rank:e.id})):console.log("no rank")})))}}),[l]),l?r.a.createElement(h.a,null,r.a.createElement(h.a,{container:!0,className:t.message},r.a.createElement(I.a,null,"\u0427\u0442\u043e\u0431\u044b \u043f\u043e\u043d\u044f\u0442\u044c, \u043a\u0430\u043a \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0431\u043e\u0442 \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0438\u0442\u0435 \u043d\u0430\u0448\u0443 ",r.a.createElement(et.a,{href:"https://www.youtube.com/watch?v=jJX5uMqqC7Q&feature=youtu.be"},"\u0432\u0438\u0434\u0435\u043e-\u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044e"),"."),r.a.createElement(I.a,null,"8 \u0430\u043f\u0440\u0435\u043b\u044f \u0441 08:00 \u0434\u043e 22:00 \u0441\u043e\u0441\u0442\u043e\u0438\u0442\u0441\u044f \u0433\u0435\u043d\u0435\u0440\u0430\u043b\u044c\u043d\u0430\u044f \u0440\u0435\u043f\u0435\u0442\u0438\u0446\u0438\u044f \u0432\u044b\u0431\u043e\u0440\u043e\u0432."),r.a.createElement(I.a,null,"\u0412\u0441\u044e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043c\u044b \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c \u0442\u043e\u043b\u044c\u043a\u043e \u0447\u0435\u0440\u0435\u0437 \u0442\u0435\u043b\u0435\u0433\u0440\u0430\u043c-\u0431\u043e\u0442.")),0===b.length?r.a.createElement(G.a,{fullWidth:!0,open:E,"aria-labelledby":"max-width-dialog-title"},r.a.createElement(Q.a,{id:"max-width-dialog-title"},r.a.createElement(I.a,{style:{paddingBottom:10},variant:"h5",align:"center"},"\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u0435 \u0431\u043e\u0442, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u043e\u0439 / \u0421\u0438\u0441\u0442\u0435\u043c\u0430\u043d\u044b \u043a\u043e\u043b\u0434\u043e\u043d\u0443\u0443 \u04af\u0447\u04af\u043d \u0431\u043e\u0442\u043a\u043e \u043a\u043e\u0448\u0443\u043b\u0443\u04a3\u0443\u0437")),r.a.createElement(H.a,null,r.a.createElement(K.a,null,r.a.createElement(h.a,{container:!0,justify:"center"},r.a.createElement(I.a,{style:{paddingBottom:10},variant:"h5",align:"center"},"\u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0441\u0432\u044f\u0437\u0430\u0442\u044c \u0441\u0432\u043e\u0439 \u0430\u043a\u043a\u0430\u0443\u043d\u0442 \u0441 \u043d\u0430\u0448\u0438\u043c \u0422\u0435\u043b\u0435\u0433\u0440\u0430\u043c-\u0431\u043e\u0442\u043e\u043c. \u0414\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043d\u0430\u0436\u043c\u0438\u0442\u0435 \u043d\u0430 \u0441\u0441\u044b\u043b\u043a\u0443 \u043d\u0438\u0436\u0435."),r.a.createElement(I.a,{style:{paddingBottom:10},variant:"h5",align:"center"},"\u0421\u0438\u0437 \u04e9\u0437\u04af\u04a3\u04af\u0437\u0434\u04af\u043d \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0443\u04a3\u0443\u0437\u0434\u0443 \u0431\u0438\u0437\u0434\u0438\u043d \u0442\u0435\u043b\u0435\u0433\u0440\u0430\u043c-\u0431\u043e\u0442\u043a\u043e \u0442\u0443\u0442\u0430\u0448\u0442\u044b\u0440\u0430 \u0430\u043b\u0430\u0441\u044b\u0437. \u0410\u043b \u04af\u0447\u04af\u043d \u0442\u04e9\u043c\u04e9\u043d\u0434\u04e9\u0433\u04af \u0448\u0438\u043b\u0442\u0435\u043c\u0435\u043d\u0438 \u0431\u0430\u0441\u044b\u04a3\u044b\u0437."),o?r.a.createElement(et.a,{variant:"h5",href:"https://telegram.me/journal_tg_bot?start="+o},"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0431\u043e\u0442 / \u0411\u043e\u0442\u043a\u043e \u0448\u0438\u043b\u0442\u0435\u043c\u0435"):r.a.createElement(I.a,{variant:"body2",align:"center"},"\u0415\u0441\u043b\u0438 \u0441\u0441\u044b\u043b\u043a\u0430 \u043d\u0435 \u0441\u043e\u0437\u0434\u0430\u043b\u0430\u0441\u044c \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 5 \u0441\u0435\u043a\u0443\u043d\u0434, \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443"),r.a.createElement(q.a,{style:{marginTop:20},size:"large",color:"primary",variant:"contained",onClick:u},"\u0412\u043e\u0439\u0442\u0438 \u0441 \u0434\u0440\u0443\u0433\u043e\u0433\u043e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430"))))):null):r.a.createElement(h.a,{container:!0,direction:"column",style:{padding:20},justify:"center"},r.a.createElement(I.a,{align:"center",variant:"h3"},"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),r.a.createElement("br",null),r.a.createElement(q.a,{size:"large",color:"primary",variant:"contained",onClick:u},"\u0412\u043e\u0439\u0442\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google"))},rt=Object(D.a)({root:{minWidth:275},bullet:{display:"inline-block",margin:"0 2px",transform:"scale(0.8)"},title:{fontSize:14},pos:{marginBottom:12}});function ct(e){var t=rt();return console.log("TEST CARD"),console.log(e),e.userInfo=={}?r.a.createElement("div",null):r.a.createElement(Ce.a,{className:t.root,variant:"outlined"},r.a.createElement(Ie.a,null,r.a.createElement(I.a,{className:t.title,color:"textSecondary",gutterBottom:!0},"id: ",e.userInfo.id),r.a.createElement(I.a,{variant:"h5",component:"h2"},e.userInfo.surname+" "+e.userInfo.name),r.a.createElement(I.a,{className:t.pos,color:"textSecondary"},"username: ",e.userInfo.username),r.a.createElement(I.a,{className:t.pos,color:"textSecondary"},"\u0420\u0435\u0433\u0438\u043e\u043d: ",e.userInfo.district),r.a.createElement(I.a,{variant:"body2",component:"p"},e.userInfo.phone),r.a.createElement(I.a,{variant:"body2",component:"p"},e.userInfo.email)))}var ot=a(78),it=function(e){var t=Object(n.useState)({}),a=Object(i.a)(t,2),c=a[0],o=a[1],l=function(){var t=Object(ne.a)(ae.a.mark((function t(a){return ae.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(a.map(function(){var t=Object(ne.a)(ae.a.mark((function t(a){var n;return ae.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.storageRef.child(a.name).put(a),o((function(e){var t=Object(j.a)({},a.name,{status:"loading",progress:0});return e?Object(g.a)(Object(g.a)({},e),t):t})),n.on(s.a.storage.TaskEvent.STATE_CHANGED,(function(e){var t=e.bytesTransferred/e.totalBytes*100;switch(o((function(e){var n=Object(j.a)({},a.name,{status:"loading",progress:t});return e?Object(g.a)(Object(g.a)({},e),n):n})),console.log("Upload is "+t+"% done"),e.state){case s.a.storage.TaskState.PAUSED:console.log("Upload is paused");break;case s.a.storage.TaskState.RUNNING:console.log("Upload is running")}}),(function(e){e.code}),(function(){n.snapshot.ref.getDownloadURL().then(function(){var t=Object(ne.a)(ae.a.mark((function t(n){var r;return ae.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n,e.secure&&(c=n.split("?")[0],r=c.replace("https://firebasestorage.googleapis.com/v0/b/journal-bb5e3.appspot.com/o","https://storage.cloud.google.com/journal-bb5e3.appspot.com")+"?authuser=1"),t.next=4,e.filesLinks.set({contents:Object(j.a)({},r,{name:a.name,url:r})},{merge:e.allowMultipleFiles});case 4:o((function(e){var t=Object.assign({},e);return delete t[a.name],t})),console.log("File available at",r);case 6:case"end":return t.stop()}var c}),t)})));return function(e){return t.apply(this,arguments)}}())}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return r.a.createElement("div",null,r.a.createElement("input",{type:"file",onChange:function(e){console.log("Files selected: ",Object(Be.a)(e.target.files)),l(Object(Be.a)(e.target.files))},multiple:e.allowMultipleFiles}),Object.keys(c).map((function(e){return r.a.createElement("div",{key:e},r.a.createElement("p",null,e),r.a.createElement(oe,{value:c[e].progress}))})))},st=a(388),lt=a.n(st),ut=a(389),dt=a.n(ut),ft=function(e){var t=Object(n.useState)(!1),a=Object(i.a)(t,2),c=a[0],o=a[1],s=Object(n.useState)(!1),l=Object(i.a)(s,2),u=l[0],f=l[1],m=Object(n.useState)(!1),p=Object(i.a)(m,2),b=p[0],h=p[1],g=Object(n.useState)(null),O=Object(i.a)(g,2),E=O[0],v=O[1],y=null,k=null;e.disabled||(y=d.storage().ref(e.taskID).child(e.name).child(e.currentUserUid),k=function(){var t=Object(ne.a)(ae.a.mark((function t(){return ae.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o(!0),t.next=3,d.firestore().collection("users").doc(e.currentUserUid).set({fileUpload:e.taskID+"/"+e.name},{merge:!0});case 3:o(!1),f(!0);case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}());var w=d.firestore().collection("tasks").doc(e.taskID).collection("responses").doc(e.name),S={};e.formData&&Object.keys(e.formData).length>0?S=e.formData:e.initResp&&e.name&&e.initResp[e.name]&&e.initResp[e.name].contents&&Object.keys(e.initResp[e.name].contents).length>0&&(S=e.initResp[e.name].contents);var x=function(e){if(e){var t=e.name.substring(e.name.lastIndexOf(".")+1,e.name.length).toLowerCase()||"";return console.log("debug file extension",t),"jpeg"===t||"jpg"===t||"png"===t?r.a.createElement("img",{src:e.url,style:{height:"100%",width:"auto"},alt:e.name}):"mp4"===t||"ogg"===t||"webm"===t||"mov"===t?r.a.createElement("video",{controls:"controls",style:{maxHeight:"100%",width:"auto"}},r.a.createElement("source",{src:e.url})):r.a.createElement(I.a,null,"\u0424\u0430\u0439\u043b \u043d\u0435 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0444\u043e\u0442\u043e \u0438\u043b\u0438 \u0432\u0438\u0434\u0435\u043e")}return null};return r.a.createElement("div",null,r.a.createElement(G.a,{onClose:function(){h(!1)},open:b},E),e.schema.title?r.a.createElement("div",null,e.schema.title):r.a.createElement("div",null),e.schema.description?r.a.createElement("div",null,e.schema.description):r.a.createElement("div",null),e.disabled?null:r.a.createElement("div",null,r.a.createElement(it,{storageRef:y,allowMultipleFiles:!(!e.stage||!e.stage.allowMultipleFiles)&&e.stage.allowMultipleFiles,secure:!(!e.stage||!e.stage.cleanFileLink)&&e.stage.cleanFileLink,filesLinks:w}),c?r.a.createElement(re.a,null):u?r.a.createElement("div",null,'\u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u043d\u0430\u0447\u0430\u0442\u044c \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0443 \u0444\u0430\u0439\u043b\u043e\u0432 \u0447\u0435\u0440\u0435\u0437 \u0431\u043e\u0442\u0430. \u0412\u0441\u0435 \u0444\u0430\u0439\u043b\u044b, \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c\u044b\u0435 \u0431\u043e\u0442\u0443, \u0431\u0443\u0434\u0443\u0442 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0442\u044c\u0441\u044f \u0437\u0434\u0435\u0441\u044c. \u041f\u043e\u0441\u043b\u0435 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0444\u0430\u0439\u043b\u043e\u0432 \u0447\u0435\u0440\u0435\u0437 \u0431\u043e\u0442, \u043d\u0435 \u0437\u0430\u0431\u0443\u0434\u044c\u0442\u0435 \u0432\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u0441\u044e\u0434\u0430 \u0438 \u043d\u0430\u0436\u0430\u0442\u044c "\u041e\u0422\u041f\u0420\u0410\u0412\u0418\u0422\u042c". ',r.a.createElement("a",{href:"https://t.me/journal_tg_bot"},"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u0431\u043e\u0442.")):r.a.createElement("div",null,r.a.createElement("p",null,"\u0412\u044b \u0442\u0430\u043a \u0436\u0435 \u043c\u043e\u0436\u0435\u0442\u0435 \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0441\u044e\u0434\u0430 \u0444\u0430\u0439\u043b\u044b \u0447\u0435\u0440\u0435\u0437 \u0422\u0435\u043b\u0435\u0433\u0440\u0430\u043c-\u0431\u043e\u0442\u0430. \u0414\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043d\u0430\u0436\u043c\u0438\u0442\u0435 \u043a\u043d\u043e\u043f\u043a\u0443 \u043d\u0438\u0436\u0435: "),r.a.createElement("button",{onClick:k},"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0447\u0435\u0440\u0435\u0437 \u0431\u043e\u0442"))),S?r.a.createElement("div",null,Object.keys(S).map((function(t){return r.a.createElement("div",{key:t},r.a.createElement("a",{href:S[t].url,target:"_blank",rel:"noreferrer"},S[t].name),e.metadata&&!e.metadata.is_complete&&r.a.createElement(_.a,{onClick:function(){return function(t){console.log(t),w.set({contents:Object(j.a)({},t,d.firestore.FieldValue.delete())},{merge:!0}).then((function(){delete S[t],console.log("file removed"),Object.keys(S).length>0?e.onChange(S):e.onChange()})).catch((function(e){return console.log(e)}))}(t)},size:"small"},r.a.createElement(lt.a,null)),r.a.createElement(_.a,{onClick:function(){return function(e){var t=x(e);v(t),h(!0)}(S[t])},size:"small"},r.a.createElement(dt.a,null)))}))):r.a.createElement("div",null))},mt=a(104),pt=function(e){var t=Object(n.useState)({}),a=Object(i.a)(t,2),c=a[0],o=a[1],s=Object(n.useState)({}),l=Object(i.a)(s,2),m=l[0],p=l[1],b=Object(n.useState)({}),O=Object(i.a)(b,2),E=O[0],v=O[1],y=Object(n.useState)({}),k=Object(i.a)(y,2),_=k[0],w=k[1],S=Object(n.useState)({}),x=Object(i.a)(S,2),C=x[0],D=x[1],F=Object(n.useState)(null),T=Object(i.a)(F,2),U=T[0],P=T[1],R=Object(n.useState)("loading"),B=Object(i.a)(R,2),W=B[0],A=B[1],N=Object(n.useContext)(f).currentUser,z=e.id;Object(n.useEffect)((function(){if(N&&z){var e=d.firestore().collection("tasks").doc(z);P(e),e.onSnapshot((function(e){w(e.data()),e.data().is_complete&&A("sent"),e.data().assigned_users.includes(N.uid)||A("released"),console.log("Task Metadata: ",e.data())})),e.collection("responses").onSnapshot((function(e){var t={},a=[],n=!1;e.docChanges().forEach((function(e){if("added"===e.type||"modified"===e.type){var r=e.doc.data().contents;t[e.doc.id]=r,n=!0}"removed"===e.type&&(console.log("Response Removed: ",e.doc.data()),a.push(e.doc.id),n=!0)})),n&&o((function(e){var n=Object(ot.cloneDeep)(e);return a.forEach((function(e){return delete n[e]})),Object.keys(t).forEach((function(e){return n[e]=t[e]})),n}))})),e.collection("questions").onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||p((function(t){return Object(g.a)(Object(g.a)({},t),{},Object(j.a)({},e.doc.id,e.doc.data()))}))}))}))}}),[z,N]),Object(n.useEffect)((function(){Object.entries(_).length>0&&(console.log("Task metadata: ",_),d.firestore().collection("schema").doc("structure").collection("cases").doc(_.case_type).collection("stages").onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||(console.log("Case stage: ",e.doc.data()),D((function(t){return Object(g.a)(Object(g.a)({},t),{},Object(j.a)({},e.doc.id,e.doc.data()))}))),"removed"===e.type&&D((function(t){var a=Object.assign({},t);return delete a[e.doc.id],a}))}))})))}),[_]),Object(n.useEffect)((function(){v(L(m,C[_.case_stage_id]))}),[m,_,C]);var L=function(e,t){var a=Object.assign({},e),n=Object.assign({},t);n.start=n.start?n.start:{},n.end=n.end?n.end:{},n.start_ui_schema=n.start_ui_schema?n.start_ui_schema:{},n.end_ui_schema=n.end_ui_schema?n.end_ui_schema:{},a.form_questions=a.form_questions?a.form_questions:{},a.ui_schema=a.ui_schema?a.ui_schema:{};var r=Object(g.a)(Object(g.a)(Object(g.a)({},n.start.properties?n.start.properties:{}),n.end.properties?n.end.properties:{}),a.form_questions.properties?a.form_questions.properties:{}),c=Object(g.a)(Object(g.a)(Object(g.a)({},n.start.definitions?n.start.definitions:{}),n.end.definitions?n.end.definitions:{}),a.form_questions.definitions?a.form_questions.definitions:{}),o="";a.form_questions.title?o=a.form_questions.title:n.end.title?o=n.end.title:n.start.title&&(o=n.start.title);var i="";a.form_questions.description?i=a.form_questions.description:n.end.description?i=n.end.description:n.start.description&&(i=n.start.description);var s=Object(Be.a)(new Set([].concat(Object(Be.a)(n.start.required?n.start.required:[]),Object(Be.a)(a.form_questions.required?a.form_questions.required:[]),Object(Be.a)(n.end.required?n.end.required:[])))),l=Object(Be.a)(new Set([].concat(Object(Be.a)(n.start_ui_schema["ui:order"]?n.start_ui_schema["ui:order"]:[]),Object(Be.a)(a.ui_schema["ui:order"]?a.ui_schema["ui:order"]:[]),Object(Be.a)(n.end_ui_schema["ui:order"]?n.end_ui_schema["ui:order"]:[])))),u=Object(g.a)(Object(g.a)(Object(g.a)({},n.start_ui_schema?n.start_ui_schema:{}),n.end_ui_schema?n.end_ui_schema:{}),a.ui_schema?a.ui_schema:{});return{form_questions:{properties:r,definitions:c,title:o,description:i,required:s},ui_schema:u=Object(g.a)(Object(g.a)({},u),{"ui:order":l})}},M={customImageWidget:function(e){return console.log("PROPS",e),r.a.createElement("img",{src:e.value,alt:e.schema.title,style:{maxWidth:"100%",height:"auto"}})},customVideoWidget:function(e){return console.log("PROPS",e),r.a.createElement("video",{title:e.schema.title,style:{maxWidth:"100%",height:"auto"},controls:!0},r.a.createElement("source",{src:e.value,type:"video/mp4"}))},customIframeWidget:function(e){return console.log("PROPS",e),r.a.createElement("iframe",{title:e.schema.title,src:e.value,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}};return N?r.a.createElement(h.a,{style:{padding:30}},E&&U&&C&&_&&_.case_stage_id&&C[_.case_stage_id]?r.a.createElement(mt.a,{schema:E.form_questions,uiSchema:E.ui_schema,formData:c,fields:{customFileUpload:function(e){return ft(Object(g.a)(Object(g.a)(Object(g.a)(Object(g.a)({},e),{taskID:z}),{currentUserUid:N.uid}),{stage:C[_.case_stage_id]}))}},disabled:"loading"===W||"sent"===W||"released"===W,widgets:M,noHtml5Validate:!0,onChange:function(e){!function(e){o(e.formData)}(e)}},r.a.createElement(r.a.Fragment,null)):null):r.a.createElement(h.a,{container:!0,direction:"column",style:{padding:20},justify:"center"},r.a.createElement(I.a,{align:"center",variant:"h3"},"\u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044c"),r.a.createElement("br",null),r.a.createElement(q.a,{variant:"contained",onClick:u},"\u0412\u043e\u0439\u0442\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google"))},bt=function(e){var t=r.a.useState([]),a=Object(i.a)(t,2),c=(a[0],a[1],Object(n.useState)({})),o=Object(i.a)(c,2),s=o[0],l=o[1],u={},f=Object(n.useState)([]),m=Object(i.a)(f,2),p=(m[0],m[1]),b=Object(n.useState)([]),g=Object(i.a)(b,2),j=(g[0],g[1]),O=Object(n.useState)({}),E=Object(i.a)(O,2),v=E[0],y=E[1],k=Object(n.useState)(r.a.createElement("div",null)),_=Object(i.a)(k,2),w=(_[0],_[1]),S=Object(n.useState)(!1),x=Object(i.a)(S,2),C=(x[0],x[1]),q=Object(n.useState)(!1),D=Object(i.a)(q,2),F=(D[0],D[1]),T=Object(n.useState)(!1),U=Object(i.a)(T,2),P=(U[0],U[1]),R=Object(n.useState)(!1),B=Object(i.a)(R,2),W=(B[0],B[1]),A=Object(n.useState)(!1),N=Object(i.a)(A,2),z=(N[0],N[1]),L=function(){var t=Object(ne.a)(ae.a.mark((function t(){return ae.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:d.firestore().collection("tasks").doc(e.task.id).get().then((function(e){var t;t=e.exists&&e.data()&&e.data().review_status?e.data().review_status:"pending",console.log("TEST TEST",e.data()),C("pending"===t),F("passed"===t),P("not passed"===t),W("verified"===t),z("not verified"===t)}));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();Object(n.useEffect)((function(){var t=function(){var t=Object(ne.a)(ae.a.mark((function t(){var a,n,c,o;return ae.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=[],n=[],c=[],o=!0,console.log("HOOK"),L(),t.next=8,d.firestore().collection("tasks").doc(e.task.id).get().then((function(e){l(e.data())})).catch((function(e){console.log("Error getting documents: ",e)}));case 8:return t.next=10,d.firestore().collection("tasks").doc(e.task.id).collection("questions").get().then((function(e){e.forEach((function(e){a.push({questionId:e.id,data:e.data()})}))})).then((function(){p(a)})).catch((function(e){console.log("Error getting documents: ",e)}));case 10:return t.next=12,d.firestore().collection("tasks").doc(e.task.id).collection("responses").get().then((function(e){e.forEach((function(e){n.push({responseId:e.id,data:e.data()})}))})).then((function(){j(n)})).catch((function(e){console.log("Error getting documents: ",e)}));case 12:w(r.a.createElement("div",null)),c=a.map((function(e,t){var a=null;return n.forEach((function(n){e.questionId===n.responseId&&(a=n.data.answer,M(n.data.answer,t))})),r.a.createElement(Ae,{key:t,question:e.data,index:t,response:a,returnAnswer:M,locked:o})})),w(c);case 15:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();e.task.id&&t()}),[e.task.id]);var M=function(e,t){var a=v;a[t]=e,y(a)};return function(){if(void 0!==s.assigned_users&&s.assigned_users.length>0){var t=e.users.find((function(e){return e.id===s.assigned_users[0]}));u=void 0!==t?t:{}}}(),r.a.createElement(h.a,{style:{padding:30}},r.a.createElement(h.a,{container:!0,justify:"center"},r.a.createElement(ct,{userInfo:u}," ")),r.a.createElement(I.a,null,"Task ID: "+e.task.id),r.a.createElement(I.a,null,"Case ID: "+e.task.case_id),e.task.is_compete&&r.a.createElement(I.a,null,"Completion time:"+e.task.completion_time.toDate()),r.a.createElement(pt,{id:e.task.id}))},ht=a(914),gt=function(e){var t=Object(n.useState)(0),a=Object(i.a)(t,2),c=a[0],o=a[1],s=Object(n.useState)(1),l=Object(i.a)(s,2),u=l[0],d=(l[1],Object(n.useState)([])),f=Object(i.a)(d,2),m=f[0],p=f[1],b=function(e,t,a){var n=Object(Ve.a)(a),r=Math.floor(n.size/t);console.log("numberOfPages",r);var c=e*t,o=n.size;return e!==r-1&&(o=(e+1)*t),console.log("Start",c),console.log("End",o),a.slice(c,o)};Object(n.useEffect)((function(){o(0),p(b(0,1,e.data))}),[e.data]);var g=e.data.length>0&&r.a.createElement(h.a,{container:!0,justify:"center"},r.a.createElement(ht.a,{justify:"center",component:"div",count:e.data.length,page:c,onChangePage:function(t,a){p(b(a,u,e.data)),o(a)},rowsPerPage:u,onChangeRowsPerPage:function(e){},labelRowsPerPage:"\u041f\u043e \u043e\u0434\u043d\u043e\u0439 \u0437\u0430\u0434\u0430\u0447\u0435 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443!"})),j=void 0!==m[0];return r.a.createElement("div",null,g,r.a.createElement(h.a,{container:!0,spacing:0,direction:"column",alignItems:"center",justify:"center",style:{minHeight:"100vh"}},r.a.createElement(h.a,{item:!0,xs:12},r.a.createElement(h.a,{container:!0,justify:"center",direction:"column",spacing:1},j?r.a.createElement(h.a,{item:!0},r.a.createElement(bt,{task:m[0],users:e.users})):"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0438 \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u0435 \u0444\u0438\u043b\u044c\u0442\u0440\u044b!"))),g)},jt=a(910),Ot=a(203),Et=a.n(Ot),vt=function(e){var t=Object(n.useContext)(f).currentUser,a=r.a.useState([]),c=Object(i.a)(a,2),o=c[0],s=c[1],l=Object(n.useState)([]),u=Object(i.a)(l,2),m=u[0],p=u[1],b=Object(n.useState)({}),j=Object(i.a)(b,2),O=j[0],E=j[1],v=r.a.useState([]),y=Object(i.a)(v,2),k=y[0],_=y[1],w=r.a.useState(""),S=Object(i.a)(w,2),x=S[0],C=S[1],I=Object(n.useState)(null),D=Object(i.a)(I,2),F=D[0],T=D[1],U=r.a.useState(null),P=Object(i.a)(U,2),R=P[0],B=P[1],W=Object(n.useState)(""),A=Object(i.a)(W,2),z=A[0],L=A[1],M=Object(n.useState)(!0),G=Object(i.a)(M,2),V=G[0],H=G[1],K=Object(n.useState)(""),Q=Object(i.a)(K,2),J=Q[0],X=Q[1],Y=d.firestore().collection("schema").doc("structure").collection("cases");Object(n.useEffect)((function(){Y.get().then((function(e){var t=[];return e.forEach((function(e){t.push(e.id)})),t})).then((function(e){return p(e)}))}),[t]),Object(n.useEffect)((function(){E(null),F&&Y.doc(F).collection("stages").get().then((function(e){var t=[];return e.forEach((function(e){t.push(e.id)})),t})).then((function(e){return E(e)}))}),[F]);var $=function(e){C(e)},ee=function(){var e=Object(ne.a)(ae.a.mark((function e(){var t,a;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],a=d.firestore().collection("users"),e.next=4,a.get().then((function(e){e.forEach((function(e){t.push(Object(g.a)({id:e.id},e.data()))})),_(t)}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),te=function(){var e=Object(ne.a)(ae.a.mark((function e(){var t,a;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],a=d.firestore().collection("tasks").where("is_complete","==",V),console.log(x),console.log(F),console.log(R),""!==x&&(a=a.where("assigned_users","array-contains",x),console.log("USER FIRED",x)),null!==F&&(a=a.where("case_type","==",F),console.log("CASE FIRED",F)),null!==R&&(a=a.where("case_stage_id","==",R),console.log("STAGE FIRED",R)),""!==J&&(a=a.where("assigned_users","array-contains",J),console.log(J)),""===z){e.next=13;break}d.firestore().collection("tasks").doc(z).get().then((function(e){return s([Object(g.a)({id:e.id},e.data())])})),e.next=15;break;case 13:return e.next=15,a.get().then((function(e){e.forEach((function(e){t.push(Object(g.a)({id:e.id},e.data()))})),s(t)}));case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){ee()}),[]),r.a.createElement("div",null,r.a.createElement(h.a,{container:!0,justify:"center",style:{padding:15}},r.a.createElement(jt.a,{id:"combo-box-demo",options:m,style:{width:350},disabled:z.length>0,value:F,onChange:function(e,t){return a=t,B(null),void T(a);var a},renderInput:function(e){return r.a.createElement(N.a,Object.assign({},e,{fullWidth:!0,label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0438\u043b\u044c\u0442\u0440 \u043f\u043e case",variant:"outlined"}))}})),null!==O&&O.length>0&&r.a.createElement(h.a,{container:!0,justify:"center",style:{padding:15}},r.a.createElement(jt.a,{id:"combo-box-demo",options:O,style:{width:350},disabled:z.length>0,value:R,onChange:function(e,t){B(t)},renderInput:function(e){return r.a.createElement(N.a,Object.assign({},e,{fullWidth:!0,label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0438\u043b\u044c\u0442\u0440 \u043f\u043e stage",variant:"outlined"}))}})),r.a.createElement(h.a,{container:!0,justify:"center",style:{padding:15}},r.a.createElement(jt.a,{id:"combo-box-demo",options:k,getOptionLabel:function(e){return e.surname+" "+e.name+" ("+e.username+")"},style:{width:350},disabled:z.length>0,value:x.value,onChange:function(e,t){$(t?t.id:"")},renderInput:function(e){return r.a.createElement(N.a,Object.assign({},e,{fullWidth:!0,label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0438\u043b\u044c\u0442\u0440 \u043f\u043e users",variant:"outlined"}))}})),r.a.createElement(h.a,{container:!0,justify:"center",style:{padding:15}},r.a.createElement(Z.a,{style:{width:350,margin:4}},r.a.createElement(de.a,{id:"demo-simple-select-label"},"Is complete"),r.a.createElement(me.a,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:V,variant:"outlined",onChange:function(e){return H(e.target.value)}},r.a.createElement(fe.a,{value:!0},"True"),r.a.createElement(fe.a,{value:!1},"False")))),r.a.createElement(h.a,{container:!0,justify:"center",style:{padding:15}},r.a.createElement(N.a,{style:{width:350},value:z,variant:"outlined",label:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 id \u0442\u0430\u0441\u043a\u0430",onChange:function(e,t){return L(e.target.value)}})),r.a.createElement(h.a,{container:!0,justify:"center",style:{padding:15}},r.a.createElement(N.a,{style:{width:350},value:J,variant:"outlined",label:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 id \u044e\u0437\u0435\u0440\u0430",onChange:function(e,t){return X(e.target.value)}})),r.a.createElement(h.a,{container:!0,justify:"center"},r.a.createElement(q.a,{style:{width:"350px"},type:"number",variant:"contained",onClick:function(e){te()},color:"primary",startIcon:r.a.createElement(Et.a,null)},"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440\u044b")),r.a.createElement(h.a,{container:!0,justify:"center"},r.a.createElement(gt,{data:o,users:k})))},yt=function(){return Object(n.useContext)(f).currentUser?r.a.createElement(b.a,{to:"/"}):r.a.createElement(h.a,{container:!0,direction:"column",style:{padding:20},justify:"center"},r.a.createElement(I.a,{align:"center",variant:"h4"},"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),r.a.createElement(I.a,{variant:"body1",align:"center"},"\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \u043d\u0430 \u043a\u043d\u043e\u043f\u043a\u0443 (\u0412\u0445\u043e\u0434 \u0438\u043b\u0438 \u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f)."),r.a.createElement(I.a,{variant:"body1",align:"center"},"\u0415\u0441\u043b\u0438 \u0443 \u0432\u0430\u0441 \u043d\u0435\u0442 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google, \u0442\u043e \u0441\u043e\u0437\u0434\u0430\u0439\u0442\u0435 \u0435\u0433\u043e."),r.a.createElement("br",null),r.a.createElement(q.a,{size:"large",color:"primary",variant:"contained",onClick:u},"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"))},kt=function(e){var t=e.component,a=Object(_e.a)(e,["component"]),c=Object(n.useContext)(f).currentUser;return r.a.createElement(b.b,Object.assign({},a,{render:function(e){return c?r.a.createElement(t,e):r.a.createElement(b.a,{to:"/signin"})}}))},_t=a(384),wt=a(804),St=Object(D.a)((function(e){return{root:Object(j.a)({border:"2px grey solid",padding:"0px 10px",margin:10,background:"yellow",width:700},e.breakpoints.down("sm"),{maxWidth:300}),button:{background:"orange",margin:"10px 0"}}})),xt=Object(n.forwardRef)((function(e,t){var a=St(),n=r.a.useState(""),c=Object(i.a)(n,2),o=c[0],s=c[1],l=e.title,u=e.sendAnswer,d=e.taskId,f=e.questionId;return r.a.createElement("div",{className:a.root},r.a.createElement(z.a,{display:"flex",style:{marginBottom:10,marginTop:10}},r.a.createElement(I.a,{variant:"h6",style:{paddingRight:8}},l)),r.a.createElement(N.a,{label:"\u041c\u043e\u0439 \u043e\u0442\u0432\u0435\u0442",value:o,style:{background:"white"},onChange:function(e){s(e.target.value)},multiline:!0,rows:5,variant:"outlined",fullWidth:!0}),r.a.createElement(h.a,{container:!0,justify:"flex-end"},r.a.createElement(q.a,{className:a.button,onClick:function(){return u(d,f,o)}},"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c")))})),Ct=Object(D.a)((function(e){return{select:Object(j.a)({margin:"20px 0",width:500},e.breakpoints.down("sm"),{maxWidth:300})}})),qt=function(e){var t=Ct(),a=["\u0412\u0421\u0415","\u041f\u043e\u0438\u0441\u043a \u043a\u043e\u043d\u0442\u0430\u043a\u0442\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445","interview"],c=r.a.useState([]),o=Object(i.a)(c,2),s=(o[0],o[1]),l=r.a.useState(a[0]),u=Object(i.a)(l,2),f=u[0],m=u[1],p=Object(n.useState)([]),b=Object(i.a)(p,2),j=b[0],O=b[1],E=function(){var e=Object(ne.a)(ae.a.mark((function e(t){var a;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v();case 2:a=e.sent,y(a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=Object(ne.a)(ae.a.mark((function e(){var t,a;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],a=d.firestore().collection("tasks").where("case_type","==","FAQ").where("is_complete","==",!1),"\u0412\u0421\u0415"!==f&&(a=a.where("type","==",f)),console.log("fired"),e.next=6,a.get().then((function(e){e.forEach((function(e){t.push(Object(g.a)({id:e.id},e.data()))})),t.sort((function(e,t){return t.timestamp.toDate()-e.timestamp.toDate()})),s(t)}));case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),y=function(){var e=Object(ne.a)(ae.a.mark((function e(t){var a;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.map(function(){var e=Object(ne.a)(ae.a.mark((function e(t){var a;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],e.next=3,d.firestore().collection("tasks").doc(t.id).collection("questions").get().then((function(e){e.forEach((function(e){a.push(Object(g.a)({taskId:t.id,questionId:e.id,timestamp:t.timestamp.toDate()},e.data()))}))}));case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:a=e.sent,Promise.all(a).then((function(e){return O([].concat.apply([],e))}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),k=function(e,t,a){d.firestore().collection("tasks").doc(e).collection("responses").doc(t).set({answer:a}),console.log(e,a)};return r.a.createElement(h.a,{container:!0,justify:"center"},r.a.createElement(h.a,{container:!0,justify:"center"},r.a.createElement(Z.a,{className:t.select},r.a.createElement(_t.a,{value:f,onChange:function(e){m(e.target.value)},name:"filterTaskType"},a.map((function(e,t){return r.a.createElement("option",{key:e,value:e},e)}))),r.a.createElement(wt.a,null,"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0438\u043b\u044c\u0442\u0440 \u043f\u043e \u0442\u0438\u043f\u0443 \u0437\u0430\u0434\u0430\u0447\u0438"))),r.a.createElement(h.a,{container:!0,justify:"center",className:t.select},r.a.createElement(q.a,{style:{width:"350px"},type:"number",variant:"contained",onClick:E,color:"primary",startIcon:r.a.createElement(Et.a,null)},"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440\u044b")),r.a.createElement(h.a,{container:!0,justify:"center"},j?j.map((function(e,t){return r.a.createElement(xt,{key:"task_"+t,taskId:e.taskId,questionId:e.questionId,title:e.title,sendAnswer:k})})):r.a.createElement(I.a,{style:{padding:30}},"\u041d\u0435\u0442 \u043d\u043e\u0432\u044b\u0445 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432")))},It=a(407),Dt=a(908),Ft=Object(D.a)({root:{minWidth:250,maxWidth:400},bullet:{display:"inline-block",margin:"0 2px"},title:{fontSize:14},pos:{marginBottom:12}}),Tt=function(e){var t,a=Ft(),c=Object(b.g)(),o=e.complete,s=e.id,l=e.cardColor,u=e.cardType,f=e.stage,m=e.stageID,p=e.task,g=e.user,O=e.pCase,E=Object(n.useState)(!1),v=Object(i.a)(E,2),y=v[0],k=v[1],_=Object(n.useState)(null),w=Object(i.a)(_,2),S=(w[0],w[1],function(){k(!0);var e="",t="",a="";"creatable"===u||"creatableUnlim"===u?(e=Object(Dt.a)(),t="callbackId",a="callbackId"):"selectable"===u&&(e=s,a="taskId",t=d.firestore.FieldPath.documentId()),d.firestore().collection("task_requests").doc(g.uid).collection("requests").add(Object(j.a)({status:"pending",user:g.uid,case_type:O,case_stage_id:m},a,e)).then((function(a){var n=d.firestore().collection("tasks").where("assigned_users","array-contains",g.uid).where(t,"==",e).onSnapshot((function(e){e.docChanges().forEach((function(e){"added"===e.type&&e.doc.id&&(n(),c.push("/t/"+e.doc.id))}))}))}))}),x=function(){k(!0);var e="",t="",a="";"creatable"===u||"creatableUnlim"===u?(e=Object(Dt.a)(),t="callbackId",a="callbackId"):"selectable"===u&&(e=s,a="taskId",t=d.firestore.FieldPath.documentId()),d.firestore().collection("task_requests").doc(g.uid).collection("requests").add(Object(j.a)({status:"pending",user:g.uid,case_type:O,case_stage_id:m},a,e)).then((function(a){var n=d.firestore().collection("tasks").where("assigned_users","array-contains",g.uid).where(t,"==",e).onSnapshot((function(e){e.docChanges().forEach((function(e){"added"===e.type&&e.doc.id&&(n(),c.push("/tasks/"+e.doc.id))}))}))}))};return r.a.createElement(z.a,null,r.a.createElement(Ce.a,{key:s,className:a.root,style:{background:l}},r.a.createElement(Ie.a,null,r.a.createElement(z.a,{display:"flex",justifyContent:"space-between",alignItems:"center"},r.a.createElement(I.a,{variant:"h6"},f.title),o&&r.a.createElement(I.a,{color:"error"},"\u0421\u0434\u0430\u043d\u043e")),r.a.createElement(I.a,{variant:"subtitle1",className:a.pos,color:"textSecondary"},"#",s),r.a.createElement(I.a,{variant:"body2",component:"p"},p&&p.cardData&&("selectable"===u||f&&f.showCard)?(t=p.cardData,Object.keys(t).map((function(e,a){return"message"===e?r.a.createElement(I.a,{key:e+a},t[e]):Object.keys(t[e]).map((function(a){if(f&&f.cardData&&f.cardData[e]&&f.cardData[e].includes(a))return"attachedFiles"===a?r.a.createElement("div",{key:e+a},"Files"):r.a.createElement("typography",{variant:"body2",component:"p",key:e+a},JSON.stringify(t[e][a],null,2))}))}))):"\u0417\u0430\u0434\u0430\u043d\u0438\u0435: "+f.description)),r.a.createElement(qe.a,null,y?r.a.createElement(re.a,null):r.a.createElement(h.a,null,r.a.createElement(q.a,{size:"small",onClick:function(){"creatable"===u||"selectable"===u||"creatableUnlim"===u?S():c.push("/t/"+s)}},"creatableUnlim"===u?"\u0421\u041e\u0417\u0414\u0410\u0422\u042c \u041d\u041e\u0412\u0423\u042e \u0424\u041e\u0420\u041c\u0423":"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"),f.showOldButton&&r.a.createElement(q.a,{size:"small",onClick:function(){"creatable"===u||"selectable"===u||"creatableUnlim"===u?x():c.push("/tasks/"+s)}},"\u041e\u0442\u043a\u0440\u044b\u0442\u044c (Old)")))))},Ut=function(e,t,a){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||t((function(t){var n=Object.assign({},t);return n[a]||(n[a]={}),n[a][e.doc.id]=e.doc.data(),n})),"removed"===e.type&&t((function(t){var n=Object.assign({},t);return delete n[a][e.doc.id],n}))}))},Pt=function(e,t){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||t((function(t){return Object(g.a)(Object(g.a)({},t),{},Object(j.a)({},e.doc.id,e.doc.data()))})),"removed"===e.type&&t((function(t){var a=Object.assign({},t);return delete a[e.doc.id],a}))}))};function Rt(e){var t=e.children,a=e.value,n=e.index,c=Object(_e.a)(e,["children","value","index"]);return r.a.createElement("div",Object.assign({role:"tabpanel",hidden:a!==n,id:"full-width-tabpanel-".concat(n),"aria-labelledby":"full-width-tab-".concat(n)},c),a===n&&r.a.createElement(z.a,{p:3},r.a.createElement(I.a,null,t)))}function Bt(e){return{id:"full-width-tab-".concat(e),"aria-controls":"full-width-tabpanel-".concat(e)}}var Wt=Object(D.a)({root:{paddingTop:30,flexGrow:1}}),At=function(){var e=Object(n.useContext)(f).currentUser,t=Object(b.h)().id,a=Wt(),c=Object(n.useState)({}),o=Object(i.a)(c,2),s=o[0],l=o[1],u=Object(n.useState)([]),m=Object(i.a)(u,2),p=m[0],O=m[1],E=Object(n.useState)({}),v=Object(i.a)(E,2),y=v[0],k=v[1],_=Object(n.useState)({}),w=Object(i.a)(_,2),S=w[0],x=w[1],C=Object(n.useState)({}),D=Object(i.a)(C,2),F=D[0],T=D[1],U=Object(n.useState)({}),P=Object(i.a)(U,2),R=P[0],B=P[1],W=Object(n.useState)({}),A=Object(i.a)(W,2),N=(A[0],A[1]),z=Object(n.useState)({}),L=Object(i.a)(z,2),M=L[0],G=L[1],V=Object(n.useState)({}),H=Object(i.a)(V,2),K=H[0],Q=H[1],J=Object(n.useState)(0),X=Object(i.a)(J,2),Y=X[0],Z=X[1],$=Object(n.useState)({}),ee=Object(i.a)($,2),te=ee[0],re=ee[1],ce=Object(n.useState)({}),oe=Object(i.a)(ce,2),ie=oe[0],se=oe[1],le=Object(n.useState)({}),ue=Object(i.a)(le,2),de=ue[0],fe=ue[1],me=Object(n.useState)({}),pe=Object(i.a)(me,2),be=pe[0],he=pe[1],ge=Object(n.useState)({}),je=Object(i.a)(ge,2),Oe=je[0],Ee=je[1],ve=Object(n.useState)((function(){})),ye=Object(i.a)(ve,2),ke=(ye[0],ye[1],Object(n.useState)([])),_e=Object(i.a)(ke,2),Ce=_e[0],qe=_e[1];Object(n.useEffect)((function(){var a=function(){};return e&&(a=d.firestore().collection("pages").doc(t).onSnapshot((function(e){l(e.data())}))),a}),[e,t]),Object(n.useEffect)((function(){var t=function(){};return e&&s&&s.ranks&&(t=d.firestore().collection("users").doc(e.uid).collection("user_private").doc("private").onSnapshot((function(e){O(Fe(e.data().ranks,s.ranks))}))),t}),[e,t,s]),Object(n.useEffect)((function(){if(s&&Object.entries(s).length>0&&p.length>0){k({}),T({}),x({}),re({}),he({}),se({});var t=d.firestore().collection("schema").doc("structure").collection("cases");s.cases.map((function(e){t.doc(e).get().then((function(e){N((function(t){var a=Object.assign({},t);return a[e.id]=e.data(),a}))})),t.doc(e).collection("stages").where("ranks_write","array-contains-any",p).onSnapshot((function(t){Ut(t,k,e)})),t.doc(e).collection("stages").onSnapshot((function(t){Ut(t,x,e)}))})),d.firestore().collection("tasks").where("assigned_users","array-contains",e.uid).onSnapshot((function(e){e.docChanges().forEach((function(e){s.cases.includes(e.doc.data().case_type)&&("added"!==e.type&&"modified"!==e.type||T((function(t){return Object(g.a)(Object(g.a)({},t),{},Object(j.a)({},e.doc.id,e.doc.data()))})),"removed"===e.type&&T((function(t){var a=Object.assign({},t);return delete a[e.doc.id],a})))}))})),s.caseWithSelectableTasks&&(t.doc(s.caseWithSelectableTasks).collection("stages").onSnapshot((function(e){var t={};e.forEach((function(e){e.data().ranks_read&&(e.data().ranks_read.some((function(e){return p.includes(e)}))&&(t[e.id]=e.data()))})),re(t)})),t.doc(s.caseWithSelectableTasks).collection("stages").onSnapshot((function(e){Pt(e,se)})),d.firestore().collection("tasks").where("case_type","==",s.caseWithSelectableTasks).where("assigned_users","==",[]).where("available","==",!0).where("is_complete","==",!1).where("ranks_read","array-contains-any",p).orderBy("created_date","desc").limit(25).onSnapshot((function(e){Pt(e,he)})))}}),[e,s,p,t]),Object(n.useEffect)((function(){var e=function(){};if(s&&Object.entries(s).length>0&&p.length>0&&s.caseWithSelectableTasks)if(0!==Object.keys(de).length){var t=te,a=t[Object.keys(t)[0]].filters;a.emergency_form_filling.violationType={violationType:"=="},a.emergency_form_filling.violationTime="==",he({});var n=d.firestore().collection("tasks").where("case_type","==",s.caseWithSelectableTasks).where("assigned_users","==",[]).where("available","==",!0).where("is_complete","==",!1).where("ranks_read","array-contains-any",p);Object.keys(a).forEach((function(e){Object.keys(a[e]).forEach((function(t){de[t]&&de[t][t]?n=n.where("cardData.".concat(e,".").concat(t,".").concat(t),a[e][t][t],de[t][t]):de[t]&&Object.keys(de[t]).length>0&&!de[t][t]&&(n=n.where("cardData.".concat(e,".").concat(t),a[e][t],de[t]))}))})),e=n=n.orderBy("created_date","desc").limit(25).onSnapshot((function(e){Pt(e,he)}))}else he({}),e=d.firestore().collection("tasks").where("case_type","==",s.caseWithSelectableTasks).where("assigned_users","==",[]).where("available","==",!0).where("is_complete","==",!1).where("ranks_read","array-contains-any",p).orderBy("created_date","desc").limit(25).onSnapshot((function(e){Pt(e,he)}));return e}),[e,s,p,t,de]),Object(n.useEffect)((function(){if(Object.keys(y).length>0){var e=Object(ot.cloneDeep)(y);Object.keys(y).map((function(t){Object.keys(y[t]).map((function(a){var n=y[t][a];if(n.ranks_write&&Object.keys(n.ranks_write).length>0&&Fe(n.ranks_write,p).length>0&&"creatable"in n&&n.creatable){if(n.rank_limit_number&&Object.keys(n.rank_limit_number).length>0){var r=Fe(Object.keys(n.rank_limit_number),p);if(r.length>0){var c=De(r,n.rank_limit_number);Ie(a,F,t,y[t][a])>=c&&delete e[t][a]}}}else delete e[t][a]}))})),B(e)}}),[e,y,F,t]);var Ie=function(e,t,a,n){var r=0;return Object.values(t).map((function(t){if(t.case_stage_id===e&&a===t.case_type){var c=!0;n&&!1===n.countComplete?(c=!1,t.is_complete===c&&r++):r++}})),r},De=function(e,t){var a=0;return e.map((function(e){t[e]>a&&(a=t[e])})),a},Fe=function(e,t){var a,n=new Set(e),r=new Set(t),c=new Set,o=Object(It.a)(r);try{for(o.s();!(a=o.n()).done;){var i=a.value;n.has(i)&&c.add(i)}}catch(s){o.e(s)}finally{o.f()}return Object(Be.a)(c)};Object(n.useEffect)((function(){p.length>0&&d.firestore().collection("schema").doc("structure").collection("ranks").where(d.firestore.FieldPath.documentId(),"in",p).onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||Ee((function(t){return Object(g.a)(Object(g.a)({},t),{},Object(j.a)({},e.doc.id,e.doc.data()))})),"removed"===e.type&&Ee((function(t){var a=Object.assign({},t);return delete a[e.doc.id],a}))}))}))}),[p]),Object(n.useEffect)((function(){Object.keys(y).length>0?Ue():G({})}),[y]);var Te=function(t,a,n,c,o){return Object.keys(t).map((function(i){var s=t[i].case_type,l=t[i].case_stage_id,u=!1;if(a?a[l]&&(u=a[l]):n&&n[s]&&n[s][l]&&(u=n[s][l]),u&&t[i].is_complete===o)return r.a.createElement(h.a,{key:i,style:{padding:10}},r.a.createElement(Tt,{stage:u,stageID:l,cardType:c,task:t[i],user:e,pCase:s,id:i}))}))},Ue=function(){var e={type:"object",properties:{request:{title:"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435",$ref:"#/definitions/cases"}},definitions:{cases:{type:"object",properties:{case:{type:"string",enum:["none"].concat(Object(Be.a)(Object.keys(y))),default:"none"}},required:["case"],dependencies:{case:{oneOf:[{properties:{case:{enum:["none"]}}}]}}}}};Object.keys(y).forEach((function(t,a){var n=y[t];s.cases.includes(t)&&e.definitions.cases.dependencies.case.oneOf.push({properties:{case:{enum:[t]},task:{type:"string",enum:["none"].concat(Object(Be.a)(Object.keys(n))),default:"none"}},required:["task"]})})),G(e)};Object(n.useEffect)((function(){var e=function(){var e=Object(ne.a)(ae.a.mark((function e(){var t;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,d.firestore().collection("schema").doc("structure").collection("ranks").get().then((function(e){e.forEach((function(e){s.ranks.includes(e.id)&&e.data().assign_without_moderator&&t.push(e.id)}))}));case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();s&&s.ranks&&e().then((function(e){return qe(function(e){return e.filter((function(e){return p&&!p.includes(e)}))}(e))}))}),[s,p]);return r.a.createElement(h.a,{container:!0,justify:"center",alignItems:"center",direction:"column"},r.a.createElement(nt,null),Ce.length>0&&r.a.createElement(h.a,{container:!0,justify:"center",alignItems:"center",direction:"column",style:{paddingBottom:20}},r.a.createElement(I.a,{variant:"h5"},s.message),Ce.map((function(t,a){return r.a.createElement(q.a,{key:a,variant:"contained",color:"primary",onClick:function(){return function(t){d.firestore().collection("rank_requests").add({timestamp:d.firestore.FieldValue.serverTimestamp(),user_id:e.uid,processed:!1,rank:t})}(t)},style:{margin:15}},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0440\u0430\u043d\u0433 ",t)}))),s.showTaskSelector&&r.a.createElement(h.a,{style:{paddingBottom:30}},r.a.createElement(mt.a,{schema:M,formData:K,onChange:function(e){!function(e){Q(e.formData)}(e)},onSubmit:function(){"none"!==K.request.case&&"none"!==K.request.task?d.firestore().collection("task_requests").doc(e.uid).collection("requests").add({status:"pending",user:e.uid,case_type:K.request.case,case_stage_id:K.request.task}):alert("\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 case \u0438 task!")}},r.a.createElement("button",{type:"submit",className:"btn btn-info"},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c"))),Object.keys(Oe).length>0?p.map((function(e){if(Oe[e]&&Oe[e].description)return r.a.createElement(I.a,{variant:"h5",key:e},Oe[e].description)})):null,r.a.createElement("div",{className:a.root},r.a.createElement(h.a,{container:!0},r.a.createElement(h.a,{container:!0,flex:!0,justify:"center"},r.a.createElement(I.a,{variant:"h5"},"\u0421\u041e\u0417\u0414\u0410\u0422\u042c \u041d\u041e\u0412\u0423\u042e \u0424\u041e\u0420\u041c\u0423")),r.a.createElement(h.a,{container:!0},Object.keys(R).map((function(t){return Object.keys(R[t]).map((function(a){return R[t][a].hasOwnProperty("countComplete")&&!1===R[t][a].countComplete?r.a.createElement(h.a,{item:!0,key:t+a,style:{padding:10}},r.a.createElement(Tt,{complete:!1,stage:R[t][a],stageID:a,user:e,pCase:t,cardType:"creatable"})):null}))})))),r.a.createElement(we.a,{position:"static",color:"default"},r.a.createElement(Se.a,{value:Y,onChange:function(e,t){Z(t)},variant:"fullWidth",centered:!0,"aria-label":"simple tabs example"},r.a.createElement(xe.a,Object.assign({label:"\u041d\u0435\u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435"},Bt(0))),r.a.createElement(xe.a,Object.assign({label:"\u0412\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435"},Bt(1))),Object.keys(be).length>0&&Object.keys(te).length>0?r.a.createElement(xe.a,Object.assign({label:"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435"},Bt(2))):null))),r.a.createElement(Rt,{value:Y,index:0},Object.keys(R).map((function(t){return Object.keys(R[t]).map((function(a){return R[t][a].hasOwnProperty("countComplete")&&!0!==R[t][a].countComplete?null:r.a.createElement(h.a,{item:!0,key:t+a,style:{padding:10}},r.a.createElement(Tt,{complete:!1,stage:R[t][a],stageID:a,user:e,pCase:t,cardType:"creatable"}))}))})),Te(F,!1,S,"selected",!1)),r.a.createElement(Rt,{value:Y,index:1},Te(F,!1,S,"selected",!0)),Object.keys(be).length>0&&Object.keys(te).length>0?r.a.createElement(Rt,{value:Y,index:2},function(e,t,a,n){if(1===Object.keys(e).length&&e[Object.keys(e)[0]]&&e[Object.keys(e)[0]].filters&&Object.keys(e[Object.keys(e)[0]].filters).length>0&&Object.keys(t).length>0){var c=e[Object.keys(e)[0]].filters;c.emergency_form_filling.violationType={violationType:"=="},c.emergency_form_filling.violationTime="==";var o={properties:{}},i={};return Object.keys(c).forEach((function(e){Object.keys(c[e]).forEach((function(a){var n=t[e].end.properties[a];n&&(delete n.dependencies,o.properties[a]=n,i[a]={"ui:widget":"select"})}))})),r.a.createElement(mt.a,{schema:o,uiSchema:i,formData:a,onChange:function(e){n(e)}}," ")}return null}(te,ie,de,(function(e){fe(e.formData)})),Te(be,te,!1,"selectable",!1)):null)},Nt=function(e){var t=e.formContext,a=Object(n.useState)({}),c=Object(i.a)(a,2),o=c[0],s=c[1],l=Object(n.useState)(!1),u=Object(i.a)(l,2),m=u[0],p=u[1],b=Object(n.useState)({}),h=Object(i.a)(b,2),j=h[0],O=h[1],E=Object(n.useContext)(f).currentUser,v=d.firestore().collection("UIKS1"),y=d.firestore().collection("tasks").doc(e.taskID).collection("responses").doc(e.name),k=d.firestore().collection("tasks").doc(e.taskID).collection("responses").doc("uikData");Object(n.useEffect)((function(){if(t&&t.conditional&&t.role){var a=d.firestore().collection("UIKS1"),n={},r=t.conditional;return console.log("DEBUG PROPS",e),e.prevResp.conditional&&!e.metadata.is_complete&&(e.prevResp.conditional.region===r.region&&e.prevResp.conditional.subregion===r.subregion&&e.prevResp.conditional.locality===r.locality&&e.prevResp.conditional.district===r.district||("\u0421\u0442\u0430\u0446\u0438\u043e\u043d\u0430\u0440\u043d\u044b\u0439 \u043d\u0430\u0431\u043b\u044e\u0434\u0430\u0442\u0435\u043b\u044c / \u0441\u0442\u0430\u0446\u0438\u043e\u043d\u0430\u0440\u0434\u0443\u043a \u0431\u0430\u0439\u043a\u043e\u043e\u0447\u0443"===t.role?y.set({contents:""}):y.set({contents:"mobile"}),k.set({}),v.where("observers","array-contains",E.uid).get().then(function(){var e=Object(ne.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.forEach(function(){var e=Object(ne.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.ref.update({observers:d.firestore.FieldValue.arrayRemove(E.uid)});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))),"\u0421\u0442\u0430\u0446\u0438\u043e\u043d\u0430\u0440\u043d\u044b\u0439 \u043d\u0430\u0431\u043b\u044e\u0434\u0430\u0442\u0435\u043b\u044c / \u0441\u0442\u0430\u0446\u0438\u043e\u043d\u0430\u0440\u0434\u0443\u043a \u0431\u0430\u0439\u043a\u043e\u043e\u0447\u0443"===t.role?(p(!0),"mobile"!==t.uik||e.metadata.is_complete||(y.set({contents:""}),k.set({}),v.where("observers","array-contains",E.uid).get().then(function(){var e=Object(ne.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.forEach(function(){var e=Object(ne.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.ref.update({observers:d.firestore.FieldValue.arrayRemove(E.uid)});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))):"mobile"===t.uik||e.metadata.is_complete||(p(!1),y.set({contents:"mobile"}),k.set({}),v.where("observers","array-contains",E.uid).get().then(function(){var e=Object(ne.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.forEach(function(){var e=Object(ne.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.ref.update({observers:d.firestore.FieldValue.arrayRemove(E.uid)});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),r.region&&(a=a.where("region","==",r.region)),r.subregion&&(a=a.where("subregion","==",r.subregion)),r.locality&&(a=a.where("locality","==",r.locality)),r.district&&(a=a.where("district","==",r.district)),n=a.onSnapshot((function(e){var t={};e.forEach((function(e){t[e.id]=e.data()})),O(t),w(t)})),function(){return n()}}}),[t]);var _=function(){var t=Object(ne.a)(ae.a.mark((function t(a){return ae.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("DEBUG FORMDATA",a.formData),""!==a.formData&&void 0!==a.formData&&null!==a.formData){t.next=9;break}if(e.metadata.is_complete){t.next=7;break}return y.set({contents:""}),k.set({}),t.next=7,v.where("observers","array-contains",E.uid).get().then(function(){var e=Object(ne.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.forEach(function(){var e=Object(ne.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.ref.update({observers:d.firestore.FieldValue.arrayRemove(E.uid)});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 7:t.next=15;break;case 9:if(e.metadata.is_complete){t.next=15;break}return y.set({contents:a.formData}),k.set(Object(g.a)(Object(g.a)({},j[a.formData]),{},{uikNumber:a.formData})),t.next=14,v.where("observers","array-contains",E.uid).get().then(function(){var e=Object(ne.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.forEach(function(){var e=Object(ne.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.ref.update({observers:d.firestore.FieldValue.arrayRemove(E.uid)});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 14:v.doc(a.formData).update({observers:d.firestore.FieldValue.arrayUnion(E.uid)});case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),w=function(t){var a={title:e.schema.title,enum:[],type:"string",enumNames:[]},n={"ui:enumDisabled":[]},r=function(e){var t=[],a=Object.keys(e),n=[];return Object.keys(e).forEach((function(a){e[a].address?n.push(a+" "+e[a].address):n.push(a),e[a].observers.length>=2&&t.push(a)})),console.log("DISABLED",t),{available:a,customLabels:n,disabled:t}}(t);a.enum=r.available,a.enumNames=r.customLabels,n["ui:enumDisabled"]=r.disabled,console.log("schema",a),s({schema:a,uiSchema:n})};return m&&r.a.createElement(mt.a,{schema:o.schema?o.schema:{},uiSchema:o.uiSchema?o.uiSchema:{},formData:e.formData,disabled:e.metadata.is_complete,noHtml5Validate:!0,onChange:function(e){return _(e)}}," ")},zt=a(128),Lt=function(e){var t=e.formContext,a=Object(n.useState)({}),c=Object(i.a)(a,2),o=c[0],s=c[1],l=Object(n.useState)(!1),u=Object(i.a)(l,2),m=(u[0],u[1],Object(n.useState)({})),p=Object(i.a)(m,2),b=(p[0],p[1]);Object(n.useContext)(f).currentUser,d.firestore().collection("UIKS1");console.log("CUSTOM UIK FIELD",e);var h=d.firestore().collection("tasks").doc(e.taskID).collection("responses").doc(e.name);d.firestore().collection("tasks").doc(e.taskID).collection("responses").doc("uikData");Object(n.useEffect)((function(){if(t){var a=d.firestore().collection("UIKS1"),n={},r=t.place;return console.log("DEBUG PROPS",e),e.prevResp.place&&!e.metadata.is_complete&&(e.prevResp.place.region===r.region&&e.prevResp.place.subregion===r.subregion&&e.prevResp.place.locality===r.locality&&e.prevResp.place.district===r.district||h.set({contents:""})),r&&(r.region&&(a=a.where("region","==",r.region)),r.subregion&&(a=a.where("subregion","==",r.subregion)),r.locality&&(a=a.where("locality","==",r.locality)),r.district&&(a=a.where("district","==",r.district))),n=a.onSnapshot((function(e){var t={};e.forEach((function(e){t[e.id]=e.data()})),b(t),j(t)})),function(){return n()}}}),[t]);var g=function(){var t=Object(ne.a)(ae.a.mark((function t(a){return ae.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("DEBUG FORMDATA",a.formData),""===a.formData||void 0===a.formData||null===a.formData?e.metadata.is_complete||h.set({contents:""}):e.metadata.is_complete||h.set({contents:a.formData});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),j=function(t){var a={title:e.schema.title,enum:[],type:"string",enumNames:[]},n={"ui:enumDisabled":[]},r=function(e){var t=[],a=Object.keys(e),n=[];return Object.keys(e).forEach((function(t){e[t].address?n.push(t+" "+e[t].address):n.push(t)})),console.log("DISABLED",t),{available:a,customLabels:n,disabled:t}}(t);a.enum=r.available,a.enumNames=r.customLabels,n["ui:enumDisabled"]=r.disabled,console.log("schema",a),s({schema:a,uiSchema:n})},O={};return e.formData?O=e.formData:e.initResp&&e.name&&e.initResp[e.name]&&e.initResp[e.name].contents&&(O=e.initResp[e.name].contents),r.a.createElement(zt.a,{schema:o.schema?o.schema:{},uiSchema:o.uiSchema?o.uiSchema:{},formData:O,disabled:e.metadata.is_complete,noHtml5Validate:!0,onChange:function(e){return g(e)}}," ")},Mt=(a(720),a(794),function(){var e=Object(n.useState)({}),t=Object(i.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)({}),s=Object(i.a)(o,2),l=s[0],m=s[1],p=Object(n.useState)({}),O=Object(i.a)(p,2),E=O[0],v=O[1],y=Object(n.useState)({}),k=Object(i.a)(y,2),_=k[0],w=k[1],S=Object(n.useState)({}),x=Object(i.a)(S,2),C=x[0],D=x[1],F=Object(n.useState)({}),T=Object(i.a)(F,2),U=T[0],P=T[1],R=Object(n.useState)({}),B=Object(i.a)(R,2),W=B[0],A=B[1],N=Object(n.useState)({}),z=Object(i.a)(N,2),L=z[0],M=z[1],J=Object(n.useState)({}),X=Object(i.a)(J,2),Y=X[0],Z=X[1],$=Object(n.useState)(""),ee=Object(i.a)($,2),te=(ee[0],ee[1]),ae=Object(n.useState)(null),ne=Object(i.a)(ae,2),re=ne[0],ce=ne[1],oe=Object(n.useState)("loading"),ie=Object(i.a)(oe,2),se=ie[0],le=ie[1],ue=Object(n.useState)(null),de=Object(i.a)(ue,2),fe=de[0],me=de[1],pe=Object(n.useState)({}),be=Object(i.a)(pe,2),he=be[0],ge=be[1],je=Object(n.useState)({}),Oe=Object(i.a)(je,2),Ee=Oe[0],ve=Oe[1],ye=Object(n.useState)(!1),ke=Object(i.a)(ye,2),_e=ke[0],we=ke[1],Se=Object(n.useState)(null),xe=Object(i.a)(Se,2),Ce=xe[0],qe=xe[1],Ie=Object(n.useState)({}),De=Object(i.a)(Ie,2),Fe=De[0],Te=De[1],Ue=Object(n.useState)(!1),Pe=Object(i.a)(Ue,2),Re=Pe[0],We=Pe[1],Ae=Object(n.useContext)(f).currentUser,ze=Object(b.h)().id,Le=Object(b.g)();Object(n.useEffect)((function(){if(Ae&&ze){var e=d.firestore().collection("tasks").doc(ze);ce(e),e.onSnapshot((function(e){e&&e.exists?(w(e.data()),e.data().is_complete&&le("sent"),e.data().assigned_users.includes(Ae.uid)||le("released"),console.log("Task Metadata: ",e.data())):console.log("DOC DOESN't EXIST")})),e.collection("responses").onSnapshot((function(e){var t={},a=[],n=!1;e.docChanges().forEach((function(e){if("added"===e.type||"modified"===e.type){var r=e.doc.data().contents;t[e.doc.id]=r,n=!0}"removed"===e.type&&(a.push(e.doc.id),n=!0)})),n&&c((function(e){var n=Object(ot.cloneDeep)(e);return ge(n),a.forEach((function(e){return delete n[e]})),Object.keys(t).forEach((function(e){return n[e]=t[e]})),n}))})),e.collection("questions").onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||m((function(t){return Object(g.a)(Object(g.a)({},t),{},Object(j.a)({},e.doc.id,e.doc.data()))}))}))}))}}),[ze,Ae]),Object(n.useEffect)((function(){var e=d.firestore().collection("tasks").doc(ze).collection("responses").onSnapshot((function(e){var t={};e.forEach((function(e){t[e.id]=e.data()})),ve(t)}));return function(){return e()}}),[ze]),Object(n.useEffect)((function(){Object.entries(_).length>0&&_.case_type&&d.firestore().collection("schema").doc("structure").collection("cases").doc(_.case_type).collection("stages").onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||D((function(t){return Object(g.a)(Object(g.a)({},t),{},Object(j.a)({},e.doc.id,e.doc.data()))})),"removed"===e.type&&D((function(t){var a=Object.assign({},t);return delete a[e.doc.id],a}))}))}))}),[_]),Object(n.useEffect)((function(){var e={};Object.keys(U).map((function(t){if(t!==ze){var a=U[t].case_stage_id;e[a]||(e[a]={}),e[a][t]=Me(W[t],C[a])}})),M(e)}),[U,W,C]),Object(n.useEffect)((function(){if(Object.keys(E).length>0&&"loading"===se&&le("ready"),E&&E.form_questions&&E.form_questions.required&&a){var e=E.form_questions.required.every(He);We(e)}}),[a,E]),Object(n.useEffect)((function(){v(Me(l,C[_.case_stage_id]))}),[l,_,C]),Object(n.useEffect)((function(){if(Object.keys(C).length>0&&Object.keys(_).length>0&&C[_.case_stage_id]){var e=C[_.case_stage_id].backgroundStages;e&&e.length>0&&d.firestore().collection("tasks").where("case_id","==",_.case_id).where("case_stage_id","in",e).orderBy("created_date").onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||P((function(t){return Object(g.a)(Object(g.a)({},t),{},Object(j.a)({},e.doc.id,e.doc.data()))})),"removed"===e.type&&P((function(t){var a=Object.assign({},t);return delete a[e.doc.id],a}))}))}))}}),[C,_]),Object(n.useEffect)((function(){Object.entries(U).length>0&&Object.keys(U).map((function(e){d.firestore().collection("tasks").doc(e).collection("questions").onSnapshot((function(t){Ut(t,A,e)})),d.firestore().collection("tasks").doc(e).collection("responses").onSnapshot((function(t){t.docChanges().forEach((function(t){"added"!==t.type&&"modified"!==t.type||Z((function(a){var n=Object.assign({},a);return n[e]||(n[e]={}),n[e][t.doc.id]=t.doc.data().contents,n})),"removed"===t.type&&Z((function(a){var n=Object.assign({},a);return delete n[e][t.doc.id],n}))}))}))}))}),[U]);var Me=function(e,t){var a=Object.assign({},e),n=Object.assign({},t);n.start=n.start?n.start:{},n.end=n.end?n.end:{},n.start_ui_schema=n.start_ui_schema?n.start_ui_schema:{},n.end_ui_schema=n.end_ui_schema?n.end_ui_schema:{},a.form_questions=a.form_questions?a.form_questions:{},a.ui_schema=a.ui_schema?a.ui_schema:{};var r=Object(g.a)(Object(g.a)(Object(g.a)({},n.start.properties?n.start.properties:{}),n.end.properties?n.end.properties:{}),a.form_questions.properties?a.form_questions.properties:{}),c=Object(g.a)(Object(g.a)(Object(g.a)({},n.start.definitions?n.start.definitions:{}),n.end.definitions?n.end.definitions:{}),a.form_questions.definitions?a.form_questions.definitions:{}),o="";a.form_questions.title?o=a.form_questions.title:n.end.title?o=n.end.title:n.start.title&&(o=n.start.title);var i="";a.form_questions.description?i=a.form_questions.description:n.end.description?i=n.end.description:n.start.description&&(i=n.start.description);var s=Object(Be.a)(new Set([].concat(Object(Be.a)(n.start.required?n.start.required:[]),Object(Be.a)(a.form_questions.required?a.form_questions.required:[]),Object(Be.a)(n.end.required?n.end.required:[])))),l=Object(Be.a)(new Set([].concat(Object(Be.a)(n.start_ui_schema["ui:order"]?n.start_ui_schema["ui:order"]:[]),Object(Be.a)(a.ui_schema["ui:order"]?a.ui_schema["ui:order"]:[]),Object(Be.a)(n.end_ui_schema["ui:order"]?n.end_ui_schema["ui:order"]:[])))),u=Object(g.a)(Object(g.a)(Object(g.a)({},n.start_ui_schema?n.start_ui_schema:{}),n.end_ui_schema?n.end_ui_schema:{}),a.ui_schema?a.ui_schema:{});return u=Object(g.a)(Object(g.a)({},u),{"ui:order":l}),"FAQ"===_.case_type&&"answer_the_question"===_.case_stage_id&&(u.answer=Object(g.a)(Object(g.a)({},u.answer),{},{sendOnBlur:!0})),{form_questions:{properties:r,definitions:c,title:o,description:i,required:s},ui_schema:u}},Ge=function(){we(!1)},Ve=function(){we(!1),Le.goBack()},He=function(e){return"object"===typeof a[e]&&null!==a[e]&&Object.values(a[e]).length>0||("object"!==typeof a[e]&&null!==a[e]&&""!==a[e]&&a[e]!=={}&&void 0!==a[e]||!(!E.ui_schema.hasOwnProperty(e)||!E.ui_schema[e].hasOwnProperty("ui:field")||"customFileUpload"!==E.ui_schema[e]["ui:field"])&&!!(Ee[e]&&Ee[e].contents&&Object.keys(Ee[e].contents).length>0))},Ke=function(e){console.log("Dialog open"),"send"===e&&(qe("send"),we(!0),Object.keys(a).forEach((function(e){E.ui_schema.hasOwnProperty(e)&&E.ui_schema[e].hasOwnProperty("ui:field")&&"customFileUpload"===E.ui_schema[e]["ui:field"]||re.collection("responses").doc(e).set({contents:a[e]?a[e]:""})}))),"release"===e&&(qe("release"),we(!0))},Qe=function(e){var t=d.firestore().collection("tasks").doc(ze).collection("user_editable").doc("user_editable");t.set({status:e}),"released"===e&&Fe.reasons&&(Fe.extra?t.update({status:e,release_status:Fe.reasons,release_description:Fe.extra}):t.update({status:e,release_status:Fe.reasons,release_description:""}))},Je={customImageWidget:function(e){return r.a.createElement("img",{src:e.value,alt:e.schema.title,style:{maxWidth:"100%",height:"auto"}})},customVideoWidget:function(e){return r.a.createElement("video",{title:e.schema.title,style:{maxWidth:"100%",height:"auto"},controls:!0},r.a.createElement("source",{src:e.value,type:"video/mp4"}))},customIframeWidget:function(e){return r.a.createElement("iframe",{title:e.schema.title,src:e.value,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}};return Ae?r.a.createElement(h.a,{style:{wordBreak:"break-word"}},"send"===Ce&&r.a.createElement(Ne,{state:_e,handleClose:Ge,handleOk:Ve,showOk:"sent"===se,title:"sent"===se?"\u0424\u043e\u0440\u043c\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0430.":"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0444\u043e\u0440\u043c\u0443?",content:"sent"===se?"\u0421\u043f\u0430\u0441\u0438\u0431\u043e":"\u0412\u044b \u0441\u043e\u0431\u0438\u0440\u0430\u0435\u0442\u0435\u0441\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0444\u043e\u0440\u043c\u0443. \u042d\u0442\u043e \u0437\u043d\u0430\u0447\u0438\u0442, \u0447\u0442\u043e \u0432\u044b \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u0441\u043c\u043e\u0436\u0435\u0442\u0435 \u0438\u0437\u043c\u0435\u043d\u044f\u0442\u044c \u043e\u0442\u0432\u0435\u0442\u044b.",dialogFunction:function(){Qe("complete")}}),"release"===Ce&&r.a.createElement(G.a,{open:_e,onClose:Ge},"released"===se&&r.a.createElement(Q.a,{id:"alert-dialog-title"},"\u0424\u043e\u0440\u043c\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043e\u0441\u0432\u043e\u0431\u043e\u0436\u0434\u0435\u043d\u0430. \u0422\u0435\u043f\u0435\u0440\u044c \u0435\u044e \u0441\u043c\u043e\u0436\u0435\u0442 \u0437\u0430\u043d\u044f\u0442\u044c\u0441\u044f \u043a\u0442\u043e-\u0442\u043e \u0435\u0449\u0435."),r.a.createElement(H.a,null,"released"===se?r.a.createElement(K.a,null,"\u0421\u043f\u0430\u0441\u0438\u0431\u043e"):r.a.createElement(zt.a,{schema:C[_.case_stage_id].releaseFeedback_schema,uiSchema:C[_.case_stage_id].releaseFeedback_ui,formData:Fe,widgets:Je,onChange:function(e){var t;Te((t=e).formData),console.log("event",t.formData)},onSubmit:function(){return Qe("released")}},r.a.createElement(V.a,null,r.a.createElement(q.a,{onClick:Ge,color:"primary"},"\u041e\u0442\u043c\u0435\u043d\u0430"),r.a.createElement(q.a,{type:"submit",color:"primary",autoFocus:!0},"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c")))),"released"===se&&r.a.createElement(V.a,null,r.a.createElement(q.a,{onClick:Ve,color:"primary"},"Ok"))),Object.keys(C).length>0&&Object.keys(_).length>0&&C[_.case_stage_id]&&C[_.case_stage_id].backgroundStages&&C[_.case_stage_id].backgroundStages.length>0&&Object.keys(L).length>0?r.a.createElement(h.a,{style:{paddingBottom:30}},C[_.case_stage_id].backgroundStages.map((function(e){return r.a.createElement("div",{key:e},L[e]?Object.keys(L[e]).map((function(t){return r.a.createElement(h.a,{style:{paddingBottom:30},key:t},r.a.createElement(zt.a,{schema:L[e][t].form_questions,uiSchema:L[e][t].ui_schema,formData:Y[t],widgets:Je,fields:{customFileUpload:function(e){return ft(Object(g.a)(Object(g.a)(Object(g.a)({},e),{taskID:t}),{currentUserUid:Ae.uid}))}},disabled:!0}," "))})):null)}))):null,E&&re&&C&&_&&_.case_stage_id&&C[_.case_stage_id]?r.a.createElement(zt.a,{schema:E.form_questions,uiSchema:E.ui_schema,formData:a,fields:{CustomUIKField:function(e){return Nt(Object(g.a)(Object(g.a)(Object(g.a)(Object(g.a)(Object(g.a)({},e),{metadata:_}),{initResp:Ee}),{prevResp:he}),{taskID:ze}))},NewCustomUIKField:function(e){return Lt(Object(g.a)(Object(g.a)(Object(g.a)(Object(g.a)(Object(g.a)({},e),{metadata:_}),{initResp:Ee}),{prevResp:he}),{taskID:ze}))},customFileUpload:function(e){return ft(Object(g.a)(Object(g.a)(Object(g.a)(Object(g.a)(Object(g.a)(Object(g.a)({},e),{taskID:ze}),{initResp:Ee}),{currentUserUid:Ae.uid}),{metadata:_}),{stage:C[_.case_stage_id]}))}},disabled:"loading"===se||"sent"===se||"released"===se,widgets:Je,omitExtraData:!0,liveOmit:!0,formContext:a,noHtml5Validate:!0,onChange:function(e){!function(e){Object.keys(e.formData).forEach((function(t){var n={};Object(ot.isEqual)(e.formData[t],a[t])||(n=e.formData[t],console.log(n),me(t),c((function(e){return Object(g.a)(Object(g.a)({},e),{},Object(j.a)({},t,n))})),a.hasOwnProperty(t)&&"object"===typeof n&&null!==n&&Object.keys(n).length>0?Object.keys(n).forEach((function(r){Object(ot.isEqual)(e.formData[t][r],a[t][r])||E.ui_schema.hasOwnProperty(t)&&E.ui_schema[t].hasOwnProperty(r)&&E.ui_schema[t][r].hasOwnProperty("ui:field")&&"customFileUpload"===E.ui_schema[t][r]["ui:field"]||E.ui_schema.hasOwnProperty(t)&&E.ui_schema[t].hasOwnProperty(r)&&E.ui_schema[t][r].hasOwnProperty("sendOnBlur")&&E.ui_schema[t][r].sendOnBlur||re.collection("responses").doc(t).set({contents:n}).then((function(){return console.log("changed value object k: ",t," response:",Object(j.a)({},r,n[r]))}))})):E.ui_schema.hasOwnProperty(t)&&E.ui_schema[t].hasOwnProperty("ui:field")&&"customFileUpload"===E.ui_schema[t]["ui:field"]||E.ui_schema.hasOwnProperty(t)&&E.ui_schema[t].hasOwnProperty("sendOnBlur")&&E.ui_schema[t].sendOnBlur||"object"===typeof n&&null!==n&&0===Object.keys(n).length||re.collection("responses").doc(t).set({contents:n}).then((function(){return console.log("changed value k: ",t," response:",n)})))}))}(e)},onFocus:function(e){console.log("That is what was focused",e),te(e.split("_")[1])},onSubmit:function(){return Ke("send")},onBlur:function(e,t){!function(e,t){re&&(console.log("Responses: ",a),console.log("That is what was blured",e),Object.keys(a).forEach((function(e){"object"===typeof a[e]&&null!==a[e]?Object.keys(a[e]).forEach((function(t){E.ui_schema.hasOwnProperty(e)&&E.ui_schema[e].hasOwnProperty(t)&&E.ui_schema[e][t].hasOwnProperty("sendOnBlur")&&E.ui_schema[e][t].sendOnBlur&&e===fe&&re.collection("responses").doc(e).set({contents:Object(j.a)({},t,a[e][t])},{merge:!0}).then((function(){return console.log("changed value object k: ",e," response:",Object(j.a)({},t,a[e][t]))}))})):E.ui_schema.hasOwnProperty(e)&&E.ui_schema[e].hasOwnProperty("sendOnBlur")&&E.ui_schema[e].sendOnBlur&&e===fe&&re.collection("responses").doc(e).set({contents:a[e]}).then((function(){return console.log("changed value k: ",e," response:",a[e])}))})))}(e)}},"sent"===se?r.a.createElement("div",null,"\u0424\u043e\u0440\u043c\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e"):null,"ready"===se?r.a.createElement("div",null,C[_.case_stage_id].additionalButtons&&C[_.case_stage_id].additionalButtons.includes("release")?r.a.createElement(q.a,{variant:"outlined",disabled:"loading"===se||"sent"===se||"released"===se,style:{borderWidth:2,borderColor:"#003366",color:"#003366",margin:5},onClick:function(){return Ke("release")}},"\u041e\u0441\u0432\u043e\u0431\u043e\u0434\u0438\u0442\u044c"):null,!Re&&r.a.createElement(I.a,{color:"error"},"\u0412\u044b \u043d\u0435 \u043c\u043e\u0436\u0435\u0442\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c, \u043f\u043e\u043a\u0430 \u043d\u0435 \u0437\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u0435 \u0432\u0441\u0435 \u043f\u043e\u043b\u044f"),r.a.createElement(q.a,{type:"submit",variant:"outlined",disabled:"loading"===se||"sent"===se||"released"===se||!Re,style:Re?{borderWidth:2,borderColor:"red",color:"red",margin:5}:null},"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c")):null,"released"===se?r.a.createElement("div",null,"\u0412\u044b \u043e\u0441\u0432\u043e\u0431\u043e\u0434\u0438\u043b\u0438 \u044d\u0442\u0443 \u0444\u043e\u0440\u043c\u0443 \u0438 \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442\u0435 \u0435\u0435 \u0437\u0430\u043f\u043e\u043b\u043d\u044f\u0442\u044c."):null):null):r.a.createElement(h.a,{container:!0,direction:"column",style:{padding:20},justify:"center"},r.a.createElement(I.a,{align:"center",variant:"h3"},"\u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044c"),r.a.createElement("br",null),r.a.createElement(q.a,{variant:"contained",onClick:u},"\u0412\u043e\u0439\u0442\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google"))}),Gt=function(e){var t=Object(b.h)(),a=t.prefix,c=t.id,o=Object(n.useState)([]),s=Object(i.a)(o,2),l=s[0],u=s[1];return Object(n.useEffect)((function(){c&&a&&d.firestore().collection("badges").where("prefix","==",a).where("number","==",parseInt(c)).get().then((function(e){var t=[];return e.forEach((function(e){e.data().file_url&&t.push(r.a.createElement(h.a,{container:!0,item:!0,justify:"center",key:e.id},r.a.createElement("img",{style:{maxWidth:"100%"},src:e.data().file_url,alt:e.data().file_url})))})),t})).then((function(e){console.log("TMP",e),u(e)}))}),[c,a]),l.length>0?r.a.createElement(h.a,{container:!0,direction:"column",justify:"center",spacing:1},r.a.createElement(h.a,{item:!0},r.a.createElement(I.a,{align:"center",variant:"h6"},"\u0423\u0434\u043e\u0441\u0442\u043e\u0432\u0435\u0440\u0435\u043d\u0438\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u043e 16.04.2021\u0433. \u041c\u044b \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u043c, \u0447\u0442\u043e \u044d\u0442\u043e\u0442 \u0447\u0435\u043b\u043e\u0432\u0435\u043a \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0432\u043d\u0435\u0448\u0442\u0430\u0442\u043d\u044b\u043c \u0436\u0443\u0440\u043d\u0430\u043b\u0438\u0441\u0442\u043e\u043c \xab\u041a\u043b\u043e\u043e\u043f \u041c\u0435\u0434\u0438\u0430\xbb.")),r.a.createElement(h.a,{item:!0},r.a.createElement(I.a,{align:"center",variant:"h6"},"\u041a\u04af\u0431\u04e9\u043b\u04af\u043a 16.04.21 \u0447\u0435\u0439\u0438\u043d \u0436\u0430\u0440\u0430\u043a\u0442\u0443\u0443. \u0411\u0438\u0437 \u0431\u0443\u043b \u0430\u0434\u0430\u043c \xab\u041a\u043b\u043e\u043e\u043f \u041c\u0435\u0434\u0438\u0430\u043d\u044b\u043d\xbb \u0448\u0442\u0430\u0442\u0442\u0430\u043d \u0442\u044b\u0448\u043a\u0430\u0440\u043a\u044b \u0436\u0443\u0440\u043d\u0430\u043b\u0438\u0441\u0442\u0438 \u044d\u043a\u0435\u043d\u0438\u043d \u0442\u0430\u0441\u0442\u044b\u043a\u0442\u0430\u0439\u0431\u044b\u0437.")),l[0]):r.a.createElement(h.a,{container:!0,direction:"column",justify:"center",spacing:1},r.a.createElement(h.a,{item:!0},r.a.createElement(I.a,{align:"center",variant:"h5"},"\u0415\u0441\u043b\u0438 \u0441\u0441\u044b\u043b\u043a\u0430 \u043d\u0435 \u043e\u0442\u043a\u0440\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u2014  \u0437\u043d\u0430\u0447\u0438\u0442, \u0443 \u043d\u0430\u0441 \u043d\u0435\u0442 \u0442\u0430\u043a\u043e\u0433\u043e \u0432\u043d\u0435\u0448\u0442\u0430\u0442\u043d\u043e\u0433\u043e \u0436\u0443\u0440\u043d\u0430\u043b\u0438\u0441\u0442\u0430, \u044d\u0442\u043e \u043c\u043e\u0433\u0443\u0442 \u0431\u044b\u0442\u044c \u043c\u043e\u0448\u0435\u043d\u043d\u0438\u043a\u0438.")),r.a.createElement(h.a,{item:!0},r.a.createElement(I.a,{align:"center",variant:"h5"},"\u042d\u0433\u0435\u0440\u0434\u0435 \u0448\u0438\u043b\u0442\u0435\u043c\u0435 \u0430\u0447\u044b\u043b\u0431\u0430\u0439 \u0436\u0430\u0442\u0441\u0430, \u0434\u0435\u043c\u0435\u043a \u0431\u0438\u0437\u0434\u0438\u043d \u043c\u044b\u043d\u0434\u0430\u0439 \u0448\u0442\u0430\u0442\u0442\u0430\u043d \u0442\u044b\u0448\u043a\u0430\u0440\u043a\u044b \u0436\u0443\u0440\u043d\u0430\u043b\u0438\u0441\u0442\u0438\u0431\u0438\u0437 \u0436\u043e\u043a. \u0411\u0443\u043b \u0430\u0444\u0435\u0440\u0438\u0441\u0442\u0442\u0435\u0440 \u0431\u043e\u043b\u0443\u0448\u0443 \u043c\u04af\u043c\u043a\u04af\u043d.")))},Vt=a(409),Ht=function(e){var t=Object(n.useContext)(f).currentUser,a=Object(n.useState)([]),c=Object(i.a)(a,2),o=c[0],s=c[1],l=function(){var e=Object(ne.a)(ae.a.mark((function e(t){var a;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){var a=new FileReader;a.onload=function(){return e(a.result)},a.readAsDataURL(t)}));case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),u=function(e){return new Promise((function(t,a){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onreadystatechange=function(r){4===n.readyState&&(200===n.status?t(n.response):a(new Error("Ajax error for "+e+": "+n.status)))},n.send()}))},m=function(){var e=Object(ne.a)(ae.a.mark((function e(t,a){var n,r,c;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(t);case 2:return n=e.sent,e.next=5,l(n);case 5:r=e.sent,(c=new Vt.a).addImage(r,"JPEG",0,0,70,105),c.save(a);case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){t&&d.firestore().collection("badges").where("user_id","==",t.uid).get().then((function(e){var t=[];return e.forEach((function(e){e.data().file_url&&t.push(r.a.createElement(h.a,{container:!0,item:!0,justify:"center",style:{paddingTop:10}},r.a.createElement(h.a,{container:!0,item:!0,justify:"center"},r.a.createElement(q.a,{variant:"contained",color:"primary",onClick:function(){return m(e.data().file_url,e.id)}},"\u0421\u043a\u0430\u0447\u0430\u0442\u044c PDF")),r.a.createElement(h.a,{container:!0,item:!0,justify:"center",key:e.id},r.a.createElement("img",{style:{maxWidth:"100%"},src:e.data().file_url,alt:e.data().file_url}))))})),t})).then((function(e){console.log("TMP",e),s(e)}))}),[t]),o.length>0?r.a.createElement(h.a,{container:!0,direction:"column",justify:"center",spacing:1},r.a.createElement(h.a,{item:!0},r.a.createElement(I.a,{align:"center",variant:"h6"},"\u0423\u0434\u043e\u0441\u0442\u043e\u0432\u0435\u0440\u0435\u043d\u0438\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u043e 16.04.2021\u0433. \u041c\u044b \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u043c, \u0447\u0442\u043e \u044d\u0442\u043e\u0442 \u0447\u0435\u043b\u043e\u0432\u0435\u043a \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0432\u043d\u0435\u0448\u0442\u0430\u0442\u043d\u044b\u043c \u0436\u0443\u0440\u043d\u0430\u043b\u0438\u0441\u0442\u043e\u043c \xab\u041a\u043b\u043e\u043e\u043f \u041c\u0435\u0434\u0438\u0430\xbb.")),r.a.createElement(h.a,{item:!0},r.a.createElement(I.a,{align:"center",variant:"h6"},"\u041a\u04af\u0431\u04e9\u043b\u04af\u043a 16.04.21 \u0447\u0435\u0439\u0438\u043d \u0436\u0430\u0440\u0430\u043a\u0442\u0443\u0443. \u0411\u0438\u0437 \u0431\u0443\u043b \u0430\u0434\u0430\u043c \xab\u041a\u043b\u043e\u043e\u043f \u041c\u0435\u0434\u0438\u0430\u043d\u044b\u043d\xbb \u0448\u0442\u0430\u0442\u0442\u0430\u043d \u0442\u044b\u0448\u043a\u0430\u0440\u043a\u044b \u0436\u0443\u0440\u043d\u0430\u043b\u0438\u0441\u0442\u0438 \u044d\u043a\u0435\u043d\u0438\u043d \u0442\u0430\u0441\u0442\u044b\u043a\u0442\u0430\u0439\u0431\u044b\u0437.")),o):r.a.createElement(h.a,{container:!0,direction:"column",justify:"center",spacing:1},r.a.createElement(h.a,{item:!0},r.a.createElement(I.a,{align:"center",variant:"h6"},"\u0423 \u0432\u0430\u0441 \u043d\u0435\u0442 \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 \u0443\u0434\u043e\u0441\u0442\u043e\u0432\u0435\u0440\u0435\u043d\u0438\u0439.")),r.a.createElement(h.a,{item:!0},r.a.createElement(I.a,{align:"center",variant:"h6"},"\u0421\u0438\u0437\u0434\u0438\u043d \u0430\u043a\u0442\u0438\u0432\u0434\u04af\u04af \u043a\u04af\u0431\u04e9\u043b\u04af\u0433\u04af\u04a3\u04af\u0437 \u0436\u043e\u043a.")))},Kt=function(){var e=Object(n.useContext)(f).currentUser,t=Object(n.useState)(""),a=Object(i.a)(t,2),c=a[0],o=a[1];return Object(n.useEffect)((function(){var t=function(){};return e&&(t=d.firestore().collection("users").doc(e.uid).collection("user_private").doc("private").onSnapshot((function(e){e.exists&&"tg_id"in e.data()&&(console.log("APP TGID: ",e.data().tg_id),o(e.data().tg_id))}))),function(){t()}}),[e]),r.a.createElement(p.a,null,r.a.createElement(h.a,{container:!0,justify:"center"},r.a.createElement(A,null,""!==c?r.a.createElement(b.d,null,r.a.createElement(b.b,{exact:!0,path:"/profile"},r.a.createElement(ke,null)),r.a.createElement(b.b,{exact:!0,path:"/request"},r.a.createElement(Ke,null)),r.a.createElement(b.b,{exact:!0,path:"/tasks"},r.a.createElement(Re,null)),r.a.createElement(b.b,{path:"/tasks/:id"},r.a.createElement(Ge,null)),r.a.createElement(b.b,{path:"/t/:id"},r.a.createElement(Mt,null)),r.a.createElement(b.b,{exact:!0,path:"/tasksObserver"},r.a.createElement(vt,null)),r.a.createElement(b.b,{exact:!0,path:"/notifications"},r.a.createElement(Xe,null)),r.a.createElement(b.b,{exact:!0,path:"/signin"},r.a.createElement(yt,null)),r.a.createElement(b.b,{exact:!0,path:"/faq"},r.a.createElement(qt,null)),r.a.createElement(b.b,{exact:!0,path:"/badges/:prefix/:id"},r.a.createElement(Gt,null)),r.a.createElement(b.b,{exact:!0,path:"/mybadges"},r.a.createElement(Ht,null)),r.a.createElement(b.b,{path:"/p/:id"},e?r.a.createElement(At,null):r.a.createElement(yt,null)),r.a.createElement(kt,{path:"/",component:nt})):r.a.createElement(b.d,null,r.a.createElement(b.b,{exact:!0,path:"/badges/:prefix/:id"},r.a.createElement(Gt,null)),r.a.createElement(b.b,null,r.a.createElement(nt,null))))))},Qt=function(e){e&&e instanceof Function&&a.e(6).then(a.bind(null,1291)).then((function(t){var a=t.getCLS,n=t.getFID,r=t.getFCP,c=t.getLCP,o=t.getTTFB;a(e),n(e),r(e),c(e),o(e)}))};o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(m,null,r.a.createElement(Kt,null))),document.getElementById("root")),Qt()}},[[795,1,2]]]);
//# sourceMappingURL=main.a745d67c.chunk.js.map