(this.webpackJsonpjournal=this.webpackJsonpjournal||[]).push([[0],{416:function(e,t,n){},693:function(e,t,n){"use strict";n.r(t);var c=n(2),a=n(0),r=n.n(a),i=n(27),s=n.n(i),o=(n(416),n(7)),l=n(82);l.a.initializeApp({apiKey:"AIzaSyBfzhQOCtbcUk_tWjPDnjYtHwoouCEkclg",authDomain:"journal-bb5e3.firebaseapp.com",databaseURL:"https://journal-bb5e3.firebaseio.com",projectId:"journal-bb5e3",storageBucket:"journal-bb5e3.appspot.com",messagingSenderId:"918752509407",appId:"1:918752509407:web:77670a68ff906f13e5d86a"});var d=new l.a.auth.GoogleAuthProvider,u=function(){l.a.auth().signInWithPopup(d)},j=l.a,b=r.a.createContext(),f=function(e){var t=e.children,n=Object(a.useState)(null),r=Object(o.a)(n,2),i=r[0],s=r[1],l=Object(a.useState)(!0),d=Object(o.a)(l,2),u=(d[0],d[1]);return Object(a.useEffect)((function(){j.auth().onAuthStateChanged((function(e){s(e),u(!1);var t=j.firestore().collection("users");if(e){var n=t.doc(e.uid);n.get().then((function(t){t&&t.exists?console.log("User Exist"):(console.log("Creating user"),n.set({username:e.displayName,email:e.email,created_date:j.firestore.FieldValue.serverTimestamp()}))}))}}))}),[]),Object(c.jsx)(b.Provider,{value:{currentUser:i},children:t})},O=n(60),h=n(23),p=n(749),x=n(14),g=n.n(x),m=n(24),v=n(12),y=n(28),k=n(747),w=n(746),S=n(744),_=n(779),C=n(774),E=n(697),q=n(355),I=n.n(q),F=n(382),D=n(748),T=n(753),U=n(191),A=n(742),N=n(33),z=n.p+"static/media/kloop_transparent_site.f6fb098e.png",P=n(356),R=n.n(P),B=n(750),W=240,L=Object(A.a)((function(e){return{root:{display:"flex"},drawer:Object(y.a)({},e.breakpoints.up("sm"),{width:W,flexShrink:0}),appBar:Object(y.a)({background:"white",boxShadow:"none"},e.breakpoints.up("sm"),{width:"calc(100% - ".concat(W,"px)"),marginLeft:W}),menuButton:Object(y.a)({color:"black",marginRight:e.spacing(2)},e.breakpoints.up("sm"),{display:"none"}),toolbar:e.mixins.toolbar,drawerPaper:{width:W},content:{flexGrow:1,padding:e.spacing(3)}}}));var M=function(e){var t=e.window,n=L(),i=Object(N.a)(),s=r.a.useState(!1),l=Object(o.a)(s,2),d=l[0],f=l[1],h=Object(a.useContext)(b).currentUser,x=r.a.useState(null),q=Object(o.a)(x,2),A=q[0],P=q[1],W=Boolean(A),M=function(){f(!d)},G=Object(a.useState)(!1),V=Object(o.a)(G,2),Q=V[0],H=V[1],K=Object(a.useState)(0),J=Object(o.a)(K,2),Y=J[0],Z=J[1],X=Object(a.useState)([]),$=Object(o.a)(X,2),ee=$[0],te=$[1],ne=Object(a.useState)([]),ce=Object(o.a)(ne,2),ae=ce[0],re=ce[1],ie=Object(a.useState)({}),se=Object(o.a)(ie,2),oe=se[0],le=se[1];Object(a.useEffect)((function(){h&&j.firestore().collection("editors").get().then((function(e){e.forEach((function(e){e.id===h.uid&&(console.log("moderator"),H(!0))}))})).catch((function(){return H(!1)}))}),[h]),Object(a.useEffect)((function(){h&&j.firestore().collection("users").doc(h.uid).collection("user_private").doc("private").onSnapshot((function(e){re(e.data().ranks),console.log("User ranks: ",e.data().ranks)}))}),[h]),Object(a.useEffect)((function(){ae.length>0&&j.firestore().collection("pages").where("ranks","array-contains-any",ae).onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||(le((function(t){return Object(v.a)(Object(v.a)({},t),{},Object(y.a)({},e.doc.id,e.doc.data()))})),console.log("User pages: ",e.doc.id))}))}))}),[ae]),Object(a.useEffect)((function(){if(h){var e=j.firestore().collection("notifications").where("user_id","array-contains",h.uid).onSnapshot(function(){var e=Object(m.a)(g.a.mark((function e(t){var n,c;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(t.size),n=[],c=0,t.forEach((function(e){e.data().shown||(n.push(Object(v.a)({id:e.id},e.data())),c++)})),n.sort((function(e,t){return t.created_date.toDate()-e.created_date.toDate()})),Z(c),te(n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());return function(){return e()}}}),[h]);var de=Object(c.jsxs)("div",{children:[Object(c.jsx)("div",{className:n.toolbar}),Object(c.jsx)(S.a,{}),Object(c.jsx)("nav",{children:Object(c.jsxs)("ul",{children:[Object(c.jsx)("li",{children:Object(c.jsx)(O.b,{to:"/",children:"\u0413\u043b\u0430\u0432\u043d\u0430\u044f"})}),Object(c.jsx)("li",{children:Object(c.jsx)(O.b,{to:"/profile",children:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"})}),Object(c.jsx)("li",{children:Object(c.jsx)(O.b,{to:"/notifications",children:"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f"})}),Q?Object(c.jsx)("li",{children:Object(c.jsx)(O.b,{to:"/tasksObserver",children:"\u041c\u043e\u0434\u0435\u0440\u0430\u0442\u043e\u0440"})}):null,Q?Object(c.jsx)("li",{children:Object(c.jsx)(O.b,{to:"/faq",children:"FAQ \u0434\u043b\u044f \u043c\u043e\u0434\u0435\u0440\u0430\u0442\u043e\u0440\u043e\u0432"})}):null,Object(c.jsx)("li",{children:Object.keys(oe).map((function(e){return Object(c.jsx)(O.b,{to:"/p/"+e,children:oe[e].name},e)}))})]})})]}),ue=void 0!==t?function(){return t().document.body}:void 0;return Object(c.jsxs)("div",{className:n.root,children:[Object(c.jsx)(w.a,{}),Object(c.jsx)(k.a,{position:"fixed",className:n.appBar,children:Object(c.jsxs)(D.a,{children:[Object(c.jsx)(E.a,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:M,className:n.menuButton,children:Object(c.jsx)(I.a,{})}),Object(c.jsx)(p.a,{container:!0,style:{flexGrow:1},children:Object(c.jsx)("img",{src:z,alt:"Kloop.kg - \u041d\u043e\u0432\u043e\u0441\u0442\u0438 \u041a\u044b\u0440\u0433\u044b\u0437\u0441\u0442\u0430\u043d\u0430",style:{width:150,height:"auto"}})}),h&&Object(c.jsxs)("div",{children:[Object(c.jsx)(E.a,{"aria-label":"account of current user","aria-controls":"menu-appbar","aria-haspopup":"true",onClick:function(e){P(e.currentTarget)},color:"inherit",size:"small",children:Object(c.jsx)(B.a,{badgeContent:Y,color:"secondary",overlap:"circle",children:Object(c.jsx)(R.a,{style:{fill:"grey",fontSize:"28px"}})})}),Object(c.jsx)(F.a,{id:"menu-appbar",anchorEl:A,anchorOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:W,onClose:function(){P(null)},children:Object(c.jsx)(p.a,{container:!0,direction:"column",alignItems:"center",children:ee.length>0?ee.map((function(e,t){return Object(c.jsxs)(p.a,{container:!0,className:n.message,justify:"flex-start",style:{padding:0},children:[Object(c.jsx)(U.a,{style:{flex:1,padding:10},children:e.title}),Object(c.jsx)(T.a,{style:{padding:10},onClick:function(){return t=e.id,void j.firestore().collection("notifications").doc(t).update({shown:!0});var t},size:"small",children:"\u0441\u043a\u0440\u044b\u0442\u044c"})]},"notification_"+t)})):Object(c.jsx)(U.a,{className:n.message,align:"center",style:{padding:10},children:"\u041d\u0435\u0442 \u043d\u043e\u0432\u044b\u0445 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0439"})})})]}),h?Object(c.jsxs)("div",{children:[Object(c.jsx)("span",{style:{color:"black",fontSize:12,marginLeft:7},children:h.email}),Object(c.jsx)(T.a,{style:{borderColor:"black",color:"black",marginLeft:10,fontSize:12},variant:"outlined",size:"small",onClick:function(){return j.auth().signOut()},children:"\u0412\u044b\u0445\u043e\u0434"})]}):Object(c.jsx)(T.a,{style:{borderColor:"black",color:"black",marginLeft:10,fontSize:12},size:"small",variant:"outlined",onClick:u,children:"\u0432\u0445\u043e\u0434"})]})}),Object(c.jsxs)("nav",{className:n.drawer,"aria-label":"mailbox folders",children:[Object(c.jsx)(C.a,{smUp:!0,implementation:"css",children:Object(c.jsx)(_.a,{container:ue,variant:"temporary",anchor:"rtl"===i.direction?"right":"left",open:d,onClose:M,classes:{paper:n.drawerPaper},ModalProps:{keepMounted:!0},children:de})}),Object(c.jsx)(C.a,{xsDown:!0,implementation:"css",children:Object(c.jsx)(_.a,{classes:{paper:n.drawerPaper},variant:"permanent",open:!0,children:de})})]}),Object(c.jsxs)("main",{className:n.content,children:[Object(c.jsx)("div",{className:n.toolbar}),e.children]})]})},G=n(756),V=n(772),Q=n(251),H=n.n(Q),K=n(757),J=n(761),Y=n(759),Z=n(760),X=n(758),$=n(775),ee=n(754),te=n(755),ne=n(699),ce=function(e){var t=Object(a.useState)(null),n=Object(o.a)(t,2),r=n[0],i=n[1],s=Object(a.useState)(""),l=Object(o.a)(s,2),d=l[0],u=l[1],j=e.returnAnswer;return Object(c.jsxs)("div",{children:[Object(c.jsx)("h4",{children:e.title}),Object(c.jsx)(ne.a,{const:"fieldset",style:{paddingBottom:15},children:Object(c.jsx)(ee.a,{"aria-label":e.title,name:e.title,value:r,onChange:function(e){i(e.target.value),j({reason:e.target.value,text:d})},children:e.answers.map((function(t,n){return Object(c.jsx)(te.a,{value:t,control:Object(c.jsx)($.a,{color:"primary"}),label:t,disabled:!!e.locked},n)}))})}),Object(c.jsx)(G.a,{id:"feedback_input",label:"\u041f\u0440\u0438\u043c\u0435\u0447\u0430\u043d\u0438\u0435",value:d,onChange:function(e){u(e.target.value),j({reason:r,text:e.target.value})},multiline:!0,rows:5,variant:"outlined",fullWidth:!0})]})};function ae(e){return Object(c.jsx)("div",{children:Object(c.jsxs)(K.a,{open:e.state,onClose:e.handleClose,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[Object(c.jsx)(X.a,{id:"alert-dialog-title",children:e.title}),Object(c.jsx)(Y.a,{children:Object(c.jsxs)(Z.a,{id:"alert-dialog-description",children:[Object(c.jsx)(U.a,{children:e.description}),Object(c.jsx)(ce,{answers:e.answers,returnAnswer:e.returnFeedback})]})}),Object(c.jsxs)(J.a,{children:[Object(c.jsx)(T.a,{onClick:e.handleClose,color:"primary",children:"\u041e\u0442\u043c\u0435\u043d\u0430"}),Object(c.jsx)(T.a,{onClick:e.dialogFunction,disabled:!e.feedbackValue.reason,color:"primary",autoFocus:!0,children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})})}var re=n(763),ie=(n(358),n(359),n(762)),se=function(e){return Object(c.jsxs)(V.a,{display:"flex",alignItems:"center",children:[Object(c.jsx)(V.a,{width:"100%",mr:1,children:Object(c.jsx)(ie.a,Object(v.a)({variant:"determinate"},e))}),Object(c.jsx)(V.a,{minWidth:35,children:Object(c.jsx)(U.a,{variant:"body2",color:"textSecondary",children:"".concat(Math.round(e.value),"%")})})]})},oe=Object(A.a)((function(e){return{root:{"& > *":{width:"40ch"}}}})),le=function(e){oe();var t=r.a.useState(""),n=Object(o.a)(t,2),i=(n[0],n[1],Object(a.useState)(!1)),s=Object(o.a)(i,2),l=(s[0],s[1],Object(a.useState)({})),d=Object(o.a)(l,2),u=(d[0],d[1],Object(a.useState)({})),b=Object(o.a)(u,2),f=(b[0],b[1]),O=Object(a.useState)(!1),h=Object(o.a)(O,2),p=(h[0],h[1]),x=e.returnFile,g=(e.locked,e.id),m=e.feedbackType,v=e.askFeedback;e.saveQuestionFeedback,e.prevTaskId;Object(a.useEffect)((function(){console.log(m),m&&v?(console.log(m),j.firestore().collection("schema").doc("structure").collection("feedbacks").doc(m).get().then((function(e){f(e.data())})),p(!0)):p(!1)}),[m]);return Object(c.jsx)("div",{children:Object(c.jsx)("input",{type:"file",onChange:function(e){x(e.target.files,g)},multiple:!0})})},de=Object(A.a)((function(e){return{root:{"& > *":{width:"40ch"}}}})),ue=Object(a.forwardRef)((function(e,t){de();var n=r.a.useState(""),i=Object(o.a)(n,2),s=i[0],l=i[1],d=Object(a.useState)(!1),u=Object(o.a)(d,2),b=u[0],f=u[1],O=Object(a.useState)(null),h=Object(o.a)(O,2),p=(h[0],h[1],Object(a.useState)({})),x=Object(o.a)(p,2),g=x[0],m=x[1],v=Object(a.useState)({}),y=Object(o.a)(v,2),k=y[0],w=y[1],S=Object(a.useState)(!1),_=Object(o.a)(S,2),C=_[0],q=_[1],I=e.index,F=e.response,D=e.returnFile,T=e.locked,A=e.id,N=e.feedbackType,z=e.askFeedback,P=e.saveQuestionFeedback,R=e.prevTaskId,B=(e.uploadFilesData,e.attachMaterials);Object(a.useEffect)((function(){F&&l(F)}),[F]),Object(a.useEffect)((function(){N&&z?(console.log(N),j.firestore().collection("schema").doc("structure").collection("feedbacks").doc(N).get().then((function(e){w(e.data())})),q(!0)):q(!1)}),[N]);var W=function(){f(!1)};return Object(c.jsxs)("div",{children:[Object(c.jsx)(ae,{title:k.title,dialogFunction:function(){P(g,A,R),W()},state:b,handleClose:W,feedbackValue:g,answers:k.answers,description:k.description,returnFeedback:function(e){m(e)}}),Object(c.jsxs)(V.a,{display:"flex",style:{marginBottom:10,marginTop:20},children:[Object(c.jsx)(U.a,{variant:"h6",style:{paddingRight:8},children:e.title}),C&&Object(c.jsx)(E.a,{size:"small",onClick:function(){return f(!0)},children:Object(c.jsx)(H.a,{color:"primary"})})]}),Object(c.jsx)(G.a,{id:"inputBox"+I,label:"\u041c\u043e\u0439 \u043e\u0442\u0432\u0435\u0442",value:s,onChange:function(t){l(t.target.value),e.returnAnswer(t.target.value,e.index)},multiline:!0,rows:5,disabled:T,variant:"outlined",fullWidth:!0}),!T&&B&&Object(c.jsx)(le,{returnFile:D,locked:T,id:A})]})})),je=n(702),be=n(764),fe=n(709),Oe=Object(A.a)((function(e){return{formControl:{minWidth:100,maxWidth:300}}}));function he(e){var t=Oe(),n=r.a.useState(""),i=Object(o.a)(n,2),s=i[0],l=i[1],d=r.a.useState(!1),u=Object(o.a)(d,2),j=u[0],b=u[1],f=e.index,O=e.response,h=(e.required,e.locked);Object(a.useEffect)((function(){O&&l(O)}),[O]);return Object(c.jsxs)("div",{children:[Object(c.jsx)(U.a,{variant:"h6",style:{marginBottom:5,marginTop:20},children:e.title}),Object(c.jsxs)(ne.a,{className:t.formControl,disabled:h,children:[Object(c.jsx)(je.a,{id:"controlled-open-select-label",children:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c"}),Object(c.jsxs)(fe.a,{labelId:"controlled-open-select-label",id:"select"+f,open:j,onClose:function(e){b(!1)},onOpen:function(e){b(!0)},value:s,onChange:function(t){l(t.target.value);e.answers.indexOf(t.target.value);e.returnAnswer(t.target.value,f)},children:[Object(c.jsx)(be.a,{value:"",children:Object(c.jsx)("em",{children:"None"})}),e.answers.map((function(e,t){return Object(c.jsx)(be.a,{value:e,children:e},t)}))]})]})]})}function pe(e){var t=r.a.useState(""),n=Object(o.a)(t,2),i=n[0],s=n[1],l=e.index,d=e.response;Object(a.useEffect)((function(){d&&s(d)}),[d]);return Object(c.jsxs)("div",{children:[Object(c.jsx)("h4",{children:e.title}),Object(c.jsx)(ne.a,{const:"fieldset",children:Object(c.jsx)(ee.a,{"aria-label":e.title,name:e.title,value:i,onChange:function(t){s(t.target.value);var n=e.answers.indexOf(t.target.value);e.returnAnswer(t.target.value,l,n)},children:e.answers.map((function(t,n){return Object(c.jsx)(te.a,{value:t,control:Object(c.jsx)($.a,{color:"primary"}),label:t,disabled:!!e.locked},n)}))})})]})}var xe=Object(A.a)((function(e){return{container:{display:"flex",flexWrap:"wrap"},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:"auto"}}}));function ge(e){var t=xe(),n=r.a.useState(""),i=Object(o.a)(n,2),s=i[0],l=i[1],d=e.index,u=e.response;Object(a.useEffect)((function(){u&&l(u)}),[d,u]);return Object(c.jsxs)("div",{children:[Object(c.jsx)("h4",{children:e.title}),Object(c.jsx)("form",{className:t.container,noValidate:!0,children:Object(c.jsx)(G.a,{id:"time"+d,label:"\u0412\u0440\u0435\u043c\u044f",type:"time",value:s,onChange:function(t){l(t.target.value),e.returnAnswer(t.target.value,d,t.target.value)},className:t.textField,InputLabelProps:{shrink:!0},InputProps:{disableUnderline:!0},disabled:!!e.locked})})]})}var me=n(703),ve=n(700),ye=n(777);function ke(e){var t=r.a.useState({}),n=Object(o.a)(t,2),i=n[0],s=n[1],l=Object(a.useState)(!1),d=Object(o.a)(l,2),u=d[0],j=d[1],b=e.index,f=e.answers,O=(e.required,e.response),h=e.locked;Object(a.useEffect)((function(){if(O){s(O);var t={};f.forEach((function(e,n){O[e]?t[e]=O[e]:t[e]=!1})),s(t),e.returnAnswer(t,b)}else{var n={};f.forEach((function(e,t){return n[e]=!1})),e.returnAnswer(n,b)}j(!0),console.log(i)}),[O,f]);var p=function(t){s(Object(v.a)(Object(v.a)({},i),{},Object(y.a)({},t.target.name,t.target.checked))),e.returnAnswer(Object(v.a)(Object(v.a)({},i),{},Object(y.a)({},t.target.name,t.target.checked)),b)};return u?Object(c.jsxs)("div",{children:[Object(c.jsx)(U.a,{variant:"h6",style:{marginBottom:0,marginTop:20},children:e.title}),Object(c.jsxs)(ne.a,{component:"fieldset",disabled:h,children:[Object(c.jsx)(me.a,{component:"legend",children:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u0438\u043d \u0438\u043b\u0438 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u043e\u0432"}),Object(c.jsx)(ve.a,{children:f.map((function(e,t){return Object(c.jsx)(te.a,{control:Object(c.jsx)(ye.a,{checked:i[e],onChange:p,name:e}),label:e},t)}))})]})]}):null}var we=function(){var e=Object(a.useState)([]),t=Object(o.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)({}),s=Object(o.a)(i,2),l=s[0],d=s[1],f=Object(a.useState)([]),O=Object(o.a)(f,2),x=O[0],g=O[1],m=Object(a.useState)(!1),y=Object(o.a)(m,2),k=y[0],w=y[1],S=Object(a.useState)(!1),_=Object(o.a)(S,2),C=_[0],E=_[1],q=Object(a.useState)({}),I=Object(o.a)(q,2),F=(I[0],I[1]),D=Object(a.useContext)(b).currentUser;Object(a.useEffect)((function(){var e={};D&&j.firestore().collection("users").doc(D.uid).get().then((function(t){F(t.data()),e=t.data()})).then((function(){j.firestore().collection("profileTemplate").doc("Template").get().then((function(t){console.log(JSON.stringify(t.data())),r(t.data().questions),console.log(t.data().questions);var n=t.data().questions.map((function(t,n){var a=null;return e[t.key]&&(console.log(e[t.key]),a=e[t.key]),"input"===t.type?Object(c.jsx)(ue,{index:n,title:t.question,response:a,returnAnswer:A,required:t.required},"profile_"+n):"select"===t.type?Object(c.jsx)(he,{index:n,title:t.question,response:a,answers:t.answers,returnAnswer:A,required:t.required},"profile_"+n):"radio"===t.type?Object(c.jsx)(pe,{index:n,title:t.question,response:a,answers:t.answers,returnAnswer:A,required:t.required},"profile_"+n):"time"===t.type?Object(c.jsx)(ge,{index:n,title:t.question,response:a,returnAnswer:A,required:t.required},"profile_"+n):"checkbox"===t.type?Object(c.jsx)(ke,{index:n,title:t.question,response:a,answers:t.answers,returnAnswer:A,required:t.required},"profile_"+n):null}));g(n)}))}))}),[D]);var A=function(e,t){var n=l;n[t]=e,d(n),console.log(l)};return D?Object(c.jsxs)(p.a,{style:{padding:30},children:[C&&Object(c.jsx)(h.a,{to:"/"}),x,Object(c.jsxs)(p.a,{container:!0,style:{padding:20},justify:"center",children:[Object(c.jsx)(T.a,{variant:"outlined",style:{borderWidth:2,borderColor:"#003366",color:"#003366",margin:10},onClick:function(){var e={};n.forEach((function(t,n){l[n]&&(e[t.key]=l[n])})),j.firestore().collection("users").doc(D.uid).update(Object(v.a)({},e)).then((function(){return w(!0)}))},children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"}),k&&Object(c.jsx)(T.a,{variant:"outlined",style:{borderWidth:2,borderColor:"red",color:"red",margin:10},onClick:function(){return E(!0)},children:"\u041d\u0430 \u0433\u043b\u0430\u0432\u043d\u0443\u044e"})]})]}):Object(c.jsxs)(p.a,{container:!0,direction:"column",style:{padding:20},justify:"center",children:[Object(c.jsx)(U.a,{align:"center",variant:"h3",children:"\u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044c"}),Object(c.jsx)("br",{}),Object(c.jsx)(T.a,{variant:"contained",onClick:u,children:"\u0412\u043e\u0439\u0442\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google"})]})},Se=n(121),_e=n(262),Ce=n(773),Ee=n(768),qe=n(765),Ie=n(767),Fe=n(766),De=Object(A.a)({root:{minWidth:250},bullet:{display:"inline-block",margin:"0 2px"},title:{fontSize:14},pos:{marginBottom:12}}),Te=function(e){var t=De(),n=e.title,r=e.complete,i=e.type,s=(e.language,e.description),l=e.id,d=e.cardColor,u=e.sendRequest,j=e.disabled,b=Object(a.useState)(!1),f=Object(o.a)(b,2),O=f[0],p=f[1];return Object(c.jsxs)("div",{children:[O&&Object(c.jsx)(h.a,{to:"/tasks/"+l}),Object(c.jsxs)(qe.a,{className:t.root,style:{background:d},children:[Object(c.jsxs)(Fe.a,{children:[Object(c.jsxs)(V.a,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[Object(c.jsx)(U.a,{variant:"h6",children:n}),r&&Object(c.jsx)(U.a,{color:"error",children:"\u0421\u0434\u0430\u043d\u043e"})]}),Object(c.jsxs)(U.a,{variant:"subtitle1",className:t.pos,color:"textSecondary",children:["#",i]}),Object(c.jsxs)(U.a,{variant:"body2",component:"p",children:["\u0417\u0430\u0434\u0430\u043d\u0438\u0435: ",s]})]}),Object(c.jsx)(Ie.a,{children:u?Object(c.jsx)(T.a,{variant:"contained",disabled:j,color:"primary",size:"small",onClick:function(){return u(i,l)},children:"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435"}):Object(c.jsx)(T.a,{size:"small",onClick:function(){return p(!0)},children:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"})})]})]})};function Ue(e){var t=e.children,n=e.value,a=e.index,r=Object(Se.a)(e,["children","value","index"]);return Object(c.jsx)("div",Object(v.a)(Object(v.a)({role:"tabpanel",hidden:n!==a,id:"full-width-tabpanel-".concat(a),"aria-labelledby":"full-width-tab-".concat(a)},r),{},{children:n===a&&Object(c.jsx)(V.a,{p:3,children:Object(c.jsx)(U.a,{children:t})})}))}function Ae(e){return{id:"full-width-tab-".concat(e),"aria-controls":"full-width-tabpanel-".concat(e)}}var Ne=Object(A.a)({root:{paddingTop:30,flexGrow:1}}),ze=function(e){var t=Ne(),n=Object(a.useState)(null),r=Object(o.a)(n,2),i=r[0],s=r[1],l=Object(a.useState)(null),d=Object(o.a)(l,2),u=d[0],f=d[1],O=Object(a.useState)(null),h=Object(o.a)(O,2),x=(h[0],h[1],Object(a.useContext)(b).currentUser),g=Object(a.useState)(0),m=Object(o.a)(g,2),y=m[0],k=m[1];Object(a.useEffect)((function(){if(x){var e=[],t=[];console.log("Fired"),j.firestore().collection("tasks").where("assigned_users","array-contains",x.uid).get().then((function(n){n.forEach((function(n){console.log(n.id," => ",n.data()),n.data().is_complete?t.push(Object(v.a)({id:n.id},n.data())):e.push(Object(v.a)({id:n.id},n.data()))}))})).then((function(){s(e),f(t)})).catch((function(e){console.log("Error getting documents: ",e)}))}}),[x]);return Object(c.jsxs)(p.a,{container:!0,justify:"center",alignItems:"center",direction:"column",children:[Object(c.jsx)("div",{className:t.root,children:Object(c.jsx)(_e.a,{position:"static",color:"default",children:Object(c.jsxs)(Ce.a,{value:y,onChange:function(e,t){k(t)},variant:"fullWidth",centered:!0,"aria-label":"simple tabs example",children:[Object(c.jsx)(Ee.a,Object(v.a)({label:"\u041d\u0435\u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435"},Ae(0))),Object(c.jsx)(Ee.a,Object(v.a)({label:"\u0412\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435"},Ae(1)))]})})}),Object(c.jsx)(Ue,{value:y,index:0,children:i&&i.map((function(e,t){return Object(c.jsx)(p.a,{style:{padding:10},children:Object(c.jsx)(Te,{title:e.title,complete:e.is_complete,description:e.description,type:e.type,id:e.id})},"active_task_"+t)}))}),Object(c.jsx)(Ue,{value:y,index:1,children:u&&u.map((function(e,t){return Object(c.jsx)(p.a,{style:{padding:10},children:Object(c.jsx)(Te,{title:e.title,complete:e.is_complete,description:e.description,type:e.type,id:e.id})},"submitted_task_"+t)}))})]})},Pe=n(39);var Re=function(e){var t=e.title;return Object(c.jsx)("div",{children:Object(c.jsx)(U.a,{variant:"h6",style:{marginBottom:0,marginTop:20},children:t})})},Be=Object(a.forwardRef)((function(e,t){var n=e.question,a=e.index,r=e.response,i=e.uploadsRef,s=e.returnAnswer,o=e.locked,l=e.askFeedback,d=e.saveQuestionFeedback,u=e.id,j=e.prevTaskId,b=e.returnFile,f=e.uploadFilesData;return"input"===n.type?Object(c.jsx)(ue,{index:a,title:n.title,response:r,returnAnswer:s,required:n.required,locked:o,askFeedback:l,feedbackType:n.feedback_type,saveQuestionFeedback:d,id:u,prevTaskId:j,uploadFilesData:f,uploadsRef:i,returnFile:b,attachMaterials:n.attachMaterials},a):"select"===n.type?Object(c.jsx)(he,{index:a,title:n.title,response:r,answers:n.answers,returnAnswer:s,required:n.required,locked:o},a):"radio"===n.type?Object(c.jsx)(pe,{index:a,title:n.title,response:r,answers:n.answers,returnAnswer:s,required:n.required,locked:o},a):"time"===n.type?Object(c.jsx)(ge,{index:a,title:n.title,response:r,returnAnswer:s,required:n.required,locked:o},a):"checkbox"===n.type?Object(c.jsx)(ke,{index:a,title:n.title,response:r,answers:n.answers,returnAnswer:s,required:n.required,locked:o},a):"text"===n.type?Object(c.jsx)(Re,{title:n.title},a):"file"===n.type?Object(c.jsx)(le,{index:a,id:u,title:n.title,returnFile:b,locked:o,askFeedback:l,feedbackType:n.feedback_type,saveQuestionFeedback:d,prevTaskId:j},a):null}));function We(e){return Object(c.jsx)("div",{children:Object(c.jsxs)(K.a,{open:e.state,onClose:e.handleClose,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[Object(c.jsx)(X.a,{id:"alert-dialog-title",children:e.title}),Object(c.jsx)(Y.a,{children:Object(c.jsx)(Z.a,{id:"alert-dialog-description",children:e.content})}),e.hideActions?"":Object(c.jsxs)(J.a,{children:[Object(c.jsx)(T.a,{onClick:e.handleClose,color:"primary",children:"\u041e\u0442\u043c\u0435\u043d\u0430"}),Object(c.jsx)(T.a,{onClick:e.dialogFunction,color:"primary",autoFocus:!0,children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})})}var Le=n(778),Me=n(144),Ge=n.n(Me),Ve=function(){var e=Object(a.useState)([]),t=Object(o.a)(e,2),n=t[0],i=t[1],s=Object(a.useState)([]),l=Object(o.a)(s,2),d=(l[0],l[1]),f=Object(a.useState)({}),O=Object(o.a)(f,2),x=O[0],y=O[1],k=Object(a.useState)([]),w=Object(o.a)(k,2),S=w[0],_=w[1],C=Object(a.useState)(!1),q=Object(o.a)(C,2),I=q[0],F=q[1],D=Object(a.useState)(!1),A=Object(o.a)(D,2),N=A[0],z=A[1],P=Object(a.useState)({}),R=Object(o.a)(P,2),B=(R[0],R[1],Object(a.useState)(!1)),W=Object(o.a)(B,2),L=W[0],M=W[1],G=Object(a.useState)([]),V=Object(o.a)(G,2),Q=(V[0],V[1]),H=Object(a.useState)(!1),K=Object(o.a)(H,2),J=K[0],Y=K[1],Z=Object(a.useState)(null),X=Object(o.a)(Z,2),$=X[0],ee=X[1],te=Object(a.useState)({}),ne=Object(o.a)(te,2),ce=ne[0],ie=ne[1],se=Object(a.useState)({}),oe=Object(o.a)(se,2),le=oe[0],de=oe[1],ue=Object(a.useState)(!1),je=Object(o.a)(ue,2),be=je[0],fe=je[1],Oe=Object(a.useState)({}),he=Object(o.a)(Oe,2),pe=he[0],xe=he[1],ge=Object(a.useState)(!1),me=Object(o.a)(ge,2),ve=me[0],ye=me[1],ke=Object(a.useContext)(b).currentUser,we=Object(h.g)().id,Se=function(e,t){"clickaway"!==t&&fe(!1)};Object(a.useEffect)((function(){var e=function(){var e=Object(m.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],e.next=3,j.firestore().collection("tasks").doc(t).collection("questions").get().then((function(e){e.forEach((function(e){n.push({questionId:e.id,data:e.data()})}))})).catch((function(e){console.log("Error getting documents: ",e)}));case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t=function(){var e=Object(m.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],e.next=3,j.firestore().collection("tasks").doc(t).collection("responses").get().then((function(e){e.forEach((function(e){n.push({responseId:e.id,data:e.data()})}))})).catch((function(e){console.log("Error getting documents: ",e)}));case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n=function(){var e=Object(m.a)(g.a.mark((function e(){var t;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,j.firestore().collection("tasks").doc(we).get().then((function(e){return e.data()})).then(function(){var e=Object(m.a)(g.a.mark((function e(n){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.firestore().collection("tasks").where("case_id","==",n.case_id).get().then((function(e){e.forEach((function(e){e.id!==we&&t.push(Object(v.a)({id:e.id},e.data()))}))}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();ke&&function(){var a=Object(m.a)(g.a.mark((function a(){var r,s,o,l,u,b,f,O,h,p,x;return g.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return r=[],s=!0,_(null),a.next=5,j.firestore().collection("tasks").doc(we).collection("user_editable").doc("user_editable").get().then((function(e){"complete"===e.data().status?(s=!0,M(!0)):s=!1}));case 5:return o=[],l=[],a.next=9,n();case 9:if(u=a.sent,Q(u),!(u.length>0)){a.next=21;break}return b=u.map((function(t){return e(t.id)})),f=u.map((function(e){return t(e.id)})),console.log(b),a.next=17,Promise.all(b).then((function(e){return e.forEach((function(e){return o.push.apply(o,Object(Pe.a)(e))}))}));case 17:return a.next=19,Promise.all(f).then((function(e){return e.forEach((function(e){return l.push.apply(l,Object(Pe.a)(e))}))}));case 19:console.log(o),console.log(l);case 21:return(O=o.map((function(e,t){var n=null;return l.forEach((function(c){e.questionId===c.responseId&&(n=c.data.answer,_e(c.data.answer,t))})),Object(c.jsx)(Be,{question:e.data,index:t,response:n,returnAnswer:_e,locked:!0,askFeedback:!0,saveQuestionFeedback:qe,id:e.questionId,prevTaskId:u[0].id},e.questionId+"_"+t)}))).push(Object(c.jsx)("div",{style:{height:25,margin:"20px 0",background:"repeating-linear-gradient( 45deg, white, white 10px, grey 10px, grey 25px)"},children:Object(c.jsx)("br",{})},"div_divider_stripped")),a.next=25,e(we);case 25:return h=a.sent,a.next=28,t(we);case 28:p=a.sent,i(h),d(p),r=h.map((function(e,t){var n=null;return p.forEach((function(c){e.questionId===c.responseId&&(n=c.data.answer,_e(c.data.answer,t))})),Object(c.jsx)(Be,{question:e.data,index:t,response:n,returnFile:Ce,returnAnswer:_e,id:e.questionId,locked:s,uploadFilesData:Fe},e.questionId+"_"+t)})),x=O.concat(r),_(x);case 34:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}()()}),[ke,we,L]);var _e=function(e,t){var n=x;n[t]=e,y(n)},Ce=function(e,t){var n=Object(Pe.a)(e),c=pe;c[t]=n,xe(c),console.log(Object(Pe.a)(e),t)},Ee=function(){var e=Object(m.a)(g.a.mark((function e(){var t,n,c;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Object.keys(pe).length>0)){e.next=12;break}console.log("files"),ye(!0),t=g.a.mark((function e(){var t,a,r,i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(o.a)(c[n],2),a=t[0],r=t[1],i=j.storage().ref(we).child(a).child(ke.uid),e.next=4,Promise.all(r.map(function(){var e=Object(m.a)(g.a.mark((function e(t){var n,c,r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.child(t.name).put(t);case 2:return n=e.sent,e.next=5,n.ref.getDownloadURL();case 5:return c=e.sent,r=c.split("?")[0],e.next=9,Fe(t.name,r,a);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:case"end":return e.stop()}}),e)})),n=0,c=Object.entries(pe);case 5:if(!(n<c.length)){e.next=10;break}return e.delegateYield(t(),"t0",7);case 7:n++,e.next=5;break;case 10:F(!0),ye(!1);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),qe=function(e,t,n){n?j.firestore().collection("tasks").doc(n).collection("feedbacks").doc(t).collection("messages").add({answer:e.reason,text:e.text,user_id:ke.uid,timestamp:j.firestore.FieldValue.serverTimestamp()}).then((function(){return fe(!0)})):alert("\u041e\u0448\u0438\u0431\u043a\u0430: \u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a \u043f\u0440\u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0438 \u0444\u0438\u0434\u0431\u0435\u043a\u0430. \u0421\u043e\u043e\u0431\u0449\u0438\u0442\u0435 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0441\u0442\u0443!")},Ie=function(){var e=Object(m.a)(g.a.mark((function e(t){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee();case 2:if(n.forEach(function(){var e=Object(m.a)(g.a.mark((function e(t,n){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!x[n]&&""!==x[n]){e.next=3;break}return e.next=3,j.firestore().collection("tasks").doc(we).collection("responses").doc(t.questionId).set({answer:x[n]},{merge:!0});case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),!t){e.next=9;break}return e.next=6,j.firestore().collection("tasks").doc(we).collection("user_editable").doc("user_editable").update({status:"complete"});case 6:M(!0),console.log("Task Locked"),Y(!1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Fe=function(){var e=Object(m.a)(g.a.mark((function e(t,n,c){var a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=j.firestore().collection("tasks").doc(we).collection("responses").doc(c),console.log("\u0424\u0430\u0439\u043b \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d"),t&&n&&a.set({files:j.firestore.FieldValue.arrayUnion({public_url:n,filename:t})},{merge:!0}).then((function(){return console.log("super")}));case 3:case"end":return e.stop()}}),e)})));return function(t,n,c){return e.apply(this,arguments)}}(),De=function(){Y(!1),ie({})},Te=function(e){"send"===e&&(ee("send"),Y(!0)),"release"===e&&(ee("release"),Y(!0))};Object(a.useEffect)((function(){j.firestore().collection("schema").doc("structure").collection("feedbacks").doc("release").get().then((function(e){de(e.data())}))}),[]);return ke?Object(c.jsxs)(p.a,{style:{padding:30},children:["send"===$&&Object(c.jsx)(We,{state:J,handleClose:De,hideActions:ve||I,title:ve?"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0444\u0430\u0439\u043b\u043e\u0432":I?"\u0424\u0430\u0439\u043b\u044b \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u044b":"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435?",content:ve?Object(c.jsx)(re.a,{}):I?"\u0421\u043f\u0430\u0441\u0438\u0431\u043e":"\u0412\u044b \u0441\u043e\u0431\u0438\u0440\u0430\u0435\u0442\u0435\u0441\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435. \u042d\u0442\u043e \u0437\u043d\u0430\u0447\u0438\u0442, \u0447\u0442\u043e \u0432\u044b \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u0441\u043c\u043e\u0436\u0435\u0442\u0435 \u0438\u0437\u043c\u0435\u043d\u044f\u0442\u044c \u043e\u0442\u0432\u0435\u0442\u044b.",dialogFunction:function(){return Ie(!0)}}),"release"===$&&Object(c.jsx)(ae,{state:J,feedbackValue:ce,handleClose:De,title:le.title,dialogFunction:function(){j.firestore().collection("tasks").doc(we).collection("user_editable").doc("user_editable").update({status:"open"}).then((function(){return j.firestore().collection("tasks").doc(we).collection("user_editable").doc("user_editable").update({status:"released",release_status:ce.reason,release_description:ce.text}).then((function(){Y(!1),M(!0)}))}))},answers:le.answers,description:le.description,returnFeedback:function(e){ie(e)}}),N&&Object(c.jsx)(h.a,{to:"/tasks"}),Object(c.jsx)(Le.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:be,autoHideDuration:6e3,onClose:Se,message:"\u0424\u0438\u0434\u0431\u0435\u043a \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d",action:Object(c.jsx)(r.a.Fragment,{children:Object(c.jsx)(E.a,{size:"small","aria-label":"close",color:"inherit",onClick:Se,children:Object(c.jsx)(Ge.a,{fontSize:"small"})})})}),S,Object(c.jsxs)(p.a,{container:!0,style:{padding:20},justify:"center",children:[Object(c.jsx)(T.a,{variant:"outlined",style:{borderWidth:2,borderColor:"grey",color:"grey",margin:5},onClick:function(){return z(!0)},children:"\u041d\u0430\u0437\u0430\u0434"}),!L&&Object(c.jsxs)("div",{children:[Object(c.jsx)(T.a,{variant:"outlined",disabled:L,style:{borderWidth:2,borderColor:"#003366",color:"#003366",margin:5},onClick:function(){return Ie(!1)},children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"}),Object(c.jsx)(T.a,{variant:"outlined",disabled:L,style:{borderWidth:2,borderColor:"red",color:"red",margin:5},onClick:function(){return Te("send")},children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"}),Object(c.jsx)(T.a,{variant:"outlined",disabled:L,style:{borderWidth:2,borderColor:"red",color:"red",margin:5},onClick:function(){return Te("release")},children:"\u041e\u0441\u0432\u043e\u0431\u043e\u0434\u0438\u0442\u044c"})]})]})]}):Object(c.jsxs)(p.a,{container:!0,direction:"column",style:{padding:20},justify:"center",children:[Object(c.jsx)(U.a,{align:"center",variant:"h3",children:"\u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044c"}),Object(c.jsx)("br",{}),Object(c.jsx)(T.a,{variant:"contained",onClick:u,children:"\u0412\u043e\u0439\u0442\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google"})]})},Qe=n(252),He=function(e){var t=e.caseId,n=e.userRanks,i=Object(a.useState)(null),s=Object(o.a)(i,2),l=s[0],d=s[1],u=Object(a.useState)(!1),f=Object(o.a)(u,2),O=f[0],h=f[1],x=Object(a.useContext)(b).currentUser,g=r.a.useState(!1),m=Object(o.a)(g,2),y=m[0],k=m[1],w=Object(a.useState)(!1),S=Object(o.a)(w,2),_=S[0],C=S[1],q=Object(a.useState)(""),I=Object(o.a)(q,2),F=I[0],D=I[1],T=function(e,t){"clickaway"!==t&&k(!1)};Object(a.useEffect)((function(){if(x){var e=[];console.log("Fired"),j.firestore().collection("schema").doc("structure").collection("cases").doc(t).collection("stages").get().then((function(t){t.forEach((function(t){var c=t.data().ranks;console.log("RANKS"),console.log(c),console.log(n),e.push(Object(v.a)(Object(v.a)({id:t.id},t.data()),{},{disabled:!1}))}))})).then((function(){e.sort((function(e,t){return parseInt(e.order)-parseInt(t.order)})),d(e),h(!0)})).catch((function(e){console.log("Error getting documents: ",e)}))}}),[x]),Object(a.useEffect)((function(){x&&j.firestore().collection("tasks").where("assigned_users","array-contains",x.uid).where("is_complete","==",!1).get().then((function(e){e.size<3?(console.log("SIZE",e.size),C(!1)):(C(!0),D(Object(c.jsx)(U.a,{color:"error",children:"\u0423 \u0432\u0430\u0441 \u0435\u0441\u0442\u044c \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0435 \u0437\u0430\u0434\u0430\u043d\u0438\u044f. \u0421\u0434\u0430\u0439\u0442\u0435 \u0438\u043b\u0438 \u043e\u0441\u0432\u043e\u0431\u043e\u0434\u0438\u0442\u0435 \u0438\u0445, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043d\u043e\u0432\u044b\u0435."})))}))}),[x,_,y]);var A=function(e,n){j.firestore().collection("task_requests").doc(x.uid).collection("requests").add({taskType:e,status:"pending",user:x.uid,case_type:t,case_stage_id:n}).then((function(e){k(!0),console.log("sending request")}))};return Object(c.jsxs)("div",{children:[Object(c.jsx)(Le.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:y,autoHideDuration:6e3,onClose:T,message:"\u0417\u0430\u043f\u0440\u043e\u0441 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d",action:Object(c.jsx)(r.a.Fragment,{children:Object(c.jsx)(E.a,{size:"small","aria-label":"close",color:"inherit",onClick:T,children:Object(c.jsx)(Ge.a,{fontSize:"small"})})})}),Object(c.jsxs)(_e.a,{style:{margin:"20px 5px",border:"1px grey solid"},children:[Object(c.jsxs)(V.a,{style:{padding:"10px 20px 0px"},children:[Object(c.jsx)(V.a,{style:{padding:"5px 10px 10px"},children:Object(c.jsx)(U.a,{variant:"h6",children:e.title})}),Object(c.jsx)(V.a,{style:{padding:"10px 10px 5px"},children:Object(c.jsx)(U.a,{variant:"body2",children:e.description})}),Object(c.jsx)(V.a,{style:{padding:"10px 10px 0px"},children:F})]}),Object(c.jsx)(p.a,{container:!0,justify:"center",style:{padding:10},children:O&&l.map((function(e,t){return Object(c.jsx)(p.a,{item:!0,style:{padding:10},children:Object(c.jsx)(Te,{title:e.title,description:e.description,type:e.type,id:e.id,cardColor:"#F5F5F5",sendRequest:A,disabled:_||e.disabled})},t)}))})]})]})},Ke=function(){var e=Object(a.useContext)(b).currentUser,t=Object(a.useState)([]),n=Object(o.a)(t,2),r=n[0],i=n[1],s=Object(a.useState)(!1),l=Object(o.a)(s,2),d=l[0],u=l[1],f=Object(a.useState)([]),O=Object(o.a)(f,2),h=O[0],p=O[1];Object(a.useEffect)((function(){e&&j.firestore().collection("users").doc(e.uid).collection("user_private").doc("private").get().then((function(e){if(e&&e.exists){var t=e.data().ranks;console.log(t),p(t),x(t)}}))}),[e]);var x=function(e){var t=[];console.log("Fired"),j.firestore().collection("schema").doc("structure").collection("cases").where("ranks","array-contains-any",e).get().then((function(e){e.forEach((function(e){console.log(e.data()),t.push(Object(v.a)({id:e.id},e.data()))}))})).then((function(){i(t),u(!0)})).catch((function(e){console.log("Error getting documents: ",e)}))};return Object(c.jsx)("div",{children:d&&r.map((function(e,t){return Object(c.jsx)(He,{title:e.title,description:e.description,caseId:e.id,userRanks:h},t)}))})},Je=Object(A.a)((function(e){return{root:Object(y.a)({margin:20,width:500},e.breakpoints.down("sm"),{maxWidth:300}),bullet:{display:"inline-block",margin:"0 2px"},title:{fontSize:14},pos:{marginBottom:12}}})),Ye=function(e){var t,n=Je(),a=e.title,r=e.description,i=e.id,s=e.setShown,o=e.shown,l=e.date;return Object(c.jsx)(p.a,{container:!0,justify:"center",children:Object(c.jsxs)(qe.a,{className:n.root,style:o?{background:"grey",opacity:.25}:{background:"lightblue"},children:[Object(c.jsxs)(Fe.a,{children:[Object(c.jsx)(U.a,{variant:"h6",children:a}),Object(c.jsx)(U.a,{variant:"body2",component:"p",children:r})]}),Object(c.jsxs)(Ie.a,{style:{justifyContent:"space-between"},children:[Object(c.jsx)(U.a,{style:{paddingLeft:8},variant:"subtitle2",children:(t=l.toDate(),"".concat(t.getDate().toString().padStart(2,"0"),"/").concat((t.getMonth()+1).toString().padStart(2,"0"),"/").concat(t.getFullYear().toString().padStart(4,"0")," ").concat(t.getHours().toString().padStart(2,"0"),":").concat(t.getMinutes().toString().padStart(2,"0"),":").concat(t.getSeconds().toString().padStart(2,"0")))}),Object(c.jsx)(T.a,{size:"small",onClick:function(){return s(i)},children:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u043d\u043e"})]})]})})},Ze=function(){var e=Object(a.useContext)(b).currentUser,t=Object(a.useState)([]),n=Object(o.a)(t,2),r=n[0],i=n[1],s=function(e){j.firestore().collection("notifications").doc(e).update({shown:!0})};return Object(a.useEffect)((function(){if(e){var t=j.firestore().collection("notifications").where("user_id","array-contains",e.uid).onSnapshot(function(){var e=Object(m.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],t.forEach((function(e,t){n.push(Object(v.a)({id:e.id},e.data()))})),console.log(n[0].created_date.toDate()),n.sort((function(e,t){return t.created_date.toDate()-e.created_date.toDate()})),i(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());return function(){return t()}}}),[e]),Object(c.jsxs)("div",{children:[Object(c.jsx)(U.a,{variant:"h5",align:"center",children:"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f"}),r.map((function(e,t){return Object(c.jsx)(Ye,{id:e.id,index:t,date:e.created_date,title:e.title,setShown:s,shown:e.shown,description:e.description},t)}))]})},Xe=n(360),$e=n.n(Xe),et=n(769),tt=n(770),nt=n(432),ct=Object(A.a)((function(e){return{root:Object(y.a)({marginTop:20,background:"lightgreen",height:200,width:500},e.breakpoints.down("sm"),{maxWidth:300})}})),at=function(){var e=ct(),t=Object(a.useState)(null),n=Object(o.a)(t,2),r=n[0],i=n[1],s=Object(a.useContext)(b).currentUser;return Object(a.useEffect)((function(){var e=function(){return Object(et.a)().toString()+"_"+Date.now()};if(s){var t=j.firestore().collection("users").doc(s.uid).onSnapshot((function(t){var n;if(n=!(!t.exists||!t.data().tg_token)&&t.data().tg_token,console.log(n),n){console.log(n);var c=parseInt(n.substring(n.indexOf("_")+1)),a=$e()().diff(c,"hours");if(console.log(a),a>0){var r=e();j.firestore().collection("users").doc(s.uid).update({tg_token:r}),i(r)}else i(n)}else{console.log("no token");var o=e();j.firestore().collection("users").doc(s.uid).update({tg_token:o}),i(o)}}));return function(){return t()}}}),[s]),Object(a.useEffect)((function(){if(s){var e=nt.parse(window.location.search);e.rank&&(console.log(e.rank),j.firestore().collection("schema").doc("structure").collection("ranks").doc(e.rank).get().then((function(e){e.exists?(console.log("creating request"),j.firestore().collection("rank_requests").add({timestamp:j.firestore.FieldValue.serverTimestamp(),user_id:s.uid,processed:!1,rank:e.id})):console.log("no rank")})))}}),[s]),s?Object(c.jsxs)(p.a,{container:!0,justify:"center",direction:"column",alignItems:"center",className:e.root,children:[Object(c.jsx)(U.a,{style:{paddingBottom:10},variant:"h5",align:"center",children:"\u0412\u044b \u043f\u043e\u0447\u0442\u0438 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c! \u041e\u0441\u0442\u0430\u043b\u043e\u0441\u044c \u043d\u0430\u0436\u0430\u0442\u044c \u043d\u0430 \u0441\u0441\u044b\u043b\u043a\u0443 \u043d\u0438\u0436\u0435."}),r?Object(c.jsx)(tt.a,{variant:"h5",href:"https://telegram.me/journal_tg_bot?start="+r,children:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0431\u043e\u0442"}):Object(c.jsx)(U.a,{variant:"body2",align:"center",children:"\u0415\u0441\u043b\u0438 \u0441\u0441\u044b\u043b\u043a\u0430 \u043d\u0435 \u0441\u043e\u0437\u0434\u0430\u043b\u0430\u0441\u044c \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 5 \u0441\u0435\u043a\u0443\u043d\u0434, \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443"})]}):Object(c.jsxs)(p.a,{container:!0,direction:"column",style:{padding:20},justify:"center",children:[Object(c.jsx)(U.a,{align:"center",variant:"h3",children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"}),Object(c.jsx)("br",{}),Object(c.jsx)(T.a,{size:"large",color:"primary",variant:"contained",onClick:u,children:"\u0412\u043e\u0439\u0442\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google"})]})},rt=Object(A.a)({root:{minWidth:275},bullet:{display:"inline-block",margin:"0 2px",transform:"scale(0.8)"},title:{fontSize:14},pos:{marginBottom:12}});function it(e){var t=rt();return console.log("TEST CARD"),console.log(e),e.userInfo=={}?Object(c.jsx)("div",{}):Object(c.jsx)(qe.a,{className:t.root,variant:"outlined",children:Object(c.jsxs)(Fe.a,{children:[Object(c.jsxs)(U.a,{className:t.title,color:"textSecondary",gutterBottom:!0,children:["id: ",e.userInfo.id]}),Object(c.jsxs)(U.a,{variant:"h5",component:"h2",children:[e.userInfo.surname," ",e.userInfo.name]}),Object(c.jsxs)(U.a,{className:t.pos,color:"textSecondary",children:["\u0420\u0435\u0433\u0438\u043e\u043d: ",e.userInfo.district]}),Object(c.jsx)(U.a,{variant:"body2",component:"p",children:e.userInfo.phone}),Object(c.jsx)(U.a,{variant:"body2",component:"p",children:e.userInfo.email})]})})}var st=function(e){var t=r.a.useState([]),n=Object(o.a)(t,2),i=(n[0],n[1],Object(a.useState)({})),s=Object(o.a)(i,2),l=s[0],d=s[1],u={},b=Object(a.useState)([]),f=Object(o.a)(b,2),O=(f[0],f[1]),h=Object(a.useState)([]),x=Object(o.a)(h,2),v=(x[0],x[1]),y=Object(a.useState)({}),k=Object(o.a)(y,2),w=k[0],S=k[1],_=Object(a.useState)(Object(c.jsx)("div",{})),C=Object(o.a)(_,2),E=C[0],q=C[1],I=Object(a.useState)(!1),F=Object(o.a)(I,2),D=F[0],U=F[1],A=Object(a.useState)(!1),N=Object(o.a)(A,2),z=N[0],P=N[1],R=Object(a.useState)(!1),B=Object(o.a)(R,2),W=B[0],L=B[1],M=Object(a.useState)(!1),G=Object(o.a)(M,2),V=G[0],Q=G[1],H=Object(a.useState)(!1),K=Object(o.a)(H,2),J=K[0],Y=K[1],Z=function(){var t=Object(m.a)(g.a.mark((function t(){return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:j.firestore().collection("tasks").doc(e.task.id).get().then((function(e){var t=e.data().review_status;U("pending"===t),P("passed"===t),L("not passed"===t),Q("verified"===t),Y("not verified"===t)}));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();Object(a.useEffect)((function(){var t=function(){var t=Object(m.a)(g.a.mark((function t(){var n,a,r,i;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],a=[],r=[],i=!0,console.log("HOOK"),Z(),t.next=8,j.firestore().collection("tasks").doc(e.task.id).get().then((function(e){d(e.data())})).catch((function(e){console.log("Error getting documents: ",e)}));case 8:return t.next=10,j.firestore().collection("tasks").doc(e.task.id).collection("questions").get().then((function(e){e.forEach((function(e){n.push({questionId:e.id,data:e.data()})}))})).then((function(){O(n)})).catch((function(e){console.log("Error getting documents: ",e)}));case 10:return t.next=12,j.firestore().collection("tasks").doc(e.task.id).collection("responses").get().then((function(e){e.forEach((function(e){a.push({responseId:e.id,data:e.data()})}))})).then((function(){v(a)})).catch((function(e){console.log("Error getting documents: ",e)}));case 12:q(Object(c.jsx)("div",{})),r=n.map((function(e,t){var n=null;return a.forEach((function(c){e.questionId===c.responseId&&(n=c.data.answer,X(c.data.answer,t))})),Object(c.jsx)(Be,{question:e.data,index:t,response:n,returnAnswer:X,locked:i},t)})),q(r);case 15:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();e.task.id&&t()}),[e.task.id]);var X=function(e,t){var n=w;n[t]=e,S(n)},$=function(){var t=Object(m.a)(g.a.mark((function t(n){return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.firestore().collection("tasks").doc(e.task.id).update({review_status:n});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return function(){if(void 0!==l.assigned_users&&l.assigned_users.length>0){var t=e.users.find((function(e){return e.id===l.assigned_users[0]}));u=void 0!==t?t:{}}}(),Object(c.jsxs)(p.a,{style:{padding:30},children:[Object(c.jsxs)(p.a,{container:!0,style:{padding:20},justify:"center",children:[Object(c.jsx)(T.a,{variant:"contained",color:D?"secondary":"{}",onClick:function(){$("pending"),Z()},children:"PENDING"}),Object(c.jsx)(T.a,{variant:"contained",color:z?"secondary":"{}",onClick:function(){$("passed"),Z()},children:"PASSED"}),Object(c.jsx)(T.a,{variant:"contained",color:W?"secondary":"{}",onClick:function(){$("not passed"),Z()},children:"NOT PASSED"}),Object(c.jsx)(T.a,{variant:"contained",color:V?"secondary":"{}",onClick:function(){$("verified"),Z()},children:"VERIFIED"}),Object(c.jsx)(T.a,{variant:"contained",color:J?"secondary":"{}",onClick:function(){$("not verified"),Z()},children:"NOT VERIFIED"})]}),Object(c.jsx)(p.a,{container:!0,justify:"center",children:Object(c.jsx)(it,{userInfo:u,children:" "})}),E]})},ot=n(776),lt=function(e){var t=Object(a.useState)(0),n=Object(o.a)(t,2),r=n[0],i=n[1],s=Object(a.useState)(1),l=Object(o.a)(s,2),d=l[0],u=(l[1],Object(a.useState)([])),j=Object(o.a)(u,2),b=j[0],f=j[1],O=function(e,t,n){var c=Object(Qe.a)(n),a=Math.floor(c.size/t);console.log("numberOfPages",a);var r=e*t,i=c.size;return e!==a-1&&(i=(e+1)*t),console.log("Start",r),console.log("End",i),n.slice(r,i)};Object(a.useEffect)((function(){i(0),f(O(0,1,e.data))}),[e.data]);var h=e.data.length>0&&Object(c.jsx)(p.a,{container:!0,justify:"center",children:Object(c.jsx)(ot.a,{justify:"center",component:"div",count:e.data.length,page:r,onChangePage:function(t,n){f(O(n,d,e.data)),i(n)},rowsPerPage:d,onChangeRowsPerPage:function(e){},labelRowsPerPage:"\u041f\u043e \u043e\u0434\u043d\u043e\u0439 \u0437\u0430\u0434\u0430\u0447\u0435 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443!"})}),x=void 0!==b[0];return Object(c.jsxs)("div",{children:[h,Object(c.jsx)(p.a,{container:!0,spacing:0,direction:"column",alignItems:"center",justify:"center",style:{minHeight:"100vh"},children:Object(c.jsx)(p.a,{item:!0,xs:12,children:Object(c.jsx)(p.a,{container:!0,justify:"center",direction:"column",spacing:1,children:x?Object(c.jsx)(p.a,{item:!0,children:Object(c.jsx)(st,{task:b[0],users:e.users})}):"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0438 \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u0435 \u0444\u0438\u043b\u044c\u0442\u0440\u044b!"})})}),h]})},dt=n(357),ut=n(704),jt=n(186),bt=n.n(jt),ft=function(e){var t=["\u0412\u0421\u0415","\u041f\u043e\u0438\u0441\u043a \u043a\u043e\u043d\u0442\u0430\u043a\u0442\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445","interview"],n=["\u0412\u0421\u0415","\u0417\u0430\u0434\u0430\u043d\u0438\u0435 \u2116 1.1","\u0417\u0430\u0434\u0430\u043d\u0438\u0435 \u2116 1.2","\u0417\u0430\u0434\u0430\u043d\u0438\u0435 \u2116 1.3","\u0417\u0430\u0434\u0430\u043d\u0438\u0435 \u2116 2.1","\u0417\u0430\u0434\u0430\u043d\u0438\u0435 \u2116 2.2","\u0417\u0430\u0434\u0430\u043d\u0438\u0435 \u2116 2.3","\u0417\u0430\u0434\u0430\u043d\u0438\u0435 3.1","\u0417\u0430\u0434\u0430\u043d\u0438\u0435 3.2","\u0417\u0430\u0434\u0430\u043d\u0438\u0435 3.3"],i=["\u0412\u0421\u0415","pending","passed","not passed","verified","not verified"],s=r.a.useState([]),l=Object(o.a)(s,2),d=l[0],u=l[1],b=r.a.useState("\u0412\u0421\u0415"),f=Object(o.a)(b,2),O=f[0],h=f[1],x=r.a.useState([]),y=Object(o.a)(x,2),k=y[0],w=y[1],S=r.a.useState(t[0]),_=Object(o.a)(S,2),C=_[0],E=_[1],q=r.a.useState(n[0]),I=Object(o.a)(q,2),F=I[0],D=I[1],U=r.a.useState(i[0]),A=Object(o.a)(U,2),N=A[0],z=A[1],P=function(){var e=Object(m.a)(g.a.mark((function e(){var t,n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[{id:"\u0412\u0421\u0415",name:"\u0412\u0421\u0415",surname:""}],n=j.firestore().collection("users").orderBy("surname"),e.next=4,n.get().then((function(e){e.forEach((function(e){t.push(Object(v.a)({id:e.id},e.data()))})),w(t)}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),R=function(){var e=Object(m.a)(g.a.mark((function e(){var t,n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=j.firestore().collection("tasks"),"\u0412\u0421\u0415"!=O&&(n=n.where("assigned_users","array-contains",O)),"\u0412\u0421\u0415"!=F&&(n=n.where("title","==",F)),"\u0412\u0421\u0415"!=C&&(n=n.where("type","==",C)),"\u0412\u0421\u0415"!=N&&(n=n.where("review_status","==",N)),e.next=8,n.get().then((function(e){e.forEach((function(e){t.push(Object(v.a)({id:e.id},e.data()))})),u(t)}));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){P()}),[]),Object(c.jsxs)("div",{children:[Object(c.jsx)(p.a,{container:!0,justify:"center",children:Object(c.jsxs)(ne.a,{style:{width:"350px"},children:[Object(c.jsx)(dt.a,{value:O.value,onChange:function(e){h(e.target.value)},name:"filterUser",children:k.map((function(e){return Object(c.jsxs)("option",{value:e.id,children:[" ",e.surname," ",e.name]})}))}),Object(c.jsx)(ut.a,{children:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0438\u043b\u044c\u0442\u0440 \u043f\u043e users"})]})}),Object(c.jsx)(p.a,{container:!0,justify:"center",children:Object(c.jsxs)(ne.a,{style:{width:"350px"},children:[Object(c.jsx)(dt.a,{value:F,onChange:function(e){D(e.target.value)},name:"filterTaskTitle",children:n.map((function(e){return Object(c.jsx)("option",{value:e,children:e})}))}),Object(c.jsx)(ut.a,{children:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0438\u043b\u044c\u0442\u0440 \u043f\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u044e \u0437\u0430\u0434\u0430\u0447\u0438"})]})}),Object(c.jsx)(p.a,{container:!0,justify:"center",children:Object(c.jsxs)(ne.a,{style:{width:"350px"},children:[Object(c.jsx)(dt.a,{value:C,onChange:function(e){E(e.target.value)},name:"filterTaskType",children:t.map((function(e){return Object(c.jsx)("option",{value:e,children:e})}))}),Object(c.jsx)(ut.a,{children:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0438\u043b\u044c\u0442\u0440 \u043f\u043e \u0442\u0438\u043f\u0443 \u0437\u0430\u0434\u0430\u0447\u0438"})]})}),Object(c.jsx)(p.a,{container:!0,justify:"center",children:Object(c.jsxs)(ne.a,{style:{width:"350px"},children:[Object(c.jsx)(dt.a,{value:N,onChange:function(e){z(e.target.value)},name:"filterReviewStatus",children:i.map((function(e){return Object(c.jsx)("option",{value:e,children:e})}))}),Object(c.jsx)(ut.a,{children:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0438\u043b\u044c\u0442\u0440 \u043f\u043e review_status"})]})}),Object(c.jsx)(p.a,{container:!0,justify:"center",children:Object(c.jsx)(T.a,{style:{width:"350px"},type:"number",variant:"contained",onClick:function(e){R()},color:"primary",startIcon:Object(c.jsx)(bt.a,{}),children:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440\u044b"})}),Object(c.jsx)(p.a,{container:!0,justify:"center",children:Object(c.jsx)(lt,{data:d,users:k})})]})},Ot=function(){return Object(a.useContext)(b).currentUser?Object(c.jsx)(h.a,{to:"/"}):Object(c.jsxs)(p.a,{container:!0,direction:"column",style:{padding:20},justify:"center",children:[Object(c.jsx)(U.a,{align:"center",variant:"h4",children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"}),Object(c.jsx)(U.a,{variant:"body1",align:"center",children:"\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \u043d\u0430 \u043a\u043d\u043e\u043f\u043a\u0443 (\u0412\u0445\u043e\u0434 \u0438\u043b\u0438 \u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f)."}),Object(c.jsx)(U.a,{variant:"body1",align:"center",children:"\u0415\u0441\u043b\u0438 \u0443 \u0432\u0430\u0441 \u043d\u0435\u0442 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google, \u0442\u043e \u0441\u043e\u0437\u0434\u0430\u0439\u0442\u0435 \u0435\u0433\u043e."}),Object(c.jsx)("br",{}),Object(c.jsx)(T.a,{size:"large",color:"primary",variant:"contained",onClick:u,children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"})]})},ht=function(e){var t=e.component,n=Object(Se.a)(e,["component"]),r=Object(a.useContext)(b).currentUser;return Object(c.jsx)(h.b,Object(v.a)(Object(v.a)({},n),{},{render:function(e){return r?Object(c.jsx)(t,Object(v.a)({},e)):Object(c.jsx)(h.a,{to:"/signin"})}}))},pt=Object(A.a)((function(e){return{root:Object(y.a)({border:"2px grey solid",padding:"0px 10px",margin:10,background:"yellow",width:700},e.breakpoints.down("sm"),{maxWidth:300}),button:{background:"orange",margin:"10px 0"}}})),xt=Object(a.forwardRef)((function(e,t){var n=pt(),a=r.a.useState(""),i=Object(o.a)(a,2),s=i[0],l=i[1],d=e.title,u=e.sendAnswer,j=e.taskId,b=e.questionId;return Object(c.jsxs)("div",{className:n.root,children:[Object(c.jsx)(V.a,{display:"flex",style:{marginBottom:10,marginTop:10},children:Object(c.jsx)(U.a,{variant:"h6",style:{paddingRight:8},children:d})}),Object(c.jsx)(G.a,{label:"\u041c\u043e\u0439 \u043e\u0442\u0432\u0435\u0442",value:s,style:{background:"white"},onChange:function(e){l(e.target.value)},multiline:!0,rows:5,variant:"outlined",fullWidth:!0}),Object(c.jsx)(p.a,{container:!0,justify:"flex-end",children:Object(c.jsx)(T.a,{className:n.button,onClick:function(){return u(j,b,s)},children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"})})]})})),gt=Object(A.a)((function(e){return{select:Object(y.a)({margin:"20px 0",width:500},e.breakpoints.down("sm"),{maxWidth:300})}})),mt=function(e){var t=gt(),n=["\u0412\u0421\u0415","\u041f\u043e\u0438\u0441\u043a \u043a\u043e\u043d\u0442\u0430\u043a\u0442\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445","interview"],i=r.a.useState([]),s=Object(o.a)(i,2),l=(s[0],s[1]),d=r.a.useState(n[0]),u=Object(o.a)(d,2),b=u[0],f=u[1],O=Object(a.useState)([]),h=Object(o.a)(O,2),x=h[0],y=h[1],k=function(){var e=Object(m.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w();case 2:n=e.sent,S(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=function(){var e=Object(m.a)(g.a.mark((function e(){var t,n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=j.firestore().collection("tasks").where("case_type","==","FAQ").where("is_complete","==",!1),"\u0412\u0421\u0415"!==b&&(n=n.where("type","==",b)),console.log("fired"),e.next=6,n.get().then((function(e){e.forEach((function(e){t.push(Object(v.a)({id:e.id},e.data()))})),t.sort((function(e,t){return t.timestamp.toDate()-e.timestamp.toDate()})),l(t)}));case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),S=function(){var e=Object(m.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.map(function(){var e=Object(m.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],e.next=3,j.firestore().collection("tasks").doc(t.id).collection("questions").get().then((function(e){e.forEach((function(e){n.push(Object(v.a)({taskId:t.id,questionId:e.id,timestamp:t.timestamp.toDate()},e.data()))}))}));case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:n=e.sent,Promise.all(n).then((function(e){return y([].concat.apply([],e))}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=function(e,t,n){j.firestore().collection("tasks").doc(e).collection("responses").doc(t).set({answer:n}),console.log(e,n)};return Object(c.jsxs)(p.a,{container:!0,justify:"center",children:[Object(c.jsx)(p.a,{container:!0,justify:"center",children:Object(c.jsxs)(ne.a,{className:t.select,children:[Object(c.jsx)(dt.a,{value:b,onChange:function(e){f(e.target.value)},name:"filterTaskType",children:n.map((function(e,t){return Object(c.jsx)("option",{value:e,children:e},e)}))}),Object(c.jsx)(ut.a,{children:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0438\u043b\u044c\u0442\u0440 \u043f\u043e \u0442\u0438\u043f\u0443 \u0437\u0430\u0434\u0430\u0447\u0438"})]})}),Object(c.jsx)(p.a,{container:!0,justify:"center",className:t.select,children:Object(c.jsx)(T.a,{style:{width:"350px"},type:"number",variant:"contained",onClick:k,color:"primary",startIcon:Object(c.jsx)(bt.a,{}),children:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440\u044b"})}),Object(c.jsx)(p.a,{container:!0,justify:"center",children:x?x.map((function(e,t){return Object(c.jsx)(xt,{taskId:e.taskId,questionId:e.questionId,title:e.title,sendAnswer:_},"task_"+t)})):Object(c.jsx)(U.a,{style:{padding:30},children:"\u041d\u0435\u0442 \u043d\u043e\u0432\u044b\u0445 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432"})})]})},vt=n(361),yt=n(771),kt=Object(A.a)({root:{minWidth:250},bullet:{display:"inline-block",margin:"0 2px"},title:{fontSize:14},pos:{marginBottom:12}}),wt=function(e){var t=kt(),n=e.title,r=e.complete,i=e.type,s=(e.language,e.description),l=e.id,d=e.cardColor,u=(e.sendRequest,e.disabled,e.creatable),b=e.pCase,f=e.stage,O=e.user,p=Object(a.useState)(!1),x=Object(o.a)(p,2),g=x[0],m=x[1],v=Object(a.useState)(!1),y=Object(o.a)(v,2),k=y[0],w=y[1],S=Object(a.useState)(null),_=Object(o.a)(S,2),C=_[0],E=_[1],q=function(e,t){w(!0);var n=Object(yt.a)();j.firestore().collection("task_requests").doc(O.uid).collection("requests").add({status:"pending",user:O.uid,case_type:e,case_stage_id:t,callbackId:n}).then((function(e){var t=j.firestore().collection("tasks").where("assigned_users","array-contains",O.uid).where("callbackId","==",n).onSnapshot((function(e){e.docChanges().forEach((function(e){"added"===e.type&&e.doc.id&&(E(e.doc.id),m(!0),t())}))}))}))};return Object(c.jsxs)("div",{children:[g&&Object(c.jsx)(h.a,{to:"/t/"+(l||C)}),Object(c.jsxs)(qe.a,{className:t.root,style:{background:d},children:[Object(c.jsxs)(Fe.a,{children:[Object(c.jsxs)(V.a,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[Object(c.jsx)(U.a,{variant:"h6",children:n}),r&&Object(c.jsx)(U.a,{color:"error",children:"\u0421\u0434\u0430\u043d\u043e"})]}),Object(c.jsxs)(U.a,{variant:"subtitle1",className:t.pos,color:"textSecondary",children:["#",i]}),Object(c.jsxs)(U.a,{variant:"body2",component:"p",children:["\u0417\u0430\u0434\u0430\u043d\u0438\u0435: ",s]})]}),Object(c.jsx)(Ie.a,{children:k?Object(c.jsx)(re.a,{}):Object(c.jsx)(T.a,{size:"small",onClick:function(){u?q(b,f):m(!0)},children:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"})})]})]})};function St(e){var t=e.children,n=e.value,a=e.index,r=Object(Se.a)(e,["children","value","index"]);return Object(c.jsx)("div",Object(v.a)(Object(v.a)({role:"tabpanel",hidden:n!==a,id:"full-width-tabpanel-".concat(a),"aria-labelledby":"full-width-tab-".concat(a)},r),{},{children:n===a&&Object(c.jsx)(V.a,{p:3,children:Object(c.jsx)(U.a,{children:t})})}))}function _t(e){return{id:"full-width-tab-".concat(e),"aria-controls":"full-width-tabpanel-".concat(e)}}var Ct=Object(A.a)({root:{paddingTop:30,flexGrow:1}}),Et=function(){var e=Object(a.useContext)(b).currentUser,t=Object(h.g)().id,n=Ct(),r=Object(a.useState)({}),i=Object(o.a)(r,2),s=i[0],l=i[1],d=Object(a.useState)([]),u=Object(o.a)(d,2),f=u[0],O=u[1],x=Object(a.useState)({}),g=Object(o.a)(x,2),m=g[0],k=g[1],w=Object(a.useState)({}),S=Object(o.a)(w,2),_=S[0],C=S[1],E=Object(a.useState)({}),q=Object(o.a)(E,2),I=q[0],F=q[1],D=Object(a.useState)({}),T=Object(o.a)(D,2),U=T[0],A=T[1],N=Object(a.useState)(0),z=Object(o.a)(N,2),P=z[0],R=z[1];Object(a.useEffect)((function(){console.log("Page id: ",t),console.log("Current user: ",e),e&&(j.firestore().collection("pages").doc(t).onSnapshot((function(e){l(e.data()),console.log("Page data: ",e.data())})),j.firestore().collection("users").doc(e.uid).collection("user_private").doc("private").onSnapshot((function(e){O(e.data().ranks),console.log("User ranks: ",e.data().ranks)})))}),[e,t]),Object(a.useEffect)((function(){Object.entries(s).length>0&&f.length>0&&(s.cases.map((function(e){j.firestore().collection("schema").doc("structure").collection("cases").doc(e).collection("stages").where("ranks_write","array-contains-any",f).onSnapshot((function(t){t.docChanges().forEach((function(t){"added"!==t.type&&"modified"!==t.type||k((function(n){var c=Object.assign({},n);return c[e]||(c[e]={}),c[e][t.doc.id]=t.doc.data(),console.log("User stages: ",c),c})),"removed"===t.type&&k((function(n){var c=Object.assign({},n);return delete c[e][t.doc.id],c}))}))}))})),j.firestore().collection("tasks").where("assigned_users","array-contains",e.uid).where("case_type","in",s.cases).where("is_complete","==",!0).onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||C((function(t){return Object(v.a)(Object(v.a)({},t),{},Object(y.a)({},e.doc.id,e.doc.data()))})),"removed"===e.type&&C((function(t){var n=Object.assign({},t);return delete n[e.doc.id],n}))}))})),j.firestore().collection("tasks").where("assigned_users","array-contains",e.uid).where("case_type","in",s.cases).where("is_complete","==",!1).onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||F((function(t){return Object(v.a)(Object(v.a)({},t),{},Object(y.a)({},e.doc.id,e.doc.data()))})),"removed"===e.type&&F((function(t){var n=Object.assign({},t);return delete n[e.doc.id],n}))}))})))}),[e,s,f]),Object(a.useEffect)((function(){if(Object.keys(m).length>0){var e={};Object.keys(m).map((function(t){Object.keys(m[t]).map((function(n){if(m[t][n].rank_limit_number&&Object.keys(m[t][n].rank_limit_number).length>0){var c=new Set(Object.keys(m[t][n].rank_limit_number)),a=new Set(f),r=M(c,a);(0==r.size||B(L(r,m[t][n].rank_limit_number),n,_,I))&&(e[t]||(e[t]={}),e[t][n]=m[t][n])}else e[t]||(e[t]={}),e[t][n]=m[t][n]}))})),A(e)}}),[e,m,I,_]);var B=function(e,t,n,c){var a=W(t,n)+W(t,c);return console.log("stageOccurrences: ",a),console.log("number: ",e),a<e},W=function(e,t){var n=0;return Object.values(t).map((function(t){t.case_stage_id===e&&n++})),n},L=function(e,t){var n=0;return Object(Pe.a)(e).map((function(e){t[e]>n&&(n=t[e])})),n},M=function(e,t){var n,c=new Set,a=Object(vt.a)(t);try{for(a.s();!(n=a.n()).done;){var r=n.value;e.has(r)&&c.add(r)}}catch(i){a.e(i)}finally{a.f()}return c};return Object(c.jsxs)(p.a,{container:!0,justify:"center",alignItems:"center",direction:"column",children:[Object(c.jsx)("div",{className:n.root,children:Object(c.jsx)(_e.a,{position:"static",color:"default",children:Object(c.jsxs)(Ce.a,{value:P,onChange:function(e,t){R(t)},variant:"fullWidth",centered:!0,"aria-label":"simple tabs example",children:[Object(c.jsx)(Ee.a,Object(v.a)({label:"\u041d\u0435\u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435"},_t(0))),Object(c.jsx)(Ee.a,Object(v.a)({label:"\u0412\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435"},_t(1)))]})})}),Object(c.jsxs)(St,{value:P,index:0,children:[Object.keys(U).map((function(t){return Object.keys(U[t]).map((function(n){return Object(c.jsx)(p.a,{style:{padding:10},children:Object(c.jsx)(wt,{title:U[t][n].title,complete:!1,description:U[t][n].description,type:"\u041d\u043e\u0432\u0430\u044f",pCase:t,stage:n,user:e,id:"",creatable:!0})},t+n)}))})),Object.keys(I).map((function(e){return Object(c.jsx)(p.a,{style:{padding:10},children:Object(c.jsx)(wt,{title:m[I[e].case_type][I[e].case_stage_id].title,complete:I[e].is_complete,description:m[I[e].case_type][I[e].case_stage_id].description,type:e,id:e})},e)}))]}),Object(c.jsx)(St,{value:P,index:1,children:Object.keys(_).map((function(e){return Object(c.jsx)(p.a,{style:{padding:10},children:Object(c.jsx)(wt,{title:m[_[e].case_type][_[e].case_stage_id].title,complete:_[e].is_complete,description:m[_[e].case_type][_[e].case_stage_id].description,type:e,id:e})},e)}))})]})},qt=n(253),It=function(e){var t=Object(a.useState)({}),n=Object(o.a)(t,2),r=n[0],i=n[1],s=function(){var t=Object(m.a)(g.a.mark((function t(n){return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(n.map(function(){var t=Object(m.a)(g.a.mark((function t(n){var c;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:c=e.storageRef.child(n.name).put(n),i((function(e){var t=Object(y.a)({},n.name,{status:"loading",progress:0});return e?Object(v.a)(Object(v.a)({},e),t):t})),c.on(l.a.storage.TaskEvent.STATE_CHANGED,(function(e){var t=e.bytesTransferred/e.totalBytes*100;switch(i((function(e){var c=Object(y.a)({},n.name,{status:"loading",progress:t});return e?Object(v.a)(Object(v.a)({},e),c):c})),console.log("Upload is "+t+"% done"),e.state){case l.a.storage.TaskState.PAUSED:console.log("Upload is paused");break;case l.a.storage.TaskState.RUNNING:console.log("Upload is running")}}),(function(e){e.code}),(function(){c.snapshot.ref.getDownloadURL().then(function(){var t=Object(m.a)(g.a.mark((function t(c){return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.filesLinks.set({contents:Object(y.a)({},c,{name:n.name,url:c})},{merge:!0});case 2:i((function(e){var t=Object.assign({},e);return delete t[n.name],t})),console.log("File available at",c);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(c.jsxs)("div",{children:[Object(c.jsx)("input",{type:"file",onChange:function(e){console.log("Files selected: ",Object(Pe.a)(e.target.files)),s(Object(Pe.a)(e.target.files))},multiple:!0}),Object.keys(r).map((function(e){return Object(c.jsxs)("div",{children:[Object(c.jsx)("p",{children:e}),Object(c.jsx)(se,{value:r[e].progress})]},e)}))]})},Ft=function(e){console.log("All props: ",e),console.log("ID: ",e.taskID),console.log("Question ID: ",e.name),console.log("User UID: ",e.currentUserUid);var t=Object(a.useState)(!1),n=Object(o.a)(t,2),r=n[0],i=n[1],s=Object(a.useState)(!1),l=Object(o.a)(s,2),d=l[0],u=l[1],b=null,f=null;e.disabled||(b=j.storage().ref(e.taskID).child(e.name).child(e.currentUserUid),f=function(){var t=Object(m.a)(g.a.mark((function t(){return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i(!0),t.next=3,j.firestore().collection("users").doc(e.currentUserUid).set({fileUpload:e.taskID+"/"+e.name},{merge:!0});case 3:i(!1),u(!0);case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}());var O=j.firestore().collection("tasks").doc(e.taskID).collection("responses").doc(e.name);return console.log("Props formData: ",e.formData),Object(c.jsxs)("div",{children:[e.schema.title?Object(c.jsx)("div",{children:e.schema.title}):Object(c.jsx)("div",{}),e.schema.description?Object(c.jsx)("div",{children:e.schema.description}):Object(c.jsx)("div",{}),e.disabled?null:Object(c.jsxs)("div",{children:[Object(c.jsx)(It,{storageRef:b,filesLinks:O}),r?Object(c.jsx)(re.a,{}):d?Object(c.jsxs)("div",{children:['\u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u043d\u0430\u0447\u0430\u0442\u044c \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0443 \u0444\u0430\u0439\u043b\u043e\u0432 \u0447\u0435\u0440\u0435\u0437 \u0431\u043e\u0442\u0430. \u0412\u0441\u0435 \u0444\u0430\u0439\u043b\u044b, \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c\u044b\u0435 \u0431\u043e\u0442\u0443, \u0431\u0443\u0434\u0443\u0442 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0442\u044c\u0441\u044f \u0437\u0434\u0435\u0441\u044c. \u041f\u043e\u0441\u043b\u0435 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0444\u0430\u0439\u043b\u043e\u0432 \u0447\u0435\u0440\u0435\u0437 \u0431\u043e\u0442, \u043d\u0435 \u0437\u0430\u0431\u0443\u0434\u044c\u0442\u0435 \u0432\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u0441\u044e\u0434\u0430 \u0438 \u043d\u0430\u0436\u0430\u0442\u044c "\u041e\u0422\u041f\u0420\u0410\u0412\u0418\u0422\u042c". ',Object(c.jsx)("a",{href:"https://t.me/journal_tg_bot",children:"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u0431\u043e\u0442."})]}):Object(c.jsxs)("div",{children:[Object(c.jsx)("p",{children:"\u0412\u044b \u0442\u0430\u043a \u0436\u0435 \u043c\u043e\u0436\u0435\u0442\u0435 \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0441\u044e\u0434\u0430 \u0444\u0430\u0439\u043b\u044b \u0447\u0435\u0440\u0435\u0437 \u0422\u0435\u043b\u0435\u0433\u0440\u0430\u043c-\u0431\u043e\u0442\u0430. \u0414\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043d\u0430\u0436\u043c\u0438\u0442\u0435 \u043a\u043d\u043e\u043f\u043a\u0443 \u043d\u0438\u0436\u0435: "}),Object(c.jsx)("button",{onClick:f,children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0447\u0435\u0440\u0435\u0437 \u0431\u043e\u0442"})]})]}),e.formData?Object(c.jsx)("div",{children:Object.keys(e.formData).map((function(t){return Object(c.jsx)("div",{children:Object(c.jsx)("a",{href:e.formData[t].url,children:e.formData[t].name})},t)}))}):Object(c.jsx)("div",{})]})},Dt=n(261),Tt=function(){var e=Object(a.useState)({}),t=Object(o.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)({}),s=Object(o.a)(i,2),l=s[0],d=s[1],f=Object(a.useState)({}),O=Object(o.a)(f,2),x=O[0],g=O[1],m=Object(a.useState)({}),k=Object(o.a)(m,2),w=(k[0],k[1],Object(a.useState)({})),S=Object(o.a)(w,2),_=S[0],C=S[1],E=Object(a.useState)({}),q=Object(o.a)(E,2),I=q[0],F=q[1],D=Object(a.useState)({}),A=Object(o.a)(D,2),N=A[0],z=A[1],P=Object(a.useState)({}),R=Object(o.a)(P,2),B=R[0],W=R[1],L=Object(a.useState)({}),M=Object(o.a)(L,2),G=M[0],V=M[1],Q=Object(a.useState)({}),H=Object(o.a)(Q,2),K=H[0],J=H[1],Y=Object(a.useState)(""),Z=Object(o.a)(Y,2),X=(Z[0],Z[1]),$=Object(a.useState)(null),ee=Object(o.a)($,2),te=ee[0],ne=ee[1],ce=Object(a.useState)(!0),ae=Object(o.a)(ce,2),ie=ae[0],se=ae[1],oe=Object(a.useState)([]),le=Object(o.a)(oe,2),de=(le[0],le[1],Object(a.useState)([])),ue=Object(o.a)(de,2),je=(ue[0],ue[1],Object(a.useState)({})),be=Object(o.a)(je,2),fe=(be[0],be[1],Object(a.useState)([])),Oe=Object(o.a)(fe,2),he=(Oe[0],Oe[1],Object(a.useState)(!1)),pe=Object(o.a)(he,2),xe=pe[0],ge=(pe[1],Object(a.useState)(!1)),me=Object(o.a)(ge,2),ve=(me[0],me[1],Object(a.useState)({})),ye=Object(o.a)(ve,2),ke=(ye[0],ye[1],Object(a.useState)(!1)),we=Object(o.a)(ke,2),Se=(we[0],we[1],Object(a.useState)([])),_e=Object(o.a)(Se,2),Ce=(_e[0],_e[1],Object(a.useState)(!1)),Ee=Object(o.a)(Ce,2),qe=Ee[0],Ie=Ee[1],Fe=Object(a.useState)(null),De=Object(o.a)(Fe,2),Te=De[0],Ue=De[1],Ae=Object(a.useState)({}),Ne=Object(o.a)(Ae,2),ze=(Ne[0],Ne[1],Object(a.useState)({})),Re=Object(o.a)(ze,2),Be=(Re[0],Re[1],Object(a.useState)(!1)),Le=Object(o.a)(Be,2),Me=(Le[0],Le[1],Object(a.useState)({})),Ge=Object(o.a)(Me,2),Ve=(Ge[0],Ge[1],Object(a.useState)(!1)),Qe=Object(o.a)(Ve,2),He=Qe[0],Ke=(Qe[1],Object(a.useContext)(b).currentUser),Je=Object(h.g)().id;Object(a.useEffect)((function(){if(Ke&&Je){var e=j.firestore().collection("tasks").doc(Je);ne(e),e.onSnapshot((function(e){C(e.data()),se(e.data().is_complete),console.log("Task Metadata: ",e.data())})),e.collection("responses").onSnapshot((function(e){var t={},n=[],c=!1;e.docChanges().forEach((function(e){if("added"===e.type||"modified"===e.type){var a=e.doc.data().contents;t[e.doc.id]=a,c=!0}"removed"===e.type&&(console.log("Response Removed: ",e.doc.data()),n.push(e.doc.id),c=!0)})),c&&r((function(e){var c=Object(qt.cloneDeep)(e);return n.forEach((function(e){return delete c[e]})),Object.keys(t).forEach((function(e){return c[e]=t[e]})),c}))})),e.collection("questions").onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||d((function(t){return Object(v.a)(Object(v.a)({},t),{},Object(y.a)({},e.doc.id,e.doc.data()))}))}))}))}}),[Je,Ke]),Object(a.useEffect)((function(){Object.entries(_).length>0&&(console.log("Task metadata: ",_),j.firestore().collection("schema").doc("structure").collection("cases").doc(_.case_type).collection("stages").onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||(console.log("Case stage: ",e.doc.data()),F((function(t){return Object(v.a)(Object(v.a)({},t),{},Object(y.a)({},e.doc.id,e.doc.data()))}))),"removed"===e.type&&F((function(t){var n=Object.assign({},t);return delete n[e.doc.id],n}))}))})))}),[_.case_type]),Object(a.useEffect)((function(){var e={};console.log("Bg tasks: ",N),Object.keys(N).map((function(t){var n=N[t].case_stage_id;e[n]||(e[n]={}),e[n][t]=Ye(B[t],I[n])})),console.log("Merged bg forms: ",e),V(e)}),[N,B,I]),Object(a.useEffect)((function(){g(Ye(l,I[_.case_stage_id]))}),[l,_,I]),Object(a.useEffect)((function(){if(Object.keys(I).length>0&&Object.keys(_).length>0&&I[_.case_stage_id]){console.log("caseStages: ",I),console.log("taskMetadata: ",_);var e=I[_.case_stage_id].backgroundStages;e&&e.length>0&&(console.log("backgroundTasksList: ",e.length),j.firestore().collection("tasks").where("case_id","==",_.case_id).where("case_stage_id","in",e).onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||(console.log("Background task: ",e.doc.data()),z((function(t){return Object(v.a)(Object(v.a)({},t),{},Object(y.a)({},e.doc.id,e.doc.data()))}))),"removed"===e.type&&z((function(t){var n=Object.assign({},t);return delete n[e.doc.id],n}))}))})))}}),[I,_]),Object(a.useEffect)((function(){Object.entries(N).length>0&&Object.keys(N).map((function(e){j.firestore().collection("tasks").doc(e).collection("questions").onSnapshot((function(t){t.docChanges().forEach((function(t){"added"!==t.type&&"modified"!==t.type||W((function(n){var c=Object.assign({},n);return c[e][t.doc.id]=t.doc.data(),c}))}))})),j.firestore().collection("tasks").doc(e).collection("responses").onSnapshot((function(t){t.docChanges().forEach((function(t){"added"!==t.type&&"modified"!==t.type||J((function(n){var c=Object.assign({},n);return c[e]||(c[e]={}),c[e][t.doc.id]=t.doc.data().contents,c})),"removed"===t.type&&J((function(n){var c=Object.assign({},n);return delete c[e][t.doc.id],c}))}))}))}))}),[N]);var Ye=function(e,t){var n=Object.assign({},e),c=Object.assign({},t);c.start=c.start?c.start:{},c.end=c.end?c.end:{},c.start_ui_schema=c.start_ui_schema?c.start_ui_schema:{},c.end_ui_schema=c.end_ui_schema?c.end_ui_schema:{},n.form_questions=n.form_questions?n.form_questions:{},n.ui_schema=n.ui_schema?n.ui_schema:{};var a=Object(v.a)(Object(v.a)(Object(v.a)({},c.start.properties?c.start.properties:{}),c.end.properties?c.end.properties:{}),n.form_questions.properties?n.form_questions.properties:{}),r=Object(v.a)(Object(v.a)(Object(v.a)({},c.start.definitions?c.start.definitions:{}),c.end.definitions?c.end.definitions:{}),n.form_questions.definitions?n.form_questions.definitions:{}),i="";n.form_questions.title?i=n.form_questions.title:c.end.title?i=c.end.title:c.start.title&&(i=c.start.title);var s="";n.form_questions.description?s=n.form_questions.description:c.end.description?s=c.end.description:c.start.description&&(s=c.start.description);var o=Object(Pe.a)(new Set([].concat(Object(Pe.a)(c.start.required?c.start.required:[]),Object(Pe.a)(n.form_questions.required?n.form_questions.required:[]),Object(Pe.a)(c.start.required?c.start.required:[])))),l=Object(Pe.a)(new Set([].concat(Object(Pe.a)(c.start_ui_schema["ui:order"]?c.start_ui_schema["ui:order"]:[]),Object(Pe.a)(n.ui_schema["ui:order"]?n.ui_schema["ui:order"]:[]),Object(Pe.a)(c.end_ui_schema["ui:order"]?c.end_ui_schema["ui:order"]:[])))),d=Object(v.a)(Object(v.a)(Object(v.a)({},c.start_ui_schema?c.start_ui_schema:{}),c.end_ui_schema?c.end_ui_schema:{}),n.ui_schema?n.ui_schema:{});return{form_questions:{properties:a,definitions:r,title:i,description:s,required:o},ui_schema:d=Object(v.a)(Object(v.a)({},d),{"ui:order":l})}};return Ke?Object(c.jsxs)(p.a,{style:{padding:30},children:["send"===Te&&Object(c.jsx)(We,{state:qe,handleClose:function(){Ie(!1)},title:He?"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0444\u0430\u0439\u043b\u043e\u0432":xe?"\u0424\u0430\u0439\u043b\u044b \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u044b":"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435?",content:He?Object(c.jsx)(re.a,{}):xe?"\u0421\u043f\u0430\u0441\u0438\u0431\u043e":"\u0412\u044b \u0441\u043e\u0431\u0438\u0440\u0430\u0435\u0442\u0435\u0441\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0444\u043e\u0440\u043c\u0443. \u042d\u0442\u043e \u0437\u043d\u0430\u0447\u0438\u0442, \u0447\u0442\u043e \u0432\u044b \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u0441\u043c\u043e\u0436\u0435\u0442\u0435 \u0438\u0437\u043c\u0435\u043d\u044f\u0442\u044c \u043e\u0442\u0432\u0435\u0442\u044b.",dialogFunction:function(){j.firestore().collection("tasks").doc(Je).collection("user_editable").doc("user_editable").update({status:"complete"}),Ie(!1)}}),Object.keys(I).length>0&&Object.keys(_).length>0&&I[_.case_stage_id]&&I[_.case_stage_id].backgroundStages&&I[_.case_stage_id].backgroundStages.length>0&&Object.keys(G).length>0?Object(c.jsx)(p.a,{style:{padding:30},children:I[_.case_stage_id].backgroundStages.map((function(e){return Object(c.jsx)("div",{children:Object.keys(G[e]).map((function(t){return Object(c.jsx)(p.a,{style:{padding:30},children:Object(c.jsx)(Dt.a,{schema:G[e][t].form_questions,uiSchema:G[e][t].ui_schema,formData:K[t],fields:{customFileUpload:function(e){return Ft(Object(v.a)(Object(v.a)(Object(v.a)({},e),{taskID:t}),{currentUserUid:Ke.uid}))}},disabled:!0,children:" "})},t)}))},e)}))}):null,x&&te?Object(c.jsx)(Dt.a,{schema:x.form_questions,uiSchema:x.ui_schema,formData:n,fields:{customFileUpload:function(e){return Ft(Object(v.a)(Object(v.a)(Object(v.a)({},e),{taskID:Je}),{currentUserUid:Ke.uid}))}},disabled:ie,onChange:function(e){!function(e){r(e.formData)}(e)},onFocus:function(e){console.log("That is what was focused",e),X(e.split("_")[1])},onBlur:function(e){!function(e){te&&(console.log("Responses: ",n),console.log("That is what was blured",e),Object.keys(n).map((function(e){te.collection("responses").doc(e).set({contents:n[e]?n[e]:j.firestore.FieldValue.delete()},{merge:!0})})))}(e)},children:Object(c.jsx)(T.a,{variant:"outlined",disabled:ie,style:{borderWidth:2,borderColor:"red",color:"red",margin:5},onClick:function(){return e="send",console.log("Dialog open"),void("send"===e&&(Ue("send"),Ie(!0)));var e},children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"})}):Object(c.jsx)("p",{})]}):Object(c.jsxs)(p.a,{container:!0,direction:"column",style:{padding:20},justify:"center",children:[Object(c.jsx)(U.a,{align:"center",variant:"h3",children:"\u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044c"}),Object(c.jsx)("br",{}),Object(c.jsx)(T.a,{variant:"contained",onClick:u,children:"\u0412\u043e\u0439\u0442\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google"})]})},Ut=function(){return Object(c.jsx)(O.a,{children:Object(c.jsx)(p.a,{container:!0,justify:"center",children:Object(c.jsx)(M,{children:Object(c.jsxs)(h.d,{children:[Object(c.jsx)(h.b,{exact:!0,path:"/profile",children:Object(c.jsx)(we,{})}),Object(c.jsx)(h.b,{exact:!0,path:"/request",children:Object(c.jsx)(Ke,{})}),Object(c.jsx)(h.b,{exact:!0,path:"/tasks",children:Object(c.jsx)(ze,{})}),Object(c.jsx)(h.b,{path:"/tasks/:id",children:Object(c.jsx)(Ve,{})}),Object(c.jsx)(h.b,{path:"/t/:id",children:Object(c.jsx)(Tt,{})}),Object(c.jsx)(h.b,{exact:!0,path:"/tasksObserver",children:Object(c.jsx)(ft,{})}),Object(c.jsx)(h.b,{exact:!0,path:"/notifications",children:Object(c.jsx)(Ze,{})}),Object(c.jsx)(h.b,{exact:!0,path:"/signin",children:Object(c.jsx)(Ot,{})}),Object(c.jsx)(h.b,{exact:!0,path:"/faq",children:Object(c.jsx)(mt,{})}),Object(c.jsx)(h.b,{path:"/p/:id",children:Object(c.jsx)(Et,{})}),Object(c.jsx)(ht,{path:"/",component:at})]})})})})},At=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,781)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),c(e),a(e),r(e),i(e)}))};s.a.render(Object(c.jsx)(r.a.StrictMode,{children:Object(c.jsx)(f,{children:Object(c.jsx)(Ut,{})})}),document.getElementById("root")),At()}},[[693,1,2]]]);
//# sourceMappingURL=main.3f846e97.chunk.js.map