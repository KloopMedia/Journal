(this.webpackJsonpjournal=this.webpackJsonpjournal||[]).push([[0],{458:function(e,t,a){},792:function(e,t,a){"use strict";a.r(t);a(453);var n=a(0),r=a.n(n),c=a(26),o=a.n(c),i=(a(458),a(4)),s=a(76);s.a.initializeApp({apiKey:"AIzaSyBfzhQOCtbcUk_tWjPDnjYtHwoouCEkclg",authDomain:"journal-bb5e3.firebaseapp.com",databaseURL:"https://journal-bb5e3.firebaseio.com",projectId:"journal-bb5e3",storageBucket:"journal-bb5e3.appspot.com",messagingSenderId:"918752509407",appId:"1:918752509407:web:77670a68ff906f13e5d86a"});var l=new s.a.auth.GoogleAuthProvider,u=function(){l.setCustomParameters({prompt:"select_account"}),s.a.auth().signInWithPopup(l)},d=s.a,f=r.a.createContext(),m=function(e){var t=e.children,a=Object(n.useState)(null),c=Object(i.a)(a,2),o=c[0],s=c[1],l=Object(n.useState)(!0),u=Object(i.a)(l,2),m=(u[0],u[1]);return Object(n.useEffect)((function(){d.auth().onAuthStateChanged((function(e){s(e),m(!1);var t=d.firestore().collection("users");if(e){var a=t.doc(e.uid);a.get().then((function(t){t&&t.exists?console.log("User Exist"):(console.log("Creating user"),a.set({username:e.displayName,email:e.email,created_date:d.firestore.FieldValue.serverTimestamp()}))}))}}))}),[]),r.a.createElement(f.Provider,{value:{currentUser:o}},t)},b=a(60),p=a(23),g=a(881),h=a(9),j=a(22),O=a(879),E=a(878),v=a(876),y=a(911),k=a(906),_=a(794),w=a(383),S=a.n(w),x=a(409),C=a(880),q=a(885),I=a(206),D=a(874),F=a(32),T=a.p+"static/media/kloop_transparent_site.f6fb098e.png",U=a(384),R=a.n(U),A=a(882),P=240,W=Object(D.a)((function(e){return{root:{display:"flex"},drawer:Object(j.a)({},e.breakpoints.up("sm"),{width:P,flexShrink:0}),appBar:Object(j.a)({background:"white",boxShadow:"none"},e.breakpoints.up("sm"),{width:"calc(100% - ".concat(P,"px)"),marginLeft:P}),menuButton:Object(j.a)({color:"black",marginRight:e.spacing(2)},e.breakpoints.up("sm"),{display:"none"}),toolbar:e.mixins.toolbar,drawerPaper:{width:P},content:{flexGrow:1,padding:e.spacing(3)}}}));var B=function(e){var t=e.window,a=W(),c=Object(F.a)(),o=r.a.useState(!1),s=Object(i.a)(o,2),l=s[0],m=s[1],p=Object(n.useContext)(f).currentUser,w=r.a.useState(null),D=Object(i.a)(w,2),U=D[0],P=D[1],B=Boolean(U),N=function(){m(!l)},z=Object(n.useState)(!1),M=Object(i.a)(z,2),L=M[0],V=M[1],G=Object(n.useState)(0),H=Object(i.a)(G,2),Q=H[0],K=H[1],J=Object(n.useState)([]),Y=Object(i.a)(J,2),X=Y[0],Z=Y[1],$=Object(n.useState)([]),ee=Object(i.a)($,2),te=ee[0],ae=ee[1],ne=Object(n.useState)({}),re=Object(i.a)(ne,2),ce=re[0],oe=re[1],ie=Object(n.useState)([]),se=Object(i.a)(ie,2),le=se[0],ue=se[1];Object(n.useEffect)((function(){p&&d.firestore().collection("editors").get().then((function(e){e.forEach((function(e){e.id===p.uid&&(console.log("moderator"),V(!0))}))})).catch((function(){return V(!1)}))}),[p]),Object(n.useEffect)((function(){p&&d.firestore().collection("users").doc(p.uid).collection("user_private").doc("private").onSnapshot((function(e){e.data()&&ae(e.data().ranks)}))}),[p]),Object(n.useEffect)((function(){p&&d.firestore().collection("schema").doc("structure").collection("ranks").where("assign_without_moderator","==",!0).get().then((function(e){var t=[];return e.forEach((function(e){t.push(e.id)})),console.log("Assignable",t),t})).then((function(e){return ue(e)}))}),[p]),Object(n.useEffect)((function(){te&&te.length>0&&d.firestore().collection("pages").where("ranks","array-contains-any",te).onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||(oe((function(t){return Object(h.a)(Object(h.a)({},t),{},Object(j.a)({},e.doc.id,e.doc.data()))})),console.log("User pages: ",e.doc.id)),"removed"===e.type&&oe((function(t){var a=Object.assign({},t);return delete a[e.doc.id],a}))}))}))}),[te]),Object(n.useEffect)((function(){le&&le.length>0&&d.firestore().collection("pages").where("ranks","array-contains-any",le).onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||(oe((function(t){return Object(h.a)(Object(h.a)({},t),{},Object(j.a)({},e.doc.id,e.doc.data()))})),console.log("User pages assign: ",e.doc.id)),"removed"===e.type&&oe((function(t){var a=Object.assign({},t);return delete a[e.doc.id],a}))}))}))}),[le]),Object(n.useEffect)((function(){var e=function(){};return p&&d.firestore().collection("notifications").where("user_id","array-contains",p.uid).where("shown","!=",!0).onSnapshot((function(e){console.log(e.size);var t=[],a=0;e.forEach((function(e){t.push(Object(h.a)({id:e.id},e.data())),a++})),t.sort((function(e,t){return t.created_date.toDate()-e.created_date.toDate()})),K(a),Z(t)})),function(){return e}}),[p]);var de=r.a.createElement("div",null,r.a.createElement("div",{className:a.toolbar}),r.a.createElement(v.a,null),r.a.createElement("nav",null,r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(b.b,{to:"/"},"\u0413\u043b\u0430\u0432\u043d\u0430\u044f")),r.a.createElement("li",null,r.a.createElement(b.b,{to:"/profile"},"\u041f\u0440\u043e\u0444\u0438\u043b\u044c")),r.a.createElement("li",null,r.a.createElement(b.b,{to:"/notifications"},"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f")),L?r.a.createElement("li",null,r.a.createElement(b.b,{to:"/tasksObserver"},"\u041c\u043e\u0434\u0435\u0440\u0430\u0442\u043e\u0440")):null),r.a.createElement("ul",null,Object.keys(ce).map((function(e){return r.a.createElement("li",{key:e}," ",r.a.createElement(b.b,{to:"/p/"+e},ce[e].name)," ")}))))),fe=void 0!==t?function(){return t().document.body}:void 0;return r.a.createElement("div",{className:a.root},r.a.createElement(E.a,null),r.a.createElement(O.a,{position:"fixed",className:a.appBar},r.a.createElement(C.a,null,r.a.createElement(_.a,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:N,className:a.menuButton},r.a.createElement(S.a,null)),r.a.createElement(g.a,{container:!0,style:{flexGrow:1}},r.a.createElement("img",{src:T,alt:"Kloop.kg - \u041d\u043e\u0432\u043e\u0441\u0442\u0438 \u041a\u044b\u0440\u0433\u044b\u0437\u0441\u0442\u0430\u043d\u0430",style:{width:150,height:"auto"}})),p&&r.a.createElement("div",null,r.a.createElement(_.a,{"aria-label":"account of current user","aria-controls":"menu-appbar","aria-haspopup":"true",onClick:function(e){P(e.currentTarget)},color:"inherit",size:"small"},r.a.createElement(A.a,{badgeContent:Q,color:"secondary",overlap:"circle"},r.a.createElement(R.a,{style:{fill:"grey",fontSize:"28px"}}))),r.a.createElement(x.a,{id:"menu-appbar",anchorEl:U,anchorOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:B,onClose:function(){P(null)}},r.a.createElement(g.a,{container:!0,direction:"column",alignItems:"center"},X.length>0?X.map((function(e,t){return r.a.createElement(g.a,{container:!0,key:e.id,className:a.message,justify:"flex-start",style:{padding:0}},r.a.createElement(I.a,{style:{flex:1,padding:10}},e.title),r.a.createElement(q.a,{style:{padding:10},onClick:function(){return t=e.id,void d.firestore().collection("notifications").doc(t).update({shown:!0});var t},size:"small"},"\u0441\u043a\u0440\u044b\u0442\u044c"))})):r.a.createElement(I.a,{className:a.message,align:"center",style:{padding:10}},"\u041d\u0435\u0442 \u043d\u043e\u0432\u044b\u0445 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0439")))),p?r.a.createElement("div",null,r.a.createElement("span",{style:{color:"black",fontSize:12,marginLeft:7}},p.email),r.a.createElement(q.a,{style:{borderColor:"black",color:"black",marginLeft:10,fontSize:12},variant:"outlined",size:"small",onClick:function(){return d.auth().signOut()}},"\u0412\u044b\u0445\u043e\u0434")):r.a.createElement(q.a,{style:{borderColor:"black",color:"black",marginLeft:10,fontSize:12},size:"small",variant:"outlined",onClick:u},"\u0432\u0445\u043e\u0434"))),r.a.createElement("nav",{className:a.drawer,"aria-label":"mailbox folders"},r.a.createElement(k.a,{smUp:!0,implementation:"css"},r.a.createElement(y.a,{container:fe,variant:"temporary",anchor:"rtl"===c.direction?"right":"left",open:l,onClose:N,classes:{paper:a.drawerPaper},ModalProps:{keepMounted:!0}},de)),r.a.createElement(k.a,{xsDown:!0,implementation:"css"},r.a.createElement(y.a,{classes:{paper:a.drawerPaper},variant:"permanent",open:!0},de))),r.a.createElement("main",{className:a.content},r.a.createElement("div",{className:a.toolbar}),e.children))},N=a(888),z=a(903),M=a(268),L=a.n(M),V=a(889),G=a(893),H=a(891),Q=a(892),K=a(890),J=a(907),Y=a(886),X=a(887),Z=a(796),$=function(e){var t=Object(n.useState)(null),a=Object(i.a)(t,2),c=a[0],o=a[1],s=Object(n.useState)(""),l=Object(i.a)(s,2),u=l[0],d=l[1],f=e.returnAnswer;return r.a.createElement("div",null,r.a.createElement("h4",null,e.title),r.a.createElement(Z.a,{const:"fieldset",style:{paddingBottom:15}},r.a.createElement(Y.a,{"aria-label":e.title,name:e.title,value:c,onChange:function(e){o(e.target.value),f({reason:e.target.value,text:u})}},e.answers.map((function(t,a){return r.a.createElement(X.a,{key:a,value:t,control:r.a.createElement(J.a,{color:"primary"}),label:t,disabled:!!e.locked})})))),r.a.createElement(N.a,{id:"feedback_input",label:"\u041f\u0440\u0438\u043c\u0435\u0447\u0430\u043d\u0438\u0435",value:u,onChange:function(e){d(e.target.value),f({reason:c,text:e.target.value})},multiline:!0,rows:5,variant:"outlined",fullWidth:!0}))};function ee(e){return r.a.createElement("div",null,r.a.createElement(V.a,{open:e.state,onClose:e.handleClose,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},r.a.createElement(K.a,{id:"alert-dialog-title"},e.title),r.a.createElement(H.a,null,r.a.createElement(Q.a,{id:"alert-dialog-description"},r.a.createElement(I.a,null,e.description),r.a.createElement($,{answers:e.answers,returnAnswer:e.returnFeedback}))),r.a.createElement(G.a,null,r.a.createElement(q.a,{onClick:e.handleClose,color:"primary"},"\u041e\u0442\u043c\u0435\u043d\u0430"),r.a.createElement(q.a,{onClick:e.dialogFunction,disabled:!e.feedbackValue.reason,color:"primary",autoFocus:!0},"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"))))}var te=a(11),ae=a.n(te),ne=a(18),re=a(895),ce=(a(386),a(387),a(894)),oe=function(e){return r.a.createElement(z.a,{display:"flex",alignItems:"center"},r.a.createElement(z.a,{width:"100%",mr:1},r.a.createElement(ce.a,Object.assign({variant:"determinate"},e))),r.a.createElement(z.a,{minWidth:35},r.a.createElement(I.a,{variant:"body2",color:"textSecondary"},"".concat(Math.round(e.value),"%"))))},ie=Object(D.a)((function(e){return{root:{"& > *":{width:"40ch"}}}})),se=function(e){ie();var t=r.a.useState(""),a=Object(i.a)(t,2),c=(a[0],a[1],Object(n.useState)(!1)),o=Object(i.a)(c,2),s=(o[0],o[1],Object(n.useState)({})),l=Object(i.a)(s,2),u=(l[0],l[1],Object(n.useState)({})),f=Object(i.a)(u,2),m=(f[0],f[1]),b=Object(n.useState)(!1),p=Object(i.a)(b,2),g=(p[0],p[1]),h=e.returnFile,j=(e.locked,e.id),O=e.feedbackType,E=e.askFeedback;e.saveQuestionFeedback,e.prevTaskId;Object(n.useEffect)((function(){console.log(O),O&&E?(console.log(O),d.firestore().collection("schema").doc("structure").collection("feedbacks").doc(O).get().then((function(e){m(e.data())})),g(!0)):g(!1)}),[O]);return r.a.createElement("div",null,r.a.createElement("input",{type:"file",onChange:function(e){h(e.target.files,j)},multiple:!0}))},le=Object(D.a)((function(e){return{root:{"& > *":{width:"40ch"}}}})),ue=Object(n.forwardRef)((function(e,t){le();var a=r.a.useState(""),c=Object(i.a)(a,2),o=c[0],s=c[1],l=Object(n.useState)(!1),u=Object(i.a)(l,2),f=u[0],m=u[1],b=Object(n.useState)(null),p=Object(i.a)(b,2),g=(p[0],p[1],Object(n.useState)({})),h=Object(i.a)(g,2),j=h[0],O=h[1],E=Object(n.useState)({}),v=Object(i.a)(E,2),y=v[0],k=v[1],w=Object(n.useState)(!1),S=Object(i.a)(w,2),x=S[0],C=S[1],q=e.index,D=e.response,F=e.returnFile,T=e.locked,U=e.id,R=e.feedbackType,A=e.askFeedback,P=e.saveQuestionFeedback,W=e.prevTaskId,B=(e.uploadFilesData,e.attachMaterials);Object(n.useEffect)((function(){D&&s(D)}),[D]),Object(n.useEffect)((function(){R&&A?(console.log(R),d.firestore().collection("schema").doc("structure").collection("feedbacks").doc(R).get().then((function(e){k(e.data())})),C(!0)):C(!1)}),[R]);var M=function(){m(!1)};return r.a.createElement("div",null,r.a.createElement(ee,{title:y.title,dialogFunction:function(){P(j,U,W),M()},state:f,handleClose:M,feedbackValue:j,answers:y.answers,description:y.description,returnFeedback:function(e){O(e)}}),r.a.createElement(z.a,{display:"flex",style:{marginBottom:10,marginTop:20}},r.a.createElement(I.a,{variant:"h6",style:{paddingRight:8}},e.title),x&&r.a.createElement(_.a,{size:"small",onClick:function(){return m(!0)}},r.a.createElement(L.a,{color:"primary"}))),r.a.createElement(N.a,{id:"inputBox"+q,label:"\u041c\u043e\u0439 \u043e\u0442\u0432\u0435\u0442",value:o,onChange:function(t){s(t.target.value),e.returnAnswer(t.target.value,e.index)},multiline:!0,rows:5,disabled:T,variant:"outlined",fullWidth:!0}),!T&&B&&r.a.createElement(se,{returnFile:F,locked:T,id:U}))})),de=a(799),fe=a(912),me=a(805),be=Object(D.a)((function(e){return{formControl:{minWidth:100,maxWidth:300}}}));function pe(e){var t=be(),a=r.a.useState(""),c=Object(i.a)(a,2),o=c[0],s=c[1],l=r.a.useState(!1),u=Object(i.a)(l,2),d=u[0],f=u[1],m=e.index,b=e.response,p=(e.required,e.locked);Object(n.useEffect)((function(){b&&s(b)}),[b]);return r.a.createElement("div",null,r.a.createElement(I.a,{variant:"h6",style:{marginBottom:5,marginTop:20}},e.title),r.a.createElement(Z.a,{className:t.formControl,disabled:p},r.a.createElement(de.a,{id:"controlled-open-select-label"},"\u0412\u044b\u0431\u0440\u0430\u0442\u044c"),r.a.createElement(me.a,{labelId:"controlled-open-select-label",id:"select"+m,open:d,onClose:function(e){f(!1)},onOpen:function(e){f(!0)},value:o,onChange:function(t){s(t.target.value);e.answers.indexOf(t.target.value);e.returnAnswer(t.target.value,m)}},r.a.createElement(fe.a,{value:""},r.a.createElement("em",null,"None")),e.answers.map((function(e,t){return r.a.createElement(fe.a,{key:t,value:e},e)})))))}function ge(e){var t=r.a.useState(""),a=Object(i.a)(t,2),c=a[0],o=a[1],s=e.index,l=e.response;Object(n.useEffect)((function(){l&&o(l)}),[l]);return r.a.createElement("div",null,r.a.createElement("h4",null,e.title),r.a.createElement(Z.a,{const:"fieldset"},r.a.createElement(Y.a,{"aria-label":e.title,name:e.title,value:c,onChange:function(t){o(t.target.value);var a=e.answers.indexOf(t.target.value);e.returnAnswer(t.target.value,s,a)}},e.answers.map((function(t,a){return r.a.createElement(X.a,{key:a,value:t,control:r.a.createElement(J.a,{color:"primary"}),label:t,disabled:!!e.locked})})))))}var he=Object(D.a)((function(e){return{container:{display:"flex",flexWrap:"wrap"},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:"auto"}}}));function je(e){var t=he(),a=r.a.useState(""),c=Object(i.a)(a,2),o=c[0],s=c[1],l=e.index,u=e.response;Object(n.useEffect)((function(){u&&s(u)}),[l,u]);return r.a.createElement("div",null,r.a.createElement("h4",null,e.title),r.a.createElement("form",{className:t.container,noValidate:!0},r.a.createElement(N.a,{id:"time"+l,label:"\u0412\u0440\u0435\u043c\u044f",type:"time",value:o,onChange:function(t){s(t.target.value),e.returnAnswer(t.target.value,l,t.target.value)},className:t.textField,InputLabelProps:{shrink:!0},InputProps:{disableUnderline:!0},disabled:!!e.locked})))}var Oe=a(800),Ee=a(797),ve=a(909);function ye(e){var t=r.a.useState({}),a=Object(i.a)(t,2),c=a[0],o=a[1],s=Object(n.useState)(!1),l=Object(i.a)(s,2),u=l[0],d=l[1],f=e.index,m=e.answers,b=(e.required,e.response),p=e.locked;Object(n.useEffect)((function(){if(b){o(b);var t={};m.forEach((function(e,a){b[e]?t[e]=b[e]:t[e]=!1})),o(t),e.returnAnswer(t,f)}else{var a={};m.forEach((function(e,t){return a[e]=!1})),e.returnAnswer(a,f)}d(!0),console.log(c)}),[b,m]);var g=function(t){o(Object(h.a)(Object(h.a)({},c),{},Object(j.a)({},t.target.name,t.target.checked))),e.returnAnswer(Object(h.a)(Object(h.a)({},c),{},Object(j.a)({},t.target.name,t.target.checked)),f)};return u?r.a.createElement("div",null,r.a.createElement(I.a,{variant:"h6",style:{marginBottom:0,marginTop:20}},e.title),r.a.createElement(Z.a,{component:"fieldset",disabled:p},r.a.createElement(Oe.a,{component:"legend"},"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u0438\u043d \u0438\u043b\u0438 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u043e\u0432"),r.a.createElement(Ee.a,null,m.map((function(e,t){return r.a.createElement(X.a,{key:t,control:r.a.createElement(ve.a,{checked:c[e],onChange:g,name:e}),label:e})}))))):null}var ke=function(){var e=Object(n.useState)([]),t=Object(i.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)({}),s=Object(i.a)(o,2),l=s[0],m=s[1],b=Object(n.useState)([]),j=Object(i.a)(b,2),O=j[0],E=j[1],v=Object(n.useState)(!1),y=Object(i.a)(v,2),k=y[0],_=y[1],w=Object(n.useState)(!1),S=Object(i.a)(w,2),x=S[0],C=S[1],D=Object(n.useState)({}),F=Object(i.a)(D,2),T=(F[0],F[1]),U=Object(n.useContext)(f).currentUser;Object(n.useEffect)((function(){var e={};U&&d.firestore().collection("users").doc(U.uid).get().then((function(t){T(t.data()),e=t.data()})).then((function(){d.firestore().collection("profileTemplate").doc("Template").get().then((function(t){console.log(JSON.stringify(t.data())),c(t.data().questions),console.log(t.data().questions);var a=t.data().questions.map((function(t,a){var n=null;return e[t.key]&&(console.log(e[t.key]),n=e[t.key]),"input"===t.type?r.a.createElement(ue,{key:"profile_"+a,index:a,title:t.question,response:n,returnAnswer:R,required:t.required}):"select"===t.type?r.a.createElement(pe,{key:"profile_"+a,index:a,title:t.question,response:n,answers:t.answers,returnAnswer:R,required:t.required}):"radio"===t.type?r.a.createElement(ge,{key:"profile_"+a,index:a,title:t.question,response:n,answers:t.answers,returnAnswer:R,required:t.required}):"time"===t.type?r.a.createElement(je,{key:"profile_"+a,index:a,title:t.question,response:n,returnAnswer:R,required:t.required}):"checkbox"===t.type?r.a.createElement(ye,{key:"profile_"+a,index:a,title:t.question,response:n,answers:t.answers,returnAnswer:R,required:t.required}):null}));E(a)}))}))}),[U]);var R=function(e,t){var a=l;a[t]=e,m(a),console.log(l)};return U?r.a.createElement(g.a,{style:{padding:30}},x&&r.a.createElement(p.a,{to:"/"}),O,r.a.createElement(g.a,{container:!0,style:{padding:20},justify:"center"},r.a.createElement(q.a,{variant:"outlined",style:{borderWidth:2,borderColor:"#003366",color:"#003366",margin:10},onClick:function(){var e={};a.forEach((function(t,a){l[a]&&(e[t.key]=l[a])})),d.firestore().collection("users").doc(U.uid).update(Object(h.a)({},e)).then((function(){return _(!0)}))}},"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"),k&&r.a.createElement(q.a,{variant:"outlined",style:{borderWidth:2,borderColor:"red",color:"red",margin:10},onClick:function(){return C(!0)}},"\u041d\u0430 \u0433\u043b\u0430\u0432\u043d\u0443\u044e"))):r.a.createElement(g.a,{container:!0,direction:"column",style:{padding:20},justify:"center"},r.a.createElement(I.a,{align:"center",variant:"h3"},"\u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044c"),r.a.createElement("br",null),r.a.createElement(q.a,{variant:"contained",onClick:u},"\u0412\u043e\u0439\u0442\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google"))},_e=a(122),we=a(279),Se=a(905),xe=a(899),Ce=a(896),qe=a(898),Ie=a(897),De=Object(D.a)({root:{minWidth:250},bullet:{display:"inline-block",margin:"0 2px"},title:{fontSize:14},pos:{marginBottom:12}}),Fe=function(e){var t=De(),a=e.title,c=e.complete,o=e.type,s=(e.language,e.description),l=e.id,u=e.cardColor,d=e.sendRequest,f=e.disabled,m=Object(n.useState)(!1),b=Object(i.a)(m,2),g=b[0],h=b[1];return r.a.createElement("div",null,g&&r.a.createElement(p.a,{to:"/tasks/"+l}),r.a.createElement(Ce.a,{className:t.root,style:{background:u}},r.a.createElement(Ie.a,null,r.a.createElement(z.a,{display:"flex",justifyContent:"space-between",alignItems:"center"},r.a.createElement(I.a,{variant:"h6"},a),c&&r.a.createElement(I.a,{color:"error"},"\u0421\u0434\u0430\u043d\u043e")),r.a.createElement(I.a,{variant:"subtitle1",className:t.pos,color:"textSecondary"},"#",o),r.a.createElement(I.a,{variant:"body2",component:"p"},"\u0417\u0430\u0434\u0430\u043d\u0438\u0435: ",s)),r.a.createElement(qe.a,null,d?r.a.createElement(q.a,{variant:"contained",disabled:f,color:"primary",size:"small",onClick:function(){return d(o,l)}},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435"):r.a.createElement(q.a,{size:"small",onClick:function(){return h(!0)}},"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"))))};function Te(e){var t=e.children,a=e.value,n=e.index,c=Object(_e.a)(e,["children","value","index"]);return r.a.createElement("div",Object.assign({role:"tabpanel",hidden:a!==n,id:"full-width-tabpanel-".concat(n),"aria-labelledby":"full-width-tab-".concat(n)},c),a===n&&r.a.createElement(z.a,{p:3},r.a.createElement(I.a,null,t)))}function Ue(e){return{id:"full-width-tab-".concat(e),"aria-controls":"full-width-tabpanel-".concat(e)}}var Re=Object(D.a)({root:{paddingTop:30,flexGrow:1}}),Ae=function(e){var t=Re(),a=Object(n.useState)(null),c=Object(i.a)(a,2),o=c[0],s=c[1],l=Object(n.useState)(null),u=Object(i.a)(l,2),m=u[0],b=u[1],p=Object(n.useState)(null),j=Object(i.a)(p,2),O=(j[0],j[1],Object(n.useContext)(f).currentUser),E=Object(n.useState)(0),v=Object(i.a)(E,2),y=v[0],k=v[1];Object(n.useEffect)((function(){if(O){var e=[],t=[];console.log("Fired"),d.firestore().collection("tasks").where("assigned_users","array-contains",O.uid).get().then((function(a){a.forEach((function(a){console.log(a.id," => ",a.data()),a.data().is_complete?t.push(Object(h.a)({id:a.id},a.data())):e.push(Object(h.a)({id:a.id},a.data()))}))})).then((function(){s(e),b(t)})).catch((function(e){console.log("Error getting documents: ",e)}))}}),[O]);return r.a.createElement(g.a,{container:!0,justify:"center",alignItems:"center",direction:"column"},r.a.createElement("div",{className:t.root},r.a.createElement(we.a,{position:"static",color:"default"},r.a.createElement(Se.a,{value:y,onChange:function(e,t){k(t)},variant:"fullWidth",centered:!0,"aria-label":"simple tabs example"},r.a.createElement(xe.a,Object.assign({label:"\u041d\u0435\u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435"},Ue(0))),r.a.createElement(xe.a,Object.assign({label:"\u0412\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435"},Ue(1)))))),r.a.createElement(Te,{value:y,index:0},o&&o.map((function(e,t){return r.a.createElement(g.a,{key:"active_task_"+t,style:{padding:10}},r.a.createElement(Fe,{title:e.title,complete:e.is_complete,description:e.description,type:e.type,id:e.id}))}))),r.a.createElement(Te,{value:y,index:1},m&&m.map((function(e,t){return r.a.createElement(g.a,{key:"submitted_task_"+t,style:{padding:10}},r.a.createElement(Fe,{title:e.title,complete:e.is_complete,description:e.description,type:e.type,id:e.id}))}))))},Pe=a(27);var We=function(e){var t=e.title;return r.a.createElement("div",null,r.a.createElement(I.a,{variant:"h6",style:{marginBottom:0,marginTop:20}},t))},Be=Object(n.forwardRef)((function(e,t){var a=e.question,n=e.index,c=e.response,o=e.uploadsRef,i=e.returnAnswer,s=e.locked,l=e.askFeedback,u=e.saveQuestionFeedback,d=e.id,f=e.prevTaskId,m=e.returnFile,b=e.uploadFilesData;return"input"===a.type?r.a.createElement(ue,{key:n,index:n,title:a.title,response:c,returnAnswer:i,required:a.required,locked:s,askFeedback:l,feedbackType:a.feedback_type,saveQuestionFeedback:u,id:d,prevTaskId:f,uploadFilesData:b,uploadsRef:o,returnFile:m,attachMaterials:a.attachMaterials}):"select"===a.type?r.a.createElement(pe,{key:n,index:n,title:a.title,response:c,answers:a.answers,returnAnswer:i,required:a.required,locked:s}):"radio"===a.type?r.a.createElement(ge,{key:n,index:n,title:a.title,response:c,answers:a.answers,returnAnswer:i,required:a.required,locked:s}):"time"===a.type?r.a.createElement(je,{key:n,index:n,title:a.title,response:c,returnAnswer:i,required:a.required,locked:s}):"checkbox"===a.type?r.a.createElement(ye,{key:n,index:n,title:a.title,response:c,answers:a.answers,returnAnswer:i,required:a.required,locked:s}):"text"===a.type?r.a.createElement(We,{key:n,title:a.title}):"file"===a.type?r.a.createElement(se,{key:n,index:n,id:d,title:a.title,returnFile:m,locked:s,askFeedback:l,feedbackType:a.feedback_type,saveQuestionFeedback:u,prevTaskId:f}):null}));function Ne(e){return r.a.createElement("div",null,r.a.createElement(V.a,{open:e.state,onClose:e.handleClose,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},r.a.createElement(K.a,{id:"alert-dialog-title"},e.title),r.a.createElement(H.a,null,r.a.createElement(Q.a,{id:"alert-dialog-description"},e.content)),e.hideActions?"":e.showOk?r.a.createElement(G.a,null,r.a.createElement(q.a,{onClick:e.handleOk,color:"primary"},"Ok")):r.a.createElement(G.a,null,r.a.createElement(q.a,{onClick:e.handleClose,color:"primary"},"\u041e\u0442\u043c\u0435\u043d\u0430"),r.a.createElement(q.a,{onClick:e.dialogFunction,color:"primary",autoFocus:!0},"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"))))}var ze=a(910),Me=a(149),Le=a.n(Me),Ve=function(){var e=Object(n.useState)([]),t=Object(i.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)([]),s=Object(i.a)(o,2),l=(s[0],s[1]),m=Object(n.useState)({}),b=Object(i.a)(m,2),j=b[0],O=b[1],E=Object(n.useState)([]),v=Object(i.a)(E,2),y=v[0],k=v[1],w=Object(n.useState)(!1),S=Object(i.a)(w,2),x=S[0],C=S[1],D=Object(n.useState)(!1),F=Object(i.a)(D,2),T=F[0],U=(F[1],Object(n.useState)({})),R=Object(i.a)(U,2),A=(R[0],R[1],Object(n.useState)(!1)),P=Object(i.a)(A,2),W=P[0],B=P[1],N=Object(n.useState)([]),z=Object(i.a)(N,2),M=(z[0],z[1]),L=Object(n.useState)(!1),V=Object(i.a)(L,2),G=V[0],H=V[1],Q=Object(n.useState)(null),K=Object(i.a)(Q,2),J=K[0],Y=K[1],X=Object(n.useState)({}),Z=Object(i.a)(X,2),$=Z[0],te=Z[1],ce=Object(n.useState)({}),oe=Object(i.a)(ce,2),ie=oe[0],se=oe[1],le=Object(n.useState)(!1),ue=Object(i.a)(le,2),de=ue[0],fe=ue[1],me=Object(n.useState)({}),be=Object(i.a)(me,2),pe=be[0],ge=be[1],he=Object(n.useState)(!1),je=Object(i.a)(he,2),Oe=je[0],Ee=je[1],ve=Object(n.useContext)(f).currentUser,ye=Object(p.h)().id,ke=Object(p.g)(),_e=function(e,t){"clickaway"!==t&&fe(!1)};Object(n.useEffect)((function(){var e=function(){var e=Object(ne.a)(ae.a.mark((function e(t){var a;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],e.next=3,d.firestore().collection("tasks").doc(t).collection("questions").get().then((function(e){e.forEach((function(e){a.push({questionId:e.id,data:e.data()})}))})).catch((function(e){console.log("Error getting documents: ",e)}));case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t=function(){var e=Object(ne.a)(ae.a.mark((function e(t){var a;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],e.next=3,d.firestore().collection("tasks").doc(t).collection("responses").get().then((function(e){e.forEach((function(e){a.push({responseId:e.id,data:e.data()})}))})).catch((function(e){console.log("Error getting documents: ",e)}));case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a=function(){var e=Object(ne.a)(ae.a.mark((function e(){var t;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,d.firestore().collection("tasks").doc(ye).get().then((function(e){return e.data()})).then(function(){var e=Object(ne.a)(ae.a.mark((function e(a){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.firestore().collection("tasks").where("case_id","==",a.case_id).get().then((function(e){e.forEach((function(e){e.id!==ye&&t.push(Object(h.a)({id:e.id},e.data()))}))}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();ve&&function(){var n=Object(ne.a)(ae.a.mark((function n(){var o,i,s,u,f,m,b,p,g,h,j;return ae.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=[],i=!0,k(null),n.next=5,d.firestore().collection("tasks").doc(ye).collection("user_editable").doc("user_editable").get().then((function(e){"complete"===e.data().status?(i=!0,B(!0)):i=!1}));case 5:return s=[],u=[],n.next=9,a();case 9:if(f=n.sent,M(f),!(f.length>0)){n.next=21;break}return m=f.map((function(t){return e(t.id)})),b=f.map((function(e){return t(e.id)})),console.log(m),n.next=17,Promise.all(m).then((function(e){return e.forEach((function(e){return s.push.apply(s,Object(Pe.a)(e))}))}));case 17:return n.next=19,Promise.all(b).then((function(e){return e.forEach((function(e){return u.push.apply(u,Object(Pe.a)(e))}))}));case 19:console.log(s),console.log(u);case 21:return(p=s.map((function(e,t){var a=null;return u.forEach((function(n){e.questionId===n.responseId&&(a=n.data.answer,we(n.data.answer,t))})),r.a.createElement(Be,{key:e.questionId+"_"+t,question:e.data,index:t,response:a,returnAnswer:we,locked:!0,askFeedback:!0,saveQuestionFeedback:Ce,id:e.questionId,prevTaskId:f[0].id})}))).push(r.a.createElement("div",{key:"div_divider_stripped",style:{height:25,margin:"20px 0",background:"repeating-linear-gradient( 45deg, white, white 10px, grey 10px, grey 25px)"}},r.a.createElement("br",null))),n.next=25,e(ye);case 25:return g=n.sent,n.next=28,t(ye);case 28:h=n.sent,c(g),l(h),o=g.map((function(e,t){var a=null;return h.forEach((function(n){e.questionId===n.responseId&&(a=n.data.answer,we(n.data.answer,t))})),r.a.createElement(Be,{key:e.questionId+"_"+t,question:e.data,index:t,response:a,returnFile:Se,returnAnswer:we,id:e.questionId,locked:i,uploadFilesData:Ie})})),j=p.concat(o),k(j);case 34:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}()()}),[ve,ye,W]);var we=function(e,t){var a=j;a[t]=e,O(a)},Se=function(e,t){var a=Object(Pe.a)(e),n=pe;n[t]=a,ge(n),console.log(Object(Pe.a)(e),t)},xe=function(){var e=Object(ne.a)(ae.a.mark((function e(){var t,a,n;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Object.keys(pe).length>0)){e.next=12;break}console.log("files"),Ee(!0),t=ae.a.mark((function e(){var t,r,c,o;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(i.a)(n[a],2),r=t[0],c=t[1],o=d.storage().ref(ye).child(r).child(ve.uid),e.next=4,Promise.all(c.map(function(){var e=Object(ne.a)(ae.a.mark((function e(t){var a,n,c;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.child(t.name).put(t);case 2:return a=e.sent,e.next=5,a.ref.getDownloadURL();case 5:return n=e.sent,c=n.split("?")[0],e.next=9,Ie(t.name,c,r);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:case"end":return e.stop()}}),e)})),a=0,n=Object.entries(pe);case 5:if(!(a<n.length)){e.next=10;break}return e.delegateYield(t(),"t0",7);case 7:a++,e.next=5;break;case 10:C(!0),Ee(!1);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ce=function(e,t,a){a?d.firestore().collection("tasks").doc(a).collection("feedbacks").doc(t).collection("messages").add({answer:e.reason,text:e.text,user_id:ve.uid,timestamp:d.firestore.FieldValue.serverTimestamp()}).then((function(){return fe(!0)})):alert("\u041e\u0448\u0438\u0431\u043a\u0430: \u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a \u043f\u0440\u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0438 \u0444\u0438\u0434\u0431\u0435\u043a\u0430. \u0421\u043e\u043e\u0431\u0449\u0438\u0442\u0435 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0441\u0442\u0443!")},qe=function(){var e=Object(ne.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xe();case 2:if(a.forEach(function(){var e=Object(ne.a)(ae.a.mark((function e(t,a){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!j[a]&&""!==j[a]){e.next=3;break}return e.next=3,d.firestore().collection("tasks").doc(ye).collection("responses").doc(t.questionId).set({answer:j[a]},{merge:!0});case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),!t){e.next=9;break}return e.next=6,d.firestore().collection("tasks").doc(ye).collection("user_editable").doc("user_editable").update({status:"complete"});case 6:B(!0),console.log("Task Locked"),H(!1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ie=function(){var e=Object(ne.a)(ae.a.mark((function e(t,a,n){var r;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=d.firestore().collection("tasks").doc(ye).collection("responses").doc(n),console.log("\u0424\u0430\u0439\u043b \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d"),t&&a&&r.set({files:d.firestore.FieldValue.arrayUnion({public_url:a,filename:t})},{merge:!0}).then((function(){return console.log("super")}));case 3:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),De=function(){H(!1),te({})},Fe=function(e){"send"===e&&(Y("send"),H(!0)),"release"===e&&(Y("release"),H(!0))};Object(n.useEffect)((function(){d.firestore().collection("schema").doc("structure").collection("feedbacks").doc("release").get().then((function(e){se(e.data())}))}),[]);return ve?r.a.createElement(g.a,{style:{padding:30}},"send"===J&&r.a.createElement(Ne,{state:G,handleClose:De,hideActions:Oe||x,title:Oe?"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0444\u0430\u0439\u043b\u043e\u0432":x?"\u0424\u0430\u0439\u043b\u044b \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u044b":"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435?",content:Oe?r.a.createElement(re.a,null):x?"\u0421\u043f\u0430\u0441\u0438\u0431\u043e":"\u0412\u044b \u0441\u043e\u0431\u0438\u0440\u0430\u0435\u0442\u0435\u0441\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435. \u042d\u0442\u043e \u0437\u043d\u0430\u0447\u0438\u0442, \u0447\u0442\u043e \u0432\u044b \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u0441\u043c\u043e\u0436\u0435\u0442\u0435 \u0438\u0437\u043c\u0435\u043d\u044f\u0442\u044c \u043e\u0442\u0432\u0435\u0442\u044b.",dialogFunction:function(){return qe(!0)}}),"release"===J&&r.a.createElement(ee,{state:G,feedbackValue:$,handleClose:De,title:ie.title,dialogFunction:function(){d.firestore().collection("tasks").doc(ye).collection("user_editable").doc("user_editable").update({status:"open"}).then((function(){return d.firestore().collection("tasks").doc(ye).collection("user_editable").doc("user_editable").update({status:"released",release_status:$.reason,release_description:$.text}).then((function(){H(!1),B(!0)}))}))},answers:ie.answers,description:ie.description,returnFeedback:function(e){te(e)}}),T&&r.a.createElement(p.a,{to:"/tasks"}),r.a.createElement(ze.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:de,autoHideDuration:6e3,onClose:_e,message:"\u0424\u0438\u0434\u0431\u0435\u043a \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d",action:r.a.createElement(r.a.Fragment,null,r.a.createElement(_.a,{size:"small","aria-label":"close",color:"inherit",onClick:_e},r.a.createElement(Le.a,{fontSize:"small"})))}),y,r.a.createElement(g.a,{container:!0,style:{padding:20},justify:"center"},r.a.createElement(q.a,{variant:"outlined",style:{borderWidth:2,borderColor:"grey",color:"grey",margin:5},onClick:function(){return ke.goBack()}},"\u041d\u0430\u0437\u0430\u0434"),!W&&r.a.createElement("div",null,r.a.createElement(q.a,{variant:"outlined",disabled:W,style:{borderWidth:2,borderColor:"#003366",color:"#003366",margin:5},onClick:function(){return qe(!1)}},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"),r.a.createElement(q.a,{variant:"outlined",disabled:W,style:{borderWidth:2,borderColor:"red",color:"red",margin:5},onClick:function(){return Fe("send")}},"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"),r.a.createElement(q.a,{variant:"outlined",disabled:W,style:{borderWidth:2,borderColor:"red",color:"red",margin:5},onClick:function(){return Fe("release")}},"\u041e\u0441\u0432\u043e\u0431\u043e\u0434\u0438\u0442\u044c")))):r.a.createElement(g.a,{container:!0,direction:"column",style:{padding:20},justify:"center"},r.a.createElement(I.a,{align:"center",variant:"h3"},"\u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044c"),r.a.createElement("br",null),r.a.createElement(q.a,{variant:"contained",onClick:u},"\u0412\u043e\u0439\u0442\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google"))},Ge=a(269),He=function(e){var t=e.caseId,a=e.userRanks,c=Object(n.useState)(null),o=Object(i.a)(c,2),s=o[0],l=o[1],u=Object(n.useState)(!1),m=Object(i.a)(u,2),b=m[0],p=m[1],j=Object(n.useContext)(f).currentUser,O=r.a.useState(!1),E=Object(i.a)(O,2),v=E[0],y=E[1],k=Object(n.useState)(!1),w=Object(i.a)(k,2),S=w[0],x=w[1],C=Object(n.useState)(""),q=Object(i.a)(C,2),D=q[0],F=q[1],T=function(e,t){"clickaway"!==t&&y(!1)};Object(n.useEffect)((function(){if(j){var e=[];console.log("Fired"),d.firestore().collection("schema").doc("structure").collection("cases").doc(t).collection("stages").get().then((function(t){t.forEach((function(t){var n=t.data().ranks;console.log("RANKS"),console.log(n),console.log(a),e.push(Object(h.a)(Object(h.a)({id:t.id},t.data()),{},{disabled:!1}))}))})).then((function(){e.sort((function(e,t){return parseInt(e.order)-parseInt(t.order)})),l(e),p(!0)})).catch((function(e){console.log("Error getting documents: ",e)}))}}),[j]),Object(n.useEffect)((function(){j&&d.firestore().collection("tasks").where("assigned_users","array-contains",j.uid).where("is_complete","==",!1).get().then((function(e){e.size<3?(console.log("SIZE",e.size),x(!1)):(x(!0),F(r.a.createElement(I.a,{color:"error"},"\u0423 \u0432\u0430\u0441 \u0435\u0441\u0442\u044c \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0435 \u0437\u0430\u0434\u0430\u043d\u0438\u044f. \u0421\u0434\u0430\u0439\u0442\u0435 \u0438\u043b\u0438 \u043e\u0441\u0432\u043e\u0431\u043e\u0434\u0438\u0442\u0435 \u0438\u0445, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043d\u043e\u0432\u044b\u0435.")))}))}),[j,S,v]);var U=function(e,a){d.firestore().collection("task_requests").doc(j.uid).collection("requests").add({taskType:e,status:"pending",user:j.uid,case_type:t,case_stage_id:a}).then((function(e){y(!0),console.log("sending request")}))};return r.a.createElement("div",null,r.a.createElement(ze.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:v,autoHideDuration:6e3,onClose:T,message:"\u0417\u0430\u043f\u0440\u043e\u0441 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d",action:r.a.createElement(r.a.Fragment,null,r.a.createElement(_.a,{size:"small","aria-label":"close",color:"inherit",onClick:T},r.a.createElement(Le.a,{fontSize:"small"})))}),r.a.createElement(we.a,{style:{margin:"20px 5px",border:"1px grey solid"}},r.a.createElement(z.a,{style:{padding:"10px 20px 0px"}},r.a.createElement(z.a,{style:{padding:"5px 10px 10px"}},r.a.createElement(I.a,{variant:"h6"},e.title)),r.a.createElement(z.a,{style:{padding:"10px 10px 5px"}},r.a.createElement(I.a,{variant:"body2"},e.description)),r.a.createElement(z.a,{style:{padding:"10px 10px 0px"}},D)),r.a.createElement(g.a,{container:!0,justify:"center",style:{padding:10}},b&&s.map((function(e,t){return r.a.createElement(g.a,{item:!0,key:t,style:{padding:10}},r.a.createElement(Fe,{title:e.title,description:e.description,type:e.type,id:e.id,cardColor:"#F5F5F5",sendRequest:U,disabled:S||e.disabled}))})))))},Qe=function(){var e=Object(n.useContext)(f).currentUser,t=Object(n.useState)([]),a=Object(i.a)(t,2),c=a[0],o=a[1],s=Object(n.useState)(!1),l=Object(i.a)(s,2),u=l[0],m=l[1],b=Object(n.useState)([]),p=Object(i.a)(b,2),g=p[0],j=p[1];Object(n.useEffect)((function(){e&&d.firestore().collection("users").doc(e.uid).collection("user_private").doc("private").get().then((function(e){if(e&&e.exists){var t=e.data().ranks;console.log(t),j(t),O(t)}}))}),[e]);var O=function(e){var t=[];console.log("Fired"),d.firestore().collection("schema").doc("structure").collection("cases").where("ranks","array-contains-any",e).get().then((function(e){e.forEach((function(e){console.log(e.data()),t.push(Object(h.a)({id:e.id},e.data()))}))})).then((function(){o(t),m(!0)})).catch((function(e){console.log("Error getting documents: ",e)}))};return r.a.createElement("div",null,u&&c.map((function(e,t){return e.hide?null:r.a.createElement(He,{key:t,title:e.title,description:e.description,caseId:e.id,userRanks:g})})))},Ke=Object(D.a)((function(e){return{root:Object(j.a)({margin:20,width:500},e.breakpoints.down("sm"),{maxWidth:300}),bullet:{display:"inline-block",margin:"0 2px"},title:{fontSize:14},pos:{marginBottom:12}}})),Je=function(e){var t,a=Ke(),n=e.title,c=e.description,o=e.id,i=e.setShown,s=e.shown,l=e.date;return r.a.createElement(g.a,{container:!0,justify:"center"},r.a.createElement(Ce.a,{className:a.root,style:s?{background:"grey",opacity:.25}:{background:"lightblue"}},r.a.createElement(Ie.a,null,r.a.createElement(I.a,{variant:"h6"},n),r.a.createElement(I.a,{variant:"body2",component:"p"},c)),r.a.createElement(qe.a,{style:{justifyContent:"space-between"}},r.a.createElement(I.a,{style:{paddingLeft:8},variant:"subtitle2"},(t=l.toDate(),"".concat(t.getDate().toString().padStart(2,"0"),"/").concat((t.getMonth()+1).toString().padStart(2,"0"),"/").concat(t.getFullYear().toString().padStart(4,"0")," ").concat(t.getHours().toString().padStart(2,"0"),":").concat(t.getMinutes().toString().padStart(2,"0"),":").concat(t.getSeconds().toString().padStart(2,"0")))),r.a.createElement(q.a,{size:"small",onClick:function(){return i(o)}},"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u043d\u043e"))))},Ye=function(){var e=Object(n.useContext)(f).currentUser,t=Object(n.useState)([]),a=Object(i.a)(t,2),c=a[0],o=a[1],s=function(e){d.firestore().collection("notifications").doc(e).update({shown:!0})};return Object(n.useEffect)((function(){if(e){var t=d.firestore().collection("notifications").where("user_id","array-contains",e.uid).onSnapshot(function(){var e=Object(ne.a)(ae.a.mark((function e(t){var a;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],t.forEach((function(e,t){a.push(Object(h.a)({id:e.id},e.data()))})),console.log(a[0].created_date.toDate()),a.sort((function(e,t){return t.created_date.toDate()-e.created_date.toDate()})),o(a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());return function(){return t()}}}),[e]),r.a.createElement("div",null,r.a.createElement(I.a,{variant:"h5",align:"center"},"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f"),c.map((function(e,t){return r.a.createElement(Je,{key:t,id:e.id,index:t,date:e.created_date,title:e.title,setShown:s,shown:e.shown,description:e.description})})))},Xe=a(388),Ze=a.n(Xe),$e=a(900),et=a(901),tt=a(474),at=Object(D.a)((function(e){return{root:Object(j.a)({marginTop:20,background:"lightgreen",width:500},e.breakpoints.down("sm"),{maxWidth:300}),message:Object(j.a)({background:"lightgreen",width:500,margin:10,padding:10},e.breakpoints.down("sm"),{maxWidth:300})}})),nt=function(e){var t=at(),a=Object(n.useState)(null),c=Object(i.a)(a,2),o=c[0],s=c[1],l=Object(n.useContext)(f).currentUser,m=Object(n.useState)(""),b=Object(i.a)(m,2),p=b[0],h=b[1],j=r.a.useState(!1),O=Object(i.a)(j,2),E=O[0],v=O[1];return Object(n.useEffect)((function(){var e=function(){return Object($e.a)().toString()+"_"+Date.now()},t=function(){},a=function(){};return l&&(t=d.firestore().collection("users").doc(l.uid).onSnapshot((function(t){var a;if(a=!(!t.exists||!t.data().tg_token)&&t.data().tg_token,console.log(a),a){console.log(a);var n=parseInt(a.substring(a.indexOf("_")+1)),r=Ze()().diff(n,"hours");if(console.log(r),r>0){var c=e();d.firestore().collection("users").doc(l.uid).update({tg_token:c}),s(c)}else s(a)}else{console.log("no token");var o=e();d.firestore().collection("users").doc(l.uid).update({tg_token:o}),s(o)}})),a=d.firestore().collection("users").doc(l.uid).collection("user_private").doc("private").onSnapshot((function(e){e.exists&&e.data().tg_id?(console.log("TGID: ",e.data().tg_id),h(e.data().tg_id)):v(!0)}))),function(){t(),a()}}),[l]),Object(n.useEffect)((function(){if(l){var e=tt.parse(window.location.search);e.rank&&(console.log(e.rank),d.firestore().collection("schema").doc("structure").collection("ranks").doc(e.rank).get().then((function(e){e.exists?(console.log("creating request"),d.firestore().collection("rank_requests").add({timestamp:d.firestore.FieldValue.serverTimestamp(),user_id:l.uid,processed:!1,rank:e.id})):console.log("no rank")})))}}),[l]),l?r.a.createElement(g.a,null,r.a.createElement(g.a,{container:!0,className:t.message},r.a.createElement(I.a,null,"\u0417\u0434\u0440\u0430\u0432\u0441\u0442\u0432\u0443\u0439\u0442\u0435, \u0434\u043e\u0440\u043e\u0433\u0438\u0435 \u043d\u0430\u0431\u043b\u044e\u0434\u0430\u0442\u0435\u043b\u0438!"),r.a.createElement(I.a,null,"10-\u0433\u043e \u043c\u0430\u0440\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u043e\u0441\u044c \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u0435. \u0412\u0441\u0435 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0435 \u0442\u0440\u0435\u043d\u0438\u043d\u0433\u0438 \u0438 \u0437\u0430\u0434\u0430\u043d\u0438\u044f \u043c\u044b \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c \u0442\u043e\u043b\u044c\u043a\u043e \u0447\u0435\u0440\u0435\u0437 \u0442\u0435\u043b\u0435\u0433\u0440\u0430\u043c-\u0431\u043e\u0442."),r.a.createElement(I.a,null,"\u0427\u0442\u043e\u0431\u044b \u043f\u043e\u043d\u044f\u0442\u044c, \u043a\u0430\u043a \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0431\u043e\u0442 \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0438\u0442\u0435 \u043d\u0430\u0448\u0443 ",r.a.createElement(et.a,{href:"https://www.youtube.com/watch?v=jJX5uMqqC7Q&feature=youtu.be"},"\u0432\u0438\u0434\u0435\u043e-\u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044e"),". \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0439\u0442\u0435 \u0432\u0441\u0435 \u0437\u0430\u0434\u0430\u043d\u0438\u044f."),r.a.createElement(I.a,null,"\u041f\u043e\u0441\u043b\u0435 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f \u0432\u0441\u0435\u0445 \u0442\u0440\u0435\u043d\u0438\u043d\u0433\u043e\u0432 \u0431\u0443\u0434\u0435\u0442 \u0444\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0442\u0435\u0441\u0442, \u043e\u043d \u0441\u043e\u0441\u0442\u043e\u0438\u0442\u0441\u044f 27 \u043c\u0430\u0440\u0442\u0430 \u0432 18:00. \u0415\u0441\u043b\u0438 \u0432\u044b \u043d\u0435 \u0441\u0434\u0430\u0434\u0438\u0442\u0435 \u0442\u0435\u0441\u0442, \u0442\u043e, \u043a \u0441\u043e\u0436\u0430\u043b\u0435\u043d\u0438\u044e, \u0432\u044b \u043d\u0435 \u0441\u043c\u043e\u0436\u0435\u0442\u0435 \u0431\u044b\u0442\u044c \u043d\u0430\u0431\u043b\u044e\u0434\u0430\u0442\u0435\u043b\u0435\u043c \u043e\u0442 \xab\u041a\u043b\u043e\u043e\u043f\u0430\xbb")),0===p.length?r.a.createElement(V.a,{fullWidth:!0,open:E,"aria-labelledby":"max-width-dialog-title"},r.a.createElement(K.a,{id:"max-width-dialog-title"},r.a.createElement(I.a,{style:{paddingBottom:10},variant:"h5",align:"center"},"\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u0435 \u0431\u043e\u0442, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u043e\u0439 / \u0421\u0438\u0441\u0442\u0435\u043c\u0430\u043d\u044b \u043a\u043e\u043b\u0434\u043e\u043d\u0443\u0443 \u04af\u0447\u04af\u043d \u0431\u043e\u0442\u043a\u043e \u043a\u043e\u0448\u0443\u043b\u0443\u04a3\u0443\u0437")),r.a.createElement(H.a,null,r.a.createElement(Q.a,null,r.a.createElement(g.a,{container:!0,justify:"center"},r.a.createElement(I.a,{style:{paddingBottom:10},variant:"h5",align:"center"},"\u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0441\u0432\u044f\u0437\u0430\u0442\u044c \u0441\u0432\u043e\u0439 \u0430\u043a\u043a\u0430\u0443\u043d\u0442 \u0441 \u043d\u0430\u0448\u0438\u043c \u0422\u0435\u043b\u0435\u0433\u0440\u0430\u043c-\u0431\u043e\u0442\u043e\u043c. \u0414\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043d\u0430\u0436\u043c\u0438\u0442\u0435 \u043d\u0430 \u0441\u0441\u044b\u043b\u043a\u0443 \u043d\u0438\u0436\u0435."),r.a.createElement(I.a,{style:{paddingBottom:10},variant:"h5",align:"center"},"\u0421\u0438\u0437 \u04e9\u0437\u04af\u04a3\u04af\u0437\u0434\u04af\u043d \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0443\u04a3\u0443\u0437\u0434\u0443 \u0431\u0438\u0437\u0434\u0438\u043d \u0442\u0435\u043b\u0435\u0433\u0440\u0430\u043c-\u0431\u043e\u0442\u043a\u043e \u0442\u0443\u0442\u0430\u0448\u0442\u044b\u0440\u0430 \u0430\u043b\u0430\u0441\u044b\u0437. \u0410\u043b \u04af\u0447\u04af\u043d \u0442\u04e9\u043c\u04e9\u043d\u0434\u04e9\u0433\u04af \u0448\u0438\u043b\u0442\u0435\u043c\u0435\u043d\u0438 \u0431\u0430\u0441\u044b\u04a3\u044b\u0437."),o?r.a.createElement(et.a,{variant:"h5",href:"https://telegram.me/journal_tg_bot?start="+o},"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0431\u043e\u0442 / \u0411\u043e\u0442\u043a\u043e \u0448\u0438\u043b\u0442\u0435\u043c\u0435"):r.a.createElement(I.a,{variant:"body2",align:"center"},"\u0415\u0441\u043b\u0438 \u0441\u0441\u044b\u043b\u043a\u0430 \u043d\u0435 \u0441\u043e\u0437\u0434\u0430\u043b\u0430\u0441\u044c \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 5 \u0441\u0435\u043a\u0443\u043d\u0434, \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443"),r.a.createElement(q.a,{style:{marginTop:20},size:"large",color:"primary",variant:"contained",onClick:u},"\u0412\u043e\u0439\u0442\u0438 \u0441 \u0434\u0440\u0443\u0433\u043e\u0433\u043e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430"))))):null):r.a.createElement(g.a,{container:!0,direction:"column",style:{padding:20},justify:"center"},r.a.createElement(I.a,{align:"center",variant:"h3"},"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),r.a.createElement("br",null),r.a.createElement(q.a,{size:"large",color:"primary",variant:"contained",onClick:u},"\u0412\u043e\u0439\u0442\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google"))},rt=Object(D.a)({root:{minWidth:275},bullet:{display:"inline-block",margin:"0 2px",transform:"scale(0.8)"},title:{fontSize:14},pos:{marginBottom:12}});function ct(e){var t=rt();return console.log("TEST CARD"),console.log(e),e.userInfo=={}?r.a.createElement("div",null):r.a.createElement(Ce.a,{className:t.root,variant:"outlined"},r.a.createElement(Ie.a,null,r.a.createElement(I.a,{className:t.title,color:"textSecondary",gutterBottom:!0},"id: ",e.userInfo.id),r.a.createElement(I.a,{variant:"h5",component:"h2"},e.userInfo.surname+" "+e.userInfo.name),r.a.createElement(I.a,{className:t.pos,color:"textSecondary"},"username: ",e.userInfo.username),r.a.createElement(I.a,{className:t.pos,color:"textSecondary"},"\u0420\u0435\u0433\u0438\u043e\u043d: ",e.userInfo.district),r.a.createElement(I.a,{variant:"body2",component:"p"},e.userInfo.phone),r.a.createElement(I.a,{variant:"body2",component:"p"},e.userInfo.email)))}var ot=a(102),it=function(e){var t=Object(n.useState)({}),a=Object(i.a)(t,2),c=a[0],o=a[1],l=function(){var t=Object(ne.a)(ae.a.mark((function t(a){return ae.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(a.map(function(){var t=Object(ne.a)(ae.a.mark((function t(a){var n;return ae.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.storageRef.child(a.name).put(a),o((function(e){var t=Object(j.a)({},a.name,{status:"loading",progress:0});return e?Object(h.a)(Object(h.a)({},e),t):t})),n.on(s.a.storage.TaskEvent.STATE_CHANGED,(function(e){var t=e.bytesTransferred/e.totalBytes*100;switch(o((function(e){var n=Object(j.a)({},a.name,{status:"loading",progress:t});return e?Object(h.a)(Object(h.a)({},e),n):n})),console.log("Upload is "+t+"% done"),e.state){case s.a.storage.TaskState.PAUSED:console.log("Upload is paused");break;case s.a.storage.TaskState.RUNNING:console.log("Upload is running")}}),(function(e){e.code}),(function(){n.snapshot.ref.getDownloadURL().then(function(){var t=Object(ne.a)(ae.a.mark((function t(n){var r;return ae.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n,e.secure&&(c=n.split("?")[0],r=c.replace("https://firebasestorage.googleapis.com/v0/b/journal-bb5e3.appspot.com/o","https://storage.cloud.google.com/journal-bb5e3.appspot.com")+"?authuser=1"),t.next=4,e.filesLinks.set({contents:Object(j.a)({},r,{name:a.name,url:r})},{merge:e.allowMultipleFiles});case 4:o((function(e){var t=Object.assign({},e);return delete t[a.name],t})),console.log("File available at",r);case 6:case"end":return t.stop()}var c}),t)})));return function(e){return t.apply(this,arguments)}}())}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return r.a.createElement("div",null,r.a.createElement("input",{type:"file",onChange:function(e){console.log("Files selected: ",Object(Pe.a)(e.target.files)),l(Object(Pe.a)(e.target.files))},multiple:e.allowMultipleFiles}),Object.keys(c).map((function(e){return r.a.createElement("div",{key:e},r.a.createElement("p",null,e),r.a.createElement(oe,{value:c[e].progress}))})))},st=a(389),lt=a.n(st),ut=function(e){console.log("All props: ",e),console.log("ID: ",e.taskID),console.log("Question ID: ",e.name),console.log("User UID: ",e.currentUserUid);var t=Object(n.useState)(!1),a=Object(i.a)(t,2),c=a[0],o=a[1],s=Object(n.useState)(!1),l=Object(i.a)(s,2),u=l[0],f=l[1],m=null,b=null;e.disabled||(m=d.storage().ref(e.taskID).child(e.name).child(e.currentUserUid),b=function(){var t=Object(ne.a)(ae.a.mark((function t(){return ae.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o(!0),t.next=3,d.firestore().collection("users").doc(e.currentUserUid).set({fileUpload:e.taskID+"/"+e.name},{merge:!0});case 3:o(!1),f(!0);case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}());var p=d.firestore().collection("tasks").doc(e.taskID).collection("responses").doc(e.name);console.log("Props formData: ",e.formData);return r.a.createElement("div",null,e.schema.title?r.a.createElement("div",null,e.schema.title):r.a.createElement("div",null),e.schema.description?r.a.createElement("div",null,e.schema.description):r.a.createElement("div",null),e.disabled?null:r.a.createElement("div",null,r.a.createElement(it,{storageRef:m,allowMultipleFiles:!(!e.stage||!e.stage.allowMultipleFiles)&&e.stage.allowMultipleFiles,secure:!(!e.stage||!e.stage.cleanFileLink)&&e.stage.cleanFileLink,filesLinks:p}),c?r.a.createElement(re.a,null):u?r.a.createElement("div",null,'\u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u043d\u0430\u0447\u0430\u0442\u044c \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0443 \u0444\u0430\u0439\u043b\u043e\u0432 \u0447\u0435\u0440\u0435\u0437 \u0431\u043e\u0442\u0430. \u0412\u0441\u0435 \u0444\u0430\u0439\u043b\u044b, \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c\u044b\u0435 \u0431\u043e\u0442\u0443, \u0431\u0443\u0434\u0443\u0442 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0442\u044c\u0441\u044f \u0437\u0434\u0435\u0441\u044c. \u041f\u043e\u0441\u043b\u0435 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0444\u0430\u0439\u043b\u043e\u0432 \u0447\u0435\u0440\u0435\u0437 \u0431\u043e\u0442, \u043d\u0435 \u0437\u0430\u0431\u0443\u0434\u044c\u0442\u0435 \u0432\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u0441\u044e\u0434\u0430 \u0438 \u043d\u0430\u0436\u0430\u0442\u044c "\u041e\u0422\u041f\u0420\u0410\u0412\u0418\u0422\u042c". ',r.a.createElement("a",{href:"https://t.me/journal_tg_bot"},"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u0431\u043e\u0442.")):r.a.createElement("div",null,r.a.createElement("p",null,"\u0412\u044b \u0442\u0430\u043a \u0436\u0435 \u043c\u043e\u0436\u0435\u0442\u0435 \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0441\u044e\u0434\u0430 \u0444\u0430\u0439\u043b\u044b \u0447\u0435\u0440\u0435\u0437 \u0422\u0435\u043b\u0435\u0433\u0440\u0430\u043c-\u0431\u043e\u0442\u0430. \u0414\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043d\u0430\u0436\u043c\u0438\u0442\u0435 \u043a\u043d\u043e\u043f\u043a\u0443 \u043d\u0438\u0436\u0435: "),r.a.createElement("button",{onClick:b},"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0447\u0435\u0440\u0435\u0437 \u0431\u043e\u0442"))),e.formData?r.a.createElement("div",null,Object.keys(e.formData).map((function(t){return r.a.createElement("div",{key:t},r.a.createElement("a",{href:e.formData[t].url},e.formData[t].name),e.metadata&&!e.metadata.is_complete&&r.a.createElement(_.a,{onClick:function(){return function(e){console.log(e),p.set({contents:Object(j.a)({},e,d.firestore.FieldValue.delete())},{merge:!0}).then((function(){return console.log("file removed")})).catch((function(e){return console.log(e)}))}(t)},size:"small"},r.a.createElement(lt.a,null)))}))):r.a.createElement("div",null))},dt=a(105),ft=function(e){var t=Object(n.useState)({}),a=Object(i.a)(t,2),c=a[0],o=a[1],s=Object(n.useState)({}),l=Object(i.a)(s,2),m=l[0],b=l[1],p=Object(n.useState)({}),O=Object(i.a)(p,2),E=O[0],v=O[1],y=Object(n.useState)({}),k=Object(i.a)(y,2),_=k[0],w=k[1],S=Object(n.useState)({}),x=Object(i.a)(S,2),C=x[0],D=x[1],F=Object(n.useState)(null),T=Object(i.a)(F,2),U=T[0],R=T[1],A=Object(n.useState)("loading"),P=Object(i.a)(A,2),W=P[0],B=P[1],N=Object(n.useContext)(f).currentUser,z=e.id;Object(n.useEffect)((function(){if(N&&z){var e=d.firestore().collection("tasks").doc(z);R(e),e.onSnapshot((function(e){w(e.data()),e.data().is_complete&&B("sent"),e.data().assigned_users.includes(N.uid)||B("released"),console.log("Task Metadata: ",e.data())})),e.collection("responses").onSnapshot((function(e){var t={},a=[],n=!1;e.docChanges().forEach((function(e){if("added"===e.type||"modified"===e.type){var r=e.doc.data().contents;t[e.doc.id]=r,n=!0}"removed"===e.type&&(console.log("Response Removed: ",e.doc.data()),a.push(e.doc.id),n=!0)})),n&&o((function(e){var n=Object(ot.cloneDeep)(e);return a.forEach((function(e){return delete n[e]})),Object.keys(t).forEach((function(e){return n[e]=t[e]})),n}))})),e.collection("questions").onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||b((function(t){return Object(h.a)(Object(h.a)({},t),{},Object(j.a)({},e.doc.id,e.doc.data()))}))}))}))}}),[z,N]),Object(n.useEffect)((function(){Object.entries(_).length>0&&(console.log("Task metadata: ",_),d.firestore().collection("schema").doc("structure").collection("cases").doc(_.case_type).collection("stages").onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||(console.log("Case stage: ",e.doc.data()),D((function(t){return Object(h.a)(Object(h.a)({},t),{},Object(j.a)({},e.doc.id,e.doc.data()))}))),"removed"===e.type&&D((function(t){var a=Object.assign({},t);return delete a[e.doc.id],a}))}))})))}),[_]),Object(n.useEffect)((function(){v(M(m,C[_.case_stage_id]))}),[m,_,C]);var M=function(e,t){var a=Object.assign({},e),n=Object.assign({},t);n.start=n.start?n.start:{},n.end=n.end?n.end:{},n.start_ui_schema=n.start_ui_schema?n.start_ui_schema:{},n.end_ui_schema=n.end_ui_schema?n.end_ui_schema:{},a.form_questions=a.form_questions?a.form_questions:{},a.ui_schema=a.ui_schema?a.ui_schema:{};var r=Object(h.a)(Object(h.a)(Object(h.a)({},n.start.properties?n.start.properties:{}),n.end.properties?n.end.properties:{}),a.form_questions.properties?a.form_questions.properties:{}),c=Object(h.a)(Object(h.a)(Object(h.a)({},n.start.definitions?n.start.definitions:{}),n.end.definitions?n.end.definitions:{}),a.form_questions.definitions?a.form_questions.definitions:{}),o="";a.form_questions.title?o=a.form_questions.title:n.end.title?o=n.end.title:n.start.title&&(o=n.start.title);var i="";a.form_questions.description?i=a.form_questions.description:n.end.description?i=n.end.description:n.start.description&&(i=n.start.description);var s=Object(Pe.a)(new Set([].concat(Object(Pe.a)(n.start.required?n.start.required:[]),Object(Pe.a)(a.form_questions.required?a.form_questions.required:[]),Object(Pe.a)(n.end.required?n.end.required:[])))),l=Object(Pe.a)(new Set([].concat(Object(Pe.a)(n.start_ui_schema["ui:order"]?n.start_ui_schema["ui:order"]:[]),Object(Pe.a)(a.ui_schema["ui:order"]?a.ui_schema["ui:order"]:[]),Object(Pe.a)(n.end_ui_schema["ui:order"]?n.end_ui_schema["ui:order"]:[])))),u=Object(h.a)(Object(h.a)(Object(h.a)({},n.start_ui_schema?n.start_ui_schema:{}),n.end_ui_schema?n.end_ui_schema:{}),a.ui_schema?a.ui_schema:{});return{form_questions:{properties:r,definitions:c,title:o,description:i,required:s},ui_schema:u=Object(h.a)(Object(h.a)({},u),{"ui:order":l})}},L={customImageWidget:function(e){return console.log("PROPS",e),r.a.createElement("img",{src:e.value,alt:e.schema.title,style:{maxWidth:"100%",height:"auto"}})},customVideoWidget:function(e){return console.log("PROPS",e),r.a.createElement("video",{title:e.schema.title,style:{maxWidth:"100%",height:"auto"},controls:!0},r.a.createElement("source",{src:e.value,type:"video/mp4"}))},customIframeWidget:function(e){return console.log("PROPS",e),r.a.createElement("iframe",{title:e.schema.title,src:e.value,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}};return N?r.a.createElement(g.a,{style:{padding:30}},E&&U&&C&&_&&_.case_stage_id&&C[_.case_stage_id]?r.a.createElement(dt.a,{schema:E.form_questions,uiSchema:E.ui_schema,formData:c,fields:{customFileUpload:function(e){return ut(Object(h.a)(Object(h.a)(Object(h.a)(Object(h.a)({},e),{taskID:z}),{currentUserUid:N.uid}),{stage:C[_.case_stage_id]}))}},disabled:"loading"===W||"sent"===W||"released"===W,widgets:L,noHtml5Validate:!0,onChange:function(e){!function(e){o(e.formData)}(e)}},r.a.createElement(r.a.Fragment,null)):null):r.a.createElement(g.a,{container:!0,direction:"column",style:{padding:20},justify:"center"},r.a.createElement(I.a,{align:"center",variant:"h3"},"\u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044c"),r.a.createElement("br",null),r.a.createElement(q.a,{variant:"contained",onClick:u},"\u0412\u043e\u0439\u0442\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google"))},mt=function(e){var t=r.a.useState([]),a=Object(i.a)(t,2),c=(a[0],a[1],Object(n.useState)({})),o=Object(i.a)(c,2),s=o[0],l=o[1],u={},f=Object(n.useState)([]),m=Object(i.a)(f,2),b=(m[0],m[1]),p=Object(n.useState)([]),h=Object(i.a)(p,2),j=(h[0],h[1]),O=Object(n.useState)({}),E=Object(i.a)(O,2),v=E[0],y=E[1],k=Object(n.useState)(r.a.createElement("div",null)),_=Object(i.a)(k,2),w=(_[0],_[1]),S=Object(n.useState)(!1),x=Object(i.a)(S,2),C=(x[0],x[1]),q=Object(n.useState)(!1),D=Object(i.a)(q,2),F=(D[0],D[1]),T=Object(n.useState)(!1),U=Object(i.a)(T,2),R=(U[0],U[1]),A=Object(n.useState)(!1),P=Object(i.a)(A,2),W=(P[0],P[1]),B=Object(n.useState)(!1),N=Object(i.a)(B,2),z=(N[0],N[1]),M=function(){var t=Object(ne.a)(ae.a.mark((function t(){return ae.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:d.firestore().collection("tasks").doc(e.task.id).get().then((function(e){var t=e.data().review_status;C("pending"===t),F("passed"===t),R("not passed"===t),W("verified"===t),z("not verified"===t)}));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();Object(n.useEffect)((function(){var t=function(){var t=Object(ne.a)(ae.a.mark((function t(){var a,n,c,o;return ae.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=[],n=[],c=[],o=!0,console.log("HOOK"),M(),t.next=8,d.firestore().collection("tasks").doc(e.task.id).get().then((function(e){l(e.data())})).catch((function(e){console.log("Error getting documents: ",e)}));case 8:return t.next=10,d.firestore().collection("tasks").doc(e.task.id).collection("questions").get().then((function(e){e.forEach((function(e){a.push({questionId:e.id,data:e.data()})}))})).then((function(){b(a)})).catch((function(e){console.log("Error getting documents: ",e)}));case 10:return t.next=12,d.firestore().collection("tasks").doc(e.task.id).collection("responses").get().then((function(e){e.forEach((function(e){n.push({responseId:e.id,data:e.data()})}))})).then((function(){j(n)})).catch((function(e){console.log("Error getting documents: ",e)}));case 12:w(r.a.createElement("div",null)),c=a.map((function(e,t){var a=null;return n.forEach((function(n){e.questionId===n.responseId&&(a=n.data.answer,L(n.data.answer,t))})),r.a.createElement(Be,{key:t,question:e.data,index:t,response:a,returnAnswer:L,locked:o})})),w(c);case 15:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();e.task.id&&t()}),[e.task.id]);var L=function(e,t){var a=v;a[t]=e,y(a)};return function(){if(void 0!==s.assigned_users&&s.assigned_users.length>0){var t=e.users.find((function(e){return e.id===s.assigned_users[0]}));u=void 0!==t?t:{}}}(),r.a.createElement(g.a,{style:{padding:30}},r.a.createElement(g.a,{container:!0,justify:"center"},r.a.createElement(ct,{userInfo:u}," ")),r.a.createElement(I.a,null,e.task.id),r.a.createElement(ft,{id:e.task.id}))},bt=a(908),pt=function(e){var t=Object(n.useState)(0),a=Object(i.a)(t,2),c=a[0],o=a[1],s=Object(n.useState)(1),l=Object(i.a)(s,2),u=l[0],d=(l[1],Object(n.useState)([])),f=Object(i.a)(d,2),m=f[0],b=f[1],p=function(e,t,a){var n=Object(Ge.a)(a),r=Math.floor(n.size/t);console.log("numberOfPages",r);var c=e*t,o=n.size;return e!==r-1&&(o=(e+1)*t),console.log("Start",c),console.log("End",o),a.slice(c,o)};Object(n.useEffect)((function(){o(0),b(p(0,1,e.data))}),[e.data]);var h=e.data.length>0&&r.a.createElement(g.a,{container:!0,justify:"center"},r.a.createElement(bt.a,{justify:"center",component:"div",count:e.data.length,page:c,onChangePage:function(t,a){b(p(a,u,e.data)),o(a)},rowsPerPage:u,onChangeRowsPerPage:function(e){},labelRowsPerPage:"\u041f\u043e \u043e\u0434\u043d\u043e\u0439 \u0437\u0430\u0434\u0430\u0447\u0435 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443!"})),j=void 0!==m[0];return r.a.createElement("div",null,h,r.a.createElement(g.a,{container:!0,spacing:0,direction:"column",alignItems:"center",justify:"center",style:{minHeight:"100vh"}},r.a.createElement(g.a,{item:!0,xs:12},r.a.createElement(g.a,{container:!0,justify:"center",direction:"column",spacing:1},j?r.a.createElement(g.a,{item:!0},r.a.createElement(mt,{task:m[0],users:e.users})):"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0438 \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u0435 \u0444\u0438\u043b\u044c\u0442\u0440\u044b!"))),h)},gt=a(904),ht=a(201),jt=a.n(ht),Ot=function(e){var t=Object(n.useContext)(f).currentUser,a=r.a.useState([]),c=Object(i.a)(a,2),o=c[0],s=c[1],l=Object(n.useState)([]),u=Object(i.a)(l,2),m=u[0],b=u[1],p=Object(n.useState)({}),j=Object(i.a)(p,2),O=j[0],E=j[1],v=r.a.useState([]),y=Object(i.a)(v,2),k=y[0],_=y[1],w=r.a.useState(""),S=Object(i.a)(w,2),x=S[0],C=S[1],I=Object(n.useState)(null),D=Object(i.a)(I,2),F=D[0],T=D[1],U=r.a.useState(null),R=Object(i.a)(U,2),A=R[0],P=R[1],W=d.firestore().collection("schema").doc("structure").collection("cases");Object(n.useEffect)((function(){W.get().then((function(e){var t=[];return e.forEach((function(e){t.push(e.id)})),t})).then((function(e){return b(e)}))}),[t]),Object(n.useEffect)((function(){E(null),F&&W.doc(F).collection("stages").get().then((function(e){var t=[];return e.forEach((function(e){t.push(e.id)})),t})).then((function(e){return E(e)}))}),[F]);var B=function(e){C(e)},z=function(){var e=Object(ne.a)(ae.a.mark((function e(){var t,a;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],a=d.firestore().collection("users"),e.next=4,a.get().then((function(e){e.forEach((function(e){t.push(Object(h.a)({id:e.id},e.data()))})),_(t)}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),M=function(){var e=Object(ne.a)(ae.a.mark((function e(){var t,a;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],a=d.firestore().collection("tasks").where("is_complete","==",!0),console.log(x),console.log(F),console.log(A),""!==x&&(a=a.where("assigned_users","array-contains",x),console.log("USER FIRED",x)),null!==F&&(a=a.where("case_type","==",F),console.log("CASE FIRED",F)),null!==A&&(a=a.where("case_stage_id","==",A),console.log("STAGE FIRED",A)),e.next=10,a.get().then((function(e){e.forEach((function(e){t.push(Object(h.a)({id:e.id},e.data()))})),s(t)}));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){z()}),[]),r.a.createElement("div",null,r.a.createElement(g.a,{container:!0,justify:"center",style:{padding:15}},r.a.createElement(gt.a,{id:"combo-box-demo",options:m,style:{width:350},value:F,onChange:function(e,t){return a=t,P(null),void T(a);var a},renderInput:function(e){return r.a.createElement(N.a,Object.assign({},e,{fullWidth:!0,label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0438\u043b\u044c\u0442\u0440 \u043f\u043e case",variant:"outlined"}))}})),null!==O&&O.length>0&&r.a.createElement(g.a,{container:!0,justify:"center",style:{padding:15}},r.a.createElement(gt.a,{id:"combo-box-demo",options:O,style:{width:350},value:A,onChange:function(e,t){P(t)},renderInput:function(e){return r.a.createElement(N.a,Object.assign({},e,{fullWidth:!0,label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0438\u043b\u044c\u0442\u0440 \u043f\u043e stage",variant:"outlined"}))}})),r.a.createElement(g.a,{container:!0,justify:"center",style:{padding:15}},r.a.createElement(gt.a,{id:"combo-box-demo",options:k,getOptionLabel:function(e){return e.surname+" "+e.name+" ("+e.username+")"},style:{width:350},value:x.value,onChange:function(e,t){B(t?t.id:"")},renderInput:function(e){return r.a.createElement(N.a,Object.assign({},e,{fullWidth:!0,label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0438\u043b\u044c\u0442\u0440 \u043f\u043e users",variant:"outlined"}))}})),r.a.createElement(g.a,{container:!0,justify:"center"},r.a.createElement(q.a,{style:{width:"350px"},type:"number",variant:"contained",onClick:function(e){M()},color:"primary",startIcon:r.a.createElement(jt.a,null)},"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440\u044b")),r.a.createElement(g.a,{container:!0,justify:"center"},r.a.createElement(pt,{data:o,users:k})))},Et=function(){return Object(n.useContext)(f).currentUser?r.a.createElement(p.a,{to:"/"}):r.a.createElement(g.a,{container:!0,direction:"column",style:{padding:20},justify:"center"},r.a.createElement(I.a,{align:"center",variant:"h4"},"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),r.a.createElement(I.a,{variant:"body1",align:"center"},"\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \u043d\u0430 \u043a\u043d\u043e\u043f\u043a\u0443 (\u0412\u0445\u043e\u0434 \u0438\u043b\u0438 \u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f)."),r.a.createElement(I.a,{variant:"body1",align:"center"},"\u0415\u0441\u043b\u0438 \u0443 \u0432\u0430\u0441 \u043d\u0435\u0442 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google, \u0442\u043e \u0441\u043e\u0437\u0434\u0430\u0439\u0442\u0435 \u0435\u0433\u043e."),r.a.createElement("br",null),r.a.createElement(q.a,{size:"large",color:"primary",variant:"contained",onClick:u},"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"))},vt=function(e){var t=e.component,a=Object(_e.a)(e,["component"]),c=Object(n.useContext)(f).currentUser;return r.a.createElement(p.b,Object.assign({},a,{render:function(e){return c?r.a.createElement(t,e):r.a.createElement(p.a,{to:"/signin"})}}))},yt=a(385),kt=a(801),_t=Object(D.a)((function(e){return{root:Object(j.a)({border:"2px grey solid",padding:"0px 10px",margin:10,background:"yellow",width:700},e.breakpoints.down("sm"),{maxWidth:300}),button:{background:"orange",margin:"10px 0"}}})),wt=Object(n.forwardRef)((function(e,t){var a=_t(),n=r.a.useState(""),c=Object(i.a)(n,2),o=c[0],s=c[1],l=e.title,u=e.sendAnswer,d=e.taskId,f=e.questionId;return r.a.createElement("div",{className:a.root},r.a.createElement(z.a,{display:"flex",style:{marginBottom:10,marginTop:10}},r.a.createElement(I.a,{variant:"h6",style:{paddingRight:8}},l)),r.a.createElement(N.a,{label:"\u041c\u043e\u0439 \u043e\u0442\u0432\u0435\u0442",value:o,style:{background:"white"},onChange:function(e){s(e.target.value)},multiline:!0,rows:5,variant:"outlined",fullWidth:!0}),r.a.createElement(g.a,{container:!0,justify:"flex-end"},r.a.createElement(q.a,{className:a.button,onClick:function(){return u(d,f,o)}},"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c")))})),St=Object(D.a)((function(e){return{select:Object(j.a)({margin:"20px 0",width:500},e.breakpoints.down("sm"),{maxWidth:300})}})),xt=function(e){var t=St(),a=["\u0412\u0421\u0415","\u041f\u043e\u0438\u0441\u043a \u043a\u043e\u043d\u0442\u0430\u043a\u0442\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445","interview"],c=r.a.useState([]),o=Object(i.a)(c,2),s=(o[0],o[1]),l=r.a.useState(a[0]),u=Object(i.a)(l,2),f=u[0],m=u[1],b=Object(n.useState)([]),p=Object(i.a)(b,2),j=p[0],O=p[1],E=function(){var e=Object(ne.a)(ae.a.mark((function e(t){var a;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v();case 2:a=e.sent,y(a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=Object(ne.a)(ae.a.mark((function e(){var t,a;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],a=d.firestore().collection("tasks").where("case_type","==","FAQ").where("is_complete","==",!1),"\u0412\u0421\u0415"!==f&&(a=a.where("type","==",f)),console.log("fired"),e.next=6,a.get().then((function(e){e.forEach((function(e){t.push(Object(h.a)({id:e.id},e.data()))})),t.sort((function(e,t){return t.timestamp.toDate()-e.timestamp.toDate()})),s(t)}));case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),y=function(){var e=Object(ne.a)(ae.a.mark((function e(t){var a;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.map(function(){var e=Object(ne.a)(ae.a.mark((function e(t){var a;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],e.next=3,d.firestore().collection("tasks").doc(t.id).collection("questions").get().then((function(e){e.forEach((function(e){a.push(Object(h.a)({taskId:t.id,questionId:e.id,timestamp:t.timestamp.toDate()},e.data()))}))}));case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:a=e.sent,Promise.all(a).then((function(e){return O([].concat.apply([],e))}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),k=function(e,t,a){d.firestore().collection("tasks").doc(e).collection("responses").doc(t).set({answer:a}),console.log(e,a)};return r.a.createElement(g.a,{container:!0,justify:"center"},r.a.createElement(g.a,{container:!0,justify:"center"},r.a.createElement(Z.a,{className:t.select},r.a.createElement(yt.a,{value:f,onChange:function(e){m(e.target.value)},name:"filterTaskType"},a.map((function(e,t){return r.a.createElement("option",{key:e,value:e},e)}))),r.a.createElement(kt.a,null,"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0438\u043b\u044c\u0442\u0440 \u043f\u043e \u0442\u0438\u043f\u0443 \u0437\u0430\u0434\u0430\u0447\u0438"))),r.a.createElement(g.a,{container:!0,justify:"center",className:t.select},r.a.createElement(q.a,{style:{width:"350px"},type:"number",variant:"contained",onClick:E,color:"primary",startIcon:r.a.createElement(jt.a,null)},"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440\u044b")),r.a.createElement(g.a,{container:!0,justify:"center"},j?j.map((function(e,t){return r.a.createElement(wt,{key:"task_"+t,taskId:e.taskId,questionId:e.questionId,title:e.title,sendAnswer:k})})):r.a.createElement(I.a,{style:{padding:30}},"\u041d\u0435\u0442 \u043d\u043e\u0432\u044b\u0445 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432")))},Ct=a(407),qt=a(902),It=Object(D.a)({root:{minWidth:250},bullet:{display:"inline-block",margin:"0 2px"},title:{fontSize:14},pos:{marginBottom:12}}),Dt=function(e){var t,a=It(),c=Object(p.g)(),o=e.complete,s=e.id,l=e.cardColor,u=e.cardType,f=e.stage,m=e.stageID,b=e.task,h=e.user,O=e.pCase,E=Object(n.useState)(!1),v=Object(i.a)(E,2),y=v[0],k=v[1],_=Object(n.useState)(null),w=Object(i.a)(_,2),S=(w[0],w[1],function(){k(!0);var e="",t="",a="";"creatable"===u||"creatableUnlim"===u?(e=Object(qt.a)(),t="callbackId",a="callbackId"):"selectable"===u&&(e=s,a="taskId",t=d.firestore.FieldPath.documentId()),d.firestore().collection("task_requests").doc(h.uid).collection("requests").add(Object(j.a)({status:"pending",user:h.uid,case_type:O,case_stage_id:m},a,e)).then((function(a){var n=d.firestore().collection("tasks").where("assigned_users","array-contains",h.uid).where(t,"==",e).onSnapshot((function(e){e.docChanges().forEach((function(e){"added"===e.type&&e.doc.id&&(n(),c.push("/t/"+e.doc.id))}))}))}))}),x=function(){k(!0);var e="",t="",a="";"creatable"===u||"creatableUnlim"===u?(e=Object(qt.a)(),t="callbackId",a="callbackId"):"selectable"===u&&(e=s,a="taskId",t=d.firestore.FieldPath.documentId()),d.firestore().collection("task_requests").doc(h.uid).collection("requests").add(Object(j.a)({status:"pending",user:h.uid,case_type:O,case_stage_id:m},a,e)).then((function(a){var n=d.firestore().collection("tasks").where("assigned_users","array-contains",h.uid).where(t,"==",e).onSnapshot((function(e){e.docChanges().forEach((function(e){"added"===e.type&&e.doc.id&&(n(),c.push("/tasks/"+e.doc.id))}))}))}))};return r.a.createElement(Ce.a,{key:s,className:a.root,style:{background:l}},r.a.createElement(Ie.a,null,r.a.createElement(z.a,{display:"flex",justifyContent:"space-between",alignItems:"center"},r.a.createElement(I.a,{variant:"h6"},f.title),o&&r.a.createElement(I.a,{color:"error"},"\u0421\u0434\u0430\u043d\u043e")),r.a.createElement(I.a,{variant:"subtitle1",className:a.pos,color:"textSecondary"},"#",s),r.a.createElement(I.a,{variant:"body2",component:"p"},b&&b.cardData&&("selectable"===u||f&&f.showCard)?(t=b.cardData,Object.keys(t).map((function(e,a){return"message"===e?r.a.createElement(I.a,{key:e+a},t[e]):Object.keys(t[e]).map((function(a){if(f&&f.cardData&&f.cardData[e]&&f.cardData[e].includes(a))return"attachedFiles"===a?r.a.createElement("div",{key:e+a},"Files"):r.a.createElement("typography",{variant:"body2",component:"p",key:e+a},JSON.stringify(t[e][a],null,2))}))}))):"\u0417\u0430\u0434\u0430\u043d\u0438\u0435: "+f.description)),r.a.createElement(qe.a,null,y?r.a.createElement(re.a,null):r.a.createElement(g.a,null,r.a.createElement(q.a,{size:"small",onClick:function(){"creatable"===u||"selectable"===u||"creatableUnlim"===u?S():c.push("/t/"+s)}},"creatableUnlim"===u?"\u0421\u041e\u0417\u0414\u0410\u0422\u042c \u041d\u041e\u0412\u0423\u042e \u0424\u041e\u0420\u041c\u0423":"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"),f.showOldButton&&r.a.createElement(q.a,{size:"small",onClick:function(){"creatable"===u||"selectable"===u||"creatableUnlim"===u?x():c.push("/tasks/"+s)}},"\u041e\u0442\u043a\u0440\u044b\u0442\u044c (Old)"))))},Ft=function(e,t,a){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||t((function(t){var n=Object.assign({},t);return n[a]||(n[a]={}),n[a][e.doc.id]=e.doc.data(),n})),"removed"===e.type&&t((function(t){var n=Object.assign({},t);return delete n[a][e.doc.id],n}))}))},Tt=function(e,t){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||t((function(t){return Object(h.a)(Object(h.a)({},t),{},Object(j.a)({},e.doc.id,e.doc.data()))})),"removed"===e.type&&t((function(t){var a=Object.assign({},t);return delete a[e.doc.id],a}))}))};function Ut(e){var t=e.children,a=e.value,n=e.index,c=Object(_e.a)(e,["children","value","index"]);return r.a.createElement("div",Object.assign({role:"tabpanel",hidden:a!==n,id:"full-width-tabpanel-".concat(n),"aria-labelledby":"full-width-tab-".concat(n)},c),a===n&&r.a.createElement(z.a,{p:3},r.a.createElement(I.a,null,t)))}function Rt(e){return{id:"full-width-tab-".concat(e),"aria-controls":"full-width-tabpanel-".concat(e)}}var At=Object(D.a)({root:{paddingTop:30,flexGrow:1}}),Pt=function(){var e=Object(n.useContext)(f).currentUser,t=Object(p.h)().id,a=At(),c=Object(n.useState)({}),o=Object(i.a)(c,2),s=o[0],l=o[1],u=Object(n.useState)([]),m=Object(i.a)(u,2),b=m[0],O=m[1],E=Object(n.useState)({}),v=Object(i.a)(E,2),y=v[0],k=v[1],_=Object(n.useState)({}),w=Object(i.a)(_,2),S=w[0],x=w[1],C=Object(n.useState)({}),D=Object(i.a)(C,2),F=D[0],T=D[1],U=Object(n.useState)({}),R=Object(i.a)(U,2),A=R[0],P=R[1],W=Object(n.useState)({}),B=Object(i.a)(W,2),N=B[0],z=B[1],M=Object(n.useState)({}),L=Object(i.a)(M,2),V=L[0],G=L[1],H=Object(n.useState)({}),Q=Object(i.a)(H,2),K=Q[0],J=Q[1],Y=Object(n.useState)(0),X=Object(i.a)(Y,2),Z=X[0],$=X[1],ee=Object(n.useState)({}),te=Object(i.a)(ee,2),re=te[0],ce=te[1],oe=Object(n.useState)({}),ie=Object(i.a)(oe,2),se=ie[0],le=ie[1],ue=Object(n.useState)({}),de=Object(i.a)(ue,2),fe=de[0],me=de[1],be=Object(n.useState)({}),pe=Object(i.a)(be,2),ge=pe[0],he=pe[1],je=Object(n.useState)({}),Oe=Object(i.a)(je,2),Ee=Oe[0],ve=Oe[1],ye=Object(n.useState)((function(){})),ke=Object(i.a)(ye,2),_e=(ke[0],ke[1],Object(n.useState)([])),Ce=Object(i.a)(_e,2),qe=Ce[0],Ie=Ce[1];Object(n.useEffect)((function(){console.log("Page id: ",t),console.log("Current user: ",e);var a=function(){};return e&&(a=d.firestore().collection("pages").doc(t).onSnapshot((function(e){l(e.data()),console.log("Page data: ",e.data())}))),a}),[e,t]),Object(n.useEffect)((function(){var t=function(){};return e&&s&&s.ranks&&(t=d.firestore().collection("users").doc(e.uid).collection("user_private").doc("private").onSnapshot((function(e){O(Te(e.data().ranks,s.ranks))}))),t}),[e,t,s]),Object(n.useEffect)((function(){if(s&&Object.entries(s).length>0&&b.length>0){k({}),T({}),x({}),ce({}),he({}),le({});var t=d.firestore().collection("schema").doc("structure").collection("cases");s.cases.map((function(e){console.log("PCASE",e),t.doc(e).get().then((function(e){z((function(t){var a=Object.assign({},t);return a[e.id]=e.data(),a}))})),t.doc(e).collection("stages").where("ranks_write","array-contains-any",b).onSnapshot((function(t){Ft(t,k,e)})),t.doc(e).collection("stages").onSnapshot((function(t){Ft(t,x,e)}))})),console.log("ALLCASES",S),d.firestore().collection("tasks").where("assigned_users","array-contains",e.uid).onSnapshot((function(e){e.docChanges().forEach((function(e){s.cases.includes(e.doc.data().case_type)&&("added"!==e.type&&"modified"!==e.type||T((function(t){return Object(h.a)(Object(h.a)({},t),{},Object(j.a)({},e.doc.id,e.doc.data()))})),"removed"===e.type&&T((function(t){var a=Object.assign({},t);return delete a[e.doc.id],a})))}))})),s.caseWithSelectableTasks&&(t.doc(s.caseWithSelectableTasks).collection("stages").where("ranks_read","array-contains-any",b).onSnapshot((function(e){Tt(e,ce)})),t.doc(s.caseWithSelectableTasks).collection("stages").onSnapshot((function(e){Tt(e,le)})),d.firestore().collection("tasks").where("case_type","==",s.caseWithSelectableTasks).where("assigned_users","==",[]).where("available","==",!0).where("is_complete","==",!1).where("ranks_read","array-contains-any",b).orderBy("created_date","desc").limit(25).onSnapshot((function(e){Tt(e,he)})))}}),[e,s,b,t]),Object(n.useEffect)((function(){var e=function(){};if(s&&Object.entries(s).length>0&&b.length>0&&s.caseWithSelectableTasks)if(console.log("filtersData",fe),0!==Object.keys(fe).length){var t=re,a=t[Object.keys(t)[0]].filters;a.emergency_form_filling.violationType={violationType:"=="},a.emergency_form_filling.violationTime="==",console.log("filters",a),console.log("filtersData",fe),he({});var n=d.firestore().collection("tasks").where("case_type","==",s.caseWithSelectableTasks).where("assigned_users","==",[]).where("available","==",!0).where("is_complete","==",!1).where("ranks_read","array-contains-any",b);Object.keys(a).forEach((function(e){Object.keys(a[e]).forEach((function(t){console.log(e,t),fe[t]&&fe[t][t]?(console.log("filters3",fe[t][t],a[e][t][t]),n=n.where("cardData.".concat(e,".").concat(t,".").concat(t),a[e][t][t],fe[t][t])):fe[t]&&Object.keys(fe[t]).length>0&&!fe[t][t]&&(console.log("filters4",fe[t],a[e][t]),n=n.where("cardData.".concat(e,".").concat(t),a[e][t],fe[t]))}))})),e=n=n.orderBy("created_date","desc").limit(25).onSnapshot((function(e){Tt(e,he)}))}else he({}),e=d.firestore().collection("tasks").where("case_type","==",s.caseWithSelectableTasks).where("assigned_users","==",[]).where("available","==",!0).where("is_complete","==",!1).where("ranks_read","array-contains-any",b).orderBy("created_date","desc").limit(25).onSnapshot((function(e){Tt(e,he)}));return e}),[e,s,b,t,fe]),Object(n.useEffect)((function(){if(Object.keys(y).length>0){var e=Object(ot.cloneDeep)(y);Object.keys(y).map((function(t){Object.keys(y[t]).map((function(a){var n=y[t][a];if(n.ranks_write&&Object.keys(n.ranks_write).length>0&&Te(n.ranks_write,b).length>0&&"creatable"in n&&n.creatable){if(n.rank_limit_number&&Object.keys(n.rank_limit_number).length>0){var r=Te(Object.keys(n.rank_limit_number),b);if(r.length>0){var c=Fe(r,n.rank_limit_number);De(a,F,t)>=c&&delete e[t][a]}}}else delete e[t][a]}))})),P(e)}}),[e,y,F,t]);var De=function(e,t,a){var n=0;return Object.values(t).map((function(t){t.case_stage_id===e&&a===t.case_type&&n++})),n},Fe=function(e,t){var a=0;return e.map((function(e){t[e]>a&&(a=t[e])})),a},Te=function(e,t){var a,n=new Set(e),r=new Set(t),c=new Set,o=Object(Ct.a)(r);try{for(o.s();!(a=o.n()).done;){var i=a.value;n.has(i)&&c.add(i)}}catch(s){o.e(s)}finally{o.f()}return Object(Pe.a)(c)};Object(n.useEffect)((function(){b.length>0&&d.firestore().collection("schema").doc("structure").collection("ranks").where(d.firestore.FieldPath.documentId(),"in",b).onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||ve((function(t){return Object(h.a)(Object(h.a)({},t),{},Object(j.a)({},e.doc.id,e.doc.data()))})),"removed"===e.type&&ve((function(t){var a=Object.assign({},t);return delete a[e.doc.id],a}))}))}))}),[b]),Object(n.useEffect)((function(){Object.keys(y).length>0?Re():G({})}),[y]);var Ue=function(t,a,n,c,o){return Object.keys(t).map((function(i){var s=t[i].case_type,l=t[i].case_stage_id,u=!1;if(a?a[l]&&(u=a[l]):n&&n[s]&&n[s][l]&&(u=n[s][l]),u&&t[i].is_complete===o)return r.a.createElement(g.a,{key:i,style:{padding:10}},r.a.createElement(Dt,{stage:u,stageID:l,cardType:c,task:t[i],user:e,pCase:s,id:i}))}))},Re=function(){var e={type:"object",properties:{request:{title:"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435",$ref:"#/definitions/cases"}},definitions:{cases:{type:"object",properties:{case:{type:"string",enum:["none"].concat(Object(Pe.a)(Object.keys(y))),default:"none"}},required:["case"],dependencies:{case:{oneOf:[{properties:{case:{enum:["none"]}}}]}}}}};Object.keys(y).forEach((function(t,a){var n=y[t];console.log("cc",n),s.cases.includes(t)&&e.definitions.cases.dependencies.case.oneOf.push({properties:{case:{enum:[t]},task:{type:"string",enum:["none"].concat(Object(Pe.a)(Object.keys(n))),default:"none"}},required:["task"]})})),G(e)};Object(n.useEffect)((function(){var e=function(){var e=Object(ne.a)(ae.a.mark((function e(){var t;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,d.firestore().collection("schema").doc("structure").collection("ranks").get().then((function(e){e.forEach((function(e){s.ranks.includes(e.id)&&e.data().assign_without_moderator&&(console.log("RANK_ID",e.id),t.push(e.id))}))}));case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();s&&s.ranks&&e().then((function(e){return Ie(function(e){return e.filter((function(e){return b&&!b.includes(e)}))}(e))}))}),[s,b]);return r.a.createElement(g.a,{container:!0,justify:"center",alignItems:"center",direction:"column"},console.log("pageData: ",s),console.log("userRanks: ",b),console.log("userCases: ",y),console.log("userTasks: ",F),console.log("filteredStages: ",A),console.log("availableStages: ",re),console.log("availableTasks: ",ge),console.log("caseData",N),console.log("availableRanks: ",qe),r.a.createElement(nt,null),qe.length>0&&r.a.createElement(g.a,{container:!0,justify:"center",alignItems:"center",direction:"column",style:{paddingBottom:20}},r.a.createElement(I.a,{variant:"h5"},s.message),qe.map((function(t,a){return r.a.createElement(q.a,{key:a,variant:"contained",color:"primary",onClick:function(){return function(t){console.log("\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c \u0437\u0430\u043f\u0440\u043e\u0441"),d.firestore().collection("rank_requests").add({timestamp:d.firestore.FieldValue.serverTimestamp(),user_id:e.uid,processed:!1,rank:t})}(t)},style:{margin:15}},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0440\u0430\u043d\u0433 ",t)}))),s.showTaskSelector&&r.a.createElement(g.a,{style:{paddingBottom:30}},r.a.createElement(dt.a,{schema:V,formData:K,onChange:function(e){!function(e){J(e.formData)}(e)},onSubmit:function(){"none"!==K.request.case&&"none"!==K.request.task?(console.log("rrrr",K),d.firestore().collection("task_requests").doc(e.uid).collection("requests").add({status:"pending",user:e.uid,case_type:K.request.case,case_stage_id:K.request.task})):alert("\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 case \u0438 task!")}},r.a.createElement("button",{type:"submit",className:"btn btn-info"},"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c"))),Object.keys(Ee).length>0?b.map((function(e){if(Ee[e]&&Ee[e].description)return r.a.createElement(I.a,{variant:"h5",key:e},Ee[e].description)})):null,r.a.createElement("div",{className:a.root},r.a.createElement(we.a,{position:"static",color:"default"},r.a.createElement(Se.a,{value:Z,onChange:function(e,t){$(t)},variant:"fullWidth",centered:!0,"aria-label":"simple tabs example"},r.a.createElement(xe.a,Object.assign({label:"\u041d\u0435\u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435"},Rt(0))),r.a.createElement(xe.a,Object.assign({label:"\u0412\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435"},Rt(1))),Object.keys(ge).length>0&&Object.keys(re).length>0?r.a.createElement(xe.a,Object.assign({label:"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435"},Rt(2))):null))),r.a.createElement(Ut,{value:Z,index:0},Object.keys(A).map((function(t){return Object.keys(A[t]).map((function(a){return r.a.createElement(g.a,{key:t+a,style:{padding:10}},r.a.createElement(Dt,{complete:!1,stage:A[t][a],stageID:a,user:e,pCase:t,cardType:"creatable"}))}))})),Ue(F,!1,S,"selected",!1)),r.a.createElement(Ut,{value:Z,index:1},Ue(F,!1,S,"selected",!0)),Object.keys(ge).length>0&&Object.keys(re).length>0?r.a.createElement(Ut,{value:Z,index:2},function(e,t,a,n){if(1===Object.keys(e).length&&e[Object.keys(e)[0]]&&e[Object.keys(e)[0]].filters&&Object.keys(e[Object.keys(e)[0]].filters).length>0&&Object.keys(t).length>0){var c=e[Object.keys(e)[0]].filters;c.emergency_form_filling.violationType={violationType:"=="},c.emergency_form_filling.violationTime="==";var o={properties:{}},i={};return Object.keys(c).forEach((function(e){Object.keys(c[e]).forEach((function(a){var n=t[e].end.properties[a];n&&(delete n.dependencies,o.properties[a]=n,i[a]={"ui:widget":"select"})}))})),r.a.createElement(dt.a,{schema:o,uiSchema:i,formData:a,onChange:function(e){n(e)}}," ")}return null}(re,se,fe,(function(e){me(e.formData)})),Ue(ge,re,!1,"selectable",!1)):null)},Wt=function(e){var t=e.formContext,a=Object(n.useState)({}),c=Object(i.a)(a,2),o=c[0],s=c[1],l=Object(n.useState)(!1),u=Object(i.a)(l,2),m=u[0],b=u[1],p=Object(n.useState)({}),g=Object(i.a)(p,2),j=g[0],O=g[1],E=Object(n.useContext)(f).currentUser,v=d.firestore().collection("UIKS1"),y=d.firestore().collection("tasks").doc(e.taskID).collection("responses").doc(e.name),k=d.firestore().collection("tasks").doc(e.taskID).collection("responses").doc("uikData");Object(n.useEffect)((function(){if(t&&t.conditional&&t.role){var a=d.firestore().collection("UIKS1"),n={},r=t.conditional;return console.log("DEBUG PROPS",e),e.prevResp.conditional&&!e.metadata.is_complete&&(e.prevResp.conditional.region===r.region&&e.prevResp.conditional.subregion===r.subregion&&e.prevResp.conditional.locality===r.locality&&e.prevResp.conditional.district===r.district||(y.set({contents:""}),k.set({}),v.where("observers","array-contains",E.uid).get().then(function(){var e=Object(ne.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.forEach(function(){var e=Object(ne.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.ref.update({observers:d.firestore.FieldValue.arrayRemove(E.uid)});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))),"\u0421\u0442\u0430\u0446\u0438\u043e\u043d\u0430\u0440\u043d\u044b\u0439 \u043d\u0430\u0431\u043b\u044e\u0434\u0430\u0442\u0435\u043b\u044c / \u0441\u0442\u0430\u0446\u0438\u043e\u043d\u0430\u0440\u0434\u0443\u043a \u0431\u0430\u0439\u043a\u043e\u043e\u0447\u0443"===t.role?(b(!0),"mobile"!==t.uik||e.metadata.is_complete||(y.set({contents:""}),k.set({}),v.where("observers","array-contains",E.uid).get().then(function(){var e=Object(ne.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.forEach(function(){var e=Object(ne.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.ref.update({observers:d.firestore.FieldValue.arrayRemove(E.uid)});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))):"mobile"===t.uik||e.metadata.is_complete||(b(!1),y.set({contents:"mobile"}),k.set({}),v.where("observers","array-contains",E.uid).get().then(function(){var e=Object(ne.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.forEach(function(){var e=Object(ne.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.ref.update({observers:d.firestore.FieldValue.arrayRemove(E.uid)});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),r.region&&(a=a.where("region","==",r.region)),r.subregion&&(a=a.where("subregion","==",r.subregion)),r.locality&&(a=a.where("locality","==",r.locality)),r.district&&(a=a.where("district","==",r.district)),n=a.onSnapshot((function(e){var t={};e.forEach((function(e){t[e.id]=e.data()})),O(t),w(t)})),function(){return n()}}}),[t]);var _=function(){var t=Object(ne.a)(ae.a.mark((function t(a){return ae.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("DEBUG FORMDATA",a.formData),""!==a.formData&&void 0!==a.formData&&null!==a.formData){t.next=9;break}if(e.metadata.is_complete){t.next=7;break}return y.set({contents:""}),k.set({}),t.next=7,v.where("observers","array-contains",E.uid).get().then(function(){var e=Object(ne.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.forEach(function(){var e=Object(ne.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.ref.update({observers:d.firestore.FieldValue.arrayRemove(E.uid)});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 7:t.next=15;break;case 9:if(e.metadata.is_complete){t.next=15;break}return y.set({contents:a.formData}),k.set(Object(h.a)(Object(h.a)({},j[a.formData]),{},{uikNumber:a.formData})),t.next=14,v.where("observers","array-contains",E.uid).get().then(function(){var e=Object(ne.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.forEach(function(){var e=Object(ne.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.ref.update({observers:d.firestore.FieldValue.arrayRemove(E.uid)});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 14:v.doc(a.formData).update({observers:d.firestore.FieldValue.arrayUnion(E.uid)});case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),w=function(t){var a={title:e.schema.title,enum:[],type:"string",enumNames:[]},n={"ui:enumDisabled":[]},r=function(e){var t=[],a=Object.keys(e),n=[];return Object.keys(e).forEach((function(a){e[a].address?n.push(a+" "+e[a].address):n.push(a),e[a].observers.length>=2&&t.push(a)})),console.log("DISABLED",t),{available:a,customLabels:n,disabled:t}}(t);a.enum=r.available,a.enumNames=r.customLabels,n["ui:enumDisabled"]=r.disabled,console.log("schema",a),s({schema:a,uiSchema:n})};return m&&r.a.createElement(dt.a,{schema:o.schema?o.schema:{},uiSchema:o.uiSchema?o.uiSchema:{},formData:e.formData,disabled:e.metadata.is_complete,noHtml5Validate:!0,onChange:function(e){return _(e)}}," ")},Bt=a(205),Nt=a(278),zt=a.n(Nt),Mt=a(791),Lt=function(){var e=Object(n.useState)({}),t=Object(i.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)({}),s=Object(i.a)(o,2),l=s[0],m=s[1],b=Object(n.useState)({}),O=Object(i.a)(b,2),E=O[0],v=O[1],y=Object(n.useState)({}),k=Object(i.a)(y,2),_=k[0],w=k[1],S=Object(n.useState)({}),x=Object(i.a)(S,2),C=x[0],D=x[1],F=Object(n.useState)({}),T=Object(i.a)(F,2),U=T[0],R=T[1],A=Object(n.useState)({}),P=Object(i.a)(A,2),W=P[0],B=P[1],N=Object(n.useState)({}),z=Object(i.a)(N,2),M=z[0],L=z[1],J=Object(n.useState)({}),Y=Object(i.a)(J,2),X=Y[0],Z=Y[1],$=Object(n.useState)(""),ee=Object(i.a)($,2),te=(ee[0],ee[1]),ae=Object(n.useState)(null),ne=Object(i.a)(ae,2),re=ne[0],ce=ne[1],oe=Object(n.useState)("loading"),ie=Object(i.a)(oe,2),se=ie[0],le=ie[1],ue=Object(n.useState)({}),de=Object(i.a)(ue,2),fe=de[0],me=de[1],be=Object(n.useState)([]),pe=Object(i.a)(be,2),ge=(pe[0],pe[1],Object(n.useState)([])),he=Object(i.a)(ge,2),je=(he[0],he[1],Object(n.useState)({})),Oe=Object(i.a)(je,2),Ee=(Oe[0],Oe[1],Object(n.useState)([])),ve=Object(i.a)(Ee,2),ye=(ve[0],ve[1],Object(n.useState)(!1)),ke=Object(i.a)(ye,2),_e=(ke[0],ke[1],Object(n.useState)(!1)),we=Object(i.a)(_e,2),Se=(we[0],we[1],Object(n.useState)({})),xe=Object(i.a)(Se,2),Ce=(xe[0],xe[1],Object(n.useState)(!1)),qe=Object(i.a)(Ce,2),Ie=(qe[0],qe[1],Object(n.useState)([])),De=Object(i.a)(Ie,2),Fe=(De[0],De[1],Object(n.useState)(!1)),Te=Object(i.a)(Fe,2),Ue=Te[0],Re=Te[1],Ae=Object(n.useState)(null),We=Object(i.a)(Ae,2),Be=We[0],ze=We[1],Me=Object(n.useState)({}),Le=Object(i.a)(Me,2),Ve=Le[0],Ge=Le[1],He=Object(n.useState)({}),Qe=Object(i.a)(He,2),Ke=(Qe[0],Qe[1],Object(n.useState)(!1)),Je=Object(i.a)(Ke,2),Ye=(Je[0],Je[1],Object(n.useState)({})),Xe=Object(i.a)(Ye,2),Ze=(Xe[0],Xe[1],Object(n.useState)(!1)),$e=Object(i.a)(Ze,2),et=($e[0],$e[1],Object(n.useState)(!1)),tt=Object(i.a)(et,2),at=tt[0],nt=tt[1],rt=Object(n.useContext)(f).currentUser,ct=Object(p.h)().id,it=Object(p.g)();Object(n.useEffect)((function(){if(rt&&ct){var e=d.firestore().collection("tasks").doc(ct);ce(e),e.onSnapshot((function(e){w(e.data()),e.data().is_complete&&le("sent"),e.data().assigned_users.includes(rt.uid)||le("released"),console.log("Task Metadata: ",e.data())})),e.collection("responses").onSnapshot((function(e){var t={},a=[],n=!1;e.docChanges().forEach((function(e){if("added"===e.type||"modified"===e.type){var r=e.doc.data().contents;t[e.doc.id]=r,n=!0}"removed"===e.type&&(console.log("Response Removed: ",e.doc.data()),a.push(e.doc.id),n=!0)})),n&&(console.log("DEBUG FIRED MODIFIED"),c((function(e){var n=Object(ot.cloneDeep)(e);return me(n),a.forEach((function(e){return delete n[e]})),Object.keys(t).forEach((function(e){return n[e]=t[e]})),n})))})),e.collection("questions").onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||m((function(t){return Object(h.a)(Object(h.a)({},t),{},Object(j.a)({},e.doc.id,e.doc.data()))}))}))}))}}),[ct,rt]),Object(n.useEffect)((function(){Object.entries(_).length>0&&_.case_type&&(console.log("Task metadata: ",_),d.firestore().collection("schema").doc("structure").collection("cases").doc(_.case_type).collection("stages").onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||(console.log("Case stage: ",e.doc.data()),D((function(t){return Object(h.a)(Object(h.a)({},t),{},Object(j.a)({},e.doc.id,e.doc.data()))}))),"removed"===e.type&&D((function(t){var a=Object.assign({},t);return delete a[e.doc.id],a}))}))})))}),[_]),Object(n.useEffect)((function(){var e={};console.log("Bg tasks: ",U),Object.keys(U).map((function(t){if(t!==ct){var a=U[t].case_stage_id;e[a]||(e[a]={}),e[a][t]=st(W[t],C[a])}})),console.log("Merged bg forms: ",e),L(e)}),[U,W,C]),Object(n.useEffect)((function(){if(Object.keys(E).length>0&&"loading"===se&&le("ready"),E&&E.form_questions&&E.form_questions.required&&a){var e=E.form_questions.required.every(ft);nt(e)}}),[a,E]),Object(n.useEffect)((function(){v(st(l,C[_.case_stage_id]))}),[l,_,C]),Object(n.useEffect)((function(){if(Object.keys(C).length>0&&Object.keys(_).length>0&&C[_.case_stage_id]){console.log("caseStages: ",C),console.log("taskMetadata: ",_);var e=C[_.case_stage_id].backgroundStages;e&&e.length>0&&(console.log("backgroundTasksList: ",e.length),d.firestore().collection("tasks").where("case_id","==",_.case_id).where("case_stage_id","in",e).orderBy("created_date").onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||(console.log("Background task: ",e.doc.data()),R((function(t){return Object(h.a)(Object(h.a)({},t),{},Object(j.a)({},e.doc.id,e.doc.data()))}))),"removed"===e.type&&R((function(t){var a=Object.assign({},t);return delete a[e.doc.id],a}))}))})))}}),[C,_]),Object(n.useEffect)((function(){Object.entries(U).length>0&&Object.keys(U).map((function(e){d.firestore().collection("tasks").doc(e).collection("questions").onSnapshot((function(t){Ft(t,B,e)})),d.firestore().collection("tasks").doc(e).collection("responses").onSnapshot((function(t){t.docChanges().forEach((function(t){"added"!==t.type&&"modified"!==t.type||Z((function(a){var n=Object.assign({},a);return n[e]||(n[e]={}),n[e][t.doc.id]=t.doc.data().contents,n})),"removed"===t.type&&Z((function(a){var n=Object.assign({},a);return delete n[e][t.doc.id],n}))}))}))}))}),[U]);var st=function(e,t){var a=Object.assign({},e),n=Object.assign({},t);n.start=n.start?n.start:{},n.end=n.end?n.end:{},n.start_ui_schema=n.start_ui_schema?n.start_ui_schema:{},n.end_ui_schema=n.end_ui_schema?n.end_ui_schema:{},a.form_questions=a.form_questions?a.form_questions:{},a.ui_schema=a.ui_schema?a.ui_schema:{};var r=Object(h.a)(Object(h.a)(Object(h.a)({},n.start.properties?n.start.properties:{}),n.end.properties?n.end.properties:{}),a.form_questions.properties?a.form_questions.properties:{}),c=Object(h.a)(Object(h.a)(Object(h.a)({},n.start.definitions?n.start.definitions:{}),n.end.definitions?n.end.definitions:{}),a.form_questions.definitions?a.form_questions.definitions:{}),o="";a.form_questions.title?o=a.form_questions.title:n.end.title?o=n.end.title:n.start.title&&(o=n.start.title);var i="";a.form_questions.description?i=a.form_questions.description:n.end.description?i=n.end.description:n.start.description&&(i=n.start.description);var s=Object(Pe.a)(new Set([].concat(Object(Pe.a)(n.start.required?n.start.required:[]),Object(Pe.a)(a.form_questions.required?a.form_questions.required:[]),Object(Pe.a)(n.end.required?n.end.required:[])))),l=Object(Pe.a)(new Set([].concat(Object(Pe.a)(n.start_ui_schema["ui:order"]?n.start_ui_schema["ui:order"]:[]),Object(Pe.a)(a.ui_schema["ui:order"]?a.ui_schema["ui:order"]:[]),Object(Pe.a)(n.end_ui_schema["ui:order"]?n.end_ui_schema["ui:order"]:[])))),u=Object(h.a)(Object(h.a)(Object(h.a)({},n.start_ui_schema?n.start_ui_schema:{}),n.end_ui_schema?n.end_ui_schema:{}),a.ui_schema?a.ui_schema:{});return{form_questions:{properties:r,definitions:c,title:o,description:i,required:s},ui_schema:u=Object(h.a)(Object(h.a)({},u),{"ui:order":l})}},lt=function(){Re(!1)},dt=function(){Re(!1),it.goBack()},ft=function(e){return"object"===typeof a[e]&&null!==a[e]&&Object.values(a[e]).length>0||"object"!==typeof a[e]&&null!==a[e]&&""!==a[e]&&a[e]!=={}&&void 0!==a[e]},mt=function(e){console.log("Dialog open"),"send"===e&&(ze("send"),Re(!0)),"release"===e&&(ze("release"),Re(!0))},bt=function(e){var t=d.firestore().collection("tasks").doc(ct).collection("user_editable").doc("user_editable");"released"===e?Ve.reasons&&(Ve.extra?t.update({status:e,release_status:Ve.reasons,release_description:Ve.extra}):t.update({status:e,release_status:Ve.reasons,release_description:""})):t.update({status:e})},pt={customImageWidget:function(e){return console.log("PROPS",e),r.a.createElement("img",{src:e.value,alt:e.schema.title,style:{maxWidth:"100%",height:"auto"}})},customVideoWidget:function(e){return console.log("PROPS",e),r.a.createElement("video",{title:e.schema.title,style:{maxWidth:"100%",height:"auto"},controls:!0},r.a.createElement("source",{src:e.value,type:"video/mp4"}))},customIframeWidget:function(e){return console.log("PROPS",e),r.a.createElement("iframe",{title:e.schema.title,src:e.value,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}};return rt?r.a.createElement(g.a,{style:{padding:30}},"send"===Be&&r.a.createElement(Ne,{state:Ue,handleClose:lt,handleOk:dt,showOk:"sent"===se,title:"sent"===se?C[_.case_stage_id].releaseTitle?r.a.createElement(zt.a,{allowDangerousHtml:!0,plugins:[Mt],children:C[_.case_stage_id].releaseTitle}):"\u0424\u043e\u0440\u043c\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0430.":"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0444\u043e\u0440\u043c\u0443?",content:"sent"===se?C[_.case_stage_id].releaseMessage?r.a.createElement(zt.a,{allowDangerousHtml:!0,plugins:[Mt],children:C[_.case_stage_id].releaseMessage}):"\u0421\u043f\u0430\u0441\u0438\u0431\u043e":"\u0412\u044b \u0441\u043e\u0431\u0438\u0440\u0430\u0435\u0442\u0435\u0441\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0444\u043e\u0440\u043c\u0443. \u042d\u0442\u043e \u0437\u043d\u0430\u0447\u0438\u0442, \u0447\u0442\u043e \u0432\u044b \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u0441\u043c\u043e\u0436\u0435\u0442\u0435 \u0438\u0437\u043c\u0435\u043d\u044f\u0442\u044c \u043e\u0442\u0432\u0435\u0442\u044b.",dialogFunction:function(){bt("complete")}}),"release"===Be&&r.a.createElement(V.a,{open:Ue,onClose:lt},"released"===se&&r.a.createElement(K.a,{id:"alert-dialog-title"},"\u0424\u043e\u0440\u043c\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043e\u0441\u0432\u043e\u0431\u043e\u0436\u0434\u0435\u043d\u0430. \u0422\u0435\u043f\u0435\u0440\u044c \u0435\u044e \u0441\u043c\u043e\u0436\u0435\u0442 \u0437\u0430\u043d\u044f\u0442\u044c\u0441\u044f \u043a\u0442\u043e-\u0442\u043e \u0435\u0449\u0435."),r.a.createElement(H.a,null,"released"===se?r.a.createElement(Q.a,null,"\u0421\u043f\u0430\u0441\u0438\u0431\u043e"):r.a.createElement(Bt.a,{schema:C[_.case_stage_id].releaseFeedback_schema,uiSchema:C[_.case_stage_id].releaseFeedback_ui,formData:Ve,widgets:pt,onChange:function(e){var t;Ge((t=e).formData),console.log("event",t.formData)},onSubmit:function(){return bt("released")}},r.a.createElement(G.a,null,r.a.createElement(q.a,{onClick:lt,color:"primary"},"\u041e\u0442\u043c\u0435\u043d\u0430"),r.a.createElement(q.a,{type:"submit",color:"primary",autoFocus:!0},"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c")))),"released"===se&&r.a.createElement(G.a,null,r.a.createElement(q.a,{onClick:dt,color:"primary"},"Ok"))),Object.keys(C).length>0&&Object.keys(_).length>0&&C[_.case_stage_id]&&C[_.case_stage_id].backgroundStages&&C[_.case_stage_id].backgroundStages.length>0&&Object.keys(M).length>0?r.a.createElement(g.a,{style:{padding:30}},C[_.case_stage_id].backgroundStages.map((function(e){return r.a.createElement("div",{key:e},console.log("STAGE: ",e),console.log("mergedBackgroundForms: ",M),M[e]?Object.keys(M[e]).map((function(t){return r.a.createElement(g.a,{style:{padding:30},key:t},r.a.createElement(Bt.a,{schema:M[e][t].form_questions,uiSchema:M[e][t].ui_schema,formData:X[t],widgets:pt,fields:{customFileUpload:function(e){return ut(Object(h.a)(Object(h.a)(Object(h.a)({},e),{taskID:t}),{currentUserUid:rt.uid}))}},disabled:!0}," "))})):null)}))):null,E&&re&&C&&_&&_.case_stage_id&&C[_.case_stage_id]?r.a.createElement(Bt.a,{schema:E.form_questions,uiSchema:E.ui_schema,formData:a,fields:{CustomUIKField:function(e){return Wt(Object(h.a)(Object(h.a)(Object(h.a)(Object(h.a)({},e),{metadata:_}),{prevResp:fe}),{taskID:ct}))},customFileUpload:function(e){return ut(Object(h.a)(Object(h.a)(Object(h.a)(Object(h.a)(Object(h.a)({},e),{taskID:ct}),{currentUserUid:rt.uid}),{metadata:_}),{stage:C[_.case_stage_id]}))}},disabled:"loading"===se||"sent"===se||"released"===se,widgets:pt,omitExtraData:!0,liveOmit:!0,formContext:a,noHtml5Validate:!0,onChange:function(e){!function(e){c(e.formData)}(e)},onFocus:function(e){console.log("That is what was focused",e),te(e.split("_")[1])},onSubmit:function(){return mt("send")},onBlur:function(e){!function(e){re&&(console.log("Responses: ",a),console.log("That is what was blured",e),Object.keys(a).map((function(e){re.collection("responses").doc(e).set({contents:a[e]?a[e]:""})})))}(e)}},"sent"===se?r.a.createElement("div",null,"\u0424\u043e\u0440\u043c\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e"):null,"ready"===se?r.a.createElement("div",null,C[_.case_stage_id].additionalButtons&&C[_.case_stage_id].additionalButtons.includes("release")?r.a.createElement(q.a,{variant:"outlined",disabled:"loading"===se||"sent"===se||"released"===se,style:{borderWidth:2,borderColor:"#003366",color:"#003366",margin:5},onClick:function(){return mt("release")}},"\u041e\u0441\u0432\u043e\u0431\u043e\u0434\u0438\u0442\u044c"):null,!at&&r.a.createElement(I.a,{color:"error"},"\u0412\u044b \u043d\u0435 \u043c\u043e\u0436\u0435\u0442\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c, \u043f\u043e\u043a\u0430 \u043d\u0435 \u0437\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u0435 \u0432\u0441\u0435 \u043f\u043e\u043b\u044f"),r.a.createElement(q.a,{type:"submit",variant:"outlined",disabled:"loading"===se||"sent"===se||"released"===se||!at,style:at?{borderWidth:2,borderColor:"red",color:"red",margin:5}:null},"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c")):null,"released"===se?r.a.createElement("div",null,"\u0412\u044b \u043e\u0441\u0432\u043e\u0431\u043e\u0434\u0438\u043b\u0438 \u044d\u0442\u0443 \u0444\u043e\u0440\u043c\u0443 \u0438 \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442\u0435 \u0435\u0435 \u0437\u0430\u043f\u043e\u043b\u043d\u044f\u0442\u044c."):null):null):r.a.createElement(g.a,{container:!0,direction:"column",style:{padding:20},justify:"center"},r.a.createElement(I.a,{align:"center",variant:"h3"},"\u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044c"),r.a.createElement("br",null),r.a.createElement(q.a,{variant:"contained",onClick:u},"\u0412\u043e\u0439\u0442\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google"))},Vt=function(){var e=Object(n.useContext)(f).currentUser,t=Object(n.useState)(""),a=Object(i.a)(t,2),c=a[0],o=a[1];return Object(n.useEffect)((function(){var t=function(){};return e&&(t=d.firestore().collection("users").doc(e.uid).collection("user_private").doc("private").onSnapshot((function(e){e.exists&&"tg_id"in e.data()&&(console.log("APP TGID: ",e.data().tg_id),o(e.data().tg_id))}))),function(){t()}}),[e]),r.a.createElement(b.a,null,r.a.createElement(g.a,{container:!0,justify:"center"},r.a.createElement(B,null,""!==c?r.a.createElement(p.d,null,r.a.createElement(p.b,{exact:!0,path:"/profile"},r.a.createElement(ke,null)),r.a.createElement(p.b,{exact:!0,path:"/request"},r.a.createElement(Qe,null)),r.a.createElement(p.b,{exact:!0,path:"/tasks"},r.a.createElement(Ae,null)),r.a.createElement(p.b,{path:"/tasks/:id"},r.a.createElement(Ve,null)),r.a.createElement(p.b,{path:"/t/:id"},r.a.createElement(Lt,null)),r.a.createElement(p.b,{exact:!0,path:"/tasksObserver"},r.a.createElement(Ot,null)),r.a.createElement(p.b,{exact:!0,path:"/notifications"},r.a.createElement(Ye,null)),r.a.createElement(p.b,{exact:!0,path:"/signin"},r.a.createElement(Et,null)),r.a.createElement(p.b,{exact:!0,path:"/faq"},r.a.createElement(xt,null)),r.a.createElement(p.b,{path:"/p/:id"},e?r.a.createElement(Pt,null):r.a.createElement(Et,null)),r.a.createElement(vt,{path:"/",component:nt})):r.a.createElement(p.b,null,r.a.createElement(nt,null)))))},Gt=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,914)).then((function(t){var a=t.getCLS,n=t.getFID,r=t.getFCP,c=t.getLCP,o=t.getTTFB;a(e),n(e),r(e),c(e),o(e)}))};o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(m,null,r.a.createElement(Vt,null))),document.getElementById("root")),Gt()}},[[792,1,2]]]);
//# sourceMappingURL=main.c35f9681.chunk.js.map