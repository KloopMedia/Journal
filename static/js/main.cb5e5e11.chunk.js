(this.webpackJsonpjournal=this.webpackJsonpjournal||[]).push([[0],{436:function(e,t,n){},787:function(e,t,n){"use strict";n.r(t);var a=n(2),c=(n(432),n(0)),r=n.n(c),s=n(26),i=n.n(s),o=(n(436),n(5)),l=n(71);l.a.initializeApp({apiKey:"AIzaSyBfzhQOCtbcUk_tWjPDnjYtHwoouCEkclg",authDomain:"journal-bb5e3.firebaseapp.com",databaseURL:"https://journal-bb5e3.firebaseio.com",projectId:"journal-bb5e3",storageBucket:"journal-bb5e3.appspot.com",messagingSenderId:"918752509407",appId:"1:918752509407:web:77670a68ff906f13e5d86a"});var d=new l.a.auth.GoogleAuthProvider,u=function(){l.a.auth().signInWithPopup(d)},j=l.a,b=r.a.createContext(),f=function(e){var t=e.children,n=Object(c.useState)(null),r=Object(o.a)(n,2),s=r[0],i=r[1],l=Object(c.useState)(!0),d=Object(o.a)(l,2),u=(d[0],d[1]);return Object(c.useEffect)((function(){j.auth().onAuthStateChanged((function(e){i(e),u(!1);var t=j.firestore().collection("users");if(e){var n=t.doc(e.uid);n.get().then((function(t){t&&t.exists?console.log("User Exist"):(console.log("Creating user"),n.set({username:e.displayName,email:e.email,created_date:j.firestore.FieldValue.serverTimestamp()}))}))}}))}),[]),Object(a.jsx)(b.Provider,{value:{currentUser:s},children:t})},O=n(56),h=n(21),p=n(846),g=n(10),m=n(22),x=n(844),v=n(843),y=n(841),k=n(876),_=n(871),w=n(789),S=n(376),C=n.n(S),q=n(400),E=n(845),I=n(850),F=n(194),D=n(839),T=n(31),U=n.p+"static/media/kloop_transparent_site.f6fb098e.png",A=n(377),P=n.n(A),W=n(847),N=240,B=Object(D.a)((function(e){return{root:{display:"flex"},drawer:Object(m.a)({},e.breakpoints.up("sm"),{width:N,flexShrink:0}),appBar:Object(m.a)({background:"white",boxShadow:"none"},e.breakpoints.up("sm"),{width:"calc(100% - ".concat(N,"px)"),marginLeft:N}),menuButton:Object(m.a)({color:"black",marginRight:e.spacing(2)},e.breakpoints.up("sm"),{display:"none"}),toolbar:e.mixins.toolbar,drawerPaper:{width:N},content:{flexGrow:1,padding:e.spacing(3)}}}));var z=function(e){var t=e.window,n=B(),s=Object(T.a)(),i=r.a.useState(!1),l=Object(o.a)(i,2),d=l[0],f=l[1],h=Object(c.useContext)(b).currentUser,S=r.a.useState(null),D=Object(o.a)(S,2),A=D[0],N=D[1],z=Boolean(A),R=function(){f(!d)},M=Object(c.useState)(!1),L=Object(o.a)(M,2),G=L[0],V=L[1],Q=Object(c.useState)(0),H=Object(o.a)(Q,2),J=H[0],K=H[1],Y=Object(c.useState)([]),X=Object(o.a)(Y,2),Z=X[0],$=X[1],ee=Object(c.useState)([]),te=Object(o.a)(ee,2),ne=te[0],ae=te[1],ce=Object(c.useState)({}),re=Object(o.a)(ce,2),se=re[0],ie=re[1],oe=Object(c.useState)([]),le=Object(o.a)(oe,2),de=le[0],ue=le[1];Object(c.useEffect)((function(){h&&j.firestore().collection("editors").get().then((function(e){e.forEach((function(e){e.id===h.uid&&(console.log("moderator"),V(!0))}))})).catch((function(){return V(!1)}))}),[h]),Object(c.useEffect)((function(){h&&j.firestore().collection("users").doc(h.uid).collection("user_private").doc("private").onSnapshot((function(e){e.data()&&ae(e.data().ranks)}))}),[h]),Object(c.useEffect)((function(){h&&j.firestore().collection("schema").doc("structure").collection("ranks").onSnapshot((function(e){var t=[];e.forEach((function(e){e.data().assign_without_moderator&&t.push(e.id)})),ue(t),console.log("Assignable",t)}))}),[h]),Object(c.useEffect)((function(){ne&&ne.length>0&&de.length>0&&(j.firestore().collection("pages").where("ranks","array-contains-any",ne).onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||(ie((function(t){return Object(g.a)(Object(g.a)({},t),{},Object(m.a)({},e.doc.id,e.doc.data()))})),console.log("User pages: ",e.doc.id))}))})),j.firestore().collection("pages").where("ranks","array-contains-any",de).onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||(ie((function(t){return Object(g.a)(Object(g.a)({},t),{},Object(m.a)({},e.doc.id,e.doc.data()))})),console.log("User pages: ",e.doc.id))}))})))}),[ne,de]),Object(c.useEffect)((function(){var e=function(){};return h&&j.firestore().collection("notifications").where("user_id","array-contains",h.uid).where("shown","!=",!0).onSnapshot((function(e){console.log(e.size);var t=[],n=0;e.forEach((function(e){t.push(Object(g.a)({id:e.id},e.data())),n++})),t.sort((function(e,t){return t.created_date.toDate()-e.created_date.toDate()})),K(n),$(t)})),function(){return e}}),[h]);var je=Object(a.jsxs)("div",{children:[Object(a.jsx)("div",{className:n.toolbar}),Object(a.jsx)(y.a,{}),Object(a.jsxs)("nav",{children:[Object(a.jsxs)("ul",{children:[Object(a.jsx)("li",{children:Object(a.jsx)(O.b,{to:"/",children:"\u0413\u043b\u0430\u0432\u043d\u0430\u044f"})}),Object(a.jsx)("li",{children:Object(a.jsx)(O.b,{to:"/profile",children:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"})}),Object(a.jsx)("li",{children:Object(a.jsx)(O.b,{to:"/notifications",children:"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f"})}),G?Object(a.jsx)("li",{children:Object(a.jsx)(O.b,{to:"/tasksObserver",children:"\u041c\u043e\u0434\u0435\u0440\u0430\u0442\u043e\u0440"})}):null]}),Object(a.jsx)("ul",{children:Object.keys(se).map((function(e){return Object(a.jsxs)("li",{children:[" ",Object(a.jsx)(O.b,{to:"/p/"+e,children:se[e].name})," "]},e)}))})]})]}),be=void 0!==t?function(){return t().document.body}:void 0;return Object(a.jsxs)("div",{className:n.root,children:[Object(a.jsx)(v.a,{}),Object(a.jsx)(x.a,{position:"fixed",className:n.appBar,children:Object(a.jsxs)(E.a,{children:[Object(a.jsx)(w.a,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:R,className:n.menuButton,children:Object(a.jsx)(C.a,{})}),Object(a.jsx)(p.a,{container:!0,style:{flexGrow:1},children:Object(a.jsx)("img",{src:U,alt:"Kloop.kg - \u041d\u043e\u0432\u043e\u0441\u0442\u0438 \u041a\u044b\u0440\u0433\u044b\u0437\u0441\u0442\u0430\u043d\u0430",style:{width:150,height:"auto"}})}),h&&Object(a.jsxs)("div",{children:[Object(a.jsx)(w.a,{"aria-label":"account of current user","aria-controls":"menu-appbar","aria-haspopup":"true",onClick:function(e){N(e.currentTarget)},color:"inherit",size:"small",children:Object(a.jsx)(W.a,{badgeContent:J,color:"secondary",overlap:"circle",children:Object(a.jsx)(P.a,{style:{fill:"grey",fontSize:"28px"}})})}),Object(a.jsx)(q.a,{id:"menu-appbar",anchorEl:A,anchorOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:z,onClose:function(){N(null)},children:Object(a.jsx)(p.a,{container:!0,direction:"column",alignItems:"center",children:Z.length>0?Z.map((function(e,t){return Object(a.jsxs)(p.a,{container:!0,className:n.message,justify:"flex-start",style:{padding:0},children:[Object(a.jsx)(F.a,{style:{flex:1,padding:10},children:e.title}),Object(a.jsx)(I.a,{style:{padding:10},onClick:function(){return t=e.id,void j.firestore().collection("notifications").doc(t).update({shown:!0});var t},size:"small",children:"\u0441\u043a\u0440\u044b\u0442\u044c"})]},e.id)})):Object(a.jsx)(F.a,{className:n.message,align:"center",style:{padding:10},children:"\u041d\u0435\u0442 \u043d\u043e\u0432\u044b\u0445 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0439"})})})]}),h?Object(a.jsxs)("div",{children:[Object(a.jsx)("span",{style:{color:"black",fontSize:12,marginLeft:7},children:h.email}),Object(a.jsx)(I.a,{style:{borderColor:"black",color:"black",marginLeft:10,fontSize:12},variant:"outlined",size:"small",onClick:function(){return j.auth().signOut()},children:"\u0412\u044b\u0445\u043e\u0434"})]}):Object(a.jsx)(I.a,{style:{borderColor:"black",color:"black",marginLeft:10,fontSize:12},size:"small",variant:"outlined",onClick:u,children:"\u0432\u0445\u043e\u0434"})]})}),Object(a.jsxs)("nav",{className:n.drawer,"aria-label":"mailbox folders",children:[Object(a.jsx)(_.a,{smUp:!0,implementation:"css",children:Object(a.jsx)(k.a,{container:be,variant:"temporary",anchor:"rtl"===s.direction?"right":"left",open:d,onClose:R,classes:{paper:n.drawerPaper},ModalProps:{keepMounted:!0},children:je})}),Object(a.jsx)(_.a,{xsDown:!0,implementation:"css",children:Object(a.jsx)(k.a,{classes:{paper:n.drawerPaper},variant:"permanent",open:!0,children:je})})]}),Object(a.jsxs)("main",{className:n.content,children:[Object(a.jsx)("div",{className:n.toolbar}),e.children]})]})},R=n(853),M=n(868),L=n(257),G=n.n(L),V=n(854),Q=n(858),H=n(856),J=n(857),K=n(855),Y=n(872),X=n(851),Z=n(852),$=n(791),ee=function(e){var t=Object(c.useState)(null),n=Object(o.a)(t,2),r=n[0],s=n[1],i=Object(c.useState)(""),l=Object(o.a)(i,2),d=l[0],u=l[1],j=e.returnAnswer;return Object(a.jsxs)("div",{children:[Object(a.jsx)("h4",{children:e.title}),Object(a.jsx)($.a,{const:"fieldset",style:{paddingBottom:15},children:Object(a.jsx)(X.a,{"aria-label":e.title,name:e.title,value:r,onChange:function(e){s(e.target.value),j({reason:e.target.value,text:d})},children:e.answers.map((function(t,n){return Object(a.jsx)(Z.a,{value:t,control:Object(a.jsx)(Y.a,{color:"primary"}),label:t,disabled:!!e.locked},n)}))})}),Object(a.jsx)(R.a,{id:"feedback_input",label:"\u041f\u0440\u0438\u043c\u0435\u0447\u0430\u043d\u0438\u0435",value:d,onChange:function(e){u(e.target.value),j({reason:r,text:e.target.value})},multiline:!0,rows:5,variant:"outlined",fullWidth:!0})]})};function te(e){return Object(a.jsx)("div",{children:Object(a.jsxs)(V.a,{open:e.state,onClose:e.handleClose,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[Object(a.jsx)(K.a,{id:"alert-dialog-title",children:e.title}),Object(a.jsx)(H.a,{children:Object(a.jsxs)(J.a,{id:"alert-dialog-description",children:[Object(a.jsx)(F.a,{children:e.description}),Object(a.jsx)(ee,{answers:e.answers,returnAnswer:e.returnFeedback})]})}),Object(a.jsxs)(Q.a,{children:[Object(a.jsx)(I.a,{onClick:e.handleClose,color:"primary",children:"\u041e\u0442\u043c\u0435\u043d\u0430"}),Object(a.jsx)(I.a,{onClick:e.dialogFunction,disabled:!e.feedbackValue.reason,color:"primary",autoFocus:!0,children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})})}var ne=n(14),ae=n.n(ne),ce=n(23),re=n(860),se=(n(379),n(380),n(859)),ie=function(e){return Object(a.jsxs)(M.a,{display:"flex",alignItems:"center",children:[Object(a.jsx)(M.a,{width:"100%",mr:1,children:Object(a.jsx)(se.a,Object(g.a)({variant:"determinate"},e))}),Object(a.jsx)(M.a,{minWidth:35,children:Object(a.jsx)(F.a,{variant:"body2",color:"textSecondary",children:"".concat(Math.round(e.value),"%")})})]})},oe=Object(D.a)((function(e){return{root:{"& > *":{width:"40ch"}}}})),le=function(e){oe();var t=r.a.useState(""),n=Object(o.a)(t,2),s=(n[0],n[1],Object(c.useState)(!1)),i=Object(o.a)(s,2),l=(i[0],i[1],Object(c.useState)({})),d=Object(o.a)(l,2),u=(d[0],d[1],Object(c.useState)({})),b=Object(o.a)(u,2),f=(b[0],b[1]),O=Object(c.useState)(!1),h=Object(o.a)(O,2),p=(h[0],h[1]),g=e.returnFile,m=(e.locked,e.id),x=e.feedbackType,v=e.askFeedback;e.saveQuestionFeedback,e.prevTaskId;Object(c.useEffect)((function(){console.log(x),x&&v?(console.log(x),j.firestore().collection("schema").doc("structure").collection("feedbacks").doc(x).get().then((function(e){f(e.data())})),p(!0)):p(!1)}),[x]);return Object(a.jsx)("div",{children:Object(a.jsx)("input",{type:"file",onChange:function(e){g(e.target.files,m)},multiple:!0})})},de=Object(D.a)((function(e){return{root:{"& > *":{width:"40ch"}}}})),ue=Object(c.forwardRef)((function(e,t){de();var n=r.a.useState(""),s=Object(o.a)(n,2),i=s[0],l=s[1],d=Object(c.useState)(!1),u=Object(o.a)(d,2),b=u[0],f=u[1],O=Object(c.useState)(null),h=Object(o.a)(O,2),p=(h[0],h[1],Object(c.useState)({})),g=Object(o.a)(p,2),m=g[0],x=g[1],v=Object(c.useState)({}),y=Object(o.a)(v,2),k=y[0],_=y[1],S=Object(c.useState)(!1),C=Object(o.a)(S,2),q=C[0],E=C[1],I=e.index,D=e.response,T=e.returnFile,U=e.locked,A=e.id,P=e.feedbackType,W=e.askFeedback,N=e.saveQuestionFeedback,B=e.prevTaskId,z=(e.uploadFilesData,e.attachMaterials);Object(c.useEffect)((function(){D&&l(D)}),[D]),Object(c.useEffect)((function(){P&&W?(console.log(P),j.firestore().collection("schema").doc("structure").collection("feedbacks").doc(P).get().then((function(e){_(e.data())})),E(!0)):E(!1)}),[P]);var L=function(){f(!1)};return Object(a.jsxs)("div",{children:[Object(a.jsx)(te,{title:k.title,dialogFunction:function(){N(m,A,B),L()},state:b,handleClose:L,feedbackValue:m,answers:k.answers,description:k.description,returnFeedback:function(e){x(e)}}),Object(a.jsxs)(M.a,{display:"flex",style:{marginBottom:10,marginTop:20},children:[Object(a.jsx)(F.a,{variant:"h6",style:{paddingRight:8},children:e.title}),q&&Object(a.jsx)(w.a,{size:"small",onClick:function(){return f(!0)},children:Object(a.jsx)(G.a,{color:"primary"})})]}),Object(a.jsx)(R.a,{id:"inputBox"+I,label:"\u041c\u043e\u0439 \u043e\u0442\u0432\u0435\u0442",value:i,onChange:function(t){l(t.target.value),e.returnAnswer(t.target.value,e.index)},multiline:!0,rows:5,disabled:U,variant:"outlined",fullWidth:!0}),!U&&z&&Object(a.jsx)(le,{returnFile:T,locked:U,id:A})]})})),je=n(794),be=n(877),fe=n(799),Oe=Object(D.a)((function(e){return{formControl:{minWidth:100,maxWidth:300}}}));function he(e){var t=Oe(),n=r.a.useState(""),s=Object(o.a)(n,2),i=s[0],l=s[1],d=r.a.useState(!1),u=Object(o.a)(d,2),j=u[0],b=u[1],f=e.index,O=e.response,h=(e.required,e.locked);Object(c.useEffect)((function(){O&&l(O)}),[O]);return Object(a.jsxs)("div",{children:[Object(a.jsx)(F.a,{variant:"h6",style:{marginBottom:5,marginTop:20},children:e.title}),Object(a.jsxs)($.a,{className:t.formControl,disabled:h,children:[Object(a.jsx)(je.a,{id:"controlled-open-select-label",children:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c"}),Object(a.jsxs)(fe.a,{labelId:"controlled-open-select-label",id:"select"+f,open:j,onClose:function(e){b(!1)},onOpen:function(e){b(!0)},value:i,onChange:function(t){l(t.target.value);e.answers.indexOf(t.target.value);e.returnAnswer(t.target.value,f)},children:[Object(a.jsx)(be.a,{value:"",children:Object(a.jsx)("em",{children:"None"})}),e.answers.map((function(e,t){return Object(a.jsx)(be.a,{value:e,children:e},t)}))]})]})]})}function pe(e){var t=r.a.useState(""),n=Object(o.a)(t,2),s=n[0],i=n[1],l=e.index,d=e.response;Object(c.useEffect)((function(){d&&i(d)}),[d]);return Object(a.jsxs)("div",{children:[Object(a.jsx)("h4",{children:e.title}),Object(a.jsx)($.a,{const:"fieldset",children:Object(a.jsx)(X.a,{"aria-label":e.title,name:e.title,value:s,onChange:function(t){i(t.target.value);var n=e.answers.indexOf(t.target.value);e.returnAnswer(t.target.value,l,n)},children:e.answers.map((function(t,n){return Object(a.jsx)(Z.a,{value:t,control:Object(a.jsx)(Y.a,{color:"primary"}),label:t,disabled:!!e.locked},n)}))})})]})}var ge=Object(D.a)((function(e){return{container:{display:"flex",flexWrap:"wrap"},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:"auto"}}}));function me(e){var t=ge(),n=r.a.useState(""),s=Object(o.a)(n,2),i=s[0],l=s[1],d=e.index,u=e.response;Object(c.useEffect)((function(){u&&l(u)}),[d,u]);return Object(a.jsxs)("div",{children:[Object(a.jsx)("h4",{children:e.title}),Object(a.jsx)("form",{className:t.container,noValidate:!0,children:Object(a.jsx)(R.a,{id:"time"+d,label:"\u0412\u0440\u0435\u043c\u044f",type:"time",value:i,onChange:function(t){l(t.target.value),e.returnAnswer(t.target.value,d,t.target.value)},className:t.textField,InputLabelProps:{shrink:!0},InputProps:{disableUnderline:!0},disabled:!!e.locked})})]})}var xe=n(795),ve=n(792),ye=n(874);function ke(e){var t=r.a.useState({}),n=Object(o.a)(t,2),s=n[0],i=n[1],l=Object(c.useState)(!1),d=Object(o.a)(l,2),u=d[0],j=d[1],b=e.index,f=e.answers,O=(e.required,e.response),h=e.locked;Object(c.useEffect)((function(){if(O){i(O);var t={};f.forEach((function(e,n){O[e]?t[e]=O[e]:t[e]=!1})),i(t),e.returnAnswer(t,b)}else{var n={};f.forEach((function(e,t){return n[e]=!1})),e.returnAnswer(n,b)}j(!0),console.log(s)}),[O,f]);var p=function(t){i(Object(g.a)(Object(g.a)({},s),{},Object(m.a)({},t.target.name,t.target.checked))),e.returnAnswer(Object(g.a)(Object(g.a)({},s),{},Object(m.a)({},t.target.name,t.target.checked)),b)};return u?Object(a.jsxs)("div",{children:[Object(a.jsx)(F.a,{variant:"h6",style:{marginBottom:0,marginTop:20},children:e.title}),Object(a.jsxs)($.a,{component:"fieldset",disabled:h,children:[Object(a.jsx)(xe.a,{component:"legend",children:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u0438\u043d \u0438\u043b\u0438 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u043e\u0432"}),Object(a.jsx)(ve.a,{children:f.map((function(e,t){return Object(a.jsx)(Z.a,{control:Object(a.jsx)(ye.a,{checked:s[e],onChange:p,name:e}),label:e},t)}))})]})]}):null}var _e=function(){var e=Object(c.useState)([]),t=Object(o.a)(e,2),n=t[0],r=t[1],s=Object(c.useState)({}),i=Object(o.a)(s,2),l=i[0],d=i[1],f=Object(c.useState)([]),O=Object(o.a)(f,2),m=O[0],x=O[1],v=Object(c.useState)(!1),y=Object(o.a)(v,2),k=y[0],_=y[1],w=Object(c.useState)(!1),S=Object(o.a)(w,2),C=S[0],q=S[1],E=Object(c.useState)({}),D=Object(o.a)(E,2),T=(D[0],D[1]),U=Object(c.useContext)(b).currentUser;Object(c.useEffect)((function(){var e={};U&&j.firestore().collection("users").doc(U.uid).get().then((function(t){T(t.data()),e=t.data()})).then((function(){j.firestore().collection("profileTemplate").doc("Template").get().then((function(t){console.log(JSON.stringify(t.data())),r(t.data().questions),console.log(t.data().questions);var n=t.data().questions.map((function(t,n){var c=null;return e[t.key]&&(console.log(e[t.key]),c=e[t.key]),"input"===t.type?Object(a.jsx)(ue,{index:n,title:t.question,response:c,returnAnswer:A,required:t.required},"profile_"+n):"select"===t.type?Object(a.jsx)(he,{index:n,title:t.question,response:c,answers:t.answers,returnAnswer:A,required:t.required},"profile_"+n):"radio"===t.type?Object(a.jsx)(pe,{index:n,title:t.question,response:c,answers:t.answers,returnAnswer:A,required:t.required},"profile_"+n):"time"===t.type?Object(a.jsx)(me,{index:n,title:t.question,response:c,returnAnswer:A,required:t.required},"profile_"+n):"checkbox"===t.type?Object(a.jsx)(ke,{index:n,title:t.question,response:c,answers:t.answers,returnAnswer:A,required:t.required},"profile_"+n):null}));x(n)}))}))}),[U]);var A=function(e,t){var n=l;n[t]=e,d(n),console.log(l)};return U?Object(a.jsxs)(p.a,{style:{padding:30},children:[C&&Object(a.jsx)(h.a,{to:"/"}),m,Object(a.jsxs)(p.a,{container:!0,style:{padding:20},justify:"center",children:[Object(a.jsx)(I.a,{variant:"outlined",style:{borderWidth:2,borderColor:"#003366",color:"#003366",margin:10},onClick:function(){var e={};n.forEach((function(t,n){l[n]&&(e[t.key]=l[n])})),j.firestore().collection("users").doc(U.uid).update(Object(g.a)({},e)).then((function(){return _(!0)}))},children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"}),k&&Object(a.jsx)(I.a,{variant:"outlined",style:{borderWidth:2,borderColor:"red",color:"red",margin:10},onClick:function(){return q(!0)},children:"\u041d\u0430 \u0433\u043b\u0430\u0432\u043d\u0443\u044e"})]})]}):Object(a.jsxs)(p.a,{container:!0,direction:"column",style:{padding:20},justify:"center",children:[Object(a.jsx)(F.a,{align:"center",variant:"h3",children:"\u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044c"}),Object(a.jsx)("br",{}),Object(a.jsx)(I.a,{variant:"contained",onClick:u,children:"\u0412\u043e\u0439\u0442\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google"})]})},we=n(116),Se=n(267),Ce=n(870),qe=n(864),Ee=n(861),Ie=n(863),Fe=n(862),De=Object(D.a)({root:{minWidth:250},bullet:{display:"inline-block",margin:"0 2px"},title:{fontSize:14},pos:{marginBottom:12}}),Te=function(e){var t=De(),n=e.title,r=e.complete,s=e.type,i=(e.language,e.description),l=e.id,d=e.cardColor,u=e.sendRequest,j=e.disabled,b=Object(c.useState)(!1),f=Object(o.a)(b,2),O=f[0],p=f[1];return Object(a.jsxs)("div",{children:[O&&Object(a.jsx)(h.a,{to:"/tasks/"+l}),Object(a.jsxs)(Ee.a,{className:t.root,style:{background:d},children:[Object(a.jsxs)(Fe.a,{children:[Object(a.jsxs)(M.a,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[Object(a.jsx)(F.a,{variant:"h6",children:n}),r&&Object(a.jsx)(F.a,{color:"error",children:"\u0421\u0434\u0430\u043d\u043e"})]}),Object(a.jsxs)(F.a,{variant:"subtitle1",className:t.pos,color:"textSecondary",children:["#",s]}),Object(a.jsxs)(F.a,{variant:"body2",component:"p",children:["\u0417\u0430\u0434\u0430\u043d\u0438\u0435: ",i]})]}),Object(a.jsx)(Ie.a,{children:u?Object(a.jsx)(I.a,{variant:"contained",disabled:j,color:"primary",size:"small",onClick:function(){return u(s,l)},children:"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435"}):Object(a.jsx)(I.a,{size:"small",onClick:function(){return p(!0)},children:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"})})]})]})};function Ue(e){var t=e.children,n=e.value,c=e.index,r=Object(we.a)(e,["children","value","index"]);return Object(a.jsx)("div",Object(g.a)(Object(g.a)({role:"tabpanel",hidden:n!==c,id:"full-width-tabpanel-".concat(c),"aria-labelledby":"full-width-tab-".concat(c)},r),{},{children:n===c&&Object(a.jsx)(M.a,{p:3,children:Object(a.jsx)(F.a,{children:t})})}))}function Ae(e){return{id:"full-width-tab-".concat(e),"aria-controls":"full-width-tabpanel-".concat(e)}}var Pe=Object(D.a)({root:{paddingTop:30,flexGrow:1}}),We=function(e){var t=Pe(),n=Object(c.useState)(null),r=Object(o.a)(n,2),s=r[0],i=r[1],l=Object(c.useState)(null),d=Object(o.a)(l,2),u=d[0],f=d[1],O=Object(c.useState)(null),h=Object(o.a)(O,2),m=(h[0],h[1],Object(c.useContext)(b).currentUser),x=Object(c.useState)(0),v=Object(o.a)(x,2),y=v[0],k=v[1];Object(c.useEffect)((function(){if(m){var e=[],t=[];console.log("Fired"),j.firestore().collection("tasks").where("assigned_users","array-contains",m.uid).get().then((function(n){n.forEach((function(n){console.log(n.id," => ",n.data()),n.data().is_complete?t.push(Object(g.a)({id:n.id},n.data())):e.push(Object(g.a)({id:n.id},n.data()))}))})).then((function(){i(e),f(t)})).catch((function(e){console.log("Error getting documents: ",e)}))}}),[m]);return Object(a.jsxs)(p.a,{container:!0,justify:"center",alignItems:"center",direction:"column",children:[Object(a.jsx)("div",{className:t.root,children:Object(a.jsx)(Se.a,{position:"static",color:"default",children:Object(a.jsxs)(Ce.a,{value:y,onChange:function(e,t){k(t)},variant:"fullWidth",centered:!0,"aria-label":"simple tabs example",children:[Object(a.jsx)(qe.a,Object(g.a)({label:"\u041d\u0435\u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435"},Ae(0))),Object(a.jsx)(qe.a,Object(g.a)({label:"\u0412\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435"},Ae(1)))]})})}),Object(a.jsx)(Ue,{value:y,index:0,children:s&&s.map((function(e,t){return Object(a.jsx)(p.a,{style:{padding:10},children:Object(a.jsx)(Te,{title:e.title,complete:e.is_complete,description:e.description,type:e.type,id:e.id})},"active_task_"+t)}))}),Object(a.jsx)(Ue,{value:y,index:1,children:u&&u.map((function(e,t){return Object(a.jsx)(p.a,{style:{padding:10},children:Object(a.jsx)(Te,{title:e.title,complete:e.is_complete,description:e.description,type:e.type,id:e.id})},"submitted_task_"+t)}))})]})},Ne=n(25);var Be=function(e){var t=e.title;return Object(a.jsx)("div",{children:Object(a.jsx)(F.a,{variant:"h6",style:{marginBottom:0,marginTop:20},children:t})})},ze=Object(c.forwardRef)((function(e,t){var n=e.question,c=e.index,r=e.response,s=e.uploadsRef,i=e.returnAnswer,o=e.locked,l=e.askFeedback,d=e.saveQuestionFeedback,u=e.id,j=e.prevTaskId,b=e.returnFile,f=e.uploadFilesData;return"input"===n.type?Object(a.jsx)(ue,{index:c,title:n.title,response:r,returnAnswer:i,required:n.required,locked:o,askFeedback:l,feedbackType:n.feedback_type,saveQuestionFeedback:d,id:u,prevTaskId:j,uploadFilesData:f,uploadsRef:s,returnFile:b,attachMaterials:n.attachMaterials},c):"select"===n.type?Object(a.jsx)(he,{index:c,title:n.title,response:r,answers:n.answers,returnAnswer:i,required:n.required,locked:o},c):"radio"===n.type?Object(a.jsx)(pe,{index:c,title:n.title,response:r,answers:n.answers,returnAnswer:i,required:n.required,locked:o},c):"time"===n.type?Object(a.jsx)(me,{index:c,title:n.title,response:r,returnAnswer:i,required:n.required,locked:o},c):"checkbox"===n.type?Object(a.jsx)(ke,{index:c,title:n.title,response:r,answers:n.answers,returnAnswer:i,required:n.required,locked:o},c):"text"===n.type?Object(a.jsx)(Be,{title:n.title},c):"file"===n.type?Object(a.jsx)(le,{index:c,id:u,title:n.title,returnFile:b,locked:o,askFeedback:l,feedbackType:n.feedback_type,saveQuestionFeedback:d,prevTaskId:j},c):null}));function Re(e){return Object(a.jsx)("div",{children:Object(a.jsxs)(V.a,{open:e.state,onClose:e.handleClose,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[Object(a.jsx)(K.a,{id:"alert-dialog-title",children:e.title}),Object(a.jsx)(H.a,{children:Object(a.jsx)(J.a,{id:"alert-dialog-description",children:e.content})}),e.hideActions?"":e.showOk?Object(a.jsx)(Q.a,{children:Object(a.jsx)(I.a,{onClick:e.handleOk,color:"primary",children:"Ok"})}):Object(a.jsxs)(Q.a,{children:[Object(a.jsx)(I.a,{onClick:e.handleClose,color:"primary",children:"\u041e\u0442\u043c\u0435\u043d\u0430"}),Object(a.jsx)(I.a,{onClick:e.dialogFunction,color:"primary",autoFocus:!0,children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})})}var Me=n(875),Le=n(141),Ge=n.n(Le),Ve=function(){var e=Object(c.useState)([]),t=Object(o.a)(e,2),n=t[0],s=t[1],i=Object(c.useState)([]),l=Object(o.a)(i,2),d=(l[0],l[1]),f=Object(c.useState)({}),O=Object(o.a)(f,2),m=O[0],x=O[1],v=Object(c.useState)([]),y=Object(o.a)(v,2),k=y[0],_=y[1],S=Object(c.useState)(!1),C=Object(o.a)(S,2),q=C[0],E=C[1],D=Object(c.useState)(!1),T=Object(o.a)(D,2),U=T[0],A=(T[1],Object(c.useState)({})),P=Object(o.a)(A,2),W=(P[0],P[1],Object(c.useState)(!1)),N=Object(o.a)(W,2),B=N[0],z=N[1],R=Object(c.useState)([]),M=Object(o.a)(R,2),L=(M[0],M[1]),G=Object(c.useState)(!1),V=Object(o.a)(G,2),Q=V[0],H=V[1],J=Object(c.useState)(null),K=Object(o.a)(J,2),Y=K[0],X=K[1],Z=Object(c.useState)({}),$=Object(o.a)(Z,2),ee=$[0],ne=$[1],se=Object(c.useState)({}),ie=Object(o.a)(se,2),oe=ie[0],le=ie[1],de=Object(c.useState)(!1),ue=Object(o.a)(de,2),je=ue[0],be=ue[1],fe=Object(c.useState)({}),Oe=Object(o.a)(fe,2),he=Oe[0],pe=Oe[1],ge=Object(c.useState)(!1),me=Object(o.a)(ge,2),xe=me[0],ve=me[1],ye=Object(c.useContext)(b).currentUser,ke=Object(h.h)().id,_e=Object(h.g)(),we=function(e,t){"clickaway"!==t&&be(!1)};Object(c.useEffect)((function(){var e=function(){var e=Object(ce.a)(ae.a.mark((function e(t){var n;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],e.next=3,j.firestore().collection("tasks").doc(t).collection("questions").get().then((function(e){e.forEach((function(e){n.push({questionId:e.id,data:e.data()})}))})).catch((function(e){console.log("Error getting documents: ",e)}));case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t=function(){var e=Object(ce.a)(ae.a.mark((function e(t){var n;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],e.next=3,j.firestore().collection("tasks").doc(t).collection("responses").get().then((function(e){e.forEach((function(e){n.push({responseId:e.id,data:e.data()})}))})).catch((function(e){console.log("Error getting documents: ",e)}));case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n=function(){var e=Object(ce.a)(ae.a.mark((function e(){var t;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,j.firestore().collection("tasks").doc(ke).get().then((function(e){return e.data()})).then(function(){var e=Object(ce.a)(ae.a.mark((function e(n){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.firestore().collection("tasks").where("case_id","==",n.case_id).get().then((function(e){e.forEach((function(e){e.id!==ke&&t.push(Object(g.a)({id:e.id},e.data()))}))}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();ye&&function(){var c=Object(ce.a)(ae.a.mark((function c(){var r,i,o,l,u,b,f,O,h,p,g;return ae.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return r=[],i=!0,_(null),c.next=5,j.firestore().collection("tasks").doc(ke).collection("user_editable").doc("user_editable").get().then((function(e){"complete"===e.data().status?(i=!0,z(!0)):i=!1}));case 5:return o=[],l=[],c.next=9,n();case 9:if(u=c.sent,L(u),!(u.length>0)){c.next=21;break}return b=u.map((function(t){return e(t.id)})),f=u.map((function(e){return t(e.id)})),console.log(b),c.next=17,Promise.all(b).then((function(e){return e.forEach((function(e){return o.push.apply(o,Object(Ne.a)(e))}))}));case 17:return c.next=19,Promise.all(f).then((function(e){return e.forEach((function(e){return l.push.apply(l,Object(Ne.a)(e))}))}));case 19:console.log(o),console.log(l);case 21:return(O=o.map((function(e,t){var n=null;return l.forEach((function(a){e.questionId===a.responseId&&(n=a.data.answer,Se(a.data.answer,t))})),Object(a.jsx)(ze,{question:e.data,index:t,response:n,returnAnswer:Se,locked:!0,askFeedback:!0,saveQuestionFeedback:Ee,id:e.questionId,prevTaskId:u[0].id},e.questionId+"_"+t)}))).push(Object(a.jsx)("div",{style:{height:25,margin:"20px 0",background:"repeating-linear-gradient( 45deg, white, white 10px, grey 10px, grey 25px)"},children:Object(a.jsx)("br",{})},"div_divider_stripped")),c.next=25,e(ke);case 25:return h=c.sent,c.next=28,t(ke);case 28:p=c.sent,s(h),d(p),r=h.map((function(e,t){var n=null;return p.forEach((function(a){e.questionId===a.responseId&&(n=a.data.answer,Se(a.data.answer,t))})),Object(a.jsx)(ze,{question:e.data,index:t,response:n,returnFile:Ce,returnAnswer:Se,id:e.questionId,locked:i,uploadFilesData:Fe},e.questionId+"_"+t)})),g=O.concat(r),_(g);case 34:case"end":return c.stop()}}),c)})));return function(){return c.apply(this,arguments)}}()()}),[ye,ke,B]);var Se=function(e,t){var n=m;n[t]=e,x(n)},Ce=function(e,t){var n=Object(Ne.a)(e),a=he;a[t]=n,pe(a),console.log(Object(Ne.a)(e),t)},qe=function(){var e=Object(ce.a)(ae.a.mark((function e(){var t,n,a;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Object.keys(he).length>0)){e.next=12;break}console.log("files"),ve(!0),t=ae.a.mark((function e(){var t,c,r,s;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(o.a)(a[n],2),c=t[0],r=t[1],s=j.storage().ref(ke).child(c).child(ye.uid),e.next=4,Promise.all(r.map(function(){var e=Object(ce.a)(ae.a.mark((function e(t){var n,a,r;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.child(t.name).put(t);case 2:return n=e.sent,e.next=5,n.ref.getDownloadURL();case 5:return a=e.sent,r=a.split("?")[0],e.next=9,Fe(t.name,r,c);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:case"end":return e.stop()}}),e)})),n=0,a=Object.entries(he);case 5:if(!(n<a.length)){e.next=10;break}return e.delegateYield(t(),"t0",7);case 7:n++,e.next=5;break;case 10:E(!0),ve(!1);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ee=function(e,t,n){n?j.firestore().collection("tasks").doc(n).collection("feedbacks").doc(t).collection("messages").add({answer:e.reason,text:e.text,user_id:ye.uid,timestamp:j.firestore.FieldValue.serverTimestamp()}).then((function(){return be(!0)})):alert("\u041e\u0448\u0438\u0431\u043a\u0430: \u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a \u043f\u0440\u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0438 \u0444\u0438\u0434\u0431\u0435\u043a\u0430. \u0421\u043e\u043e\u0431\u0449\u0438\u0442\u0435 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0441\u0442\u0443!")},Ie=function(){var e=Object(ce.a)(ae.a.mark((function e(t){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,qe();case 2:if(n.forEach(function(){var e=Object(ce.a)(ae.a.mark((function e(t,n){return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!m[n]&&""!==m[n]){e.next=3;break}return e.next=3,j.firestore().collection("tasks").doc(ke).collection("responses").doc(t.questionId).set({answer:m[n]},{merge:!0});case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),!t){e.next=9;break}return e.next=6,j.firestore().collection("tasks").doc(ke).collection("user_editable").doc("user_editable").update({status:"complete"});case 6:z(!0),console.log("Task Locked"),H(!1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Fe=function(){var e=Object(ce.a)(ae.a.mark((function e(t,n,a){var c;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=j.firestore().collection("tasks").doc(ke).collection("responses").doc(a),console.log("\u0424\u0430\u0439\u043b \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d"),t&&n&&c.set({files:j.firestore.FieldValue.arrayUnion({public_url:n,filename:t})},{merge:!0}).then((function(){return console.log("super")}));case 3:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),De=function(){H(!1),ne({})},Te=function(e){"send"===e&&(X("send"),H(!0)),"release"===e&&(X("release"),H(!0))};Object(c.useEffect)((function(){j.firestore().collection("schema").doc("structure").collection("feedbacks").doc("release").get().then((function(e){le(e.data())}))}),[]);return ye?Object(a.jsxs)(p.a,{style:{padding:30},children:["send"===Y&&Object(a.jsx)(Re,{state:Q,handleClose:De,hideActions:xe||q,title:xe?"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0444\u0430\u0439\u043b\u043e\u0432":q?"\u0424\u0430\u0439\u043b\u044b \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u044b":"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435?",content:xe?Object(a.jsx)(re.a,{}):q?"\u0421\u043f\u0430\u0441\u0438\u0431\u043e":"\u0412\u044b \u0441\u043e\u0431\u0438\u0440\u0430\u0435\u0442\u0435\u0441\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435. \u042d\u0442\u043e \u0437\u043d\u0430\u0447\u0438\u0442, \u0447\u0442\u043e \u0432\u044b \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u0441\u043c\u043e\u0436\u0435\u0442\u0435 \u0438\u0437\u043c\u0435\u043d\u044f\u0442\u044c \u043e\u0442\u0432\u0435\u0442\u044b.",dialogFunction:function(){return Ie(!0)}}),"release"===Y&&Object(a.jsx)(te,{state:Q,feedbackValue:ee,handleClose:De,title:oe.title,dialogFunction:function(){j.firestore().collection("tasks").doc(ke).collection("user_editable").doc("user_editable").update({status:"open"}).then((function(){return j.firestore().collection("tasks").doc(ke).collection("user_editable").doc("user_editable").update({status:"released",release_status:ee.reason,release_description:ee.text}).then((function(){H(!1),z(!0)}))}))},answers:oe.answers,description:oe.description,returnFeedback:function(e){ne(e)}}),U&&Object(a.jsx)(h.a,{to:"/tasks"}),Object(a.jsx)(Me.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:je,autoHideDuration:6e3,onClose:we,message:"\u0424\u0438\u0434\u0431\u0435\u043a \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d",action:Object(a.jsx)(r.a.Fragment,{children:Object(a.jsx)(w.a,{size:"small","aria-label":"close",color:"inherit",onClick:we,children:Object(a.jsx)(Ge.a,{fontSize:"small"})})})}),k,Object(a.jsxs)(p.a,{container:!0,style:{padding:20},justify:"center",children:[Object(a.jsx)(I.a,{variant:"outlined",style:{borderWidth:2,borderColor:"grey",color:"grey",margin:5},onClick:function(){return _e.goBack()},children:"\u041d\u0430\u0437\u0430\u0434"}),!B&&Object(a.jsxs)("div",{children:[Object(a.jsx)(I.a,{variant:"outlined",disabled:B,style:{borderWidth:2,borderColor:"#003366",color:"#003366",margin:5},onClick:function(){return Ie(!1)},children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"}),Object(a.jsx)(I.a,{variant:"outlined",disabled:B,style:{borderWidth:2,borderColor:"red",color:"red",margin:5},onClick:function(){return Te("send")},children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"}),Object(a.jsx)(I.a,{variant:"outlined",disabled:B,style:{borderWidth:2,borderColor:"red",color:"red",margin:5},onClick:function(){return Te("release")},children:"\u041e\u0441\u0432\u043e\u0431\u043e\u0434\u0438\u0442\u044c"})]})]})]}):Object(a.jsxs)(p.a,{container:!0,direction:"column",style:{padding:20},justify:"center",children:[Object(a.jsx)(F.a,{align:"center",variant:"h3",children:"\u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044c"}),Object(a.jsx)("br",{}),Object(a.jsx)(I.a,{variant:"contained",onClick:u,children:"\u0412\u043e\u0439\u0442\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google"})]})},Qe=n(258),He=function(e){var t=e.caseId,n=e.userRanks,s=Object(c.useState)(null),i=Object(o.a)(s,2),l=i[0],d=i[1],u=Object(c.useState)(!1),f=Object(o.a)(u,2),O=f[0],h=f[1],m=Object(c.useContext)(b).currentUser,x=r.a.useState(!1),v=Object(o.a)(x,2),y=v[0],k=v[1],_=Object(c.useState)(!1),S=Object(o.a)(_,2),C=S[0],q=S[1],E=Object(c.useState)(""),I=Object(o.a)(E,2),D=I[0],T=I[1],U=function(e,t){"clickaway"!==t&&k(!1)};Object(c.useEffect)((function(){if(m){var e=[];console.log("Fired"),j.firestore().collection("schema").doc("structure").collection("cases").doc(t).collection("stages").get().then((function(t){t.forEach((function(t){var a=t.data().ranks;console.log("RANKS"),console.log(a),console.log(n),e.push(Object(g.a)(Object(g.a)({id:t.id},t.data()),{},{disabled:!1}))}))})).then((function(){e.sort((function(e,t){return parseInt(e.order)-parseInt(t.order)})),d(e),h(!0)})).catch((function(e){console.log("Error getting documents: ",e)}))}}),[m]),Object(c.useEffect)((function(){m&&j.firestore().collection("tasks").where("assigned_users","array-contains",m.uid).where("is_complete","==",!1).get().then((function(e){e.size<3?(console.log("SIZE",e.size),q(!1)):(q(!0),T(Object(a.jsx)(F.a,{color:"error",children:"\u0423 \u0432\u0430\u0441 \u0435\u0441\u0442\u044c \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0435 \u0437\u0430\u0434\u0430\u043d\u0438\u044f. \u0421\u0434\u0430\u0439\u0442\u0435 \u0438\u043b\u0438 \u043e\u0441\u0432\u043e\u0431\u043e\u0434\u0438\u0442\u0435 \u0438\u0445, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043d\u043e\u0432\u044b\u0435."})))}))}),[m,C,y]);var A=function(e,n){j.firestore().collection("task_requests").doc(m.uid).collection("requests").add({taskType:e,status:"pending",user:m.uid,case_type:t,case_stage_id:n}).then((function(e){k(!0),console.log("sending request")}))};return Object(a.jsxs)("div",{children:[Object(a.jsx)(Me.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:y,autoHideDuration:6e3,onClose:U,message:"\u0417\u0430\u043f\u0440\u043e\u0441 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d",action:Object(a.jsx)(r.a.Fragment,{children:Object(a.jsx)(w.a,{size:"small","aria-label":"close",color:"inherit",onClick:U,children:Object(a.jsx)(Ge.a,{fontSize:"small"})})})}),Object(a.jsxs)(Se.a,{style:{margin:"20px 5px",border:"1px grey solid"},children:[Object(a.jsxs)(M.a,{style:{padding:"10px 20px 0px"},children:[Object(a.jsx)(M.a,{style:{padding:"5px 10px 10px"},children:Object(a.jsx)(F.a,{variant:"h6",children:e.title})}),Object(a.jsx)(M.a,{style:{padding:"10px 10px 5px"},children:Object(a.jsx)(F.a,{variant:"body2",children:e.description})}),Object(a.jsx)(M.a,{style:{padding:"10px 10px 0px"},children:D})]}),Object(a.jsx)(p.a,{container:!0,justify:"center",style:{padding:10},children:O&&l.map((function(e,t){return Object(a.jsx)(p.a,{item:!0,style:{padding:10},children:Object(a.jsx)(Te,{title:e.title,description:e.description,type:e.type,id:e.id,cardColor:"#F5F5F5",sendRequest:A,disabled:C||e.disabled})},t)}))})]})]})},Je=function(){var e=Object(c.useContext)(b).currentUser,t=Object(c.useState)([]),n=Object(o.a)(t,2),r=n[0],s=n[1],i=Object(c.useState)(!1),l=Object(o.a)(i,2),d=l[0],u=l[1],f=Object(c.useState)([]),O=Object(o.a)(f,2),h=O[0],p=O[1];Object(c.useEffect)((function(){e&&j.firestore().collection("users").doc(e.uid).collection("user_private").doc("private").get().then((function(e){if(e&&e.exists){var t=e.data().ranks;console.log(t),p(t),m(t)}}))}),[e]);var m=function(e){var t=[];console.log("Fired"),j.firestore().collection("schema").doc("structure").collection("cases").where("ranks","array-contains-any",e).get().then((function(e){e.forEach((function(e){console.log(e.data()),t.push(Object(g.a)({id:e.id},e.data()))}))})).then((function(){s(t),u(!0)})).catch((function(e){console.log("Error getting documents: ",e)}))};return Object(a.jsx)("div",{children:d&&r.map((function(e,t){return e.hide?null:Object(a.jsx)(He,{title:e.title,description:e.description,caseId:e.id,userRanks:h},t)}))})},Ke=Object(D.a)((function(e){return{root:Object(m.a)({margin:20,width:500},e.breakpoints.down("sm"),{maxWidth:300}),bullet:{display:"inline-block",margin:"0 2px"},title:{fontSize:14},pos:{marginBottom:12}}})),Ye=function(e){var t,n=Ke(),c=e.title,r=e.description,s=e.id,i=e.setShown,o=e.shown,l=e.date;return Object(a.jsx)(p.a,{container:!0,justify:"center",children:Object(a.jsxs)(Ee.a,{className:n.root,style:o?{background:"grey",opacity:.25}:{background:"lightblue"},children:[Object(a.jsxs)(Fe.a,{children:[Object(a.jsx)(F.a,{variant:"h6",children:c}),Object(a.jsx)(F.a,{variant:"body2",component:"p",children:r})]}),Object(a.jsxs)(Ie.a,{style:{justifyContent:"space-between"},children:[Object(a.jsx)(F.a,{style:{paddingLeft:8},variant:"subtitle2",children:(t=l.toDate(),"".concat(t.getDate().toString().padStart(2,"0"),"/").concat((t.getMonth()+1).toString().padStart(2,"0"),"/").concat(t.getFullYear().toString().padStart(4,"0")," ").concat(t.getHours().toString().padStart(2,"0"),":").concat(t.getMinutes().toString().padStart(2,"0"),":").concat(t.getSeconds().toString().padStart(2,"0")))}),Object(a.jsx)(I.a,{size:"small",onClick:function(){return i(s)},children:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u043d\u043e"})]})]})})},Xe=function(){var e=Object(c.useContext)(b).currentUser,t=Object(c.useState)([]),n=Object(o.a)(t,2),r=n[0],s=n[1],i=function(e){j.firestore().collection("notifications").doc(e).update({shown:!0})};return Object(c.useEffect)((function(){if(e){var t=j.firestore().collection("notifications").where("user_id","array-contains",e.uid).onSnapshot(function(){var e=Object(ce.a)(ae.a.mark((function e(t){var n;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],t.forEach((function(e,t){n.push(Object(g.a)({id:e.id},e.data()))})),console.log(n[0].created_date.toDate()),n.sort((function(e,t){return t.created_date.toDate()-e.created_date.toDate()})),s(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());return function(){return t()}}}),[e]),Object(a.jsxs)("div",{children:[Object(a.jsx)(F.a,{variant:"h5",align:"center",children:"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f"}),r.map((function(e,t){return Object(a.jsx)(Ye,{id:e.id,index:t,date:e.created_date,title:e.title,setShown:i,shown:e.shown,description:e.description},t)}))]})},Ze=n(381),$e=n.n(Ze),et=n(865),tt=n(866),nt=n(452),at=Object(D.a)((function(e){return{root:Object(m.a)({marginTop:20,background:"lightgreen",width:500},e.breakpoints.down("sm"),{maxWidth:300}),message:Object(m.a)({background:"lightgreen",width:500,margin:10,padding:10},e.breakpoints.down("sm"),{maxWidth:300})}})),ct=function(e){var t=at(),n=Object(c.useState)(null),r=Object(o.a)(n,2),s=r[0],i=r[1],l=Object(c.useContext)(b).currentUser,d=Object(c.useState)(""),f=Object(o.a)(d,2),O=f[0],h=f[1];return Object(c.useEffect)((function(){var e=function(){return Object(et.a)().toString()+"_"+Date.now()},t=function(){},n=function(){};return l&&(t=j.firestore().collection("users").doc(l.uid).onSnapshot((function(t){var n;if(n=!(!t.exists||!t.data().tg_token)&&t.data().tg_token,console.log(n),n){console.log(n);var a=parseInt(n.substring(n.indexOf("_")+1)),c=$e()().diff(a,"hours");if(console.log(c),c>0){var r=e();j.firestore().collection("users").doc(l.uid).update({tg_token:r}),i(r)}else i(n)}else{console.log("no token");var s=e();j.firestore().collection("users").doc(l.uid).update({tg_token:s}),i(s)}})),n=j.firestore().collection("users").doc(l.uid).collection("user_private").doc("private").onSnapshot((function(e){console.log("TGID: ",e.data().tg_id),e.exists&&"tg_id"in e.data()&&(console.log("TGID: ",e.data().tg_id),h(e.data().tg_id))}))),function(){t(),n()}}),[l]),Object(c.useEffect)((function(){if(l){var e=nt.parse(window.location.search);e.rank&&(console.log(e.rank),j.firestore().collection("schema").doc("structure").collection("ranks").doc(e.rank).get().then((function(e){e.exists?(console.log("creating request"),j.firestore().collection("rank_requests").add({timestamp:j.firestore.FieldValue.serverTimestamp(),user_id:l.uid,processed:!1,rank:e.id})):console.log("no rank")})))}}),[l]),l?Object(a.jsxs)(p.a,{children:[Object(a.jsxs)(p.a,{container:!0,className:t.message,children:[Object(a.jsx)(F.a,{children:"\u0417\u0434\u0440\u0430\u0432\u0441\u0442\u0432\u0443\u0439\u0442\u0435, \u0434\u043e\u0440\u043e\u0433\u0438\u0435 \u043d\u0430\u0431\u043b\u044e\u0434\u0430\u0442\u0435\u043b\u0438! \u041c\u044b \u0440\u0430\u0434\u044b \u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u0432\u0430\u0441 \u0432 \u043d\u0430\u0448\u0438\u0445 \u0440\u044f\u0434\u0430\u0445!"}),Object(a.jsxs)(F.a,{children:["\u0415\u0441\u043b\u0438 \u0432\u044b \u043d\u0435 \u0437\u043d\u0430\u0435\u0442\u0435, \u043a\u0430\u043a \u0437\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0430\u043d\u043a\u0435\u0442\u0443, \u0442\u043e \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0438\u0442\u0435 ",Object(a.jsx)(tt.a,{href:"https://www.youtube.com/watch?v=bkukGAemNTY&feature=youtu.be",children:"\u043d\u0430\u0448\u0435 \u0432\u0438\u0434\u0435\u043e"})]}),Object(a.jsxs)(F.a,{children:["\u0427\u0442\u043e\u0431\u044b \u043f\u043e\u043d\u044f\u0442\u044c, \u043a\u0430\u043a \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0431\u043e\u0442 \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0438\u0442\u0435 \u043d\u0430\u0448\u0443 ",Object(a.jsx)(tt.a,{href:"https://www.youtube.com/watch?v=jJX5uMqqC7Q&feature=youtu.be",children:"\u0432\u0438\u0434\u0435\u043e-\u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044e"})]}),Object(a.jsx)(F.a,{children:"\u0427\u0442\u043e\u0431\u044b \u0432\u0441\u0435 \u043d\u0430\u0447\u0430\u043b\u043e \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c, \u0432\u0430\u043c \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432 \u0441\u0430\u043c\u043e\u043c \u043d\u0430\u0447\u0430\u043b\u0435 \u043d\u0430\u0436\u0430\u0442\u044c \u043d\u0430 \u043a\u043d\u043e\u043f\u043a\u0443 \u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0440\u0430\u043d\u0433 El-Monitor"}),Object(a.jsxs)(F.a,{children:["\u0427\u0442\u043e\u0431\u044b \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u043a\u0430\u0436\u0434\u044b\u0439 \u0434\u0435\u043d\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u044f \u043e\u0442 \u043d\u0430\u0441, \u043f\u0435\u0440\u0435\u0439\u0434\u0438\u0442\u0435 \u0432 \u0440\u0430\u0437\u0434\u0435\u043b ",Object(a.jsx)(tt.a,{href:"https://kloopmedia.github.io/Journal/#/p/test_page",children:"\u0422\u0435\u0441\u0442"})]}),Object(a.jsxs)(F.a,{children:["\u0427\u0442\u043e\u0431\u044b \u043f\u043e\u043d\u044f\u0442\u044c, \u043a\u0430\u043a \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u0442\u0435\u0441\u0442\u044b \u0438 \u043a\u0430\u043a \u0437\u0430\u043f\u043e\u043b\u043d\u044f\u0442\u044c \u0444\u043e\u0440\u043c\u044b \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0438\u0442\u0435 \u043d\u0430\u0448\u0443 ",Object(a.jsx)(tt.a,{href:"https://www.youtube.com/watch?v=V4U8JFOzLFo",children:"\u0432\u0438\u0434\u0435\u043e-\u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044e"})]})]}),""===O?Object(a.jsxs)(p.a,{container:!0,justify:"center",className:t.message,children:[Object(a.jsx)(F.a,{style:{paddingBottom:10},variant:"h5",align:"center",children:"\u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0441\u0432\u044f\u0437\u0430\u0442\u044c \u0441\u0432\u043e\u0439 \u0430\u043a\u043a\u0430\u0443\u043d\u0442 \u0441 \u043d\u0430\u0448\u0438\u043c \u0422\u0435\u043b\u0435\u0433\u0440\u0430\u043c-\u0431\u043e\u0442\u043e\u043c. \u0414\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043d\u0430\u0436\u043c\u0438\u0442\u0435 \u043d\u0430 \u0441\u0441\u044b\u043b\u043a\u0443 \u043d\u0438\u0436\u0435."}),s?Object(a.jsx)(tt.a,{variant:"h5",href:"https://telegram.me/journal_tg_bot?start="+s,children:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0431\u043e\u0442"}):Object(a.jsx)(F.a,{variant:"body2",align:"center",children:"\u0415\u0441\u043b\u0438 \u0441\u0441\u044b\u043b\u043a\u0430 \u043d\u0435 \u0441\u043e\u0437\u0434\u0430\u043b\u0430\u0441\u044c \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 5 \u0441\u0435\u043a\u0443\u043d\u0434, \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443"})]}):null]}):Object(a.jsxs)(p.a,{container:!0,direction:"column",style:{padding:20},justify:"center",children:[Object(a.jsx)(F.a,{align:"center",variant:"h3",children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"}),Object(a.jsx)("br",{}),Object(a.jsx)(I.a,{size:"large",color:"primary",variant:"contained",onClick:u,children:"\u0412\u043e\u0439\u0442\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google"})]})},rt=Object(D.a)({root:{minWidth:275},bullet:{display:"inline-block",margin:"0 2px",transform:"scale(0.8)"},title:{fontSize:14},pos:{marginBottom:12}});function st(e){var t=rt();return console.log("TEST CARD"),console.log(e),e.userInfo=={}?Object(a.jsx)("div",{}):Object(a.jsx)(Ee.a,{className:t.root,variant:"outlined",children:Object(a.jsxs)(Fe.a,{children:[Object(a.jsxs)(F.a,{className:t.title,color:"textSecondary",gutterBottom:!0,children:["id: ",e.userInfo.id]}),Object(a.jsx)(F.a,{variant:"h5",component:"h2",children:e.userInfo.surname+" "+e.userInfo.name}),Object(a.jsxs)(F.a,{className:t.pos,color:"textSecondary",children:["\u0420\u0435\u0433\u0438\u043e\u043d: ",e.userInfo.district]}),Object(a.jsx)(F.a,{variant:"body2",component:"p",children:e.userInfo.phone}),Object(a.jsx)(F.a,{variant:"body2",component:"p",children:e.userInfo.email})]})})}var it=n(96),ot=function(e){var t=Object(c.useState)({}),n=Object(o.a)(t,2),r=n[0],s=n[1],i=function(){var t=Object(ce.a)(ae.a.mark((function t(n){return ae.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(n.map(function(){var t=Object(ce.a)(ae.a.mark((function t(n){var a;return ae.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=e.storageRef.child(n.name).put(n),s((function(e){var t=Object(m.a)({},n.name,{status:"loading",progress:0});return e?Object(g.a)(Object(g.a)({},e),t):t})),a.on(l.a.storage.TaskEvent.STATE_CHANGED,(function(e){var t=e.bytesTransferred/e.totalBytes*100;switch(s((function(e){var a=Object(m.a)({},n.name,{status:"loading",progress:t});return e?Object(g.a)(Object(g.a)({},e),a):a})),console.log("Upload is "+t+"% done"),e.state){case l.a.storage.TaskState.PAUSED:console.log("Upload is paused");break;case l.a.storage.TaskState.RUNNING:console.log("Upload is running")}}),(function(e){e.code}),(function(){a.snapshot.ref.getDownloadURL().then(function(){var t=Object(ce.a)(ae.a.mark((function t(a){var c;return ae.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=a,e.secure&&(r=a.split("?")[0],c=r.replace("https://firebasestorage.googleapis.com/v0/b/journal-bb5e3.appspot.com/o","https://storage.cloud.google.com/journal-bb5e3.appspot.com")+"?authuser=1"),t.next=4,e.filesLinks.set({contents:Object(m.a)({},c,{name:n.name,url:c})},{merge:e.allowMultipleFiles});case 4:s((function(e){var t=Object.assign({},e);return delete t[n.name],t})),console.log("File available at",c);case 6:case"end":return t.stop()}var r}),t)})));return function(e){return t.apply(this,arguments)}}())}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(a.jsxs)("div",{children:[Object(a.jsx)("input",{type:"file",onChange:function(e){console.log("Files selected: ",Object(Ne.a)(e.target.files)),i(Object(Ne.a)(e.target.files))},multiple:e.allowMultipleFiles}),Object.keys(r).map((function(e){return Object(a.jsxs)("div",{children:[Object(a.jsx)("p",{children:e}),Object(a.jsx)(ie,{value:r[e].progress})]},e)}))]})},lt=function(e){console.log("All props: ",e),console.log("ID: ",e.taskID),console.log("Question ID: ",e.name),console.log("User UID: ",e.currentUserUid);var t=Object(c.useState)(!1),n=Object(o.a)(t,2),r=n[0],s=n[1],i=Object(c.useState)(!1),l=Object(o.a)(i,2),d=l[0],u=l[1],b=null,f=null;e.disabled||(b=j.storage().ref(e.taskID).child(e.name).child(e.currentUserUid),f=function(){var t=Object(ce.a)(ae.a.mark((function t(){return ae.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s(!0),t.next=3,j.firestore().collection("users").doc(e.currentUserUid).set({fileUpload:e.taskID+"/"+e.name},{merge:!0});case 3:s(!1),u(!0);case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}());var O=j.firestore().collection("tasks").doc(e.taskID).collection("responses").doc(e.name);return console.log("Props formData: ",e.formData),Object(a.jsxs)("div",{children:[e.schema.title?Object(a.jsx)("div",{children:e.schema.title}):Object(a.jsx)("div",{}),e.schema.description?Object(a.jsx)("div",{children:e.schema.description}):Object(a.jsx)("div",{}),e.disabled?null:Object(a.jsxs)("div",{children:[Object(a.jsx)(ot,{storageRef:b,allowMultipleFiles:!(!e.stage||!e.stage.allowMultipleFiles)&&e.stage.allowMultipleFiles,secure:!(!e.stage||!e.stage.cleanFileLink)&&e.stage.cleanFileLink,filesLinks:O}),r?Object(a.jsx)(re.a,{}):d?Object(a.jsxs)("div",{children:['\u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u043d\u0430\u0447\u0430\u0442\u044c \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0443 \u0444\u0430\u0439\u043b\u043e\u0432 \u0447\u0435\u0440\u0435\u0437 \u0431\u043e\u0442\u0430. \u0412\u0441\u0435 \u0444\u0430\u0439\u043b\u044b, \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c\u044b\u0435 \u0431\u043e\u0442\u0443, \u0431\u0443\u0434\u0443\u0442 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0442\u044c\u0441\u044f \u0437\u0434\u0435\u0441\u044c. \u041f\u043e\u0441\u043b\u0435 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0444\u0430\u0439\u043b\u043e\u0432 \u0447\u0435\u0440\u0435\u0437 \u0431\u043e\u0442, \u043d\u0435 \u0437\u0430\u0431\u0443\u0434\u044c\u0442\u0435 \u0432\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u0441\u044e\u0434\u0430 \u0438 \u043d\u0430\u0436\u0430\u0442\u044c "\u041e\u0422\u041f\u0420\u0410\u0412\u0418\u0422\u042c". ',Object(a.jsx)("a",{href:"https://t.me/journal_tg_bot",children:"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u0431\u043e\u0442."})]}):Object(a.jsxs)("div",{children:[Object(a.jsx)("p",{children:"\u0412\u044b \u0442\u0430\u043a \u0436\u0435 \u043c\u043e\u0436\u0435\u0442\u0435 \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0441\u044e\u0434\u0430 \u0444\u0430\u0439\u043b\u044b \u0447\u0435\u0440\u0435\u0437 \u0422\u0435\u043b\u0435\u0433\u0440\u0430\u043c-\u0431\u043e\u0442\u0430. \u0414\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043d\u0430\u0436\u043c\u0438\u0442\u0435 \u043a\u043d\u043e\u043f\u043a\u0443 \u043d\u0438\u0436\u0435: "}),Object(a.jsx)("button",{onClick:f,children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0447\u0435\u0440\u0435\u0437 \u0431\u043e\u0442"})]})]}),e.formData?Object(a.jsx)("div",{children:Object.keys(e.formData).map((function(t){return Object(a.jsx)("div",{children:Object(a.jsx)("a",{href:e.formData[t].url,children:e.formData[t].name})},t)}))}):Object(a.jsx)("div",{})]})},dt=n(70),ut=function(e){var t=Object(c.useState)({}),n=Object(o.a)(t,2),r=n[0],s=n[1],i=Object(c.useState)({}),l=Object(o.a)(i,2),d=l[0],f=l[1],O=Object(c.useState)({}),h=Object(o.a)(O,2),x=h[0],v=h[1],y=Object(c.useState)({}),k=Object(o.a)(y,2),_=k[0],w=k[1],S=Object(c.useState)({}),C=Object(o.a)(S,2),q=C[0],E=C[1],D=Object(c.useState)(null),T=Object(o.a)(D,2),U=T[0],A=T[1],P=Object(c.useState)("loading"),W=Object(o.a)(P,2),N=W[0],B=W[1],z=Object(c.useContext)(b).currentUser,R=e.id;Object(c.useEffect)((function(){if(z&&R){var e=j.firestore().collection("tasks").doc(R);A(e),e.onSnapshot((function(e){w(e.data()),e.data().is_complete&&B("sent"),e.data().assigned_users.includes(z.uid)||B("released"),console.log("Task Metadata: ",e.data())})),e.collection("responses").onSnapshot((function(e){var t={},n=[],a=!1;e.docChanges().forEach((function(e){if("added"===e.type||"modified"===e.type){var c=e.doc.data().contents;t[e.doc.id]=c,a=!0}"removed"===e.type&&(console.log("Response Removed: ",e.doc.data()),n.push(e.doc.id),a=!0)})),a&&s((function(e){var a=Object(it.cloneDeep)(e);return n.forEach((function(e){return delete a[e]})),Object.keys(t).forEach((function(e){return a[e]=t[e]})),a}))})),e.collection("questions").onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||f((function(t){return Object(g.a)(Object(g.a)({},t),{},Object(m.a)({},e.doc.id,e.doc.data()))}))}))}))}}),[R,z]),Object(c.useEffect)((function(){Object.entries(_).length>0&&(console.log("Task metadata: ",_),j.firestore().collection("schema").doc("structure").collection("cases").doc(_.case_type).collection("stages").onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||(console.log("Case stage: ",e.doc.data()),E((function(t){return Object(g.a)(Object(g.a)({},t),{},Object(m.a)({},e.doc.id,e.doc.data()))}))),"removed"===e.type&&E((function(t){var n=Object.assign({},t);return delete n[e.doc.id],n}))}))})))}),[_]),Object(c.useEffect)((function(){v(M(d,q[_.case_stage_id]))}),[d,_,q]);var M=function(e,t){var n=Object.assign({},e),a=Object.assign({},t);a.start=a.start?a.start:{},a.end=a.end?a.end:{},a.start_ui_schema=a.start_ui_schema?a.start_ui_schema:{},a.end_ui_schema=a.end_ui_schema?a.end_ui_schema:{},n.form_questions=n.form_questions?n.form_questions:{},n.ui_schema=n.ui_schema?n.ui_schema:{};var c=Object(g.a)(Object(g.a)(Object(g.a)({},a.start.properties?a.start.properties:{}),a.end.properties?a.end.properties:{}),n.form_questions.properties?n.form_questions.properties:{}),r=Object(g.a)(Object(g.a)(Object(g.a)({},a.start.definitions?a.start.definitions:{}),a.end.definitions?a.end.definitions:{}),n.form_questions.definitions?n.form_questions.definitions:{}),s="";n.form_questions.title?s=n.form_questions.title:a.end.title?s=a.end.title:a.start.title&&(s=a.start.title);var i="";n.form_questions.description?i=n.form_questions.description:a.end.description?i=a.end.description:a.start.description&&(i=a.start.description);var o=Object(Ne.a)(new Set([].concat(Object(Ne.a)(a.start.required?a.start.required:[]),Object(Ne.a)(n.form_questions.required?n.form_questions.required:[]),Object(Ne.a)(a.end.required?a.end.required:[])))),l=Object(Ne.a)(new Set([].concat(Object(Ne.a)(a.start_ui_schema["ui:order"]?a.start_ui_schema["ui:order"]:[]),Object(Ne.a)(n.ui_schema["ui:order"]?n.ui_schema["ui:order"]:[]),Object(Ne.a)(a.end_ui_schema["ui:order"]?a.end_ui_schema["ui:order"]:[])))),d=Object(g.a)(Object(g.a)(Object(g.a)({},a.start_ui_schema?a.start_ui_schema:{}),a.end_ui_schema?a.end_ui_schema:{}),n.ui_schema?n.ui_schema:{});return{form_questions:{properties:c,definitions:r,title:s,description:i,required:o},ui_schema:d=Object(g.a)(Object(g.a)({},d),{"ui:order":l})}},L={customImageWidget:function(e){return console.log("PROPS",e),Object(a.jsx)("img",{src:e.value,alt:e.schema.title,style:{maxWidth:"100%",height:"auto"}})},customVideoWidget:function(e){return console.log("PROPS",e),Object(a.jsx)("video",{title:e.schema.title,style:{maxWidth:"100%",height:"auto"},controls:!0,children:Object(a.jsx)("source",{src:e.value,type:"video/mp4"})})},customIframeWidget:function(e){return console.log("PROPS",e),Object(a.jsx)("iframe",{title:e.schema.title,src:e.value,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}};return z?Object(a.jsx)(p.a,{style:{padding:30},children:x&&U&&q&&_&&_.case_stage_id&&q[_.case_stage_id]?Object(a.jsx)(dt.a,{schema:x.form_questions,uiSchema:x.ui_schema,formData:r,fields:{customFileUpload:function(e){return lt(Object(g.a)(Object(g.a)(Object(g.a)(Object(g.a)({},e),{taskID:R}),{currentUserUid:z.uid}),{stage:q[_.case_stage_id]}))}},disabled:"loading"===N||"sent"===N||"released"===N,widgets:L,noHtml5Validate:!0,onChange:function(e){!function(e){s(e.formData)}(e)},children:Object(a.jsx)(a.Fragment,{})}):null}):Object(a.jsxs)(p.a,{container:!0,direction:"column",style:{padding:20},justify:"center",children:[Object(a.jsx)(F.a,{align:"center",variant:"h3",children:"\u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044c"}),Object(a.jsx)("br",{}),Object(a.jsx)(I.a,{variant:"contained",onClick:u,children:"\u0412\u043e\u0439\u0442\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google"})]})},jt=function(e){var t=r.a.useState([]),n=Object(o.a)(t,2),s=(n[0],n[1],Object(c.useState)({})),i=Object(o.a)(s,2),l=i[0],d=i[1],u={},b=Object(c.useState)([]),f=Object(o.a)(b,2),O=(f[0],f[1]),h=Object(c.useState)([]),g=Object(o.a)(h,2),m=(g[0],g[1]),x=Object(c.useState)({}),v=Object(o.a)(x,2),y=v[0],k=v[1],_=Object(c.useState)(Object(a.jsx)("div",{})),w=Object(o.a)(_,2),S=(w[0],w[1]),C=Object(c.useState)(!1),q=Object(o.a)(C,2),E=(q[0],q[1]),I=Object(c.useState)(!1),F=Object(o.a)(I,2),D=(F[0],F[1]),T=Object(c.useState)(!1),U=Object(o.a)(T,2),A=(U[0],U[1]),P=Object(c.useState)(!1),W=Object(o.a)(P,2),N=(W[0],W[1]),B=Object(c.useState)(!1),z=Object(o.a)(B,2),R=(z[0],z[1]),M=function(){var t=Object(ce.a)(ae.a.mark((function t(){return ae.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:j.firestore().collection("tasks").doc(e.task.id).get().then((function(e){var t=e.data().review_status;E("pending"===t),D("passed"===t),A("not passed"===t),N("verified"===t),R("not verified"===t)}));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();Object(c.useEffect)((function(){var t=function(){var t=Object(ce.a)(ae.a.mark((function t(){var n,c,r,s;return ae.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],c=[],r=[],s=!0,console.log("HOOK"),M(),t.next=8,j.firestore().collection("tasks").doc(e.task.id).get().then((function(e){d(e.data())})).catch((function(e){console.log("Error getting documents: ",e)}));case 8:return t.next=10,j.firestore().collection("tasks").doc(e.task.id).collection("questions").get().then((function(e){e.forEach((function(e){n.push({questionId:e.id,data:e.data()})}))})).then((function(){O(n)})).catch((function(e){console.log("Error getting documents: ",e)}));case 10:return t.next=12,j.firestore().collection("tasks").doc(e.task.id).collection("responses").get().then((function(e){e.forEach((function(e){c.push({responseId:e.id,data:e.data()})}))})).then((function(){m(c)})).catch((function(e){console.log("Error getting documents: ",e)}));case 12:S(Object(a.jsx)("div",{})),r=n.map((function(e,t){var n=null;return c.forEach((function(a){e.questionId===a.responseId&&(n=a.data.answer,L(a.data.answer,t))})),Object(a.jsx)(ze,{question:e.data,index:t,response:n,returnAnswer:L,locked:s},t)})),S(r);case 15:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();e.task.id&&t()}),[e.task.id]);var L=function(e,t){var n=y;n[t]=e,k(n)};return function(){if(void 0!==l.assigned_users&&l.assigned_users.length>0){var t=e.users.find((function(e){return e.id===l.assigned_users[0]}));u=void 0!==t?t:{}}}(),Object(a.jsxs)(p.a,{style:{padding:30},children:[Object(a.jsx)(p.a,{container:!0,justify:"center",children:Object(a.jsx)(st,{userInfo:u,children:" "})}),Object(a.jsx)(ut,{id:e.task.id})]})},bt=n(873),ft=function(e){var t=Object(c.useState)(0),n=Object(o.a)(t,2),r=n[0],s=n[1],i=Object(c.useState)(1),l=Object(o.a)(i,2),d=l[0],u=(l[1],Object(c.useState)([])),j=Object(o.a)(u,2),b=j[0],f=j[1],O=function(e,t,n){var a=Object(Qe.a)(n),c=Math.floor(a.size/t);console.log("numberOfPages",c);var r=e*t,s=a.size;return e!==c-1&&(s=(e+1)*t),console.log("Start",r),console.log("End",s),n.slice(r,s)};Object(c.useEffect)((function(){s(0),f(O(0,1,e.data))}),[e.data]);var h=e.data.length>0&&Object(a.jsx)(p.a,{container:!0,justify:"center",children:Object(a.jsx)(bt.a,{justify:"center",component:"div",count:e.data.length,page:r,onChangePage:function(t,n){f(O(n,d,e.data)),s(n)},rowsPerPage:d,onChangeRowsPerPage:function(e){},labelRowsPerPage:"\u041f\u043e \u043e\u0434\u043d\u043e\u0439 \u0437\u0430\u0434\u0430\u0447\u0435 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443!"})}),g=void 0!==b[0];return Object(a.jsxs)("div",{children:[h,Object(a.jsx)(p.a,{container:!0,spacing:0,direction:"column",alignItems:"center",justify:"center",style:{minHeight:"100vh"},children:Object(a.jsx)(p.a,{item:!0,xs:12,children:Object(a.jsx)(p.a,{container:!0,justify:"center",direction:"column",spacing:1,children:g?Object(a.jsx)(p.a,{item:!0,children:Object(a.jsx)(jt,{task:b[0],users:e.users})}):"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0438 \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u0435 \u0444\u0438\u043b\u044c\u0442\u0440\u044b!"})})}),h]})},Ot=n(869),ht=n(192),pt=n.n(ht),gt=function(e){Object(c.useContext)(b).currentUser;var t=r.a.useState([]),n=Object(o.a)(t,2),s=n[0],i=n[1],l=r.a.useState("\u0412\u0421\u0415"),d=Object(o.a)(l,2),u=d[0],f=d[1],O=r.a.useState([]),h=Object(o.a)(O,2),m=h[0],x=h[1],v=r.a.useState("\u0412\u0421\u0415"),y=Object(o.a)(v,2),k=y[0],_=(y[1],r.a.useState("\u0412\u0421\u0415")),w=Object(o.a)(_,2),S=w[0],C=(w[1],r.a.useState("\u0412\u0421\u0415")),q=Object(o.a)(C,2),E=q[0],F=(q[1],function(){var e=Object(ce.a)(ae.a.mark((function e(){var t,n;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[{id:"",name:"NONE",surname:""}],n=j.firestore().collection("users").orderBy("surname"),e.next=4,n.get().then((function(e){e.forEach((function(e){t.push(Object(g.a)({id:e.id},e.data()))})),x(t)}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()),D=function(){var e=Object(ce.a)(ae.a.mark((function e(){var t,n;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=j.firestore().collection("tasks").where("is_complete","==",!0),"\u0412\u0421\u0415"!==u&&(n=n.where("assigned_users","array-contains",u)),"\u0412\u0421\u0415"!==S&&(n=n.where("title","==",S)),"\u0412\u0421\u0415"!==k&&(n=n.where("type","==",k)),"\u0412\u0421\u0415"!==E&&(n=n.where("review_status","==",E)),e.next=8,n.get().then((function(e){e.forEach((function(e){t.push(Object(g.a)({id:e.id},e.data()))})),i(t)}));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){F()}),[]),Object(a.jsxs)("div",{children:[Object(a.jsx)(p.a,{container:!0,justify:"center",style:{padding:15},children:Object(a.jsx)(Ot.a,{id:"combo-box-demo",options:m,getOptionLabel:function(e){return e.surname+" "+e.name},style:{width:300},value:u.value,onChange:function(e,t){f(t?t.id:"")},renderInput:function(e){return Object(a.jsx)(R.a,Object(g.a)(Object(g.a)({},e),{},{fullWidth:!0,label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0438\u043b\u044c\u0442\u0440 \u043f\u043e users",variant:"outlined"}))}})}),Object(a.jsx)(p.a,{container:!0,justify:"center",children:Object(a.jsx)(I.a,{style:{width:"350px"},type:"number",variant:"contained",onClick:function(e){D()},color:"primary",startIcon:Object(a.jsx)(pt.a,{}),children:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440\u044b"})}),Object(a.jsx)(p.a,{container:!0,justify:"center",children:Object(a.jsx)(ft,{data:s,users:m})})]})},mt=function(){return Object(c.useContext)(b).currentUser?Object(a.jsx)(h.a,{to:"/"}):Object(a.jsxs)(p.a,{container:!0,direction:"column",style:{padding:20},justify:"center",children:[Object(a.jsx)(F.a,{align:"center",variant:"h4",children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"}),Object(a.jsx)(F.a,{variant:"body1",align:"center",children:"\u041d\u0430\u0436\u043c\u0438\u0442\u0435 \u043d\u0430 \u043a\u043d\u043e\u043f\u043a\u0443 (\u0412\u0445\u043e\u0434 \u0438\u043b\u0438 \u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f)."}),Object(a.jsx)(F.a,{variant:"body1",align:"center",children:"\u0415\u0441\u043b\u0438 \u0443 \u0432\u0430\u0441 \u043d\u0435\u0442 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google, \u0442\u043e \u0441\u043e\u0437\u0434\u0430\u0439\u0442\u0435 \u0435\u0433\u043e."}),Object(a.jsx)("br",{}),Object(a.jsx)(I.a,{size:"large",color:"primary",variant:"contained",onClick:u,children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"})]})},xt=function(e){var t=e.component,n=Object(we.a)(e,["component"]),r=Object(c.useContext)(b).currentUser;return Object(a.jsx)(h.b,Object(g.a)(Object(g.a)({},n),{},{render:function(e){return r?Object(a.jsx)(t,Object(g.a)({},e)):Object(a.jsx)(h.a,{to:"/signin"})}}))},vt=n(378),yt=n(796),kt=Object(D.a)((function(e){return{root:Object(m.a)({border:"2px grey solid",padding:"0px 10px",margin:10,background:"yellow",width:700},e.breakpoints.down("sm"),{maxWidth:300}),button:{background:"orange",margin:"10px 0"}}})),_t=Object(c.forwardRef)((function(e,t){var n=kt(),c=r.a.useState(""),s=Object(o.a)(c,2),i=s[0],l=s[1],d=e.title,u=e.sendAnswer,j=e.taskId,b=e.questionId;return Object(a.jsxs)("div",{className:n.root,children:[Object(a.jsx)(M.a,{display:"flex",style:{marginBottom:10,marginTop:10},children:Object(a.jsx)(F.a,{variant:"h6",style:{paddingRight:8},children:d})}),Object(a.jsx)(R.a,{label:"\u041c\u043e\u0439 \u043e\u0442\u0432\u0435\u0442",value:i,style:{background:"white"},onChange:function(e){l(e.target.value)},multiline:!0,rows:5,variant:"outlined",fullWidth:!0}),Object(a.jsx)(p.a,{container:!0,justify:"flex-end",children:Object(a.jsx)(I.a,{className:n.button,onClick:function(){return u(j,b,i)},children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"})})]})})),wt=Object(D.a)((function(e){return{select:Object(m.a)({margin:"20px 0",width:500},e.breakpoints.down("sm"),{maxWidth:300})}})),St=function(e){var t=wt(),n=["\u0412\u0421\u0415","\u041f\u043e\u0438\u0441\u043a \u043a\u043e\u043d\u0442\u0430\u043a\u0442\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445","interview"],s=r.a.useState([]),i=Object(o.a)(s,2),l=(i[0],i[1]),d=r.a.useState(n[0]),u=Object(o.a)(d,2),b=u[0],f=u[1],O=Object(c.useState)([]),h=Object(o.a)(O,2),m=h[0],x=h[1],v=function(){var e=Object(ce.a)(ae.a.mark((function e(t){var n;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y();case 2:n=e.sent,k(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=Object(ce.a)(ae.a.mark((function e(){var t,n;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=j.firestore().collection("tasks").where("case_type","==","FAQ").where("is_complete","==",!1),"\u0412\u0421\u0415"!==b&&(n=n.where("type","==",b)),console.log("fired"),e.next=6,n.get().then((function(e){e.forEach((function(e){t.push(Object(g.a)({id:e.id},e.data()))})),t.sort((function(e,t){return t.timestamp.toDate()-e.timestamp.toDate()})),l(t)}));case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(){var e=Object(ce.a)(ae.a.mark((function e(t){var n;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.map(function(){var e=Object(ce.a)(ae.a.mark((function e(t){var n;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],e.next=3,j.firestore().collection("tasks").doc(t.id).collection("questions").get().then((function(e){e.forEach((function(e){n.push(Object(g.a)({taskId:t.id,questionId:e.id,timestamp:t.timestamp.toDate()},e.data()))}))}));case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:n=e.sent,Promise.all(n).then((function(e){return x([].concat.apply([],e))}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=function(e,t,n){j.firestore().collection("tasks").doc(e).collection("responses").doc(t).set({answer:n}),console.log(e,n)};return Object(a.jsxs)(p.a,{container:!0,justify:"center",children:[Object(a.jsx)(p.a,{container:!0,justify:"center",children:Object(a.jsxs)($.a,{className:t.select,children:[Object(a.jsx)(vt.a,{value:b,onChange:function(e){f(e.target.value)},name:"filterTaskType",children:n.map((function(e,t){return Object(a.jsx)("option",{value:e,children:e},e)}))}),Object(a.jsx)(yt.a,{children:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0438\u043b\u044c\u0442\u0440 \u043f\u043e \u0442\u0438\u043f\u0443 \u0437\u0430\u0434\u0430\u0447\u0438"})]})}),Object(a.jsx)(p.a,{container:!0,justify:"center",className:t.select,children:Object(a.jsx)(I.a,{style:{width:"350px"},type:"number",variant:"contained",onClick:v,color:"primary",startIcon:Object(a.jsx)(pt.a,{}),children:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440\u044b"})}),Object(a.jsx)(p.a,{container:!0,justify:"center",children:m?m.map((function(e,t){return Object(a.jsx)(_t,{taskId:e.taskId,questionId:e.questionId,title:e.title,sendAnswer:_},"task_"+t)})):Object(a.jsx)(F.a,{style:{padding:30},children:"\u041d\u0435\u0442 \u043d\u043e\u0432\u044b\u0445 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432"})})]})},Ct=n(399),qt=n(867),Et=Object(D.a)({root:{minWidth:250},bullet:{display:"inline-block",margin:"0 2px"},title:{fontSize:14},pos:{marginBottom:12}}),It=function(e){var t,n=Et(),r=Object(h.g)(),s=e.complete,i=e.id,l=e.cardColor,d=e.cardType,u=e.stage,b=e.stageID,f=e.task,O=e.user,g=e.pCase,x=Object(c.useState)(!1),v=Object(o.a)(x,2),y=v[0],k=v[1],_=Object(c.useState)(null),w=Object(o.a)(_,2),S=(w[0],w[1],function(){k(!0);var e="",t="",n="";"creatable"===d||"creatableUnlim"===d?(e=Object(qt.a)(),t="callbackId",n="callbackId"):"selectable"===d&&(e=i,n="taskId",t=j.firestore.FieldPath.documentId()),j.firestore().collection("task_requests").doc(O.uid).collection("requests").add(Object(m.a)({status:"pending",user:O.uid,case_type:g,case_stage_id:b},n,e)).then((function(n){var a=j.firestore().collection("tasks").where("assigned_users","array-contains",O.uid).where(t,"==",e).onSnapshot((function(e){e.docChanges().forEach((function(e){"added"===e.type&&e.doc.id&&(a(),r.push("/t/"+e.doc.id))}))}))}))}),C=function(){k(!0);var e="",t="",n="";"creatable"===d||"creatableUnlim"===d?(e=Object(qt.a)(),t="callbackId",n="callbackId"):"selectable"===d&&(e=i,n="taskId",t=j.firestore.FieldPath.documentId()),j.firestore().collection("task_requests").doc(O.uid).collection("requests").add(Object(m.a)({status:"pending",user:O.uid,case_type:g,case_stage_id:b},n,e)).then((function(n){var a=j.firestore().collection("tasks").where("assigned_users","array-contains",O.uid).where(t,"==",e).onSnapshot((function(e){e.docChanges().forEach((function(e){"added"===e.type&&e.doc.id&&(a(),r.push("/tasks/"+e.doc.id))}))}))}))};return Object(a.jsxs)(Ee.a,{className:n.root,style:{background:l},children:[Object(a.jsxs)(Fe.a,{children:[Object(a.jsxs)(M.a,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[Object(a.jsx)(F.a,{variant:"h6",children:u.title}),s&&Object(a.jsx)(F.a,{color:"error",children:"\u0421\u0434\u0430\u043d\u043e"})]}),Object(a.jsxs)(F.a,{variant:"subtitle1",className:n.pos,color:"textSecondary",children:["#",i]}),Object(a.jsx)(F.a,{variant:"body2",component:"p",children:f&&f.cardData&&("selectable"===d||u&&u.showCard)?(t=f.cardData,Object.keys(t).map((function(e,n){return"message"===e?Object(a.jsx)(F.a,{children:t[e]},e+n):Object.keys(t[e]).map((function(n){if(u&&u.cardData&&u.cardData[e]&&u.cardData[e].includes(n))return"attachedFiles"===n?Object(a.jsx)("div",{children:"Files"},e+n):Object(a.jsx)("typography",{variant:"body2",component:"p",children:JSON.stringify(t[e][n],null,2)},e+n)}))}))):"\u0417\u0430\u0434\u0430\u043d\u0438\u0435: "+u.description})]}),Object(a.jsx)(Ie.a,{children:y?Object(a.jsx)(re.a,{}):Object(a.jsxs)(p.a,{children:[Object(a.jsx)(I.a,{size:"small",onClick:function(){"creatable"===d||"selectable"===d||"creatableUnlim"===d?S():r.push("/t/"+i)},children:"creatableUnlim"===d?"\u0421\u041e\u0417\u0414\u0410\u0422\u042c \u041d\u041e\u0412\u0423\u042e \u0424\u041e\u0420\u041c\u0423":"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"}),u.showOldButton&&Object(a.jsx)(I.a,{size:"small",onClick:function(){"creatable"===d||"selectable"===d||"creatableUnlim"===d?C():r.push("/tasks/"+i)},children:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c (Old)"})]})})]},i)},Ft=function(e,t,n){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||t((function(t){var a=Object.assign({},t);return a[n]||(a[n]={}),a[n][e.doc.id]=e.doc.data(),a})),"removed"===e.type&&t((function(t){var a=Object.assign({},t);return delete a[n][e.doc.id],a}))}))},Dt=function(e,t){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||t((function(t){return Object(g.a)(Object(g.a)({},t),{},Object(m.a)({},e.doc.id,e.doc.data()))})),"removed"===e.type&&t((function(t){var n=Object.assign({},t);return delete n[e.doc.id],n}))}))};function Tt(e){var t=e.children,n=e.value,c=e.index,r=Object(we.a)(e,["children","value","index"]);return Object(a.jsx)("div",Object(g.a)(Object(g.a)({role:"tabpanel",hidden:n!==c,id:"full-width-tabpanel-".concat(c),"aria-labelledby":"full-width-tab-".concat(c)},r),{},{children:n===c&&Object(a.jsx)(M.a,{p:3,children:Object(a.jsx)(F.a,{children:t})})}))}function Ut(e){return{id:"full-width-tab-".concat(e),"aria-controls":"full-width-tabpanel-".concat(e)}}var At=Object(D.a)({root:{paddingTop:30,flexGrow:1}}),Pt=function(){var e=Object(c.useContext)(b).currentUser,t=Object(h.h)().id,n=At(),r=Object(c.useState)({}),s=Object(o.a)(r,2),i=s[0],l=s[1],d=Object(c.useState)([]),u=Object(o.a)(d,2),f=u[0],O=u[1],x=Object(c.useState)({}),v=Object(o.a)(x,2),y=v[0],k=v[1],_=Object(c.useState)({}),w=Object(o.a)(_,2),S=w[0],C=w[1],q=Object(c.useState)({}),E=Object(o.a)(q,2),D=E[0],T=E[1],U=Object(c.useState)({}),A=Object(o.a)(U,2),P=A[0],W=A[1],N=Object(c.useState)({}),B=Object(o.a)(N,2),z=B[0],R=B[1],M=Object(c.useState)({}),L=Object(o.a)(M,2),G=L[0],V=L[1],Q=Object(c.useState)({}),H=Object(o.a)(Q,2),J=H[0],K=H[1],Y=Object(c.useState)(0),X=Object(o.a)(Y,2),Z=X[0],$=X[1],ee=Object(c.useState)({}),te=Object(o.a)(ee,2),ne=te[0],re=te[1],se=Object(c.useState)({}),ie=Object(o.a)(se,2),oe=ie[0],le=ie[1],de=Object(c.useState)({}),ue=Object(o.a)(de,2),je=ue[0],be=ue[1],fe=Object(c.useState)({}),Oe=Object(o.a)(fe,2),he=Oe[0],pe=Oe[1],ge=Object(c.useState)({}),me=Object(o.a)(ge,2),xe=me[0],ve=me[1],ye=Object(c.useState)((function(){})),ke=Object(o.a)(ye,2),_e=(ke[0],ke[1],Object(c.useState)([])),we=Object(o.a)(_e,2),Ee=we[0],Ie=we[1];Object(c.useEffect)((function(){console.log("Page id: ",t),console.log("Current user: ",e);var n=function(){};return e&&(n=j.firestore().collection("pages").doc(t).onSnapshot((function(e){l(e.data()),console.log("Page data: ",e.data())}))),n}),[e,t]),Object(c.useEffect)((function(){var t=function(){};return e&&i&&i.ranks&&(t=j.firestore().collection("users").doc(e.uid).collection("user_private").doc("private").onSnapshot((function(e){O(Te(e.data().ranks,i.ranks))}))),t}),[e,t,i]),Object(c.useEffect)((function(){if(i&&Object.entries(i).length>0&&f.length>0){k({}),T({}),C({}),re({}),pe({}),le({});var t=j.firestore().collection("schema").doc("structure").collection("cases");i.cases.map((function(e){console.log("PCASE",e),t.doc(e).get().then((function(e){R((function(t){var n=Object.assign({},t);return n[e.id]=e.data(),n}))})),t.doc(e).collection("stages").where("ranks_write","array-contains-any",f).onSnapshot((function(t){Ft(t,k,e)})),t.doc(e).collection("stages").onSnapshot((function(t){Ft(t,C,e)}))})),console.log("ALLCASES",S),j.firestore().collection("tasks").where("assigned_users","array-contains",e.uid).where("case_type","in",i.cases).onSnapshot((function(e){Dt(e,T)})),i.caseWithSelectableTasks&&(t.doc(i.caseWithSelectableTasks).collection("stages").where("ranks_read","array-contains-any",f).onSnapshot((function(e){Dt(e,re)})),t.doc(i.caseWithSelectableTasks).collection("stages").onSnapshot((function(e){Dt(e,le)})),j.firestore().collection("tasks").where("case_type","==",i.caseWithSelectableTasks).where("assigned_users","==",[]).where("available","==",!0).where("is_complete","==",!1).where("ranks_read","array-contains-any",f).orderBy("created_date","desc").limit(25).onSnapshot((function(e){Dt(e,pe)})))}}),[e,i,f,t]),Object(c.useEffect)((function(){var e=function(){};if(i&&Object.entries(i).length>0&&f.length>0&&i.caseWithSelectableTasks)if(console.log("filtersData",je),0!==Object.keys(je).length){var t=ne,n=t[Object.keys(t)[0]].filters;n.emergency_form_filling.violationType={violationType:"=="},n.emergency_form_filling.violationTime="==",console.log("filters",n),console.log("filtersData",je),pe({});var a=j.firestore().collection("tasks").where("case_type","==",i.caseWithSelectableTasks).where("assigned_users","==",[]).where("available","==",!0).where("is_complete","==",!1).where("ranks_read","array-contains-any",f);Object.keys(n).forEach((function(e){Object.keys(n[e]).forEach((function(t){console.log(e,t),je[t]&&je[t][t]?(console.log("filters3",je[t][t],n[e][t][t]),a=a.where("cardData.".concat(e,".").concat(t,".").concat(t),n[e][t][t],je[t][t])):je[t]&&Object.keys(je[t]).length>0&&!je[t][t]&&(console.log("filters4",je[t],n[e][t]),a=a.where("cardData.".concat(e,".").concat(t),n[e][t],je[t]))}))})),e=a=a.orderBy("created_date","desc").limit(25).onSnapshot((function(e){Dt(e,pe)}))}else pe({}),e=j.firestore().collection("tasks").where("case_type","==",i.caseWithSelectableTasks).where("assigned_users","==",[]).where("available","==",!0).where("is_complete","==",!1).where("ranks_read","array-contains-any",f).orderBy("created_date","desc").limit(25).onSnapshot((function(e){Dt(e,pe)}));return e}),[e,i,f,t,je]),Object(c.useEffect)((function(){if(Object.keys(y).length>0){var e=Object(it.cloneDeep)(y);Object.keys(y).map((function(t){Object.keys(y[t]).map((function(n){var a=y[t][n];if(a.ranks_write&&Object.keys(a.ranks_write).length>0&&Te(a.ranks_write,f).length>0&&"creatable"in a&&a.creatable){if(a.rank_limit_number&&Object.keys(a.rank_limit_number).length>0){var c=Te(Object.keys(a.rank_limit_number),f);if(c.length>0){var r=De(c,a.rank_limit_number);Fe(n,D,t)>=r&&delete e[t][n]}}}else delete e[t][n]}))})),W(e)}}),[e,y,D,t]);var Fe=function(e,t,n){var a=0;return Object.values(t).map((function(t){t.case_stage_id===e&&n===t.case_type&&a++})),a},De=function(e,t){var n=0;return e.map((function(e){t[e]>n&&(n=t[e])})),n},Te=function(e,t){var n,a=new Set(e),c=new Set(t),r=new Set,s=Object(Ct.a)(c);try{for(s.s();!(n=s.n()).done;){var i=n.value;a.has(i)&&r.add(i)}}catch(o){s.e(o)}finally{s.f()}return Object(Ne.a)(r)};Object(c.useEffect)((function(){f.length>0&&j.firestore().collection("schema").doc("structure").collection("ranks").where(j.firestore.FieldPath.documentId(),"in",f).onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||ve((function(t){return Object(g.a)(Object(g.a)({},t),{},Object(m.a)({},e.doc.id,e.doc.data()))})),"removed"===e.type&&ve((function(t){var n=Object.assign({},t);return delete n[e.doc.id],n}))}))}))}),[f]),Object(c.useEffect)((function(){Object.keys(y).length>0?Ae():V({})}),[y]);var Ue=function(t,n,c,r,s){return Object.keys(t).map((function(i){var o=t[i].case_type,l=t[i].case_stage_id,d=!1;if(n?n[l]&&(d=n[l]):c&&c[o]&&c[o][l]&&(d=c[o][l]),d&&t[i].is_complete===s)return Object(a.jsx)(p.a,{style:{padding:10},children:Object(a.jsx)(It,{stage:d,stageID:l,cardType:r,task:t[i],user:e,pCase:o,id:i})},i)}))},Ae=function(){var e={type:"object",properties:{request:{title:"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435",$ref:"#/definitions/cases"}},definitions:{cases:{type:"object",properties:{case:{type:"string",enum:["none"].concat(Object(Ne.a)(Object.keys(y))),default:"none"}},required:["case"],dependencies:{case:{oneOf:[{properties:{case:{enum:["none"]}}}]}}}}};Object.keys(y).forEach((function(t,n){var a=y[t];console.log("cc",a),i.cases.includes(t)&&e.definitions.cases.dependencies.case.oneOf.push({properties:{case:{enum:[t]},task:{type:"string",enum:["none"].concat(Object(Ne.a)(Object.keys(a))),default:"none"}},required:["task"]})})),V(e)};Object(c.useEffect)((function(){var e=function(){var e=Object(ce.a)(ae.a.mark((function e(){var t;return ae.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,j.firestore().collection("schema").doc("structure").collection("ranks").get().then((function(e){e.forEach((function(e){i.ranks.includes(e.id)&&e.data().assign_without_moderator&&(console.log("RANK_ID",e.id),t.push(e.id))}))}));case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();i&&i.ranks&&e().then((function(e){return Ie(function(e){return e.filter((function(e){return f&&!f.includes(e)}))}(e))}))}),[i,f]);return Object(a.jsxs)(p.a,{container:!0,justify:"center",alignItems:"center",direction:"column",children:[console.log("pageData: ",i),console.log("userRanks: ",f),console.log("userCases: ",y),console.log("userTasks: ",D),console.log("filteredStages: ",P),console.log("availableStages: ",ne),console.log("availableTasks: ",he),console.log("caseData",z),console.log("availableRanks: ",Ee),Object(a.jsx)(ct,{}),Ee.length>0&&Object(a.jsxs)(p.a,{container:!0,justify:"center",alignItems:"center",direction:"column",style:{paddingBottom:20},children:[Object(a.jsx)(F.a,{variant:"h5",children:i.message}),Ee.map((function(t,n){return Object(a.jsxs)(I.a,{variant:"contained",color:"primary",onClick:function(){return function(t){console.log("\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c \u0437\u0430\u043f\u0440\u043e\u0441"),j.firestore().collection("rank_requests").add({timestamp:j.firestore.FieldValue.serverTimestamp(),user_id:e.uid,processed:!1,rank:t})}(t)},style:{margin:15},children:["\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0440\u0430\u043d\u0433 ",t]},n)}))]}),i.showTaskSelector&&Object(a.jsx)(p.a,{style:{paddingBottom:30},children:Object(a.jsx)(dt.a,{schema:G,formData:J,onChange:function(e){!function(e){K(e.formData)}(e)},onSubmit:function(){"none"!==J.request.case&&"none"!==J.request.task?(console.log("rrrr",J),j.firestore().collection("task_requests").doc(e.uid).collection("requests").add({status:"pending",user:e.uid,case_type:J.request.case,case_stage_id:J.request.task})):alert("\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 case \u0438 task!")},children:Object(a.jsx)("button",{type:"submit",className:"btn btn-info",children:"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c"})})}),Object.keys(xe).length>0?f.map((function(e){if(xe[e]&&xe[e].description)return Object(a.jsx)(F.a,{variant:"h5",children:xe[e].description},e)})):null,Object(a.jsx)("div",{className:n.root,children:Object(a.jsx)(Se.a,{position:"static",color:"default",children:Object(a.jsxs)(Ce.a,{value:Z,onChange:function(e,t){$(t)},variant:"fullWidth",centered:!0,"aria-label":"simple tabs example",children:[Object(a.jsx)(qe.a,Object(g.a)({label:"\u041d\u0435\u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435"},Ut(0))),Object(a.jsx)(qe.a,Object(g.a)({label:"\u0412\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0435"},Ut(1))),Object.keys(he).length>0&&Object.keys(ne).length>0?Object(a.jsx)(qe.a,Object(g.a)({label:"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435"},Ut(2))):null]})})}),Object(a.jsxs)(Tt,{value:Z,index:0,children:[Object.keys(P).map((function(t){return Object.keys(P[t]).map((function(n){return Object(a.jsx)(p.a,{style:{padding:10},children:Object(a.jsx)(It,{complete:!1,stage:P[t][n],stageID:n,user:e,pCase:t,cardType:"creatable"})},t+n)}))})),Ue(D,!1,S,"selected",!1)]}),Object(a.jsx)(Tt,{value:Z,index:1,children:Ue(D,!1,S,"selected",!0)}),Object.keys(he).length>0&&Object.keys(ne).length>0?Object(a.jsxs)(Tt,{value:Z,index:2,children:[function(e,t,n,c){if(1===Object.keys(e).length&&e[Object.keys(e)[0]]&&e[Object.keys(e)[0]].filters&&Object.keys(e[Object.keys(e)[0]].filters).length>0&&Object.keys(t).length>0){var r=e[Object.keys(e)[0]].filters;r.emergency_form_filling.violationType={violationType:"=="},r.emergency_form_filling.violationTime="==";var s={properties:{}},i={};return Object.keys(r).forEach((function(e){Object.keys(r[e]).forEach((function(n){var a=t[e].end.properties[n];a&&(delete a.dependencies,s.properties[n]=a,i[n]={"ui:widget":"select"})}))})),Object(a.jsx)(dt.a,{schema:s,uiSchema:i,formData:n,onChange:function(e){c(e)},children:" "})}return null}(ne,oe,je,(function(e){be(e.formData)})),Ue(he,ne,!1,"selectable",!1)]}):null]})},Wt=n(266),Nt=n.n(Wt),Bt=function(){var e=Object(c.useState)({}),t=Object(o.a)(e,2),n=t[0],r=t[1],s=Object(c.useState)({}),i=Object(o.a)(s,2),l=i[0],d=i[1],f=Object(c.useState)({}),O=Object(o.a)(f,2),x=O[0],v=O[1],y=Object(c.useState)({}),k=Object(o.a)(y,2),_=k[0],w=k[1],S=Object(c.useState)({}),C=Object(o.a)(S,2),q=C[0],E=C[1],D=Object(c.useState)({}),T=Object(o.a)(D,2),U=T[0],A=T[1],P=Object(c.useState)({}),W=Object(o.a)(P,2),N=W[0],B=W[1],z=Object(c.useState)({}),R=Object(o.a)(z,2),M=R[0],L=R[1],G=Object(c.useState)({}),Y=Object(o.a)(G,2),X=Y[0],Z=Y[1],$=Object(c.useState)(""),ee=Object(o.a)($,2),te=(ee[0],ee[1]),ne=Object(c.useState)(null),ae=Object(o.a)(ne,2),ce=ae[0],re=ae[1],se=Object(c.useState)("loading"),ie=Object(o.a)(se,2),oe=ie[0],le=ie[1],de=Object(c.useState)([]),ue=Object(o.a)(de,2),je=(ue[0],ue[1],Object(c.useState)([])),be=Object(o.a)(je,2),fe=(be[0],be[1],Object(c.useState)({})),Oe=Object(o.a)(fe,2),he=(Oe[0],Oe[1],Object(c.useState)([])),pe=Object(o.a)(he,2),ge=(pe[0],pe[1],Object(c.useState)(!1)),me=Object(o.a)(ge,2),xe=(me[0],me[1],Object(c.useState)(!1)),ve=Object(o.a)(xe,2),ye=(ve[0],ve[1],Object(c.useState)({})),ke=Object(o.a)(ye,2),_e=(ke[0],ke[1],Object(c.useState)(!1)),we=Object(o.a)(_e,2),Se=(we[0],we[1],Object(c.useState)([])),Ce=Object(o.a)(Se,2),qe=(Ce[0],Ce[1],Object(c.useState)(!1)),Ee=Object(o.a)(qe,2),Ie=Ee[0],Fe=Ee[1],De=Object(c.useState)(null),Te=Object(o.a)(De,2),Ue=Te[0],Ae=Te[1],Pe=Object(c.useState)({}),We=Object(o.a)(Pe,2),Be=We[0],ze=We[1],Me=Object(c.useState)({}),Le=Object(o.a)(Me,2),Ge=(Le[0],Le[1],Object(c.useState)(!1)),Ve=Object(o.a)(Ge,2),Qe=(Ve[0],Ve[1],Object(c.useState)({})),He=Object(o.a)(Qe,2),Je=(He[0],He[1],Object(c.useState)(!1)),Ke=Object(o.a)(Je,2),Ye=(Ke[0],Ke[1],Object(c.useContext)(b).currentUser),Xe=Object(h.h)().id,Ze=Object(h.g)();Object(c.useEffect)((function(){if(Ye&&Xe){var e=j.firestore().collection("tasks").doc(Xe);re(e),e.onSnapshot((function(e){w(e.data()),e.data().is_complete&&le("sent"),e.data().assigned_users.includes(Ye.uid)||le("released"),console.log("Task Metadata: ",e.data())})),e.collection("responses").onSnapshot((function(e){var t={},n=[],a=!1;e.docChanges().forEach((function(e){if("added"===e.type||"modified"===e.type){var c=e.doc.data().contents;t[e.doc.id]=c,a=!0}"removed"===e.type&&(console.log("Response Removed: ",e.doc.data()),n.push(e.doc.id),a=!0)})),a&&r((function(e){var a=Object(it.cloneDeep)(e);return n.forEach((function(e){return delete a[e]})),Object.keys(t).forEach((function(e){return a[e]=t[e]})),a}))})),e.collection("questions").onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||d((function(t){return Object(g.a)(Object(g.a)({},t),{},Object(m.a)({},e.doc.id,e.doc.data()))}))}))}))}}),[Xe,Ye]),Object(c.useEffect)((function(){Object.entries(_).length>0&&(console.log("Task metadata: ",_),j.firestore().collection("schema").doc("structure").collection("cases").doc(_.case_type).collection("stages").onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||(console.log("Case stage: ",e.doc.data()),E((function(t){return Object(g.a)(Object(g.a)({},t),{},Object(m.a)({},e.doc.id,e.doc.data()))}))),"removed"===e.type&&E((function(t){var n=Object.assign({},t);return delete n[e.doc.id],n}))}))})))}),[_.case_type]),Object(c.useEffect)((function(){var e={};console.log("Bg tasks: ",U),Object.keys(U).map((function(t){if(t!==Xe){var n=U[t].case_stage_id;e[n]||(e[n]={}),e[n][t]=$e(N[t],q[n])}})),console.log("Merged bg forms: ",e),L(e)}),[U,N,q]),Object(c.useEffect)((function(){Object.keys(x).length>0&&"loading"===oe&&le("ready")}),[n,x]),Object(c.useEffect)((function(){v($e(l,q[_.case_stage_id]))}),[l,_,q]),Object(c.useEffect)((function(){if(Object.keys(q).length>0&&Object.keys(_).length>0&&q[_.case_stage_id]){console.log("caseStages: ",q),console.log("taskMetadata: ",_);var e=q[_.case_stage_id].backgroundStages;e&&e.length>0&&(console.log("backgroundTasksList: ",e.length),j.firestore().collection("tasks").where("case_id","==",_.case_id).where("case_stage_id","in",e).orderBy("created_date").onSnapshot((function(e){e.docChanges().forEach((function(e){"added"!==e.type&&"modified"!==e.type||(console.log("Background task: ",e.doc.data()),A((function(t){return Object(g.a)(Object(g.a)({},t),{},Object(m.a)({},e.doc.id,e.doc.data()))}))),"removed"===e.type&&A((function(t){var n=Object.assign({},t);return delete n[e.doc.id],n}))}))})))}}),[q,_]),Object(c.useEffect)((function(){Object.entries(U).length>0&&Object.keys(U).map((function(e){j.firestore().collection("tasks").doc(e).collection("questions").onSnapshot((function(t){Ft(t,B,e)})),j.firestore().collection("tasks").doc(e).collection("responses").onSnapshot((function(t){t.docChanges().forEach((function(t){"added"!==t.type&&"modified"!==t.type||Z((function(n){var a=Object.assign({},n);return a[e]||(a[e]={}),a[e][t.doc.id]=t.doc.data().contents,a})),"removed"===t.type&&Z((function(n){var a=Object.assign({},n);return delete a[e][t.doc.id],a}))}))}))}))}),[U]);var $e=function(e,t){var n=Object.assign({},e),a=Object.assign({},t);a.start=a.start?a.start:{},a.end=a.end?a.end:{},a.start_ui_schema=a.start_ui_schema?a.start_ui_schema:{},a.end_ui_schema=a.end_ui_schema?a.end_ui_schema:{},n.form_questions=n.form_questions?n.form_questions:{},n.ui_schema=n.ui_schema?n.ui_schema:{};var c=Object(g.a)(Object(g.a)(Object(g.a)({},a.start.properties?a.start.properties:{}),a.end.properties?a.end.properties:{}),n.form_questions.properties?n.form_questions.properties:{}),r=Object(g.a)(Object(g.a)(Object(g.a)({},a.start.definitions?a.start.definitions:{}),a.end.definitions?a.end.definitions:{}),n.form_questions.definitions?n.form_questions.definitions:{}),s="";n.form_questions.title?s=n.form_questions.title:a.end.title?s=a.end.title:a.start.title&&(s=a.start.title);var i="";n.form_questions.description?i=n.form_questions.description:a.end.description?i=a.end.description:a.start.description&&(i=a.start.description);var o=Object(Ne.a)(new Set([].concat(Object(Ne.a)(a.start.required?a.start.required:[]),Object(Ne.a)(n.form_questions.required?n.form_questions.required:[]),Object(Ne.a)(a.end.required?a.end.required:[])))),l=Object(Ne.a)(new Set([].concat(Object(Ne.a)(a.start_ui_schema["ui:order"]?a.start_ui_schema["ui:order"]:[]),Object(Ne.a)(n.ui_schema["ui:order"]?n.ui_schema["ui:order"]:[]),Object(Ne.a)(a.end_ui_schema["ui:order"]?a.end_ui_schema["ui:order"]:[])))),d=Object(g.a)(Object(g.a)(Object(g.a)({},a.start_ui_schema?a.start_ui_schema:{}),a.end_ui_schema?a.end_ui_schema:{}),n.ui_schema?n.ui_schema:{});return{form_questions:{properties:c,definitions:r,title:s,description:i,required:o},ui_schema:d=Object(g.a)(Object(g.a)({},d),{"ui:order":l})}},et=function(){Fe(!1)},tt=function(){Fe(!1),Ze.goBack()},nt=function(e){console.log("Dialog open"),"send"===e&&(Ae("send"),Fe(!0)),"release"===e&&(Ae("release"),Fe(!0))},at=function(e){var t=j.firestore().collection("tasks").doc(Xe).collection("user_editable").doc("user_editable");"released"===e?Be.reasons&&(Be.extra?t.update({status:e,release_status:Be.reasons,release_description:Be.extra}):t.update({status:e,release_status:Be.reasons,release_description:""})):t.update({status:e})},ct={customImageWidget:function(e){return console.log("PROPS",e),Object(a.jsx)("img",{src:e.value,alt:e.schema.title,style:{maxWidth:"100%",height:"auto"}})},customVideoWidget:function(e){return console.log("PROPS",e),Object(a.jsx)("video",{title:e.schema.title,style:{maxWidth:"100%",height:"auto"},controls:!0,children:Object(a.jsx)("source",{src:e.value,type:"video/mp4"})})},customIframeWidget:function(e){return console.log("PROPS",e),Object(a.jsx)("iframe",{title:e.schema.title,src:e.value,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}};return Ye?Object(a.jsxs)(p.a,{style:{padding:30},children:["send"===Ue&&Object(a.jsx)(Re,{state:Ie,handleClose:et,handleOk:tt,showOk:"sent"===oe,title:"sent"===oe?q[_.case_stage_id].releaseTitle?Object(a.jsx)(Nt.a,{children:q[_.case_stage_id].releaseTitle}):"\u0424\u043e\u0440\u043c\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0430.":"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0444\u043e\u0440\u043c\u0443?",content:"sent"===oe?q[_.case_stage_id].releaseMessage?Object(a.jsx)(Nt.a,{children:q[_.case_stage_id].releaseMessage}):"\u0421\u043f\u0430\u0441\u0438\u0431\u043e":"\u0412\u044b \u0441\u043e\u0431\u0438\u0440\u0430\u0435\u0442\u0435\u0441\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0444\u043e\u0440\u043c\u0443. \u042d\u0442\u043e \u0437\u043d\u0430\u0447\u0438\u0442, \u0447\u0442\u043e \u0432\u044b \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u0441\u043c\u043e\u0436\u0435\u0442\u0435 \u0438\u0437\u043c\u0435\u043d\u044f\u0442\u044c \u043e\u0442\u0432\u0435\u0442\u044b.",dialogFunction:function(){at("complete")}}),"release"===Ue&&Object(a.jsxs)(V.a,{open:Ie,onClose:et,children:["released"===oe&&Object(a.jsx)(K.a,{id:"alert-dialog-title",children:"\u0424\u043e\u0440\u043c\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043e\u0441\u0432\u043e\u0431\u043e\u0436\u0434\u0435\u043d\u0430. \u0422\u0435\u043f\u0435\u0440\u044c \u0435\u044e \u0441\u043c\u043e\u0436\u0435\u0442 \u0437\u0430\u043d\u044f\u0442\u044c\u0441\u044f \u043a\u0442\u043e-\u0442\u043e \u0435\u0449\u0435."}),Object(a.jsx)(H.a,{children:"released"===oe?Object(a.jsx)(J.a,{children:"\u0421\u043f\u0430\u0441\u0438\u0431\u043e"}):Object(a.jsx)(dt.a,{schema:q[_.case_stage_id].releaseFeedback_schema,uiSchema:q[_.case_stage_id].releaseFeedback_ui,formData:Be,widgets:ct,onChange:function(e){var t;ze((t=e).formData),console.log("event",t.formData)},onSubmit:function(){return at("released")},children:Object(a.jsxs)(Q.a,{children:[Object(a.jsx)(I.a,{onClick:et,color:"primary",children:"\u041e\u0442\u043c\u0435\u043d\u0430"}),Object(a.jsx)(I.a,{type:"submit",color:"primary",autoFocus:!0,children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})})}),"released"===oe&&Object(a.jsx)(Q.a,{children:Object(a.jsx)(I.a,{onClick:tt,color:"primary",children:"Ok"})})]}),Object.keys(q).length>0&&Object.keys(_).length>0&&q[_.case_stage_id]&&q[_.case_stage_id].backgroundStages&&q[_.case_stage_id].backgroundStages.length>0&&Object.keys(M).length>0?Object(a.jsx)(p.a,{style:{padding:30},children:q[_.case_stage_id].backgroundStages.map((function(e){return Object(a.jsxs)("div",{children:[console.log("STAGE: ",e),console.log("mergedBackgroundForms: ",M),M[e]?Object.keys(M[e]).map((function(t){return Object(a.jsx)(p.a,{style:{padding:30},children:Object(a.jsx)(dt.a,{schema:M[e][t].form_questions,uiSchema:M[e][t].ui_schema,formData:X[t],widgets:ct,fields:{customFileUpload:function(e){return lt(Object(g.a)(Object(g.a)(Object(g.a)({},e),{taskID:t}),{currentUserUid:Ye.uid}))}},disabled:!0,children:" "})},t)})):null]},e)}))}):null,x&&ce&&q&&_&&_.case_stage_id&&q[_.case_stage_id]?Object(a.jsxs)(dt.a,{schema:x.form_questions,uiSchema:x.ui_schema,formData:n,fields:{customFileUpload:function(e){return lt(Object(g.a)(Object(g.a)(Object(g.a)(Object(g.a)({},e),{taskID:Xe}),{currentUserUid:Ye.uid}),{stage:q[_.case_stage_id]}))}},disabled:"loading"===oe||"sent"===oe||"released"===oe,widgets:ct,noHtml5Validate:!0,onChange:function(e){!function(e){r(e.formData)}(e)},onFocus:function(e){console.log("That is what was focused",e),te(e.split("_")[1])},onSubmit:function(){return nt("send")},onBlur:function(e){!function(e){ce&&(console.log("Responses: ",n),console.log("That is what was blured",e),Object.keys(n).map((function(e){ce.collection("responses").doc(e).set({contents:n[e]?n[e]:j.firestore.FieldValue.delete()},{merge:!0})})))}(e)},children:["sent"===oe?Object(a.jsx)("div",{children:"\u0424\u043e\u0440\u043c\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e"}):null,"ready"===oe?Object(a.jsxs)("div",{children:[q[_.case_stage_id].additionalButtons&&q[_.case_stage_id].additionalButtons.includes("release")?Object(a.jsx)(I.a,{variant:"outlined",disabled:"loading"===oe||"sent"===oe||"released"===oe,style:{borderWidth:2,borderColor:"#003366",color:"#003366",margin:5},onClick:function(){return nt("release")},children:"\u041e\u0441\u0432\u043e\u0431\u043e\u0434\u0438\u0442\u044c"}):null,Object(a.jsx)(I.a,{type:"submit",variant:"outlined",disabled:"loading"===oe||"sent"===oe||"released"===oe,style:{borderWidth:2,borderColor:"red",color:"red",margin:5},children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"})]}):null,"released"===oe?Object(a.jsx)("div",{children:"\u0412\u044b \u043e\u0441\u0432\u043e\u0431\u043e\u0434\u0438\u043b\u0438 \u044d\u0442\u0443 \u0444\u043e\u0440\u043c\u0443 \u0438 \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442\u0435 \u0435\u0435 \u0437\u0430\u043f\u043e\u043b\u043d\u044f\u0442\u044c."}):null]}):null]}):Object(a.jsxs)(p.a,{container:!0,direction:"column",style:{padding:20},justify:"center",children:[Object(a.jsx)(F.a,{align:"center",variant:"h3",children:"\u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044c"}),Object(a.jsx)("br",{}),Object(a.jsx)(I.a,{variant:"contained",onClick:u,children:"\u0412\u043e\u0439\u0442\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google"})]})},zt=function(){var e=Object(c.useContext)(b).currentUser;return Object(a.jsx)(O.a,{children:Object(a.jsx)(p.a,{container:!0,justify:"center",children:Object(a.jsx)(z,{children:Object(a.jsxs)(h.d,{children:[Object(a.jsx)(h.b,{exact:!0,path:"/profile",children:Object(a.jsx)(_e,{})}),Object(a.jsx)(h.b,{exact:!0,path:"/request",children:Object(a.jsx)(Je,{})}),Object(a.jsx)(h.b,{exact:!0,path:"/tasks",children:Object(a.jsx)(We,{})}),Object(a.jsx)(h.b,{path:"/tasks/:id",children:Object(a.jsx)(Ve,{})}),Object(a.jsx)(h.b,{path:"/t/:id",children:Object(a.jsx)(Bt,{})}),Object(a.jsx)(h.b,{exact:!0,path:"/tasksObserver",children:Object(a.jsx)(gt,{})}),Object(a.jsx)(h.b,{exact:!0,path:"/notifications",children:Object(a.jsx)(Xe,{})}),Object(a.jsx)(h.b,{exact:!0,path:"/signin",children:Object(a.jsx)(mt,{})}),Object(a.jsx)(h.b,{exact:!0,path:"/faq",children:Object(a.jsx)(St,{})}),Object(a.jsx)(h.b,{path:"/p/:id",children:e?Object(a.jsx)(Pt,{}):Object(a.jsx)(mt,{})}),Object(a.jsx)(xt,{path:"/",component:ct})]})})})})},Rt=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,879)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,s=t.getTTFB;n(e),a(e),c(e),r(e),s(e)}))};i.a.render(Object(a.jsx)(r.a.StrictMode,{children:Object(a.jsx)(f,{children:Object(a.jsx)(zt,{})})}),document.getElementById("root")),Rt()}},[[787,1,2]]]);
//# sourceMappingURL=main.cb5e5e11.chunk.js.map