{"version":3,"sources":["util/Firebase.js","util/Auth.js","kloop_transparent_site.png","Components/Appbar/newAppBar.js","Components/form/feedback.js","Components/Dialog/FeedbackDialog.js","Components/form/LinearProgressWithLabel.js","Components/form/file.js","Components/form/textInput.js","Components/form/selectBox.js","Components/form/radiobutton.js","Components/form/timePickers.js","Components/form/checkbox.js","Components/Profile/Profile.js","Components/Tasks/Card.js","Components/Tasks/Tasks.js","Components/form/text.js","Components/form/form.js","Components/Dialog/Dialog.js","Components/Tasks/Task.js","Components/Cases/Case.js","Components/Cases/Cases.js","Components/Notifications/Notification.js","Components/Notifications/Notifications.js","Components/Home/Home.js","Components/Moderator/UserCard.js","Components/form/Loader.js","Components/form/CustomFileUpload.js","Components/Moderator/NewForm.js","Components/Moderator/ModeratedTask.js","Components/Moderator/PaginatedTasks.js","Components/Moderator/TasksObserver.js","Components/Auth/Signin.js","util/PrivateRoute.js","Components/FAQ/Card.js","Components/FAQ/FAQ.js","Components/Tasks/JSchemaCard.js","util/Utilities.js","Components/Page/Page.js","Components/form/CustomUIKField.js","Components/Tasks/JSchemaTask.js","Components/Badges/Badge.js","Components/Badges/userBadges.js","App.js","reportWebVitals.js","index.js"],"names":["firebase","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","provider","auth","GoogleAuthProvider","firestore","settings","ignoreUndefinedProperties","signInWithGoogle","setCustomParameters","prompt","signInWithPopup","AuthContext","React","createContext","AuthProvider","children","useState","currentUser","setCurrentUser","setPending","useEffect","onAuthStateChanged","user","rootRef","collection","userRef","doc","uid","get","then","exists","console","log","set","username","displayName","email","created_date","FieldValue","serverTimestamp","Provider","value","drawerWidth","useStyles","makeStyles","theme","root","display","drawer","breakpoints","up","width","flexShrink","appBar","background","boxShadow","marginLeft","menuButton","color","marginRight","spacing","toolbar","mixins","drawerPaper","content","flexGrow","padding","ResponsiveDrawer","props","window","classes","useTheme","mobileOpen","setMobileOpen","useContext","anchorEl","setAnchorEl","menuOpen","Boolean","handleDrawerToggle","moderator","setModerator","numOfMessages","setNumOfMessages","messages","setMessages","userRanks","setUserRanks","userPages","setUserPages","availableRanks","setAvailableRanks","snap","forEach","id","catch","onSnapshot","data","ranks","where","assignableRanks","push","length","snapshot","allUserPages","some","rank","includes","docChanges","change","type","prevState","newState","Object","assign","unsubscribe","size","m","count","sort","a","b","toDate","className","Divider","to","keys","map","page","key","name","container","undefined","document","body","CssBaseline","AppBar","position","Toolbar","IconButton","aria-label","edge","onClick","Grid","style","src","KloopLogo","alt","height","aria-controls","aria-haspopup","event","currentTarget","badgeContent","overlap","fill","fontSize","anchorOrigin","vertical","horizontal","keepMounted","transformOrigin","open","onClose","direction","alignItems","message","i","justify","Typography","flex","title","Button","update","shown","align","borderColor","variant","signOut","Hidden","smUp","implementation","Drawer","anchor","paper","ModalProps","xsDown","Feedback","setValue","textValue","setTextValue","returnAnswer","FormControl","const","paddingBottom","RadioGroup","onChange","target","reason","text","answers","el","FormControlLabel","control","Radio","label","disabled","locked","TextField","multiline","rows","fullWidth","AlertDialog","Dialog","state","handleClose","aria-labelledby","aria-describedby","DialogTitle","DialogContent","DialogContentText","description","returnFeedback","DialogActions","dialogFunction","feedbackValue","autoFocus","LinearProgressWithLabel","Box","mr","LinearProgress","minWidth","Math","round","File","setFormData","setShowFeedback","returnFile","feedbackType","askFeedback","saveQuestionFeedback","prevTaskId","files","multiple","BasicTextFields","forwardRef","ref","dialogOpen","setDialogOpen","setFeedback","feedbackFormData","showFeedback","index","response","attachMaterials","uploadFilesData","handleDialogClose","marginBottom","marginTop","paddingRight","formControl","maxWidth","SelectBox","setOpen","required","InputLabel","Select","labelId","onOpen","indexOf","MenuItem","RadioButton","flexWrap","textField","TimePickers","noValidate","InputLabelProps","shrink","InputProps","disableUnderline","CheckboxesGroup","setState","ready","setReady","answer","handleChange","checked","component","FormLabel","FormGroup","Checkbox","Profile","questions","setQuestions","setAnswers","forms","setForms","uploaded","setUploaded","redirect","setRedirect","setUserData","JSON","stringify","question","tmp","borderWidth","margin","mergedAnswers","q","bullet","pos","TaskCard","complete","language","cardColor","sendRequest","Card","CardContent","justifyContent","CardActions","TabPanel","other","role","hidden","p","a11yProps","paddingTop","Tasks","allTasks","setTasks","submittedTasks","setSubmitted","tasks","submitted","querySnapshot","is_complete","error","Paper","Tabs","newValue","centered","Tab","task","Form","uploadsRef","feedback_type","hideActions","showOk","handleOk","setResponses","lockButton","setLock","setCaseTasks","dialogState","setDialog","dialogType","setDialogType","releaseFeedbackData","setReleaseFeedbackData","openSnackbar","setOpenSnackbar","setFiles","uploading","setUploading","useParams","history","useHistory","handleCloseSnackbar","getQuestions","taskID","questionId","getResponses","r","responseId","getSameCaseTasks","sameCaseTasks","case_id","f","status","sq","sr","ques","t","resp","Promise","all","d","sf","res","newF","concat","getForms","file","arr","upload","storage","child","v","put","getDownloadURL","url","url_wo_token","split","entries","previousTaskId","add","user_id","timestamp","alert","saveToFirebase","lock","merge","filename","arrayUnion","public_url","handleDialogOpen","CircularProgress","release_status","release_description","Snackbar","autoHideDuration","action","Fragment","goBack","Case","caseId","disableCase","setDisable","setMessage","parseInt","order","task_type","taskType","case_type","case_stage_id","border","item","Cases","allCases","setCases","setRanks","getCasesFromFirebase","cases","c","hide","down","dt","setShown","date","opacity","paddingLeft","getDate","toString","padStart","getMonth","getFullYear","getHours","getMinutes","getSeconds","Notifications","cards","setCards","updateFirestoreStatus","Notification","queryString","require","Home","token","setToken","tgId","setTgId","makeToken","uuid","Date","now","unsubscribeUser","unsubscribeUserPrivate","oldToken","tg_token","oldDate","substring","moment","diff","newToken","tg_id","urlString","parse","location","search","processed","Link","href","transform","UserCard","userInfo","gutterBottom","surname","district","phone","Loader","fileBeingUploaded","setFileBeingUploaded","storageRef","progress","on","TaskEvent","STATE_CHANGED","bytesTransferred","totalBytes","TaskState","PAUSED","RUNNING","code","downloadURL","fileLink","secure","replace","filesLinks","contents","allowMultipleFiles","CustomFileUpload","connectingTelegram","setConnectingTelegram","telegramConnected","setTelegramConnected","currentFile","setCurrentFile","pathToFolder","handleTgConnectClick","currentUserUid","fileUpload","linksToFiles","formData","initResp","getComponent","extension","lastIndexOf","toLowerCase","controls","maxHeight","schema","stage","cleanFileLink","path","rel","metadata","delete","removeFile","comp","openDialog","JSchemaTask","formResponses","setFormResponses","taskForm","setTaskForm","mergedForm","setMergedForm","taskMetadata","setTaskMetadata","caseStages","setCaseStages","gRef","setGRef","formStatus","setFormStatus","assigned_users","changes","deletes","modifyResponses","cloneDeep","mergeForm","caseForms","tForm","cForms","start","end","start_ui_schema","end_ui_schema","form_questions","ui_schema","properties","definitions","Set","uiOrder","uiSchema","widgets","customImageWidget","customVideoWidget","customIframeWidget","frameBorder","allow","allowFullScreen","fields","customFileUpload","noHtml5Validate","e","handleFormChange","ModeratedTask","taskInfo","setTaskInfo","setPassed","setNotPassed","setVerified","setNotVerified","getReviewStatus","review_status","getData","users","find","getUserInfo","NewForm","PaginatedTasks","setPage","rowsPerPage","dataSlice","setDataSlice","calculateSlice","pageNumber","rowsPage","iData","List","numberOfPages","floor","slice","pagination","TablePagination","onChangePage","newPage","onChangeRowsPerPage","labelRowsPerPage","isAllowedToRenderTask","minHeight","xs","TasksObserver","allStages","setStages","setUsers","setUser","selectedCase","setSelectedCase","selectedStage","setSelectedStage","taskId","setTaskId","casesPath","docs","stages","setUserHandler","getUsers","usersList","usersRef","getTasks","tasksList","tasksRef","Autocomplete","options","renderInput","params","getOptionLabel","option","startIcon","Signin","PrivateRoute","RouteComponent","rest","render","routeProps","button","sendAnswer","select","FAQ","taskTypes","setTaskType","handleClickApplyFilters","tasklist","taskList","questionList","apply","NativeSelect","FormHelperText","JSchemaTaskCard","cardData","cardType","stageID","pCase","waiting","setWaiting","sendCallbackRequest","callback","callbackType","callbackName","uuidv4","FieldPath","documentId","sendCallbackRequestOld","showCard","stgId","showOldButton","complexStateFirebaseUpdate","setFunction","subState","simpleStateFirebaseUpdate","Page","pageData","setPageData","userCases","setUserCases","setAllCases","userTasks","setUserTasks","filteredStages","setFilteredStages","setCaseData","caseSelector","setCaseSelector","caseSelectorResponse","setCaseSelectorResponse","tabValue","setTabValue","availableStages","setAvailableStages","bgStages","setBgStages","filterFormData","setFilterFormData","availableTasks","setAvailableTasks","userRanksDescriptions","setUserRanksDescriptions","intersection","caseWithSelectableTasks","allAvaiableStages","ranks_read","orderBy","limit","fs","filters","emergency_form_filling","violationType","query","stageFilter","filterQuestion","newFilteredStages","caseID","stageId","ranks_write","creatable","rank_limit_number","setIntersection","maxTasksPerStage","calculatemaxTasksPerStage","countTasksPerStage","stageData","occurrences","values","countComplete","rArray","limits","largestLimit","arrA","arrB","setA","setB","_intersection","elem","has","createCaseSelectorForm","displayTasks","caseType","request","$ref","case","enum","default","dependencies","oneOf","k","checkRank","assign_without_moderator","filter","notInUserRanks","requestRank","showTaskSelector","onSubmit","hasOwnProperty","formQuestions","formUI","endProps","showFilters","CustomUIKField","formContext","JSchema","setJSchema","UIKS","setUIKS","uiksRef","taskRef","uikDataRef","conditional","uikRef","locality","prevResp","region","subregion","observers","arrayRemove","uik","allUiks","createUIKSelectorForm","uikChangeHandler","uikNumber","enumNames","uikTypes","available","customLabels","address","getAvailableUIKS","backgroundTasks","setBackgroundTasks","backgroundTaskForms","setBackgroundTaskForms","mergedBackgroundForms","setMergedBackgroundForms","backgroundResponses","setBackgroundResponses","setCurrentFocus","focusedField","setFocusedField","prevFormResponses","setPrevResponses","initialResponses","setInitialResponses","enableButton","setEnableButton","initState","mergedBgForms","requirementsSatisfied","every","checker","backgroundTasksList","backgroundStages","sendOnBlur","changeTaskStatus","reasons","extra","wordBreak","releaseFeedback_schema","releaseFeedback_ui","omitExtraData","liveOmit","changedValues","isEqual","onFocus","onBlur","handleBlur","additionalButtons","Badge","prefix","badges","setBadges","file_url","UserBadges","fetchImage","blob","resolve","reader","FileReader","onload","result","readAsDataURL","dataUrl","downloadUrlAsPromise","reject","xhr","XMLHttpRequest","responseType","onreadystatechange","evt","readyState","Error","send","getPdfFromImage","pdfDoc","jsPDF","addImage","save","App","exact","Task","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.26f243e6.chunk.js","sourcesContent":["import firebase from 'firebase';\r\n\r\nconst firebaseConfig = {\r\n    apiKey: \"AIzaSyBfzhQOCtbcUk_tWjPDnjYtHwoouCEkclg\",\r\n    authDomain: \"journal-bb5e3.firebaseapp.com\",\r\n    databaseURL: \"https://journal-bb5e3.firebaseio.com\",\r\n    projectId: \"journal-bb5e3\",\r\n    storageBucket: \"journal-bb5e3.appspot.com\",\r\n    messagingSenderId: \"918752509407\",\r\n    appId: \"1:918752509407:web:77670a68ff906f13e5d86a\"\r\n};\r\n  // Initialize Firebase\r\n  firebase.initializeApp(firebaseConfig);\r\n  // const db = firebase.firestore();\r\n  // if (window.location.hostname === \"localhost\") {\r\n  //   db.useEmulator(\"localhost\", 8080);\r\n  // }\r\n\r\n  const provider = new firebase.auth.GoogleAuthProvider();\r\n  firebase.firestore().settings({\r\n    ignoreUndefinedProperties: true,\r\n  })\r\n  export const signInWithGoogle = () => {\r\n    provider.setCustomParameters({\r\n      prompt: 'select_account'\r\n    });\r\n    firebase.auth().signInWithPopup(provider);\r\n  };\r\n\r\n  // export {db}\r\n\r\nexport default firebase;","import React, { useEffect, useState } from \"react\";\r\nimport firebase from \"./Firebase\";\r\n\r\nexport const AuthContext = React.createContext();\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [currentUser, setCurrentUser] = useState(null);\r\n  const [pending, setPending] = useState(true);\r\n\r\n  useEffect(() => {\r\n    firebase.auth().onAuthStateChanged((user) => {\r\n      setCurrentUser(user)\r\n      setPending(false)\r\n      let rootRef = firebase.firestore().collection(\"users\")\r\n      if (user) {\r\n        let userRef = rootRef.doc(user.uid)\r\n        userRef.get().then(doc => {\r\n          if (doc && doc.exists) {\r\n              // pass\r\n              console.log('User Exist')\r\n          }\r\n          else {\r\n            console.log(\"Creating user\")\r\n            userRef.set(\r\n              {\r\n                username: user.displayName,\r\n                email: user.email,\r\n                created_date: firebase.firestore.FieldValue.serverTimestamp()\r\n              }\r\n            )\r\n          }\r\n        })\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  // if(pending){\r\n  //   return <>Loading...</>\r\n  // }\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        currentUser\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n","export default __webpack_public_path__ + \"static/media/kloop_transparent_site.f6fb098e.png\";","import React, { useContext, useState, useEffect } from 'react';\r\nimport { AuthContext } from '../../util/Auth';\r\nimport firebase, { signInWithGoogle } from '../../util/Firebase'\r\nimport PropTypes from 'prop-types';\r\nimport AppBar from '@material-ui/core/AppBar';\r\nimport CssBaseline from '@material-ui/core/CssBaseline';\r\nimport Divider from '@material-ui/core/Divider';\r\nimport Drawer from '@material-ui/core/Drawer';\r\nimport Hidden from '@material-ui/core/Hidden';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport InboxIcon from '@material-ui/icons/MoveToInbox';\r\nimport List from '@material-ui/core/List';\r\nimport ListItem from '@material-ui/core/ListItem';\r\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\r\nimport ListItemText from '@material-ui/core/ListItemText';\r\nimport MailIcon from '@material-ui/icons/Mail';\r\nimport MenuIcon from '@material-ui/icons/Menu';\r\nimport Menu from '@material-ui/core/Menu';\r\nimport Toolbar from '@material-ui/core/Toolbar';\r\nimport Button from '@material-ui/core/Button';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport { makeStyles, useTheme } from '@material-ui/core/styles';\r\nimport KloopLogo from '../../kloop_transparent_site.png'\r\nimport NotificationsIcon from '@material-ui/icons/Notifications';\r\nimport { Badge } from '@material-ui/core';\r\nimport Grid from '@material-ui/core/Grid'\r\n\r\nimport {\r\n\tLink\r\n} from \"react-router-dom\";\r\n\r\nconst drawerWidth = 240;\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n\troot: {\r\n\t\tdisplay: 'flex',\r\n\t},\r\n\tdrawer: {\r\n\t\t[theme.breakpoints.up('sm')]: {\r\n\t\t\twidth: drawerWidth,\r\n\t\t\tflexShrink: 0,\r\n\t\t},\r\n\t},\r\n\tappBar: {\r\n\t\tbackground: 'white',\r\n\t\tboxShadow: 'none',\r\n\t\t[theme.breakpoints.up('sm')]: {\r\n\t\t\twidth: `calc(100% - ${drawerWidth}px)`,\r\n\t\t\tmarginLeft: drawerWidth,\r\n\t\t},\r\n\t},\r\n\tmenuButton: {\r\n\t\tcolor: 'black',\r\n\t\tmarginRight: theme.spacing(2),\r\n\t\t[theme.breakpoints.up('sm')]: {\r\n\t\t\tdisplay: 'none',\r\n\t\t},\r\n\t},\r\n\t// necessary for content to be below app bar\r\n\ttoolbar: theme.mixins.toolbar,\r\n\tdrawerPaper: {\r\n\t\twidth: drawerWidth,\r\n\t},\r\n\tcontent: {\r\n\t\tflexGrow: 1,\r\n\t\tpadding: theme.spacing(3),\r\n\t},\r\n}));\r\n\r\nfunction ResponsiveDrawer(props) {\r\n\tconst { window } = props;\r\n\tconst classes = useStyles();\r\n\tconst theme = useTheme();\r\n\tconst [mobileOpen, setMobileOpen] = React.useState(false);\r\n\tconst { currentUser } = useContext(AuthContext);\r\n\tconst [anchorEl, setAnchorEl] = React.useState(null);\r\n\tconst menuOpen = Boolean(anchorEl);\r\n\r\n\tconst handleDrawerToggle = () => {\r\n\t\tsetMobileOpen(!mobileOpen);\r\n\t};\r\n\r\n\r\n\tconst [moderator, setModerator] = useState(false)\r\n\tconst [numOfMessages, setNumOfMessages] = useState(0)\r\n\tconst [messages, setMessages] = useState([])\r\n\tconst [userRanks, setUserRanks] = useState([])\r\n\tconst [userPages, setUserPages] = useState({})\r\n\tconst [availableRanks, setAvailableRanks] = useState([])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (currentUser) {\r\n\t\t\tfirebase.firestore().collection('editors').get().then((snap) => {\r\n\t\t\t\tsnap.forEach(doc => {\r\n\t\t\t\t\tif (doc.id === currentUser.uid) {\r\n\t\t\t\t\t\tconsole.log('moderator')\r\n\t\t\t\t\t\tsetModerator(true)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}).catch(() => setModerator(false))\r\n\t\t}\r\n\t}, [currentUser])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (currentUser) {\r\n\t\t\tfirebase\r\n\t\t\t\t.firestore()\r\n\t\t\t\t.collection('users')\r\n\t\t\t\t.doc(currentUser.uid)\r\n\t\t\t\t.collection(\"user_private\")\r\n\t\t\t\t.doc(\"private\")\r\n\t\t\t\t.onSnapshot(doc => {\r\n\t\t\t\t\tif (doc.data()) {\r\n\t\t\t\t\t\tsetUserRanks(doc.data().ranks)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t}\r\n\t}, [currentUser])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (currentUser) {\r\n\t\t\tfirebase\r\n\t\t\t\t.firestore()\r\n\t\t\t\t.collection('schema')\r\n\t\t\t\t.doc('structure')\r\n\t\t\t\t.collection(\"ranks\")\r\n\t\t\t\t.where('assign_without_moderator', '==', true)\r\n\t\t\t\t.get().then(snap => {\r\n\t\t\t\t\tlet assignableRanks = []\r\n\t\t\t\t\tsnap.forEach(doc => {\r\n\t\t\t\t\t\tassignableRanks.push(doc.id)\r\n\t\t\t\t\t})\r\n\t\t\t\t\tconsole.log(\"Assignable\", assignableRanks)\r\n\t\t\t\t\treturn assignableRanks\r\n\t\t\t\t\t// setAvailableRanks(assignableRanks)\r\n\r\n\t\t\t\t}).then(ranks => setAvailableRanks(ranks))\r\n\t\t}\r\n\t}, [currentUser])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (userRanks && userRanks.length > 0) {\r\n\t\t\tfirebase\r\n\t\t\t\t.firestore()\r\n\t\t\t\t.collection('pages')\r\n\t\t\t\t// .where(\"ranks\", \"array-contains-any\", userRanks)\r\n\t\t\t\t.onSnapshot(snapshot => {\r\n\t\t\t\t\t// snapshot.docChanges().forEach(change => {\r\n\t\t\t\t\t// \tif (change.type === \"added\" || change.type === \"modified\") {\r\n\t\t\t\t\t// \t\tsetUserPages(prevState => {\r\n\t\t\t\t\t// \t\t\treturn { ...prevState, [change.doc.id]: change.doc.data() }\r\n\t\t\t\t\t// \t\t})\r\n\t\t\t\t\t// \t\tconsole.log(\"User pages: \", change.doc.id)\r\n\t\t\t\t\t// \t}\r\n\t\t\t\t\t// \tif (change.type === \"removed\") {\r\n\t\t\t\t\t// \t\tsetUserPages(prevState => {\r\n\t\t\t\t\t// \t\t\tconst newState = Object.assign({}, prevState)\r\n\t\t\t\t\t// \t\t\tdelete newState[change.doc.id]\r\n\t\t\t\t\t// \t\t\treturn newState\r\n\t\t\t\t\t// \t\t})\r\n\t\t\t\t\t// \t}\r\n\t\t\t\t\t// })\r\n\t\t\t\t\tlet allUserPages = {}\r\n\t\t\t\t\tsnapshot.forEach(doc => {\r\n\t\t\t\t\t\tif (doc.data().ranks) {\r\n\t\t\t\t\t\t\tlet available = doc.data().ranks.some(rank => userRanks.includes(rank))\r\n\t\t\t\t\t\t\tif (available) {\r\n\t\t\t\t\t\t\t\tallUserPages[doc.id] = doc.data()\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\tsetUserPages(allUserPages)\r\n\t\t\t\t})\r\n\t\t}\r\n\t}, [userRanks])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (availableRanks && availableRanks.length > 0) {\r\n\t\t\tfirebase\r\n\t\t\t\t.firestore()\r\n\t\t\t\t.collection('pages')\r\n\t\t\t\t.where(\"ranks\", \"array-contains-any\", availableRanks)\r\n\t\t\t\t.onSnapshot(snapshot => {\r\n\t\t\t\t\tsnapshot.docChanges().forEach(change => {\r\n\t\t\t\t\t\tif (change.type === \"added\" || change.type === \"modified\") {\r\n\t\t\t\t\t\t\tsetUserPages(prevState => {\r\n\t\t\t\t\t\t\t\treturn { ...prevState, [change.doc.id]: change.doc.data() }\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tconsole.log(\"User pages assign: \", change.doc.id)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (change.type === \"removed\") {\r\n\t\t\t\t\t\t\tsetUserPages(prevState => {\r\n\t\t\t\t\t\t\t\tconst newState = Object.assign({}, prevState)\r\n\t\t\t\t\t\t\t\tdelete newState[change.doc.id]\r\n\t\t\t\t\t\t\t\treturn newState\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t}\r\n\t}, [availableRanks])\r\n\r\n\r\n\tuseEffect(() => {\r\n\t\tlet unsubscribe = () => { }\r\n\t\tif (currentUser) {\r\n\t\t\tfirebase.firestore()\r\n\t\t\t\t.collection('notifications')\r\n\t\t\t\t.where('user_id', 'array-contains', currentUser.uid)\r\n\t\t\t\t.where('shown', '!=', true)\r\n\t\t\t\t.onSnapshot(snap => {\r\n\t\t\t\t\tconsole.log(snap.size)\r\n\t\t\t\t\tlet m = []\r\n\t\t\t\t\tlet count = 0\r\n\t\t\t\t\tsnap.forEach(doc => {\r\n\t\t\t\t\t\tm.push({ id: doc.id, ...doc.data() })\r\n\t\t\t\t\t\tcount++\r\n\t\t\t\t\t})\r\n\t\t\t\t\tm.sort((a, b) => b.created_date.toDate() - a.created_date.toDate())\r\n\t\t\t\t\tsetNumOfMessages(count)\r\n\t\t\t\t\tsetMessages(m)\r\n\t\t\t\t})\r\n\t\t}\r\n\t\treturn () => unsubscribe\r\n\t}, [currentUser])\r\n\r\n\tconst updateFirestoreStatus = (id, index) => {\r\n\t\tfirebase.firestore().collection('notifications').doc(id).update({ shown: true })\r\n\t}\r\n\r\n\tconst handleMenu = (event) => {\r\n\t\tsetAnchorEl(event.currentTarget);\r\n\t};\r\n\r\n\tconst handleMenuClose = () => {\r\n\t\tsetAnchorEl(null)\r\n\t}\r\n\r\n\tconst drawer = (\r\n\t\t<div>\r\n\t\t\t<div className={classes.toolbar} />\r\n\t\t\t<Divider />\r\n\t\t\t<nav>\r\n\t\t\t\t<ul>\r\n\t\t\t\t\t<li>\r\n\t\t\t\t\t\t<Link to=\"/\"></Link>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t\t<li>\r\n\t\t\t\t\t\t<Link to=\"/profile\"></Link>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t\t{/* <li>\r\n\t\t\t\t\t\t<Link to=\"/tasks\"></Link>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t\t<li>\r\n\t\t\t\t\t\t<Link to=\"/request\"> </Link>\r\n\t\t\t\t\t</li> */}\r\n\t\t\t\t\t<li>\r\n\t\t\t\t\t\t<Link to=\"/notifications\"></Link>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t\t<li>\r\n\t\t\t\t\t\t<Link to=\"/mybadges\"></Link>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t\t{moderator ? <li>\r\n\t\t\t\t\t\t<Link to=\"/tasksObserver\"></Link>\r\n\t\t\t\t\t</li> : null}\r\n\t\t\t\t\t{/* {moderator ? <li>\r\n\t\t\t\t\t\t<Link to=\"/faq\">FAQ  </Link>\r\n\t\t\t\t\t</li> : null} */}\r\n\t\t\t\t</ul>\r\n\t\t\t\t<ul>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tObject.keys(userPages).map(page => {\r\n\t\t\t\t\t\t\treturn <li key={page}> <Link to={\"/p/\" + page}>\r\n\t\t\t\t\t\t\t\t{userPages[page].name}\r\n\t\t\t\t\t\t\t</Link> </li>\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t</ul>\r\n\t\t\t</nav>\r\n\t\t</div>\r\n\t);\r\n\r\n\tconst container = window !== undefined ? () => window().document.body : undefined;\r\n\r\n\treturn (\r\n\t\t<div className={classes.root}>\r\n\t\t\t<CssBaseline />\r\n\t\t\t<AppBar position=\"fixed\" className={classes.appBar}>\r\n\t\t\t\t<Toolbar>\r\n\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\tcolor=\"inherit\"\r\n\t\t\t\t\t\taria-label=\"open drawer\"\r\n\t\t\t\t\t\tedge=\"start\"\r\n\t\t\t\t\t\tonClick={handleDrawerToggle}\r\n\t\t\t\t\t\tclassName={classes.menuButton}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<MenuIcon />\r\n\t\t\t\t\t</IconButton>\r\n\t\t\t\t\t<Grid container style={{ flexGrow: 1 }}>\r\n\t\t\t\t\t\t<img src={KloopLogo} alt=\"Kloop.kg -  \" style={{ width: 150, height: 'auto' }} />\r\n\t\t\t\t\t\t{/* <img src=\"https://kloop.kg/wp-content/uploads/2017/01/kloop_transparent_site.png\" alt=\"Kloop.kg -  \" style={{ width: 150, height: 'auto' }} /> */}\r\n\t\t\t\t\t\t{/* <Typography variant=\"h5\" style={{ color: \"black\" }}>Journal</Typography> */}\r\n\t\t\t\t\t</Grid>\r\n\t\t\t\t\t{currentUser &&\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\t\t\taria-label=\"account of current user\"\r\n\t\t\t\t\t\t\t\taria-controls=\"menu-appbar\"\r\n\t\t\t\t\t\t\t\taria-haspopup=\"true\"\r\n\t\t\t\t\t\t\t\tonClick={handleMenu}\r\n\t\t\t\t\t\t\t\tcolor=\"inherit\"\r\n\t\t\t\t\t\t\t\tsize=\"small\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<Badge badgeContent={numOfMessages} color=\"secondary\" overlap=\"circle\" >\r\n\t\t\t\t\t\t\t\t\t<NotificationsIcon style={{ fill: 'grey', fontSize: '28px' }} />\r\n\t\t\t\t\t\t\t\t</Badge>\r\n\t\t\t\t\t\t\t</IconButton>\r\n\t\t\t\t\t\t\t<Menu\r\n\t\t\t\t\t\t\t\tid=\"menu-appbar\"\r\n\t\t\t\t\t\t\t\tanchorEl={anchorEl}\r\n\t\t\t\t\t\t\t\tanchorOrigin={{\r\n\t\t\t\t\t\t\t\t\tvertical: 'top',\r\n\t\t\t\t\t\t\t\t\thorizontal: 'right',\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\tkeepMounted\r\n\t\t\t\t\t\t\t\ttransformOrigin={{\r\n\t\t\t\t\t\t\t\t\tvertical: 'top',\r\n\t\t\t\t\t\t\t\t\thorizontal: 'right',\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\topen={menuOpen}\r\n\t\t\t\t\t\t\t\tonClose={handleMenuClose}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<Grid container direction=\"column\" alignItems=\"center\" >\r\n\t\t\t\t\t\t\t\t\t{messages.length > 0 ? messages.map((message, i) => (\r\n\t\t\t\t\t\t\t\t\t\t<Grid container key={message.id} className={classes.message} justify=\"flex-start\" style={{ padding: 0 }}>\r\n\t\t\t\t\t\t\t\t\t\t\t<Typography style={{ flex: 1, padding: 10 }}>{message.title}</Typography>\r\n\t\t\t\t\t\t\t\t\t\t\t<Button style={{ padding: 10 }} onClick={() => updateFirestoreStatus(message.id)} size=\"small\"></Button>\r\n\t\t\t\t\t\t\t\t\t\t</Grid>\r\n\t\t\t\t\t\t\t\t\t)) : <Typography className={classes.message} align=\"center\" style={{ padding: 10 }}>  </Typography>}\r\n\t\t\t\t\t\t\t\t</Grid>\r\n\t\t\t\t\t\t\t</Menu>\r\n\t\t\t\t\t\t</div>}\r\n\t\t\t\t\t{currentUser\r\n\t\t\t\t\t\t?\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<span style={{ color: 'black', fontSize: 12, marginLeft: 7 }}>\r\n\t\t\t\t\t\t\t\t{currentUser.email}\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t<Button style={{ borderColor: \"black\", color: 'black', marginLeft: 10, fontSize: 12 }}\r\n\t\t\t\t\t\t\t\tvariant=\"outlined\" size=\"small\"\r\n\t\t\t\t\t\t\t\tonClick={() => firebase.auth().signOut()}>\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t: <Button style={{ borderColor: \"black\", color: 'black', marginLeft: 10, fontSize: 12 }} size=\"small\" variant=\"outlined\" onClick={signInWithGoogle}></Button>\r\n\t\t\t\t\t}\r\n\t\t\t\t</Toolbar>\r\n\t\t\t</AppBar>\r\n\t\t\t<nav className={classes.drawer} aria-label=\"mailbox folders\">\r\n\t\t\t\t{/* The implementation can be swapped with js to avoid SEO duplication of links. */}\r\n\t\t\t\t<Hidden smUp implementation=\"css\">\r\n\t\t\t\t\t<Drawer\r\n\t\t\t\t\t\tcontainer={container}\r\n\t\t\t\t\t\tvariant=\"temporary\"\r\n\t\t\t\t\t\tanchor={theme.direction === 'rtl' ? 'right' : 'left'}\r\n\t\t\t\t\t\topen={mobileOpen}\r\n\t\t\t\t\t\tonClose={handleDrawerToggle}\r\n\t\t\t\t\t\tclasses={{\r\n\t\t\t\t\t\t\tpaper: classes.drawerPaper,\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tModalProps={{\r\n\t\t\t\t\t\t\tkeepMounted: true, // Better open performance on mobile.\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{drawer}\r\n\t\t\t\t\t</Drawer>\r\n\t\t\t\t</Hidden>\r\n\t\t\t\t<Hidden xsDown implementation=\"css\">\r\n\t\t\t\t\t<Drawer\r\n\t\t\t\t\t\tclasses={{\r\n\t\t\t\t\t\t\tpaper: classes.drawerPaper,\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tvariant=\"permanent\"\r\n\t\t\t\t\t\topen\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{drawer}\r\n\t\t\t\t\t</Drawer>\r\n\t\t\t\t</Hidden>\r\n\t\t\t</nav>\r\n\t\t\t<main className={classes.content}>\r\n\t\t\t\t<div className={classes.toolbar} />\r\n\t\t\t\t{props.children}\r\n\t\t\t</main>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nResponsiveDrawer.propTypes = {\r\n\t/**\r\n\t * Injected by the documentation to work in an iframe.\r\n\t * You won't need it on your project.\r\n\t */\r\n\twindow: PropTypes.func,\r\n};\r\n\r\nexport default ResponsiveDrawer;\r\n","import React, { useState } from 'react';\r\nimport Radio from '@material-ui/core/Radio';\r\nimport RadioGroup from '@material-ui/core/RadioGroup';\r\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\r\nimport FormControl from '@material-ui/core/FormControl';\r\nimport TextField from '@material-ui/core/TextField';\r\n\r\n\r\nconst Feedback = (props) => {\r\n\r\n    const [value, setValue] = useState(null)\r\n    const [textValue, setTextValue] = useState('')\r\n    const { returnAnswer } = props\r\n\r\n    const handleChange = (event) => {\r\n        setValue(event.target.value)\r\n        returnAnswer({reason: event.target.value, text: textValue})\r\n    };\r\n\r\n    const handleTextChange = (event) => {\r\n        setTextValue(event.target.value)\r\n        returnAnswer({reason: value, text: event.target.value})\r\n    }\r\n\r\n\r\n\r\n    return (\r\n        <div>\r\n            <h4>{props.title}</h4>\r\n            <FormControl const='fieldset' style={{paddingBottom: 15}}>\r\n                <RadioGroup aria-label={props.title} name={props.title} value={value} onChange={handleChange}>\r\n                    {props.answers.map((el, i) => <FormControlLabel\r\n                        key={i}\r\n                        value={el}\r\n                        control={<Radio color=\"primary\" />}\r\n                        label={el}\r\n                        disabled={props.locked ? true : false} />)}\r\n                </RadioGroup>\r\n            </FormControl>\r\n            <TextField\r\n                id={\"feedback_input\"}\r\n                label=\"\"\r\n                value={textValue}\r\n                onChange={handleTextChange}\r\n                // required={required}\r\n                multiline\r\n                rows={5}\r\n                variant=\"outlined\"\r\n                fullWidth\r\n            />\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Feedback","import React from 'react';\r\nimport Button from '@material-ui/core/Button';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport DialogActions from '@material-ui/core/DialogActions';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport DialogContentText from '@material-ui/core/DialogContentText';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\nimport Typography from '@material-ui/core/Typography';\r\n\r\nimport Feedback from '../form/feedback'\r\n\r\n\r\nexport default function AlertDialog(props) {\r\n\r\n  return (\r\n    <div>\r\n      <Dialog\r\n        open={props.state}\r\n        onClose={props.handleClose}\r\n        aria-labelledby=\"alert-dialog-title\"\r\n        aria-describedby=\"alert-dialog-description\"\r\n      >\r\n        <DialogTitle id=\"alert-dialog-title\">{props.title}</DialogTitle>\r\n        <DialogContent>\r\n          <DialogContentText id=\"alert-dialog-description\">\r\n            <Typography>{props.description}</Typography>\r\n            <Feedback answers={props.answers} returnAnswer={props.returnFeedback} />\r\n          </DialogContentText>\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={props.handleClose} color=\"primary\">\r\n            \r\n          </Button>\r\n          <Button onClick={props.dialogFunction} disabled={!props.feedbackValue.reason} color=\"primary\" autoFocus>\r\n            \r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n}\r\n","import React, {useState} from 'react'\r\nimport LinearProgress from '@material-ui/core/LinearProgress'\r\nimport Box from '@material-ui/core/Box'\r\nimport Typography from '@material-ui/core/Typography'\r\n\r\nconst LinearProgressWithLabel = (props) => {\r\n    return (\r\n      <Box display=\"flex\" alignItems=\"center\">\r\n        <Box width=\"100%\" mr={1}>\r\n          <LinearProgress variant=\"determinate\" {...props} />\r\n        </Box>\r\n        <Box minWidth={35}>\r\n          <Typography variant=\"body2\" color=\"textSecondary\">{`${Math.round(\r\n            props.value,\r\n          )}%`}</Typography>\r\n        </Box>\r\n      </Box>\r\n    );\r\n  }\r\n\r\nexport default LinearProgressWithLabel","import React, { useContext, useEffect, useRef, useState } from 'react';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport TextField from '@material-ui/core/TextField';\r\nimport { Typography, IconButton, Box, Button, Snackbar } from '@material-ui/core';\r\nimport FeedbackIcon from '@material-ui/icons/Feedback';\r\nimport FeedbackDialog from '../Dialog/FeedbackDialog'\r\nimport Feedback from './feedback'\r\n\r\nimport firebase from '../../util/Firebase'\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    root: {\r\n        '& > *': {\r\n            width: '40ch',\r\n        },\r\n    },\r\n\r\n}));\r\n\r\n\r\nconst File = (props) => {\r\n    const classes = useStyles();\r\n    const [value, setValue] = React.useState('');\r\n    const [dialogOpen, setDialogOpen] = useState(false)\r\n    const [feedbackValue, setFeedback] = useState({})\r\n    const [feedbackFormData, setFormData] = useState({})\r\n    const [showFeedback, setShowFeedback] = useState(false)\r\n\r\n    const { returnFile, locked, id, feedbackType, askFeedback, saveQuestionFeedback, prevTaskId } = props\r\n\r\n    useEffect(() => {\r\n        console.log(feedbackType)\r\n        if (feedbackType && askFeedback) {\r\n            console.log(feedbackType)\r\n            firebase.firestore().collection('schema').doc('structure').collection('feedbacks').doc(feedbackType).get().then(doc => {\r\n                setFormData(doc.data())\r\n            })\r\n            setShowFeedback(true)\r\n        }\r\n        else {\r\n            setShowFeedback(false)\r\n        }\r\n    }, [feedbackType])\r\n\r\n    const handleChange = (event) => {\r\n        returnFile(event.target.files, id)\r\n    };\r\n\r\n    const sendFeedback = () => {\r\n        saveQuestionFeedback(feedbackValue, id, prevTaskId)\r\n        handleDialogClose()\r\n    }\r\n\r\n    const returnFeedback = (value) => {\r\n        setFeedback(value)\r\n    }\r\n\r\n\r\n    const handleDialogClose = () => {\r\n        setDialogOpen(false)\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            {/* <FeedbackDialog\r\n                title={feedbackFormData.title}\r\n                dialogFunction={sendFeedback}\r\n                state={dialogOpen}\r\n                handleClose={handleDialogClose}\r\n                feedbackValue={feedbackValue}\r\n                answers={feedbackFormData.answers}\r\n                description={feedbackFormData.description}\r\n                returnFeedback={returnFeedback}\r\n            />\r\n            <Box display=\"flex\" style={{ marginBottom: 10, marginTop: 20 }}>\r\n                <Typography variant=\"h6\" style={{ paddingRight: 8 }}>{props.title}</Typography>\r\n                {showFeedback && <IconButton size=\"small\" onClick={() => setDialogOpen(true)}><FeedbackIcon color=\"primary\" /></IconButton>}\r\n            </Box> */}\r\n            <input\r\n                    type=\"file\"\r\n                    onChange={handleChange}\r\n                    multiple\r\n                />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default File","import React, { forwardRef, useEffect, useRef, useState } from 'react';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport TextField from '@material-ui/core/TextField';\r\nimport { Typography, IconButton, Box } from '@material-ui/core';\r\nimport FeedbackIcon from '@material-ui/icons/Feedback';\r\nimport FeedbackDialog from '../Dialog/FeedbackDialog'\r\nimport Feedback from './feedback'\r\nimport FirebaseFileUploader from './FirebaseFileUploader'\r\nimport File from './file'\r\n\r\nimport firebase from '../../util/Firebase'\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n\troot: {\r\n\t\t'& > *': {\r\n\t\t\twidth: '40ch',\r\n\t\t},\r\n\t},\r\n\r\n}));\r\n\r\n\r\nconst BasicTextFields = forwardRef((props, ref) => {\r\n\tconst classes = useStyles();\r\n\tconst [value, setValue] = React.useState('');\r\n\tconst [dialogOpen, setDialogOpen] = useState(false)\r\n\tconst [answer, setAnswer] = useState(null)\r\n\tconst [feedbackValue, setFeedback] = useState({})\r\n\tconst [feedbackFormData, setFormData] = useState({})\r\n\tconst [showFeedback, setShowFeedback] = useState(false)\r\n\r\n\tconst { index, response, returnFile, locked, id, feedbackType, askFeedback, saveQuestionFeedback, prevTaskId, uploadFilesData, attachMaterials } = props\r\n\r\n\tuseEffect(() => {\r\n\t\tif (response) {\r\n\t\t\tsetValue(response)\r\n\t\t}\r\n\t}, [response])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (feedbackType && askFeedback) {\r\n\t\t\tconsole.log(feedbackType)\r\n\t\t\tfirebase.firestore().collection('schema').doc('structure').collection('feedbacks').doc(feedbackType).get().then(doc => {\r\n\t\t\t\tsetFormData(doc.data())\r\n\t\t\t})\r\n\t\t\tsetShowFeedback(true)\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsetShowFeedback(false)\r\n\t\t}\r\n\t}, [feedbackType])\r\n\r\n\tconst handleChange = (event) => {\r\n\t\tsetValue(event.target.value)\r\n\t\tprops.returnAnswer(event.target.value, props.index)\r\n\t};\r\n\r\n\tconst sendFeedback = () => {\r\n\t\tsaveQuestionFeedback(feedbackValue, id, prevTaskId)\r\n\t\thandleDialogClose()\r\n\t}\r\n\r\n\tconst returnFeedback = (value) => {\r\n\t\tsetFeedback(value)\r\n\t}\r\n\r\n\r\n\tconst handleDialogClose = () => {\r\n\t\tsetDialogOpen(false)\r\n\t}\r\n\r\n\tconst handleFilesUpload = (filename, downloadURL) => {\r\n\t\tuploadFilesData(filename, downloadURL, id)\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div>\r\n\t\t\t<FeedbackDialog\r\n\t\t\t\ttitle={feedbackFormData.title}\r\n\t\t\t\tdialogFunction={sendFeedback}\r\n\t\t\t\tstate={dialogOpen}\r\n\t\t\t\thandleClose={handleDialogClose}\r\n\t\t\t\tfeedbackValue={feedbackValue}\r\n\t\t\t\tanswers={feedbackFormData.answers}\r\n\t\t\t\tdescription={feedbackFormData.description}\r\n\t\t\t\treturnFeedback={returnFeedback}\r\n\t\t\t/>\r\n\t\t\t<Box display=\"flex\" style={{ marginBottom: 10, marginTop: 20 }}>\r\n\t\t\t\t<Typography variant=\"h6\" style={{ paddingRight: 8 }}>{props.title}</Typography>\r\n\t\t\t\t{showFeedback && <IconButton size=\"small\" onClick={() => setDialogOpen(true)}><FeedbackIcon color=\"primary\" /></IconButton>}\r\n\t\t\t</Box>\r\n\t\t\t<TextField\r\n\t\t\t\tid={\"inputBox\" + index}\r\n\t\t\t\tlabel=\" \"\r\n\t\t\t\tvalue={value}\r\n\t\t\t\tonChange={handleChange}\r\n\t\t\t\t// required={required}\r\n\t\t\t\tmultiline\r\n\t\t\t\trows={5}\r\n\t\t\t\tdisabled={locked}\r\n\t\t\t\tvariant=\"outlined\"\r\n\t\t\t\tfullWidth\r\n\t\t\t/>\r\n\t\t\t{!locked && attachMaterials && <File returnFile={returnFile} locked={locked} id={id} />}\r\n\t\t\t{/* <FirebaseFileUploader\r\n                ref={ref}\r\n                title={\"\"}\r\n                index={index}\r\n                uploadFilesData={handleFilesUpload}\r\n            /> */}\r\n\t\t</div>\r\n\t);\r\n})\r\n\r\nexport default BasicTextFields","import React, { useEffect } from 'react';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport InputLabel from '@material-ui/core/InputLabel';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport FormControl from '@material-ui/core/FormControl';\r\nimport Select from '@material-ui/core/Select';\r\nimport { Typography } from '@material-ui/core';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n\tformControl: {\r\n\t\tminWidth: 100,\r\n\t\tmaxWidth: 300\r\n\t},\r\n}));\r\n\r\nexport default function SelectBox(props) {\r\n\tconst classes = useStyles();\r\n\tconst [value, setValue] = React.useState('');\r\n\tconst [open, setOpen] = React.useState(false);\r\n\r\n\tconst {index, response, required, locked } = props\r\n\r\n\tuseEffect(() => {\r\n\t\tif (response) {\r\n\t\t\t// console.log(props.answers[response])\r\n\t\t\t// setValue(props.answers[response])\r\n\t\t\tsetValue(response)\r\n\t\t}\r\n\t}, [response])\r\n\r\n\tconst handleChange = (event) => {\r\n\t\tsetValue(event.target.value);\r\n\t\tlet id = props.answers.indexOf(event.target.value)\r\n\t\tprops.returnAnswer(event.target.value, index)\r\n\t};\r\n\r\n\tconst handleClose = (event) => {\r\n\t\tsetOpen(false)\r\n\t};\r\n\r\n\tconst handleOpen = (event) => {\r\n\t\tsetOpen(true)\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div>\r\n\t\t\t<Typography variant=\"h6\" style={{marginBottom: 5, marginTop: 20}}>{props.title}</Typography>\r\n\t\t\t<FormControl className={classes.formControl} disabled={locked}>\r\n\t\t\t\t<InputLabel id=\"controlled-open-select-label\"></InputLabel>\r\n\t\t\t\t<Select\r\n\t\t\t\t\tlabelId=\"controlled-open-select-label\"\r\n\t\t\t\t\tid={\"select\" + index}\r\n\t\t\t\t\topen={open}\r\n\t\t\t\t\tonClose={handleClose}\r\n\t\t\t\t\tonOpen={handleOpen}\r\n\t\t\t\t\tvalue={value}\r\n\t\t\t\t\tonChange={handleChange}>\r\n\t\t\t\t\t<MenuItem value={\"\"}><em>None</em></MenuItem>\r\n\t\t\t\t\t{props.answers.map((el, i) => <MenuItem key={i} value={el}>{el}</MenuItem>)}\r\n\t\t\t\t</Select>\r\n\t\t\t</FormControl>\r\n\t\t</div>\r\n\t)\r\n\r\n}","import React, { useEffect } from 'react';\r\nimport Radio from '@material-ui/core/Radio';\r\nimport RadioGroup from '@material-ui/core/RadioGroup';\r\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\r\nimport FormControl from '@material-ui/core/FormControl';\r\n\r\nexport default function RadioButton(props) {\r\n\tconst [value, setValue] = React.useState('');\r\n\tconst {index, response} = props\r\n\r\n\tuseEffect(() => {\r\n\t\tif (response) {\r\n\t\t\tsetValue(response)\r\n\t\t}\r\n\t}, [response])\r\n\r\n\tconst handleChange = (event) => {\r\n\t\tsetValue(event.target.value)\r\n\t\tlet id = props.answers.indexOf(event.target.value)\r\n\t\tprops.returnAnswer(event.target.value, index, id)\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div>\r\n\t\t\t<h4>{props.title}</h4>\r\n\t\t\t<FormControl const='fieldset'>\r\n\t\t\t\t<RadioGroup aria-label={props.title} name={props.title} value={value} onChange={handleChange}>\r\n\t\t\t\t\t{props.answers.map((el, i) => <FormControlLabel \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tkey={i} \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={el} \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcontrol={<Radio color=\"primary\" />} \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlabel={el} \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={props.locked ? true : false} />)}\r\n\t\t\t\t</RadioGroup>\r\n\t\t\t</FormControl>\r\n\t\t</div>\r\n\t)\r\n\t\t;\r\n}","import React, { useEffect } from 'react';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport TextField from '@material-ui/core/TextField';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n\tcontainer: {\r\n\t\tdisplay: 'flex',\r\n\t\tflexWrap: 'wrap',\r\n\t},\r\n\ttextField: {\r\n\t\tmarginLeft: theme.spacing(1),\r\n\t\tmarginRight: theme.spacing(1),\r\n\t\twidth: 'auto',\r\n\t},\r\n}));\r\n\r\nexport default function TimePickers(props) {\r\n\tconst classes = useStyles();\r\n\tconst [value, setValue] = React.useState('');\r\n\tconst {index, response} = props\r\n\r\n\tuseEffect(() => {\r\n\t\tif (response) {\r\n\t\t\tsetValue(response)\r\n\t\t}\r\n\t}, [index, response])\r\n\r\n\tconst handleChange = (event) => {\r\n\t\tsetValue(event.target.value)\r\n\t\tprops.returnAnswer(event.target.value, index, event.target.value)\r\n\t};\r\n\r\n\r\n\treturn (\r\n\t\t<div>\r\n\t\t\t<h4>{props.title}</h4>\r\n\t\t\t<form className={classes.container} noValidate>\r\n\t\t\t\t<TextField\r\n\t\t\t\t\tid={\"time\" + index}\r\n\t\t\t\t\tlabel=\"\"\r\n\t\t\t\t\ttype=\"time\"\r\n\t\t\t\t\tvalue={value}\r\n\t\t\t\t\tonChange={handleChange}\r\n\t\t\t\t\tclassName={classes.textField}\r\n\t\t\t\t\tInputLabelProps={{\r\n\t\t\t\t\t\tshrink: true,\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tInputProps={{disableUnderline: true}}\r\n\t\t\t\t\tdisabled={props.locked ? true : false}\r\n\t\t\t\t/>\r\n\t\t\t</form>\r\n\t\t</div>\r\n\t);\r\n}","import React, {useEffect, useState} from 'react';\r\nimport FormLabel from '@material-ui/core/FormLabel';\r\nimport FormControl from '@material-ui/core/FormControl';\r\nimport FormGroup from '@material-ui/core/FormGroup';\r\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\r\nimport Checkbox from '@material-ui/core/Checkbox';\r\nimport { Typography } from '@material-ui/core';\r\n\r\n\r\nexport default function CheckboxesGroup(props) {\r\n    const [state, setState] = React.useState({});\r\n    const [ready, setReady] = useState(false)\r\n    const {index, answers, required, response, locked} = props\r\n\r\n    useEffect(() => {\r\n\t\tif (response) {\r\n            setState(response)\r\n            let a = {}\r\n            answers.forEach((answer, i) => {\r\n                if (response[answer]) {\r\n                    a[answer] = response[answer]\r\n                }\r\n                else {\r\n                    a[answer] = false\r\n                }\r\n            })\r\n            setState(a)\r\n            props.returnAnswer(a, index)\r\n        }\r\n        else {\r\n            let a = {}\r\n            answers.forEach((answer, i) => a[answer] = false)\r\n            props.returnAnswer(a, index)\r\n            \r\n        }\r\n        setReady(true)\r\n        console.log(state)\r\n    }, [response, answers])\r\n\r\n\r\n    const handleChange = (event) => {\r\n        setState({ ...state, [event.target.name]: event.target.checked });\r\n        props.returnAnswer({...state, [event.target.name]: event.target.checked}, index)\r\n    };\r\n\r\n    return (\r\n        ready ?\r\n        <div>\r\n            <Typography variant=\"h6\" style={{marginBottom: 0, marginTop: 20}}>{props.title}</Typography>\r\n            <FormControl component=\"fieldset\" disabled={locked}>\r\n                <FormLabel component=\"legend\">    </FormLabel>\r\n                <FormGroup>\r\n                    {answers.map((el, i) => (\r\n                        <FormControlLabel\r\n                            key={i}\r\n                            control={<Checkbox checked={state[el]} onChange={handleChange} name={el} />}\r\n                            label={el}\r\n                        />\r\n                    ))}\r\n                </FormGroup>\r\n            </FormControl>\r\n        </div> : null\r\n    );\r\n}\r\n","import React, { useState, useEffect, useContext } from 'react'\r\nimport firebase, { signInWithGoogle } from '../../util/Firebase'\r\nimport { AuthContext } from \"../../util/Auth\";\r\n\r\nimport TextInput from \"../form/textInput\";\r\nimport SelectBox from \"../form/selectBox\";\r\nimport RadioButton from \"../form/radiobutton\";\r\nimport TimePickers from \"../form/timePickers\";\r\nimport Checkbox from \"../form/checkbox\"\r\nimport { Button, Grid, Typography } from '@material-ui/core';\r\nimport { Redirect } from 'react-router';\r\n\r\n\r\nconst Profile = () => {\r\n    const [questions, setQuestions] = useState([])\r\n    const [answers, setAnswers] = useState({})\r\n    const [forms, setForms] = useState([])\r\n    const [uploaded, setUploaded] = useState(false)\r\n    const [redirect, setRedirect] = useState(false)\r\n    const [userData, setUserData] = useState({})\r\n\r\n    const { currentUser } = useContext(AuthContext);\r\n\r\n    useEffect(() => {\r\n        let user = {}\r\n        if (currentUser) {\r\n            firebase.firestore().collection(\"users\").doc(currentUser.uid).get().then(doc => {\r\n                setUserData(doc.data())\r\n                user = doc.data()\r\n            }).then(() => {\r\n                firebase.firestore().collection(\"profileTemplate\").doc(\"Template\").get().then(doc => {\r\n                    console.log(JSON.stringify(doc.data()))\r\n                    setQuestions(doc.data().questions)\r\n                    console.log(doc.data().questions)\r\n                    const forms = doc.data().questions.map((el, i) => {\r\n                        let response = null\r\n                        if (user[el.key]) {\r\n                            console.log(user[el.key])\r\n                            response = user[el.key]\r\n                        }\r\n                        if (el.type === 'input') {\r\n                            return <TextInput key={\"profile_\" + i} index={i} title={el.question} response={response} returnAnswer={returnAnswer} required={el.required} />\r\n                        }\r\n                        else if (el.type === 'select') {\r\n                            return <SelectBox key={\"profile_\" + i} index={i} title={el.question} response={response} answers={el.answers} returnAnswer={returnAnswer} required={el.required} />\r\n                        }\r\n                        else if (el.type === 'radio') {\r\n                            return <RadioButton key={\"profile_\" + i} index={i} title={el.question} response={response} answers={el.answers} returnAnswer={returnAnswer} required={el.required} />\r\n                        }\r\n                        else if (el.type === 'time') {\r\n                            return <TimePickers key={\"profile_\" + i} index={i} title={el.question} response={response} returnAnswer={returnAnswer} required={el.required} />\r\n                        }\r\n                        else if (el.type === 'checkbox') {\r\n                            return <Checkbox key={\"profile_\" + i} index={i} title={el.question} response={response} answers={el.answers} returnAnswer={returnAnswer} required={el.required} />\r\n                        }\r\n                        else {\r\n                            return null\r\n                        }\r\n                    })\r\n                    setForms(forms)\r\n                })\r\n            })\r\n        }\r\n    }, [currentUser])\r\n\r\n\r\n    const returnAnswer = (answer, index) => {\r\n        const tmp = answers\r\n        tmp[index] = answer\r\n        setAnswers(tmp)\r\n        console.log(answers)\r\n    }\r\n\r\n    const saveToFirebase = () => {\r\n        let mergedAnswers = {}\r\n        questions.forEach((q, i) => {\r\n            if (answers[i]) {\r\n                mergedAnswers[q.key] = answers[i]\r\n            }\r\n        })\r\n\r\n        firebase.firestore().collection(\"users\").doc(currentUser.uid).update({\r\n            // profileAnswers: answers,\r\n            ...mergedAnswers\r\n        }).then(() => setUploaded(true))\r\n    }\r\n\r\n    // const addCaseId = () => {\r\n    //     firebase.firestore().collection(\"tasks\").where(\"type\", \"==\", \"  \").get().then(snap => {\r\n    //         snap.forEach( async doc => {\r\n    //             await firebase.firestore().collection(\"tasks\").doc(doc.id).update({case_id: doc.id})\r\n    //             console.log(doc.id)\r\n    //         })\r\n    //     })\r\n    // }\r\n\r\n    return (\r\n        currentUser ?\r\n            <Grid style={{ padding: 30 }}>\r\n                {redirect && <Redirect to=\"/\" />}\r\n                {forms}\r\n                <Grid container style={{ padding: 20 }} justify=\"center\">\r\n                    <Button variant=\"outlined\" style={{ borderWidth: 2, borderColor: \"#003366\", color: '#003366', margin: 10 }} onClick={saveToFirebase}></Button>\r\n                    {uploaded && <Button variant=\"outlined\" style={{ borderWidth: 2, borderColor: \"red\", color: 'red', margin: 10 }} onClick={() => setRedirect(true)} > </Button>}\r\n                </Grid>\r\n\r\n            </Grid>\r\n            :\r\n            <Grid container direction=\"column\" style={{ padding: 20 }} justify=\"center\">\r\n                <Typography align=\"center\" variant=\"h3\"></Typography>\r\n                <br />\r\n                <Button variant=\"contained\" onClick={signInWithGoogle}>    Google</Button>\r\n            </Grid>\r\n    )\r\n\r\n}\r\n\r\nexport default Profile","import React, { useState } from 'react';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport Card from '@material-ui/core/Card';\r\nimport CardActions from '@material-ui/core/CardActions';\r\nimport CardContent from '@material-ui/core/CardContent';\r\nimport Button from '@material-ui/core/Button';\r\nimport Typography from '@material-ui/core/Typography';\r\n\r\nimport { Redirect } from 'react-router';\r\nimport { Box, Grid } from '@material-ui/core';\r\n\r\nconst useStyles = makeStyles({\r\n\troot: {\r\n\t\tminWidth: 250\r\n\t},\r\n\tbullet: {\r\n\t\tdisplay: 'inline-block',\r\n\t\tmargin: '0 2px',\r\n\t},\r\n\ttitle: {\r\n\t\tfontSize: 14,\r\n\t},\r\n\tpos: {\r\n\t\tmarginBottom: 12,\r\n\t},\r\n});\r\n\r\nconst TaskCard = (props) => {\r\n\tconst classes = useStyles();\r\n\tconst { title, complete, type, language, description, id, cardColor, sendRequest, disabled } = props\r\n\r\n\tconst [redirect, setRedirect] = useState(false)\r\n\r\n\treturn (\r\n\t\t<div>\r\n\t\t\t{redirect && <Redirect to={\"/tasks/\" + id} />}\r\n\t\t\t<Card className={classes.root} style={{ background: cardColor }}>\r\n\t\t\t\t<CardContent>\r\n\t\t\t\t\t<Box display=\"flex\" justifyContent=\"space-between\" alignItems=\"center\">\r\n\t\t\t\t\t\t<Typography variant=\"h6\">\r\n\t\t\t\t\t\t\t{title}\r\n\t\t\t\t\t\t</Typography>\r\n\t\t\t\t\t\t{complete && <Typography color=\"error\">\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t</Typography>}\r\n\t\t\t\t\t</Box>\r\n\t\t\t\t\t<Typography variant=\"subtitle1\" className={classes.pos} color=\"textSecondary\">\r\n\t\t\t\t\t\t#{type}\r\n\t\t\t\t\t</Typography>\r\n\t\t\t\t\t<Typography variant=\"body2\" component=\"p\">\r\n\t\t\t\t\t\t: {description}\r\n\t\t\t\t\t</Typography>\r\n\t\t\t\t</CardContent>\r\n\t\t\t\t<CardActions>\r\n\t\t\t\t\t{sendRequest ?\r\n\t\t\t\t\t\t<Button variant=\"contained\" disabled={disabled} color=\"primary\" size=\"small\" onClick={() => sendRequest(type, id)}>{\" \"}</Button>\r\n\t\t\t\t\t\t:\r\n\t\t\t\t\t\t<Button size=\"small\" onClick={() => setRedirect(true)}>{\"\"}</Button>\r\n\t\t\t\t\t}\r\n\t\t\t\t</CardActions>\r\n\t\t\t</Card>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport default TaskCard","import React, {useState, useEffect, useContext} from 'react'\r\nimport firebase, {signInWithGoogle} from '../../util/Firebase'\r\nimport {AuthContext} from \"../../util/Auth\";\r\nimport {Grid, Typography} from '@material-ui/core';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport Paper from '@material-ui/core/Paper';\r\nimport Tabs from '@material-ui/core/Tabs';\r\nimport Tab from '@material-ui/core/Tab';\r\nimport Box from '@material-ui/core/Box';\r\nimport TaskCard from './Card'\r\nimport PropTypes from 'prop-types';\r\n\r\nfunction TabPanel(props) {\r\n    const {children, value, index, ...other} = props;\r\n\r\n    return (\r\n        <div\r\n            role=\"tabpanel\"\r\n            hidden={value !== index}\r\n            id={`full-width-tabpanel-${index}`}\r\n            aria-labelledby={`full-width-tab-${index}`}\r\n            {...other}\r\n        >\r\n            {value === index && (\r\n                <Box p={3}>\r\n                    <Typography>{children}</Typography>\r\n                </Box>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nTabPanel.propTypes = {\r\n    children: PropTypes.node,\r\n    index: PropTypes.any.isRequired,\r\n    value: PropTypes.any.isRequired,\r\n};\r\n\r\nfunction a11yProps(index) {\r\n    return {\r\n        id: `full-width-tab-${index}`,\r\n        'aria-controls': `full-width-tabpanel-${index}`,\r\n    };\r\n}\r\n\r\n\r\nconst useStyles = makeStyles({\r\n    root: {\r\n        paddingTop: 30,\r\n        flexGrow: 1\r\n    },\r\n});\r\n\r\n\r\nconst Tasks = (props) => {\r\n    const classes = useStyles()\r\n    const [allTasks, setTasks] = useState(null)\r\n    const [submittedTasks, setSubmitted] = useState(null)\r\n    const [quickTasks, setQuickTasks] = useState(null)\r\n    const {currentUser} = useContext(AuthContext);\r\n    const [value, setValue] = useState(0)\r\n\r\n    useEffect(() => {\r\n        if (currentUser) {\r\n            let tasks = []\r\n            let submitted = []\r\n            console.log(\"Fired\")\r\n            firebase.firestore().collection(\"tasks\").where(\"assigned_users\", \"array-contains\", currentUser.uid).get()\r\n                .then((querySnapshot) => {\r\n                    querySnapshot.forEach((doc) => {\r\n                        console.log(doc.id, \" => \", doc.data());\r\n                        if (doc.data().is_complete) {\r\n                            submitted.push({id: doc.id, ...doc.data()})\r\n                        } else {\r\n                            tasks.push({id: doc.id, ...doc.data()})\r\n                        }\r\n\r\n                    });\r\n                })\r\n                .then(() => {\r\n                    setTasks(tasks)\r\n                    setSubmitted(submitted)\r\n                })\r\n                .catch((error) => {\r\n                    console.log(\"Error getting documents: \", error);\r\n                });\r\n        }\r\n    }, [currentUser])\r\n    const handleChange = (event, newValue) => {\r\n        setValue(newValue);\r\n    };\r\n\r\n    return (\r\n        <Grid container justify=\"center\" alignItems=\"center\" direction=\"column\">\r\n            {/* <Grid>\r\n\t\t\t\t<Button onClick={requestTask}> </Button>\r\n\t\t\t</Grid> */}\r\n\r\n            {/*<Typography variant=\"h4\"></Typography>*/}\r\n            <div className={classes.root}>\r\n                <Paper position=\"static\" color=\"default\">\r\n                    <Tabs value={value} onChange={handleChange} variant=\"fullWidth\" centered\r\n                          aria-label=\"simple tabs example\">\r\n                        <Tab label=\"\" {...a11yProps(0)}/>\r\n                        <Tab label=\"\" {...a11yProps(1)}/>\r\n                        {/*<Tab label=\" \" {...a11yProps(3)}/>*/}\r\n                    </Tabs>\r\n                </Paper>\r\n            </div>\r\n            <TabPanel value={value} index={0}>\r\n                {allTasks && allTasks.map((task, i) => (\r\n                    <Grid key={'active_task_' + i} style={{padding: 10}}>\r\n                        <TaskCard title={task.title} complete={task.is_complete} description={task.description}\r\n                                  type={task.type} id={task.id}/>\r\n                    </Grid>\r\n                ))}\r\n            </TabPanel>\r\n\r\n            <TabPanel value={value} index={1}>\r\n                {submittedTasks && submittedTasks.map((task, i) => (\r\n                    <Grid key={'submitted_task_' + i} style={{padding: 10}}>\r\n                        <TaskCard title={task.title} complete={task.is_complete} description={task.description}\r\n                                  type={task.type} id={task.id}/>\r\n                    </Grid>\r\n                ))}\r\n            </TabPanel>\r\n           {/* <TabPanel value={value} index={2}>\r\n                 \r\n            </TabPanel>*/}\r\n        </Grid>\r\n    )\r\n}\r\n\r\nexport default Tasks","import React, { useEffect } from 'react';\r\nimport { Typography } from '@material-ui/core';\r\n\r\n\r\n\r\nfunction BasicTextFields(props) {\r\n\r\n\tconst {title} = props\r\n\r\n\treturn (\r\n\t\t<div>\r\n\t\t\t<Typography variant=\"h6\" style={{marginBottom: 0, marginTop: 20}}>{title}</Typography>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport default BasicTextFields","import React, { forwardRef } from 'react'\r\n\r\nimport TextInput from \"./textInput\";\r\nimport SelectBox from \"./selectBox\";\r\nimport RadioButton from \"./radiobutton\";\r\nimport TimePickers from \"./timePickers\";\r\nimport Checkbox from \"./checkbox\"\r\nimport Text from \"./text\"\r\nimport File from \"./file\"\r\n\r\nconst Form = forwardRef((props, ref) => {\r\n\r\n    const { question, index, response, uploadsRef, returnAnswer, locked, askFeedback, saveQuestionFeedback, id, prevTaskId, returnFile, uploadFilesData } = props\r\n\r\n    if (question.type === 'input') {\r\n        return <TextInput\r\n            key={index}\r\n            // ref={ref}\r\n            index={index}\r\n            title={question.title}\r\n            response={response}\r\n            returnAnswer={returnAnswer}\r\n            required={question.required}\r\n            locked={locked}\r\n            askFeedback={askFeedback}\r\n            feedbackType={question.feedback_type}\r\n            saveQuestionFeedback={saveQuestionFeedback}\r\n            id={id}\r\n            prevTaskId={prevTaskId}\r\n            uploadFilesData={uploadFilesData}\r\n            uploadsRef={uploadsRef}\r\n            returnFile={returnFile}\r\n            attachMaterials={question.attachMaterials}\r\n        />\r\n    }\r\n    else if (question.type === 'select') {\r\n        return <SelectBox key={index} index={index} title={question.title} response={response} answers={question.answers} returnAnswer={returnAnswer} required={question.required} locked={locked} />\r\n    }\r\n    else if (question.type === 'radio') {\r\n        return <RadioButton key={index} index={index} title={question.title} response={response} answers={question.answers} returnAnswer={returnAnswer} required={question.required} locked={locked} />\r\n    }\r\n    else if (question.type === 'time') {\r\n        return <TimePickers key={index} index={index} title={question.title} response={response} returnAnswer={returnAnswer} required={question.required} locked={locked} />\r\n    }\r\n    else if (question.type === 'checkbox') {\r\n        return <Checkbox key={index} index={index} title={question.title} response={response} answers={question.answers} returnAnswer={returnAnswer} required={question.required} locked={locked} />\r\n    }\r\n    else if (question.type === 'text') {\r\n        return <Text key={index} title={question.title} />\r\n    }\r\n    else if (question.type === 'file') {\r\n        return <File key={index} index={index} id={id} title={question.title} returnFile={returnFile} locked={locked} askFeedback={askFeedback} feedbackType={question.feedback_type} saveQuestionFeedback={saveQuestionFeedback} prevTaskId={prevTaskId} />\r\n    }\r\n    else {\r\n        return null\r\n    }\r\n\r\n})\r\n\r\n\r\nexport default Form\r\n","import React from 'react';\r\nimport Button from '@material-ui/core/Button';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport DialogActions from '@material-ui/core/DialogActions';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport DialogContentText from '@material-ui/core/DialogContentText';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\n\r\nexport default function AlertDialog(props) {\r\n\r\n  return (\r\n    <div>\r\n      <Dialog\r\n        open={props.state}\r\n        onClose={props.handleClose}\r\n        aria-labelledby=\"alert-dialog-title\"\r\n        aria-describedby=\"alert-dialog-description\"\r\n      >\r\n        <DialogTitle id=\"alert-dialog-title\">{props.title}</DialogTitle>\r\n        <DialogContent>\r\n          <DialogContentText id=\"alert-dialog-description\">\r\n            {props.content}\r\n          </DialogContentText>\r\n        </DialogContent>\r\n          {props.hideActions ? \"\" :\r\n              props.showOk ?\r\n                  <DialogActions>\r\n                      <Button onClick={props.handleOk} color=\"primary\">\r\n                          Ok\r\n                      </Button>\r\n                  </DialogActions>\r\n                  :\r\n                  <DialogActions>\r\n                      <Button onClick={props.handleClose} color=\"primary\">\r\n                          \r\n                      </Button>\r\n                      <Button onClick={props.dialogFunction} color=\"primary\" autoFocus>\r\n                          \r\n                      </Button>\r\n                  </DialogActions>}\r\n      </Dialog>\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState, useEffect, useContext, useRef } from 'react'\r\nimport firebase, { signInWithGoogle } from '../../util/Firebase'\r\nimport { AuthContext } from \"../../util/Auth\";\r\n\r\nimport Form from \"../form/form\"\r\nimport Dialog from \"../Dialog/Dialog\"\r\nimport DialogFeedback from \"../Dialog/FeedbackDialog\"\r\nimport Feedback from \"../form/feedback\"\r\n\r\nimport { Button, Divider, Grid, Typography } from '@material-ui/core';\r\nimport Snackbar from '@material-ui/core/Snackbar';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport CloseIcon from '@material-ui/icons/Close';\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\n\r\nimport { Redirect, useParams, useHistory } from 'react-router';\r\nimport { Link } from \"react-router-dom\";\r\n\r\n\r\nconst Tasks = () => {\r\n\tconst [questions, setQuestions] = useState([])\r\n\tconst [responses, setResponses] = useState([])\r\n\tconst [answers, setAnswers] = useState({})\r\n\tconst [forms, setForms] = useState([])\r\n\tconst [uploaded, setUploaded] = useState(false)\r\n\tconst [redirect, setRedirect] = useState(false)\r\n\tconst [userData, setUserData] = useState({})\r\n\tconst [lockButton, setLock] = useState(false)\r\n\tconst [caseTasks, setCaseTasks] = useState([])\r\n\tconst [dialogState, setDialog] = useState(false)\r\n\tconst [dialogType, setDialogType] = useState(null)\r\n\tconst [feedbackValue, setFeedback] = useState({})\r\n\tconst [releaseFeedbackData, setReleaseFeedbackData] = useState({})\r\n\tconst [openSnackbar, setOpenSnackbar] = useState(false);\r\n\tconst [files, setFiles] = useState({})\r\n\tconst [uploading, setUploading] = useState(false)\r\n\r\n\tconst { currentUser } = useContext(AuthContext);\r\n\tconst { id } = useParams();\r\n\tconst history = useHistory();\r\n\r\n\tconst handleCloseSnackbar = (event, reason) => {\r\n\t\tif (reason === 'clickaway') {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetOpenSnackbar(false);\r\n\t};\r\n\r\n\t// const uploadsRef = useRef();\r\n\r\n\tuseEffect(() => {\r\n\t\tconst getQuestions = async (taskID) => {\r\n\t\t\tlet q = []\r\n\r\n\t\t\tawait firebase.firestore().collection(\"tasks\").doc(taskID).collection(\"questions\").get()\r\n\t\t\t\t.then((querySnapshot) => {\r\n\t\t\t\t\tquerySnapshot.forEach((doc) => {\r\n\t\t\t\t\t\tq.push({ questionId: doc.id, data: doc.data() })\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.catch((error) => {\r\n\t\t\t\t\tconsole.log(\"Error getting documents: \", error);\r\n\t\t\t\t});\r\n\r\n\t\t\treturn q\r\n\t\t}\r\n\r\n\r\n\t\tconst getResponses = async (taskID) => {\r\n\t\t\tlet r = []\r\n\r\n\t\t\tawait firebase.firestore().collection(\"tasks\").doc(taskID).collection(\"responses\").get()\r\n\t\t\t\t.then((querySnapshot) => {\r\n\t\t\t\t\tquerySnapshot.forEach((doc) => {\r\n\t\t\t\t\t\tr.push({ responseId: doc.id, data: doc.data() })\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.catch((error) => {\r\n\t\t\t\t\tconsole.log(\"Error getting documents: \", error);\r\n\t\t\t\t});\r\n\r\n\t\t\treturn r\r\n\t\t}\r\n\r\n\r\n\t\tconst getSameCaseTasks = async () => {\r\n\t\t\tlet sameCaseTasks = []\r\n\r\n\t\t\tawait firebase.firestore().collection(\"tasks\").doc(id).get().then(doc => {\r\n\t\t\t\treturn doc.data()\r\n\t\t\t}).then(async data => {\r\n\t\t\t\tawait firebase.firestore().collection(\"tasks\").where(\"case_id\", \"==\", data.case_id).get().then(snap => {\r\n\t\t\t\t\tsnap.forEach(doc => {\r\n\t\t\t\t\t\tif (doc.id !== id) {\r\n\t\t\t\t\t\t\tsameCaseTasks.push({ id: doc.id, ...doc.data() })\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t\treturn sameCaseTasks\r\n\t\t}\r\n\r\n\t\tconst getForms = async () => {\r\n\t\t\tlet f = []\r\n\t\t\tlet locked = true\r\n\r\n\t\t\tsetForms(null)\r\n\r\n\t\t\tawait firebase.firestore().collection(\"tasks\").doc(id).collection(\"user_editable\").doc(\"user_editable\").get().then(doc => {\r\n\t\t\t\tif (doc.data().status === 'complete') {\r\n\t\t\t\t\tlocked = true\r\n\t\t\t\t\tsetLock(true)\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tlocked = false\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t\tlet sq = []\r\n\t\t\tlet sr = []\r\n\r\n\t\t\tlet sameCaseTasks = await getSameCaseTasks()\r\n\t\t\tsetCaseTasks(sameCaseTasks)\r\n\t\t\tif (sameCaseTasks.length > 0) {\r\n\t\t\t\tlet ques = sameCaseTasks.map(t => {\r\n\t\t\t\t\treturn getQuestions(t.id)\r\n\t\t\t\t})\r\n\t\t\t\tlet resp = sameCaseTasks.map(t => {\r\n\t\t\t\t\treturn getResponses(t.id)\r\n\t\t\t\t})\r\n\t\t\t\tconsole.log(ques)\r\n\t\t\t\tawait Promise.all(ques).then(data => data.forEach(d => sq.push(...d)))\r\n\t\t\t\tawait Promise.all(resp).then(data => data.forEach(d => sr.push(...d)))\r\n\r\n\t\t\t\tconsole.log(sq)\r\n\t\t\t\tconsole.log(sr)\r\n\t\t\t}\r\n\r\n\t\t\tlet sf = sq.map((el, i) => {\r\n\t\t\t\tlet response = null\r\n\t\t\t\tsr.forEach((res) => {\r\n\t\t\t\t\tif (el.questionId === res.responseId) {\r\n\t\t\t\t\t\tresponse = res.data.answer\r\n\t\t\t\t\t\treturnAnswer(res.data.answer, i)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\treturn <Form key={el.questionId + '_' + i} question={el.data} index={i} response={response} returnAnswer={returnAnswer} locked={true} askFeedback={true} saveQuestionFeedback={saveQuestionFeedback} id={el.questionId} prevTaskId={sameCaseTasks[0].id} />\r\n\t\t\t})\r\n\r\n\t\t\tsf.push(<div key={\"div_divider_stripped\"} style={{ height: 25, margin: '20px 0', background: 'repeating-linear-gradient( 45deg, white, white 10px, grey 10px, grey 25px)' }}><br /></div>)\r\n\r\n\r\n\t\t\tlet q = await getQuestions(id)\r\n\t\t\tlet r = await getResponses(id)\r\n\r\n\r\n\t\t\tsetQuestions(q)\r\n\t\t\tsetResponses(r)\r\n\r\n\r\n\t\t\t// let newQ = sq.concat(q)\r\n\t\t\t// let newR = sr.concat(r)\r\n\r\n\t\t\tf = q.map((el, i) => {\r\n\t\t\t\tlet response = null\r\n\t\t\t\tr.forEach((res) => {\r\n\t\t\t\t\tif (el.questionId === res.responseId) {\r\n\t\t\t\t\t\tresponse = res.data.answer\r\n\t\t\t\t\t\treturnAnswer(res.data.answer, i)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<Form\r\n\t\t\t\t\t\tkey={el.questionId + '_' + i}\r\n\t\t\t\t\t\tquestion={el.data}\r\n\t\t\t\t\t\tindex={i}\r\n\t\t\t\t\t\tresponse={response}\r\n\t\t\t\t\t\treturnFile={returnFile}\r\n\t\t\t\t\t\treturnAnswer={returnAnswer}\r\n\t\t\t\t\t\tid={el.questionId}\r\n\t\t\t\t\t\tlocked={locked}\r\n\t\t\t\t\t\t// ref={uploadsRef}\r\n\t\t\t\t\t\tuploadFilesData={uploadFilesData} />\r\n\t\t\t\t)\r\n\t\t\t})\r\n\r\n\t\t\tlet newF = sf.concat(f)\r\n\t\t\tsetForms(newF)\r\n\t\t}\r\n\t\tif (currentUser) {\r\n\t\t\tgetForms()\r\n\t\t}\r\n\t}, [currentUser, id, lockButton])\r\n\r\n\r\n\tconst returnAnswer = (answer, index) => {\r\n\t\tconst tmp = answers\r\n\t\ttmp[index] = answer\r\n\t\tsetAnswers(tmp)\r\n\t}\r\n\r\n\tconst returnFile = (file, questionId) => {\r\n\t\tlet arr = [...file]\r\n\t\tlet tmp = files\r\n\t\ttmp[questionId] = arr\r\n\t\tsetFiles(tmp)\r\n\t\tconsole.log([...file], questionId)\r\n\t}\r\n\r\n\tconst upload = async () => {\r\n\t\t// uploadsRef.current.startUpload()\r\n\t\tif (Object.keys(files).length > 0) {\r\n\t\t\tconsole.log('files')\r\n\t\t\tsetUploading(true)\r\n\t\t\tfor (const [key, value] of Object.entries(files)) {\r\n\t\t\t\tlet ref = firebase.storage().ref(id).child(key).child(currentUser.uid)\r\n\t\t\t\tawait Promise.all(value.map(async v => {\r\n\t\t\t\t\tlet snap = await ref.child(v.name).put(v)\r\n\t\t\t\t\tlet url = await snap.ref.getDownloadURL()\r\n\t\t\t\t\tlet url_wo_token = url.split(\"?\")[0]\r\n\t\t\t\t\tawait uploadFilesData(v.name, url_wo_token, key)\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t\tsetUploaded(true)\r\n\t\t\tsetUploading(false)\r\n\t\t}\r\n\t}\r\n\r\n\tconst saveQuestionFeedback = (data, questionId, previousTaskId) => {\r\n\t\tif (previousTaskId) {\r\n\t\t\tfirebase.firestore().collection('tasks').doc(previousTaskId).collection('feedbacks').doc(questionId).collection('messages')\r\n\t\t\t\t.add({\r\n\t\t\t\t\tanswer: data.reason,\r\n\t\t\t\t\ttext: data.text,\r\n\t\t\t\t\tuser_id: currentUser.uid,\r\n\t\t\t\t\ttimestamp: firebase.firestore.FieldValue.serverTimestamp()\r\n\t\t\t\t})\r\n\t\t\t\t.then(() => setOpenSnackbar(true))\r\n\t\t}\r\n\t\telse {\r\n\t\t\talert(': -      .  !')\r\n\t\t}\r\n\t}\r\n\r\n\tconst saveToFirebase = async (lock) => {\r\n\t\tawait upload()\r\n\t\tquestions.forEach(async (q, i) => {\r\n\t\t\tif (answers[i] || answers[i] === \"\") {\r\n\t\t\t\tawait firebase.firestore().collection(\"tasks\").doc(id).collection(\"responses\").doc(q.questionId).set({ answer: answers[i] }, { merge: true })\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tif (lock) {\r\n\t\t\tawait firebase.firestore().collection(\"tasks\").doc(id).collection(\"user_editable\").doc(\"user_editable\").update({ status: 'complete' })\r\n\t\t\tsetLock(true)\r\n\t\t\tconsole.log(\"Task Locked\")\r\n\t\t\tsetDialog(false)\r\n\t\t}\r\n\t}\r\n\r\n\tconst uploadFilesData = async (filename, url, questionId) => {\r\n\t\tlet rootRef = firebase.firestore().collection(\"tasks\").doc(id).collection(\"responses\").doc(questionId)\r\n\t\tconsole.log(\" \")\r\n\t\tif (filename && url) {\r\n\t\t\trootRef.set(\r\n\t\t\t\t{\r\n\t\t\t\t\tfiles: firebase.firestore.FieldValue.arrayUnion({ public_url: url, filename: filename })\r\n\t\t\t\t}, { merge: true }\r\n\t\t\t).then(() => console.log('super'))\r\n\t\t}\r\n\t};\r\n\r\n\tconst handleDialogClose = () => {\r\n\t\tsetDialog(false);\r\n\t\tsetFeedback({})\r\n\t};\r\n\r\n\tconst handleDialogOpen = (type) => {\r\n\t\tif (type === 'send') {\r\n\t\t\tsetDialogType('send')\r\n\t\t\tsetDialog(true)\r\n\t\t}\r\n\t\tif (type === 'release') {\r\n\t\t\tsetDialogType('release')\r\n\t\t\tsetDialog(true)\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\tfirebase.firestore().collection(\"schema\").doc(\"structure\").collection(\"feedbacks\").doc(\"release\").get().then(doc => {\r\n\t\t\tsetReleaseFeedbackData(doc.data())\r\n\t\t})\r\n\t}, [])\r\n\r\n\tconst releaseTask = () => {\r\n\t\tfirebase.firestore().collection(\"tasks\").doc(id).collection(\"user_editable\").doc(\"user_editable\").update({ status: 'open' })\r\n\t\t\t.then(() => firebase.firestore().collection(\"tasks\").doc(id).collection(\"user_editable\").doc(\"user_editable\").update({ status: 'released', release_status: feedbackValue.reason, release_description: feedbackValue.text })\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tsetDialog(false)\r\n\t\t\t\t\tsetLock(true)\r\n\t\t\t\t}))\r\n\t\t// alert(feedbackValue)\r\n\t}\r\n\r\n\tconst handleFeedbackSave = (value) => {\r\n\t\tsetFeedback(value)\r\n\t}\r\n\r\n\treturn (\r\n\t\tcurrentUser ?\r\n\t\t\t<Grid style={{ padding: 30 }}>\r\n\t\t\t\t{dialogType === 'send' && <Dialog\r\n\t\t\t\t\tstate={dialogState}\r\n\t\t\t\t\thandleClose={handleDialogClose}\r\n\t\t\t\t\thideActions={uploading || uploaded}\r\n\t\t\t\t\ttitle={uploading ? \" \" : uploaded ? \" \" : \" ?\"}\r\n\t\t\t\t\tcontent={uploading ? <CircularProgress /> : uploaded ? \"\" : \"   .  ,       .\"}\r\n\t\t\t\t\tdialogFunction={() => saveToFirebase(true)} />}\r\n\t\t\t\t{dialogType === 'release' && <DialogFeedback\r\n\t\t\t\t\tstate={dialogState}\r\n\t\t\t\t\tfeedbackValue={feedbackValue}\r\n\t\t\t\t\thandleClose={handleDialogClose}\r\n\t\t\t\t\ttitle={releaseFeedbackData.title}\r\n\t\t\t\t\tdialogFunction={releaseTask}\r\n\t\t\t\t\tanswers={releaseFeedbackData.answers}\r\n\t\t\t\t\tdescription={releaseFeedbackData.description}\r\n\t\t\t\t\treturnFeedback={handleFeedbackSave} />}\r\n\t\t\t\t{redirect && <Redirect to=\"/tasks\" />}\r\n\t\t\t\t<Snackbar\r\n\t\t\t\t\tanchorOrigin={{\r\n\t\t\t\t\t\tvertical: 'bottom',\r\n\t\t\t\t\t\thorizontal: 'left',\r\n\t\t\t\t\t}}\r\n\t\t\t\t\topen={openSnackbar}\r\n\t\t\t\t\tautoHideDuration={6000}\r\n\t\t\t\t\tonClose={handleCloseSnackbar}\r\n\t\t\t\t\tmessage=\" \"\r\n\t\t\t\t\taction={\r\n\t\t\t\t\t\t<React.Fragment>\r\n\t\t\t\t\t\t\t<IconButton size=\"small\" aria-label=\"close\" color=\"inherit\" onClick={handleCloseSnackbar}>\r\n\t\t\t\t\t\t\t\t<CloseIcon fontSize=\"small\" />\r\n\t\t\t\t\t\t\t</IconButton>\r\n\t\t\t\t\t\t</React.Fragment>\r\n\t\t\t\t\t}\r\n\t\t\t\t/>\r\n\t\t\t\t{/*  {caseTasks.map((t, i) => <Button key={\"case_button_\"+i} component={ Link } to={\"/tasks/\" + t.id}>{t.title}</Button>)} */}\r\n\t\t\t\t{forms}\r\n\t\t\t\t<Grid container style={{ padding: 20 }} justify=\"center\">\r\n\t\t\t\t\t<Button variant=\"outlined\" style={{ borderWidth: 2, borderColor: \"grey\", color: 'grey', margin: 5 }} onClick={() => history.goBack()}></Button>\r\n\t\t\t\t\t{!lockButton &&\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<Button variant=\"outlined\" disabled={lockButton} style={{ borderWidth: 2, borderColor: \"#003366\", color: '#003366', margin: 5 }} onClick={() => saveToFirebase(false)}></Button>\r\n\t\t\t\t\t\t\t<Button variant=\"outlined\" disabled={lockButton} style={{ borderWidth: 2, borderColor: \"red\", color: 'red', margin: 5 }} onClick={() => handleDialogOpen('send')}></Button>\r\n\t\t\t\t\t\t\t<Button variant=\"outlined\" disabled={lockButton} style={{ borderWidth: 2, borderColor: \"red\", color: 'red', margin: 5 }} onClick={() => handleDialogOpen('release')}></Button>\r\n\t\t\t\t\t\t</div>}\r\n\t\t\t\t</Grid>\r\n\r\n\t\t\t</Grid>\r\n\t\t\t:\r\n\t\t\t<Grid container direction=\"column\" style={{ padding: 20 }} justify=\"center\">\r\n\t\t\t\t<Typography align=\"center\" variant=\"h3\"></Typography>\r\n\t\t\t\t<br />\r\n\t\t\t\t<Button variant=\"contained\" onClick={signInWithGoogle}>    Google</Button>\r\n\t\t\t</Grid>\r\n\t)\r\n\r\n}\r\n\r\nexport default Tasks","import React, { useEffect, useState, useContext } from 'react'\r\nimport { AuthContext } from \"../../util/Auth\";\r\nimport firebase from '../../util/Firebase'\r\n\r\nimport Paper from '@material-ui/core/Paper'\r\nimport Button from '@material-ui/core/Button';\r\nimport Snackbar from '@material-ui/core/Snackbar';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport CloseIcon from '@material-ui/icons/Close';\r\n\r\nimport Card from '../Tasks/Card'\r\nimport { Box, Grid, Typography } from '@material-ui/core'\r\nimport { set } from 'immutable';\r\n\r\n\r\nconst Case = (props) => {\r\n    const { caseId, userRanks } = props\r\n    const [allTasks, setTasks] = useState(null)\r\n    const [ready, setReady] = useState(false)\r\n    const { currentUser } = useContext(AuthContext);\r\n\r\n    const [open, setOpen] = React.useState(false);\r\n    const [disableCase, setDisable] = useState(false)\r\n    const [message, setMessage] = useState('')\r\n\r\n    const handleClose = (event, reason) => {\r\n        if (reason === 'clickaway') {\r\n            return;\r\n        }\r\n\r\n        setOpen(false);\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (currentUser) {\r\n            let tasks = []\r\n            console.log(\"Fired\")\r\n            firebase.firestore().collection(\"schema\").doc(\"structure\").collection(\"cases\").doc(caseId).collection(\"stages\").get()\r\n                .then((querySnapshot) => {\r\n                    querySnapshot.forEach((doc) => {\r\n                        // before change\r\n                        //tasks.push({ id: doc.id, ...doc.data() }) \r\n\r\n                        //after change\r\n                        const ranks = doc.data().ranks\r\n                        console.log('RANKS')\r\n                        console.log(ranks)\r\n                        console.log(userRanks)\r\n                        // if (ranks && userRanks.some(userRank => ranks.includes(userRank))) {\r\n                        //     tasks.push({ id: doc.id, ...doc.data(), disabled: false })\r\n                        // }\r\n                        // else {\r\n                        //     tasks.push({ id: doc.id, ...doc.data(), disabled: true })\r\n                        //     setMessage(<Typography color=\"error\" display=\"block\">  <Typography component=\"span\" display=\"inline\" color=\"primary\" align=\"justify\"> Battle For Azeroth</Typography>    </Typography>)\r\n                        // }\r\n                        tasks.push({ id: doc.id, ...doc.data(), disabled: false })\r\n                        \r\n                    });\r\n                })\r\n                .then(() => {\r\n                    tasks.sort((a, b) => parseInt(a.order) - parseInt(b.order))\r\n                    setTasks(tasks)\r\n                    setReady(true)\r\n                })\r\n                .catch((error) => {\r\n                    console.log(\"Error getting documents: \", error);\r\n                });\r\n        }\r\n    }, [currentUser])\r\n\r\n    useEffect(() => {\r\n        if (currentUser) {\r\n            firebase.firestore().collection('tasks').where('assigned_users', 'array-contains', currentUser.uid).where('is_complete', '==', false).get().then(snap => {\r\n                if (snap.size < 3) {\r\n                    console.log(\"SIZE\", snap.size)\r\n                    setDisable(false)\r\n                }\r\n                else {\r\n                    setDisable(true)\r\n                    setMessage(<Typography color=\"error\">    .    ,   .</Typography>)\r\n                }\r\n            })\r\n        }\r\n    }, [currentUser, disableCase, open])\r\n\r\n    const sendRequest = (type, task_type) => {\r\n        firebase.firestore().collection(\"task_requests\").doc(currentUser.uid).collection(\"requests\").add({\r\n            taskType: type,\r\n            status: \"pending\",\r\n            user: currentUser.uid,\r\n            case_type: caseId,\r\n            case_stage_id: task_type\r\n        }).then((doc) => {\r\n            setOpen(true)\r\n            console.log('sending request')\r\n        })\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <Snackbar\r\n                anchorOrigin={{\r\n                    vertical: 'bottom',\r\n                    horizontal: 'left',\r\n                }}\r\n                open={open}\r\n                autoHideDuration={6000}\r\n                onClose={handleClose}\r\n                message=\" \"\r\n                action={\r\n                    <React.Fragment>\r\n                        <IconButton size=\"small\" aria-label=\"close\" color=\"inherit\" onClick={handleClose}>\r\n                            <CloseIcon fontSize=\"small\" />\r\n                        </IconButton>\r\n                    </React.Fragment>\r\n                }\r\n            />\r\n\r\n            <Paper style={{ margin: '20px 5px', border: '1px grey solid' }}>\r\n                <Box style={{ padding: '10px 20px 0px' }}>\r\n                    <Box style={{ padding: '5px 10px 10px' }}>\r\n                        <Typography variant=\"h6\">{props.title}</Typography>\r\n                    </Box>\r\n                    <Box style={{ padding: '10px 10px 5px' }}>\r\n                        <Typography variant=\"body2\">{props.description}</Typography>\r\n                    </Box>\r\n                    <Box style={{ padding: '10px 10px 0px' }}>\r\n                        {message}\r\n                    </Box>\r\n                </Box>\r\n\r\n                <Grid container justify=\"center\" style={{ padding: 10 }}>\r\n                    {ready && allTasks.map((t, i) => (\r\n                        <Grid item key={i} style={{ padding: 10 }}>\r\n                            <Card title={t.title} description={t.description} type={t.type} id={t.id} cardColor=\"#F5F5F5\" sendRequest={sendRequest} disabled={disableCase || t.disabled} />\r\n                        </Grid>\r\n                    ))}\r\n                </Grid>\r\n            </Paper>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Case","import React, { useState, useEffect, useContext } from 'react'\r\nimport firebase from '../../util/Firebase'\r\nimport { AuthContext } from \"../../util/Auth\";\r\n\r\nimport Case from './Case'\r\n\r\n\r\nconst Cases = () => {\r\n\r\n    const { currentUser } = useContext(AuthContext);\r\n    const [allCases, setCases] = useState([])\r\n    const [ready, setReady] = useState(false)\r\n    const [userRanks, setRanks] = useState([])\r\n\r\n    // New\r\n    useEffect(() => {\r\n        if (currentUser) {\r\n            firebase.firestore().collection('users').doc(currentUser.uid).collection('user_private').doc('private').get().then(doc => {\r\n\r\n                if (doc && doc.exists) {\r\n\r\n                    let ranks = doc.data().ranks\r\n                    console.log(ranks)\r\n                    setRanks(ranks)\r\n                    getCasesFromFirebase(ranks)\r\n                }\r\n            })\r\n        }\r\n    }, [currentUser])\r\n\r\n\r\n    // /////// Old ////////\r\n    // useEffect(() => {\r\n    //     if (currentUser) {\r\n    //         let cases = []\r\n    //         console.log(\"Fired\")\r\n    //         firebase.firestore().collection(\"schema\").doc(\"structure\").collection(\"cases\").get()\r\n    //             .then((querySnapshot) => {\r\n    //                 querySnapshot.forEach((doc) => {\r\n    //                     cases.push({ id: doc.id, ...doc.data() })\r\n    //                 });\r\n    //             })\r\n    //             .then(() => {\r\n    //                 setCases(cases)\r\n    //                 setReady(true)\r\n    //             })\r\n    //             .catch((error) => {\r\n    //                 console.log(\"Error getting documents: \", error);\r\n    //             });\r\n    //     }\r\n    // }, [currentUser])\r\n    // //////////////\r\n\r\n    const getCasesFromFirebase = (ranks) => {\r\n        let cases = []\r\n        console.log(\"Fired\")\r\n        firebase.firestore().collection(\"schema\").doc(\"structure\").collection(\"cases\").where('ranks', 'array-contains-any', ranks).get()\r\n            .then((querySnapshot) => {\r\n                querySnapshot.forEach((doc) => {\r\n                    console.log(doc.data())\r\n                    cases.push({ id: doc.id, ...doc.data() })\r\n                });\r\n            })\r\n            .then(() => {\r\n                setCases(cases)\r\n                setReady(true)\r\n            })\r\n            .catch((error) => {\r\n                console.log(\"Error getting documents: \", error);\r\n            });\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            {ready && allCases.map((c, i) => {\r\n                if (c.hide) {\r\n                    return null\r\n                }\r\n                else {\r\n                    return (\r\n                        <Case key={i} title={c.title} description={c.description} caseId={c.id} userRanks={userRanks} />\r\n                    )\r\n                }\r\n            })}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Cases","import React, { useEffect, useState } from 'react';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport Card from '@material-ui/core/Card';\r\nimport CardActions from '@material-ui/core/CardActions';\r\nimport CardContent from '@material-ui/core/CardContent';\r\nimport Button from '@material-ui/core/Button';\r\nimport Typography from '@material-ui/core/Typography';\r\n\r\nimport { Redirect } from 'react-router';\r\nimport { Grid } from '@material-ui/core';\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n\troot: {\r\n\t\tmargin: 20,\r\n\t\twidth: 500,\r\n\t\t[theme.breakpoints.down(\"sm\")]: {\r\n\t\t\tmaxWidth: 300\r\n\t\t}\r\n\t},\r\n\tbullet: {\r\n\t\tdisplay: 'inline-block',\r\n\t\tmargin: '0 2px',\r\n\t},\r\n\ttitle: {\r\n\t\tfontSize: 14,\r\n\t},\r\n\tpos: {\r\n\t\tmarginBottom: 12,\r\n\t},\r\n}));\r\n\r\nconst TaskCard = (props) => {\r\n\tconst classes = useStyles();\r\n\tconst { title, description, id, setShown, shown, date } = props\r\n\r\n\tconst getFormatDate = (dt) => {\r\n\t\t// let month = '' + (d.getMonth() + 1)\r\n\t\t// let day = '' + d.getDate()\r\n\t\t// let year = d.getFullYear()\r\n\r\n\t\t// if (month.length < 2)\r\n\t\t// \tmonth = '0' + month;\r\n\t\t// if (day.length < 2)\r\n\t\t// \tday = '0' + day;\r\n\t\tlet formatDate = `${\r\n\t\t\tdt.getDate().toString().padStart(2, '0')}/${\r\n\t\t\t(dt.getMonth()+1).toString().padStart(2, '0')}/${\r\n\t\t\tdt.getFullYear().toString().padStart(4, '0')} ${\r\n\t\t\tdt.getHours().toString().padStart(2, '0')}:${\r\n\t\t\tdt.getMinutes().toString().padStart(2, '0')}:${\r\n\t\t\tdt.getSeconds().toString().padStart(2, '0')}`\r\n\r\n\t\treturn formatDate\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Grid container justify=\"center\">\r\n\t\t\t<Card className={classes.root} style={shown ? { background: 'grey', opacity: 0.25 } : { background: 'lightblue' }} >\r\n\t\t\t\t<CardContent>\r\n\t\t\t\t\t<Typography variant=\"h6\">\r\n\t\t\t\t\t\t{title}\r\n\t\t\t\t\t</Typography>\r\n\t\t\t\t\t<Typography variant=\"body2\" component=\"p\">\r\n\t\t\t\t\t\t{description}\r\n\t\t\t\t\t</Typography>\r\n\t\t\t\t</CardContent>\r\n\t\t\t\t<CardActions style={{ justifyContent: 'space-between' }}>\r\n\t\t\t\t\t<Typography style={{paddingLeft: 8}} variant=\"subtitle2\">{getFormatDate(date.toDate())}</Typography>\r\n\t\t\t\t\t<Button size=\"small\" onClick={() => setShown(id)}>{\"\"}</Button>\r\n\t\t\t\t</CardActions>\r\n\t\t\t</Card>\r\n\t\t</Grid>\r\n\t);\r\n}\r\n\r\nexport default TaskCard","import { Button, Grid, Typography } from '@material-ui/core';\r\nimport React, { useEffect, useState, useContext } from 'react'\r\nimport { AuthContext } from '../../util/Auth';\r\nimport firebase from '../../util/Firebase'\r\n\r\nimport Notification from './Notification'\r\n\r\n\r\nconst Notifications = () => {\r\n\r\n    const { currentUser } = useContext(AuthContext);\r\n    const [cards, setCards] = useState([])\r\n\r\n    const updateFirestoreStatus = (id) => {\r\n        firebase.firestore().collection('notifications').doc(id).update({ shown: true })\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (currentUser) {\r\n            const unsubscribe = firebase.firestore().collection('notifications').where('user_id', 'array-contains', currentUser.uid).onSnapshot(async snap => {\r\n                let messages = []\r\n                snap.forEach((doc, i) => {\r\n                    messages.push({ id: doc.id, ...doc.data() })\r\n                })\r\n                console.log(messages[0].created_date.toDate())\r\n                messages.sort((a, b) => b.created_date.toDate() - a.created_date.toDate())\r\n                setCards(messages)\r\n            })\r\n            return () => unsubscribe()\r\n        }\r\n    }, [currentUser])\r\n\r\n    return (\r\n        <div>\r\n            <Typography variant=\"h5\" align=\"center\"></Typography>\r\n            {cards.map((doc, i) => <Notification key={i} id={doc.id} index={i} date={doc.created_date} title={doc.title} setShown={updateFirestoreStatus} shown={doc.shown} description={doc.description} />)}\r\n        </div>\r\n    )\r\n\r\n}\r\n\r\nexport default Notifications","import React, { useContext, useEffect, useState } from 'react'\r\nimport firebase, { signInWithGoogle } from '../../util/Firebase'\r\nimport { AuthContext } from \"../../util/Auth\";\r\nimport moment from 'moment';\r\nimport { v1 as uuid } from 'uuid'\r\nimport { Button, Dialog, DialogContent, DialogContentText, DialogTitle, Grid, Link, makeStyles, Typography } from '@material-ui/core';\r\n\r\nconst queryString = require('query-string');\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    root: {\r\n        marginTop: 20,\r\n        background: 'lightgreen',\r\n        // height: 200,\r\n        width: 500,\r\n        [theme.breakpoints.down(\"sm\")]: {\r\n            maxWidth: 300\r\n        }\r\n    },\r\n    message: {\r\n        background: 'lightgreen',\r\n        // height: 200,\r\n        width: 500,\r\n        margin: 10,\r\n        padding: 10,\r\n        [theme.breakpoints.down(\"sm\")]: {\r\n            maxWidth: 300\r\n        }\r\n    }\r\n}));\r\n\r\n\r\nconst Home = (props) => {\r\n    const classes = useStyles();\r\n    const [token, setToken] = useState(null)\r\n    const { currentUser } = useContext(AuthContext);\r\n    const [tgId, setTgId] = useState(\"\")\r\n    const [open, setOpen] = React.useState(false);\r\n\r\n    useEffect(() => {\r\n        const makeToken = () => {\r\n            return uuid().toString() + '_' + Date.now()\r\n        }\r\n        let unsubscribeUser = () => { }\r\n        let unsubscribeUserPrivate = () => { }\r\n        if (currentUser) {\r\n            unsubscribeUser = firebase.firestore()\r\n                .collection('users')\r\n                .doc(currentUser.uid)\r\n                .onSnapshot(doc => {\r\n\r\n                    let oldToken;\r\n                    if (doc.exists && doc.data().tg_token) {\r\n                        oldToken = doc.data().tg_token\r\n                    } else {\r\n                        oldToken = false\r\n                    }\r\n\r\n                    console.log(oldToken)\r\n                    if (oldToken) {\r\n                        console.log(oldToken)\r\n                        let oldDate = parseInt(oldToken.substring(oldToken.indexOf('_') + 1))\r\n                        let date = moment().diff(oldDate, 'hours')\r\n                        console.log(date)\r\n                        if (date > 0) {\r\n                            let newToken = makeToken()\r\n                            firebase.firestore().collection('users').doc(currentUser.uid).update({ tg_token: newToken })\r\n                            setToken(newToken)\r\n                        } else {\r\n                            setToken(oldToken)\r\n                        }\r\n                    } else {\r\n                        console.log('no token')\r\n                        let newToken = makeToken()\r\n                        firebase.firestore().collection('users').doc(currentUser.uid).update({ tg_token: newToken })\r\n                        setToken(newToken)\r\n                    }\r\n                })\r\n            unsubscribeUserPrivate = firebase.firestore()\r\n                .collection('users')\r\n                .doc(currentUser.uid)\r\n                .collection(\"user_private\")\r\n                .doc(\"private\")\r\n                .onSnapshot(doc => {\r\n                    if (doc.exists && doc.data().tg_id) {\r\n                        console.log(\"TGID: \", doc.data().tg_id)\r\n                        setTgId(doc.data().tg_id)\r\n                    }\r\n                    else {\r\n                        setOpen(true)\r\n                    }\r\n                })\r\n        }\r\n        return () => {\r\n            unsubscribeUser()\r\n            unsubscribeUserPrivate()\r\n        }\r\n    }, [currentUser])\r\n\r\n    useEffect(() => {\r\n        if (currentUser) {\r\n            let urlString = queryString.parse(window.location.search)\r\n            if (urlString.rank) {\r\n                console.log(urlString.rank)\r\n                firebase.firestore().collection('schema').doc('structure').collection('ranks').doc(urlString.rank).get().then(doc => {\r\n                    if (doc.exists) {\r\n                        console.log('creating request')\r\n                        firebase.firestore().collection('rank_requests').add({\r\n                            timestamp: firebase.firestore.FieldValue.serverTimestamp(),\r\n                            user_id: currentUser.uid,\r\n                            processed: false,\r\n                            rank: doc.id\r\n                        })\r\n                    }\r\n                    else {\r\n                        console.log('no rank')\r\n                    }\r\n                })\r\n            }\r\n        }\r\n    }, [currentUser])\r\n\r\n    return (\r\n        currentUser ?\r\n            <Grid>\r\n                <Grid container className={classes.message}>\r\n                    <Typography> ,      <Link href=\"https://www.youtube.com/watch?v=jJX5uMqqC7Q&feature=youtu.be\">-</Link>.</Typography>\r\n                    <Typography>8   08:00  22:00    .</Typography>\r\n                    <Typography>      -.</Typography>\r\n                </Grid>\r\n                {tgId.length === 0 ?\r\n                    <Dialog\r\n                        fullWidth\r\n                        open={open}\r\n                        aria-labelledby=\"max-width-dialog-title\"\r\n                    >\r\n                        <DialogTitle id=\"max-width-dialog-title\">\r\n                            <Typography style={{ paddingBottom: 10 }} variant=\"h5\" align=\"center\"> ,    /     </Typography>\r\n                        </DialogTitle>\r\n                        <DialogContent>\r\n                            <DialogContentText>\r\n                                <Grid container justify=\"center\">\r\n                                    <Typography style={{ paddingBottom: 10 }} variant=\"h5\" align=\"center\">   \r\n                               -.      .</Typography>\r\n                                    <Typography style={{ paddingBottom: 10 }} variant=\"h5\" align=\"center\">    -  .     .</Typography>\r\n                                    {token ? <Link variant=\"h5\" href={\"https://telegram.me/journal_tg_bot?start=\" + token}>   /  </Link>\r\n                                        : <Typography variant=\"body2\" align=\"center\">      5 ,  </Typography>}\r\n                                    <Button style={{marginTop: 20}} size=\"large\" color=\"primary\" variant=\"contained\" onClick={signInWithGoogle}>\r\n                                           \r\n                                    </Button>\r\n                                </Grid>\r\n                            </DialogContentText>\r\n                        </DialogContent>\r\n                    </Dialog> :\r\n                    null}\r\n                {/* <Grid container justify=\"center\" className={classes.message}>\r\n                        <Typography style={{ paddingBottom: 10 }} variant=\"h5\" align=\"center\">   \r\n                               -.      .</Typography>\r\n                        {token ? <Link variant=\"h5\" href={\"https://telegram.me/journal_tg_bot?start=\" + token}>  </Link>\r\n                            : <Typography variant=\"body2\" align=\"center\">      5 ,\r\n                                 </Typography>}\r\n                    </Grid> */}\r\n\r\n\r\n            </Grid>\r\n            :\r\n            <Grid container direction=\"column\" style={{ padding: 20 }} justify=\"center\">\r\n                <Typography align=\"center\" variant=\"h3\"></Typography>\r\n                <br />\r\n                <Button size=\"large\" color=\"primary\" variant=\"contained\" onClick={signInWithGoogle}>  \r\n                     Google</Button>\r\n            </Grid>\r\n    )\r\n}\r\n\r\nexport default Home","import React from 'react';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport Card from '@material-ui/core/Card';\r\nimport CardActions from '@material-ui/core/CardActions';\r\nimport CardContent from '@material-ui/core/CardContent';\r\nimport Button from '@material-ui/core/Button';\r\nimport Typography from '@material-ui/core/Typography';\r\n\r\nconst useStyles = makeStyles({\r\n  root: {\r\n    minWidth: 275,\r\n  },\r\n  bullet: {\r\n    display: 'inline-block',\r\n    margin: '0 2px',\r\n    transform: 'scale(0.8)',\r\n  },\r\n  title: {\r\n    fontSize: 14,\r\n  },\r\n  pos: {\r\n    marginBottom: 12,\r\n  },\r\n});\r\n\r\nexport default function UserCard(props) {\r\n  const classes = useStyles();\r\n\r\n  console.log('TEST CARD')\r\n  console.log(props)\r\n\r\n  if (props.userInfo == {}) {\r\n    return (<div></div>)\r\n  }\r\n\r\n  return (\r\n    <Card className={classes.root} variant=\"outlined\">\r\n      <CardContent>\r\n        <Typography className={classes.title} color=\"textSecondary\" gutterBottom>\r\n          id: {props.userInfo.id}\r\n        </Typography>\r\n        <Typography variant=\"h5\" component=\"h2\">\r\n          {props.userInfo.surname + \" \" + props.userInfo.name}\r\n        </Typography>\r\n        <Typography className={classes.pos} color=\"textSecondary\">\r\n          username: {props.userInfo.username}\r\n        </Typography>\r\n        <Typography className={classes.pos} color=\"textSecondary\">\r\n          : {props.userInfo.district}\r\n        </Typography>\r\n        <Typography variant=\"body2\" component=\"p\">\r\n          {props.userInfo.phone}\r\n        </Typography>\r\n        <Typography variant=\"body2\" component=\"p\">\r\n          {props.userInfo.email}\r\n        </Typography>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}","import React, {useEffect, useState} from \"react\";\r\nimport firebase from \"firebase\";\r\nimport LinearProgressWithLabel from \"./LinearProgressWithLabel\";\r\nimport {cloneDeep} from \"lodash\";\r\n\r\n\r\nconst Loader = props => {\r\n    const [fileBeingUploaded, setFileBeingUploaded] = useState({})\r\n    //const [storedFiles, setStoredFiles] = useState({})\r\n\r\n    // useEffect(() => {\r\n    //     props.filesLinks.onSnapshot(doc => {\r\n    //         setStoredFiles(doc.data().contents)\r\n    //     });\r\n    // }, [props.filesLinks])\r\n\r\n    const clear_url = (url) => {\r\n        return url.replace('https://firebasestorage.googleapis.com/v0/b/journal-bb5e3.appspot.com/o', 'https://storage.cloud.google.com/journal-bb5e3.appspot.com') + '?authuser=1'\r\n    }\r\n\r\n\r\n    const upload = async files => {\r\n        await Promise.all(files.map(async file => {\r\n            const snap = props.storageRef.child(file.name).put(file)\r\n            setFileBeingUploaded(prevState => {\r\n                const update = {[file.name]: {status: \"loading\", progress: 0}}\r\n                return prevState ? {...prevState, ...update} : update\r\n            })\r\n\r\n            // Listen for state changes, errors, and completion of the upload.\r\n            snap.on(firebase.storage.TaskEvent.STATE_CHANGED, // or 'state_changed'\r\n                snapshot => {\r\n                    // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded\r\n                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\r\n                    setFileBeingUploaded(prevState => {\r\n                        const update = {[file.name]: {status: \"loading\", progress: progress}}\r\n                        return prevState ? {...prevState, ...update} : update\r\n                    })\r\n                    console.log('Upload is ' + progress + '% done');\r\n\r\n                    switch (snapshot.state) {\r\n                        case firebase.storage.TaskState.PAUSED: // or 'paused'\r\n                            console.log('Upload is paused');\r\n                            break;\r\n                        case firebase.storage.TaskState.RUNNING: // or 'running'\r\n                            console.log('Upload is running');\r\n                            break;\r\n                    }\r\n                }, error => {\r\n\r\n                    // A full list of error codes is available at\r\n                    // https://firebase.google.com/docs/storage/web/handle-errors\r\n                    switch (error.code) {\r\n                        case 'storage/unauthorized':\r\n                            // User doesn't have permission to access the object\r\n                            break;\r\n\r\n                        case 'storage/canceled':\r\n                            // User canceled the upload\r\n                            break;\r\n\r\n                        default:\r\n                            // Unknown error occurred, inspect error.serverResponse\r\n                            break;\r\n                    }\r\n                }, () => {\r\n                    // Upload completed successfully, now we can get the download URL\r\n                    snap.snapshot.ref.getDownloadURL().then(async downloadURL => {\r\n                        let fileLink = downloadURL\r\n                        if (props.secure) {\r\n                            fileLink = clear_url(downloadURL.split('?')[0])\r\n                        }\r\n                        await props.filesLinks.set({contents: {[fileLink]: {name: file.name, url: fileLink}}},\r\n\t\t\t\t\t{merge: props.allowMultipleFiles})\r\n                        setFileBeingUploaded(prevState => {\r\n                            const newState = Object.assign({}, prevState)\r\n                            delete newState[file.name]\r\n                            return newState\r\n                        })\r\n                        console.log('File available at', fileLink);\r\n                    });\r\n                });\r\n\r\n            // let url = await snap.ref.getDownloadURL()\r\n            // let url_wo_token = url.split(\"?\")[0]\r\n            // console.log(\"File uploaded: \", url)\r\n            // //await uploadFilesData(file.name, url_wo_token, key)\r\n        }));\r\n    }\r\n\r\n    const handleChange = (event) => {\r\n        console.log(\"Files selected: \", [...event.target.files,])\r\n        upload([...event.target.files])\r\n    };\r\n\r\n\r\n    return (\r\n        <div>\r\n            <input\r\n                type=\"file\"\r\n                onChange={handleChange}\r\n                multiple={props.allowMultipleFiles}\r\n            />\r\n            {Object.keys(fileBeingUploaded).map(filename =>\r\n                <div key={filename}>\r\n                    <p>{filename}</p>\r\n                    <LinearProgressWithLabel value={fileBeingUploaded[filename].progress}/>\r\n                </div>\r\n\r\n            )}\r\n            {/*{storedFiles ? <p> </p> : <p></p>}*/}\r\n            {/*{Object.keys(storedFiles).map(fileUrl =>*/}\r\n            {/*    <div key={fileUrl}>*/}\r\n            {/*        <a href={fileUrl}>{storedFiles[fileUrl].name}</a>*/}\r\n            {/*    </div>*/}\r\n            {/*)}*/}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default Loader","import firebase from \"../../util/Firebase\";\r\nimport Loader from \"./Loader\";\r\nimport React, { useState } from \"react\";\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\nimport ClearIcon from '@material-ui/icons/Clear';\r\nimport VisibilityIcon from '@material-ui/icons/Visibility';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport { Dialog, Typography } from \"@material-ui/core\";\r\n\r\nconst CustomFileUpload = props => {\r\n\r\n\tconst [connectingTelegram, setConnectingTelegram] = useState(false)\r\n\tconst [telegramConnected, setTelegramConnected] = useState(false)\r\n\tconst [open, setOpen] = useState(false)\r\n\tconst [currentFile, setCurrentFile] = useState(null)\r\n\r\n\tlet pathToFolder = null\r\n\tlet handleTgConnectClick = null\r\n\tif (!props.disabled) {\r\n\t\tpathToFolder = firebase\r\n\t\t\t.storage()\r\n\t\t\t.ref(props.taskID)\r\n\t\t\t.child(props.name)\r\n\t\t\t.child(props.currentUserUid)\r\n\r\n\t\thandleTgConnectClick = async () => {\r\n\t\t\tsetConnectingTelegram(true)\r\n\t\t\tawait firebase\r\n\t\t\t\t.firestore()\r\n\t\t\t\t.collection(\"users\")\r\n\t\t\t\t.doc(props.currentUserUid)\r\n\t\t\t\t.set({ fileUpload: props.taskID + \"/\" + props.name }, { merge: true })\r\n\t\t\tsetConnectingTelegram(false)\r\n\t\t\tsetTelegramConnected(true)\r\n\r\n\t\t}\r\n\t}\r\n\tconst linksToFiles = firebase\r\n\t\t.firestore()\r\n\t\t.collection(\"tasks\")\r\n\t\t.doc(props.taskID)\r\n\t\t.collection(\"responses\")\r\n\t\t.doc(props.name)\r\n\r\n\tconst removeFile = (path) => {\r\n\t\tconsole.log(path)\r\n\t\tlinksToFiles.set({\r\n\t\t\tcontents: { [path]: firebase.firestore.FieldValue.delete() }\r\n\t\t}, { merge: true })\r\n\t\t\t.then(() => {\r\n\t\t\t\tdelete files[path]\r\n\t\t\t\tconsole.log('file removed')\r\n\t\t\t\tif (Object.keys(files).length > 0) {\r\n\t\t\t\t\tprops.onChange(files)\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tprops.onChange()\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(error => console.log(error))\r\n\t}\r\n\r\n\tlet files = {}\r\n\tif (props.formData && Object.keys(props.formData).length > 0) {\r\n\t\tfiles = props.formData\r\n\t}\r\n\telse if (props.initResp && props.name && props.initResp[props.name] && props.initResp[props.name].contents && Object.keys(props.initResp[props.name].contents).length > 0) {\r\n\t\tfiles = props.initResp[props.name].contents\r\n\t}\r\n\r\n\tconst handleClose = () => {\r\n\t\tsetOpen(false)\r\n\t};\r\n\r\n\tconst openDialog = (file) => {\r\n\t\tlet comp = getComponent(file)\r\n\t\tsetCurrentFile(comp)\r\n\t\tsetOpen(true)\r\n\t}\r\n\r\n\tconst getComponent = (file) => {\r\n\t\tif (file) {\r\n\t\t\tconst extension = file.name.substring(file.name.lastIndexOf('.') + 1, file.name.length).toLowerCase() || ''\r\n\t\t\tconsole.log(\"debug file extension\", extension)\r\n\t\t\tif (extension === 'jpeg' || extension === 'jpg' || extension === 'png') {\r\n\t\t\t\treturn <img src={file.url} style={{ height: '100%', width: 'auto' }} alt={file.name}></img>\r\n\t\t\t}\r\n\t\t\telse if (extension === 'mp4' || extension === 'ogg' || extension === 'webm' || extension === 'mov') {\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<video controls=\"controls\" style={{ maxHeight: '100%', width: 'auto' }}>\r\n\t\t\t\t\t\t<source src={file.url}></source>\r\n\t\t\t\t\t</video>\r\n\t\t\t\t)\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn <Typography>     </Typography>\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn null\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div>\r\n\t\t\t<Dialog onClose={handleClose} open={open}>\r\n\t\t\t\t{currentFile}\r\n\t\t\t</Dialog>\r\n\t\t\t{props.schema.title ? <div>{props.schema.title}</div> : <div></div>}\r\n\t\t\t{props.schema.description ? <div>{props.schema.description}</div> : <div></div>}\r\n\t\t\t{props.disabled ? null :\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<Loader storageRef={pathToFolder}\r\n\t\t\t\t\t\tallowMultipleFiles={props.stage && props.stage.allowMultipleFiles ? props.stage.allowMultipleFiles : false}\r\n\t\t\t\t\t\tsecure={props.stage && props.stage.cleanFileLink ? props.stage.cleanFileLink : false}\r\n\t\t\t\t\t\tfilesLinks={linksToFiles} />\r\n\t\t\t\t\t{connectingTelegram ?\r\n\t\t\t\t\t\t<CircularProgress />\r\n\t\t\t\t\t\t:\r\n\t\t\t\t\t\ttelegramConnected ?\r\n\t\t\t\t\t\t\t<div>      .  ,  ,   .     ,       \"\". <a href=\"https://t.me/journal_tg_bot\">  .</a></div>\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<p>        -.     : </p>\r\n\t\t\t\t\t\t\t\t<button onClick={handleTgConnectClick}>  </button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t\t{files ?\r\n\t\t\t\t<div>\r\n\t\t\t\t\t{Object.keys(files).map(path =>\r\n\t\t\t\t\t\t<div key={path}>\r\n\t\t\t\t\t\t\t<a href={files[path].url} target=\"_blank\" rel=\"noreferrer\">{files[path].name}</a>\r\n\t\t\t\t\t\t\t{props.metadata && !props.metadata.is_complete && <IconButton onClick={() => removeFile(path)} size=\"small\"><ClearIcon /></IconButton>}\r\n\t\t\t\t\t\t\t<IconButton onClick={() => openDialog(files[path])} size=\"small\"><VisibilityIcon /></IconButton>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t\t:\r\n\t\t\t\t<div></div>\r\n\t\t\t}\r\n\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport default CustomFileUpload\r\n\r\n","import React, { useState, useEffect, useContext, useRef } from 'react'\r\nimport firebase, { signInWithGoogle } from '../../util/Firebase'\r\nimport { AuthContext } from \"../../util/Auth\";\r\n\r\nimport CustomFileUpload from \"../form/CustomFileUpload\";\r\nimport { Button, Grid, Typography } from '@material-ui/core';\r\n\r\nimport JSchemaForm from \"@rjsf/bootstrap-4\";\r\nimport { cloneDeep } from 'lodash'\r\n\r\n\r\nconst JSchemaTask = (props) => {\r\n\tconst [formResponses, setFormResponses] = useState({})\r\n\tconst [taskForm, setTaskForm] = useState({})\r\n\tconst [mergedForm, setMergedForm] = useState({})\r\n\tconst [taskMetadata, setTaskMetadata] = useState({})\r\n\tconst [caseStages, setCaseStages] = useState({})\r\n\tconst [gRef, setGRef] = useState(null)\r\n\tconst [formStatus, setFormStatus] = useState(\"loading\")\r\n\r\n\tconst { currentUser } = useContext(AuthContext);\r\n\tconst id = props.id\r\n\r\n\r\n\tuseEffect(() => {\r\n\t\tif (currentUser && id) {\r\n\r\n\t\t\tconst ref = firebase\r\n\t\t\t\t.firestore()\r\n\t\t\t\t.collection(\"tasks\")\r\n\t\t\t\t.doc(id)\r\n\r\n\t\t\tsetGRef(ref)\r\n\r\n\t\t\tref.onSnapshot(doc => {\r\n\t\t\t\tsetTaskMetadata(doc.data())\r\n\t\t\t\tif (doc.data().is_complete) {\r\n\t\t\t\t\tsetFormStatus(\"sent\")\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!doc.data().assigned_users.includes(currentUser.uid)) {\r\n\t\t\t\t\tsetFormStatus(\"released\")\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log(\"Task Metadata: \", doc.data());\r\n\t\t\t});\r\n\r\n\t\t\tref.collection(\"responses\")\r\n\t\t\t\t.onSnapshot(snapshot => {\r\n\t\t\t\t\tconst changes = {}\r\n\t\t\t\t\tconst deletes = []\r\n\t\t\t\t\tlet modifyResponses = false\r\n\t\t\t\t\tsnapshot.docChanges().forEach(change => {\r\n\t\t\t\t\t\tif (change.type === \"added\" || change.type === \"modified\") {\r\n\t\t\t\t\t\t\tconst contents = change.doc.data().contents\r\n\t\t\t\t\t\t\tchanges[change.doc.id] = contents\r\n\t\t\t\t\t\t\tmodifyResponses = true\r\n\t\t\t\t\t\t\t//}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (change.type === \"removed\") {\r\n\t\t\t\t\t\t\t//if (formResponses.hasOwnProperty(change.doc.id)) {\r\n\t\t\t\t\t\t\tconsole.log(\"Response Removed: \", change.doc.data());\r\n\t\t\t\t\t\t\tdeletes.push(change.doc.id)\r\n\t\t\t\t\t\t\tmodifyResponses = true\r\n\t\t\t\t\t\t\t//}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (modifyResponses) {\r\n\t\t\t\t\t\tsetFormResponses(prevState => {\r\n\t\t\t\t\t\t\tconst newState = cloneDeep(prevState)\r\n\t\t\t\t\t\t\tdeletes.forEach(d => delete newState[d])\r\n\t\t\t\t\t\t\tObject.keys(changes).forEach(key => newState[key] = changes[key])\r\n\t\t\t\t\t\t\treturn newState\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\tref.collection(\"questions\")\r\n\t\t\t\t.onSnapshot(snapshot => {\r\n\t\t\t\t\tsnapshot.docChanges().forEach(change => {\r\n\t\t\t\t\t\tif (change.type === \"added\" || change.type === \"modified\") {\r\n\t\t\t\t\t\t\tsetTaskForm(prevState => {\r\n\t\t\t\t\t\t\t\treturn { ...prevState, [change.doc.id]: change.doc.data() }\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t}\r\n\r\n\t}, [id, currentUser])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (Object.entries(taskMetadata).length > 0) {\r\n\t\t\tconsole.log(\"Task metadata: \", taskMetadata)\r\n\t\t\tfirebase.firestore()\r\n\t\t\t\t.collection(\"schema\")\r\n\t\t\t\t.doc(\"structure\")\r\n\t\t\t\t.collection(\"cases\")\r\n\t\t\t\t.doc(taskMetadata.case_type)\r\n\t\t\t\t.collection(\"stages\")\r\n\t\t\t\t.onSnapshot(snapshot => {\r\n\t\t\t\t\tsnapshot.docChanges().forEach(change => {\r\n\t\t\t\t\t\tif (change.type === \"added\" || change.type === \"modified\") {\r\n\t\t\t\t\t\t\tconsole.log(\"Case stage: \", change.doc.data())\r\n\t\t\t\t\t\t\tsetCaseStages(prevState => {\r\n\t\t\t\t\t\t\t\treturn { ...prevState, [change.doc.id]: change.doc.data() }\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (change.type === \"removed\") {\r\n\t\t\t\t\t\t\tsetCaseStages(prevState => {\r\n\t\t\t\t\t\t\t\tconst newState = Object.assign({}, prevState)\r\n\t\t\t\t\t\t\t\tdelete newState[change.doc.id]\r\n\t\t\t\t\t\t\t\treturn newState\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t}\r\n\t}, [taskMetadata])\r\n\r\n\tuseEffect(() => {\r\n\t\tsetMergedForm(mergeForm(taskForm, caseStages[taskMetadata.case_stage_id]))\r\n\t}, [taskForm, taskMetadata, caseStages])\r\n\r\n\tconst handleFormChange = e => {\r\n\t\tsetFormResponses(e.formData)\r\n\t};\r\n\r\n\tconst mergeForm = (taskForm, caseForms) => {\r\n\t\tconst tForm = Object.assign({}, taskForm)\r\n\t\tconst cForms = Object.assign({}, caseForms)\r\n\r\n\t\tcForms.start = cForms.start ? cForms.start : {}\r\n\t\tcForms.end = cForms.end ? cForms.end : {}\r\n\t\tcForms.start_ui_schema = cForms.start_ui_schema ? cForms.start_ui_schema : {}\r\n\t\tcForms.end_ui_schema = cForms.end_ui_schema ? cForms.end_ui_schema : {}\r\n\r\n\t\ttForm.form_questions = tForm.form_questions ? tForm.form_questions : {}\r\n\t\ttForm.ui_schema = tForm.ui_schema ? tForm.ui_schema : {}\r\n\r\n\r\n\t\tconst properties = {\r\n\t\t\t...(cForms.start.properties ? cForms.start.properties : {}),\r\n\t\t\t...(cForms.end.properties ? cForms.end.properties : {}),\r\n\t\t\t...(tForm.form_questions.properties ? tForm.form_questions.properties : {})\r\n\t\t}\r\n\r\n\t\tconst definitions = {\r\n\t\t\t...(cForms.start.definitions ? cForms.start.definitions : {}),\r\n\t\t\t...(cForms.end.definitions ? cForms.end.definitions : {}),\r\n\t\t\t...(tForm.form_questions.definitions ? tForm.form_questions.definitions : {})\r\n\t\t}\r\n\r\n\t\tlet title = \"\"\r\n\t\tif (tForm.form_questions.title) {\r\n\t\t\ttitle = tForm.form_questions.title\r\n\t\t} else if (cForms.end.title) {\r\n\t\t\ttitle = cForms.end.title\r\n\t\t} else if (cForms.start.title) {\r\n\t\t\ttitle = cForms.start.title\r\n\t\t}\r\n\r\n\t\tlet description = \"\"\r\n\t\tif (tForm.form_questions.description) {\r\n\t\t\tdescription = tForm.form_questions.description\r\n\t\t} else if (cForms.end.description) {\r\n\t\t\tdescription = cForms.end.description\r\n\t\t} else if (cForms.start.description) {\r\n\t\t\tdescription = cForms.start.description\r\n\t\t}\r\n\r\n\t\tconst required = [...new Set([\r\n\t\t\t...(cForms.start.required ? cForms.start.required : []),\r\n\t\t\t...(tForm.form_questions.required ? tForm.form_questions.required : []),\r\n\t\t\t...(cForms.end.required ? cForms.end.required : [])\r\n\t\t])]\r\n\r\n\t\tconst uiOrder = [...new Set([\r\n\t\t\t...(cForms.start_ui_schema[\"ui:order\"] ? cForms.start_ui_schema[\"ui:order\"] : []),\r\n\t\t\t...(tForm.ui_schema[\"ui:order\"] ? tForm.ui_schema[\"ui:order\"] : []),\r\n\t\t\t...(cForms.end_ui_schema[\"ui:order\"] ? cForms.end_ui_schema[\"ui:order\"] : [])\r\n\t\t])]\r\n\r\n\t\tlet uiSchema = {\r\n\t\t\t...(cForms.start_ui_schema ? cForms.start_ui_schema : {}),\r\n\t\t\t...(cForms.end_ui_schema ? cForms.end_ui_schema : {}),\r\n\t\t\t...(tForm.ui_schema ? tForm.ui_schema : {})\r\n\t\t}\r\n\r\n\t\tuiSchema = { ...uiSchema, ...{ \"ui:order\": uiOrder } }\r\n\r\n\t\tconst form = {\r\n\t\t\tproperties: properties,\r\n\t\t\tdefinitions: definitions,\r\n\t\t\ttitle: title,\r\n\t\t\tdescription: description,\r\n\t\t\trequired: required\r\n\t\t}\r\n\t\treturn { form_questions: form, ui_schema: uiSchema }\r\n\r\n\t}\r\n\r\n\tconst customImageWidget = (props) => {\r\n\t\tconsole.log(\"PROPS\", props)\r\n\t\treturn (\r\n\t\t\t<img src={props.value} alt={props.schema.title}\r\n\t\t\t\tstyle={{\r\n\t\t\t\t\tmaxWidth: \"100%\",\r\n\t\t\t\t\theight: \"auto\"\r\n\t\t\t\t}}></img>\r\n\t\t);\r\n\t};\r\n\r\n\tconst customVideoWidget = (props) => {\r\n\t\tconsole.log(\"PROPS\", props)\r\n\t\treturn (\r\n\t\t\t<video title={props.schema.title}\r\n\t\t\t\tstyle={{\r\n\t\t\t\t\tmaxWidth: \"100%\",\r\n\t\t\t\t\theight: \"auto\"\r\n\t\t\t\t}}\r\n\t\t\t\tcontrols\r\n\t\t\t>\r\n\t\t\t\t<source src={props.value} type=\"video/mp4\"></source>\r\n\t\t\t</video>\r\n\t\t)\r\n\t}\r\n\r\n\tconst customIframeWidget = (props) => {\r\n\t\tconsole.log(\"PROPS\", props)\r\n\t\treturn (\r\n\t\t\t<iframe\r\n\t\t\t\ttitle={props.schema.title}\r\n\t\t\t\tsrc={props.value}\r\n\t\t\t\tframeBorder=\"0\"\r\n\t\t\t\tallow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\r\n\t\t\t\tallowFullScreen></iframe>\r\n\t\t)\r\n\t}\r\n\r\n\tconst widgets = {\r\n\t\tcustomImageWidget: customImageWidget,\r\n\t\tcustomVideoWidget: customVideoWidget,\r\n\t\tcustomIframeWidget: customIframeWidget\r\n\t};\r\n\r\n\treturn (\r\n\t\tcurrentUser ?\r\n\t\t\t<Grid style={{ padding: 30 }}>\r\n\t\t\t\t{mergedForm && gRef && caseStages && taskMetadata && taskMetadata.case_stage_id && caseStages[taskMetadata.case_stage_id] ?\r\n\t\t\t\t\t<JSchemaForm\r\n\t\t\t\t\t\tschema={mergedForm.form_questions}\r\n\t\t\t\t\t\tuiSchema={mergedForm.ui_schema}\r\n\t\t\t\t\t\tformData={formResponses}\r\n\t\t\t\t\t\tfields={{ customFileUpload: a => CustomFileUpload({ ...a, ...{ taskID: id }, ...{ \"currentUserUid\": currentUser.uid }, ...{stage: caseStages[taskMetadata.case_stage_id]} }) }}\r\n\t\t\t\t\t\tdisabled={formStatus === \"loading\" || formStatus === \"sent\" || formStatus === \"released\"}\r\n\t\t\t\t\t\twidgets={widgets}\r\n\t\t\t\t\t\tnoHtml5Validate \r\n\t\t\t\t\t\tonChange={e => {\r\n\t\t\t\t\t\t\thandleFormChange(e)\r\n\t\t\t\t\t\t}}><></>\r\n\t\t\t\t\t</JSchemaForm>\r\n\t\t\t\t\t:\r\n\t\t\t\t\tnull}\r\n\r\n\t\t\t</Grid>\r\n\t\t\t:\r\n\t\t\t<Grid container direction=\"column\" style={{ padding: 20 }} justify=\"center\">\r\n\t\t\t\t<Typography align=\"center\" variant=\"h3\"></Typography>\r\n\t\t\t\t<br />\r\n\t\t\t\t<Button variant=\"contained\" onClick={signInWithGoogle}>    Google</Button>\r\n\t\t\t</Grid>\r\n\t)\r\n\r\n}\r\n\r\nexport default JSchemaTask","import React, { useEffect, useState, useContext } from 'react';\r\nimport firebase from '../../util/Firebase'\r\n\r\nimport Form from '../form/form'\r\nimport { Button, Grid, Typography } from '@material-ui/core';\r\n\r\nimport UserCard from '../Moderator/UserCard'\r\nimport NewForm from './NewForm'\r\n\r\n\r\nconst ModeratedTask = (props) => {\r\n\r\n\tconst [tasks, setTasks] = React.useState([]);\r\n\tconst [taskInfo, setTaskInfo] = useState({})  \r\n\t\r\n\tlet userInfo = {}\r\n\r\n    const [questions, setQuestions] = useState([])    \r\n    const [responses, setResponses] = useState([])    \r\n    const [answers, setAnswers] = useState({})    \r\n    const [forms, setForms] = useState(<div></div>)\r\n    \r\n\tconst [pending, setPending] = useState(false)\r\n\tconst [passed, setPassed] = useState(false)\r\n\tconst [notPassed, setNotPassed] = useState(false)\r\n\tconst [verified, setVerified] = useState(false)\r\n\tconst [notVerified, setNotVerified] = useState(false)\r\n\r\n\tconst getReviewStatus = async () => {\r\n        firebase.firestore().collection(\"tasks\").doc(props.task.id).get().then(doc => {\r\n\t\t\tlet review_status\r\n\t\t\tif (doc.exists && doc.data() && doc.data().review_status) {\r\n\t\t\t\treview_status = doc.data().review_status\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treview_status = 'pending'\r\n\t\t\t}\r\n\t\t\tconsole.log(\"TEST TEST\", doc.data())\r\n\t\t\t\r\n\t\t\tsetPending(review_status === 'pending')\r\n\t\t\tsetPassed(review_status === 'passed')\r\n\t\t\tsetNotPassed(review_status === 'not passed')\r\n\t\t\tsetVerified(review_status === 'verified')\r\n\t\t\tsetNotVerified(review_status === 'not verified')\t\t\t\r\n        })\r\n\t}\r\n\t\r\n\tconst getUserInfo = () => {\r\n\r\n\t\tif (taskInfo.assigned_users !== undefined && taskInfo.assigned_users.length > 0){\r\n\t\t\r\n\t\t\tlet item = props.users.find(item => item.id === taskInfo.assigned_users[0])\r\n\t\t\tif (item !== undefined){\r\n\t\t\t\tuserInfo = item\r\n\t\t\t}\t\t\t\t\r\n\t\t\telse{\r\n\t\t\t\tuserInfo = {}\r\n\t\t\t}\r\n\t\t}\r\n        \r\n    }\r\n\r\n    useEffect(() => {\r\n\t\tconst getData = async () => {\r\n\t\t\tlet q = []\r\n\t\t\tlet r = []\r\n\t\t\tlet f = []\r\n\t\t\tlet locked = true\r\n\r\n\r\n\t\t\tconsole.log(\"HOOK\")\r\n\t\t\tgetReviewStatus()\t\t\r\n\t\t\t\r\n\t\t\tawait firebase.firestore().collection(\"tasks\").doc(props.task.id).get()\r\n\t\t\t\t.then(doc => {\t\t\t\t\r\n\t\t\t\t\tsetTaskInfo(doc.data())\r\n\t\t\t\t})\r\n\t\t\t\t.catch((error) => {\r\n\t\t\t\t\tconsole.log(\"Error getting documents: \", error);\r\n\t\t\t\t});\r\n\r\n\t\t\tawait firebase.firestore().collection(\"tasks\").doc(props.task.id).collection(\"questions\").get()\r\n\t\t\t\t.then((querySnapshot) => {\r\n\t\t\t\t\tquerySnapshot.forEach((doc) => {\r\n\t\t\t\t\t\t// console.log(doc.id, \" => \", doc.data());\r\n\t\t\t\t\t\tq.push({ questionId: doc.id, data: doc.data() })\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tsetQuestions(q)\r\n\t\t\t\t})\r\n\t\t\t\t.catch((error) => {\r\n\t\t\t\t\tconsole.log(\"Error getting documents: \", error);\r\n\t\t\t\t});\r\n\r\n\t\t\tawait firebase.firestore().collection(\"tasks\").doc(props.task.id).collection(\"responses\").get()\r\n\t\t\t\t.then((querySnapshot) => {\r\n\t\t\t\t\tquerySnapshot.forEach((doc) => {\r\n\t\t\t\t\t\t// console.log(doc.id, \" => \", doc.data());\r\n\t\t\t\t\t\tr.push({ responseId: doc.id, data: doc.data() })\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tsetResponses(r)\r\n\t\t\t\t})\r\n\t\t\t\t.catch((error) => {\r\n\t\t\t\t\tconsole.log(\"Error getting documents: \", error);\r\n\t\t\t\t});\r\n\t\t\r\n\r\n\t\t\t//!!!\r\n\t\t\tsetForms(<div></div>)\t\r\n\r\n\t\t\tf = q.map((el, i) => {\r\n\t\t\t\tlet response = null\r\n\t\t\t\t// console.log(i)\r\n\t\t\t\tr.forEach((res) => {\r\n\t\t\t\t\tif (el.questionId === res.responseId) {\r\n\t\t\t\t\t\tresponse = res.data.answer\r\n\t\t\t\t\t\treturnAnswer(res.data.answer, i)\r\n\t\t\t\t\t\t// console.log(res.data)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\treturn <Form key={i} question={el.data} index={i} response={response} returnAnswer={returnAnswer} locked={locked} />\r\n\t\t\t})\r\n\t\t\tsetForms(f)\r\n\t\t}\r\n\t\tif (props.task.id) {\r\n\t\t\tgetData()\r\n\t\t}\r\n\t}, [props.task.id])\r\n    \r\n    const returnAnswer = (answer, index) => {\r\n\t\tconst tmp = answers\r\n\t\ttmp[index] = answer\r\n\t\tsetAnswers(tmp)\r\n\t\t// console.log(answers)\r\n\t}\r\n\r\n\tconst handlePending = () => {\r\n\t\tupdateReviewStatus('pending')\r\n\t\tgetReviewStatus()\r\n\t}\r\n\r\n\tconst handlePassed = () => {\r\n\t\tupdateReviewStatus('passed')\r\n\t\tgetReviewStatus()\r\n\t}\r\n\r\n\tconst handleNotPassed = () => {\r\n\t\tupdateReviewStatus('not passed')\r\n\t\tgetReviewStatus()\r\n\t}\r\n\r\n\tconst handleVerified = () => {\r\n\t\tupdateReviewStatus('verified')\r\n\t\tgetReviewStatus()\r\n\t}\r\n\r\n\tconst handleNotVerified = () => {\r\n\t\tupdateReviewStatus('not verified')\r\n\t\tgetReviewStatus()\r\n\t}\r\n\t\r\n\tconst updateReviewStatus = async (review_status) => {\r\n\t\tawait firebase.firestore().collection(\"tasks\").doc(props.task.id).update({ review_status: review_status })\r\n\t}\r\n    \r\n    // console.log('TEST')\r\n    // console.log(tasks)\r\n\r\n\tgetUserInfo()\r\n\treturn (\r\n\t\t<Grid style={{ padding: 30 }}>\r\n\r\n\t\t\t{/* <Grid container style={{ padding: 20 }} justify=\"center\">\r\n\t\t\t\t<Button variant=\"contained\" color={pending ? \"secondary\" : '{}'} onClick={handlePending}>\r\n\t\t\t\t\tPENDING\r\n\t\t\t\t</Button>\r\n\t\t\t\t<Button variant=\"contained\" color={passed ? \"secondary\" : '{}'} onClick={handlePassed}>\r\n\t\t\t\t\tPASSED\r\n\t\t\t\t</Button>\r\n\t\t\t\t<Button variant=\"contained\" color={notPassed ? \"secondary\" : '{}'} onClick={handleNotPassed}>\r\n\t\t\t\t\tNOT PASSED\r\n\t\t\t\t</Button>\r\n\t\t\t\t<Button variant=\"contained\" color={verified ? \"secondary\" : '{}'} onClick={handleVerified}>\r\n\t\t\t\t\tVERIFIED\r\n\t\t\t\t</Button>\r\n\t\t\t\t<Button variant=\"contained\" color={notVerified ? \"secondary\" : '{}'} onClick={handleNotVerified}>\r\n\t\t\t\t\tNOT VERIFIED\r\n\t\t\t\t</Button>\r\n            </Grid> */}\r\n\r\n\t\t\t<Grid container justify = \"center\">\r\n                <UserCard userInfo={userInfo}> </UserCard>\r\n            </Grid>\r\n\r\n            {/* {forms} */}\r\n\t\t\t<Typography>{\"Task ID: \" + props.task.id}</Typography>\r\n\t\t\t<Typography>{\"Case ID: \" + props.task.case_id}</Typography>\r\n            <NewForm id={props.task.id} />\r\n\r\n\t\t\t</Grid>\r\n\t);\r\n}\r\n\r\nexport default ModeratedTask","import React, {useState, useEffect} from 'react'\r\nimport ModeratedTask from './ModeratedTask'\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport TablePagination from \"@material-ui/core/TablePagination\";\r\nimport {List} from \"immutable\"\r\n\r\nconst rowsPP = 1;\r\n\r\nconst PaginatedTasks= props => {\r\n    const [page, setPage] = useState(0);\r\n    const [rowsPerPage, setRowsPerPage] = useState(rowsPP);\r\n    const [dataSlice, setDataSlice] = useState([]);\r\n\r\n    const calculateSlice = (pageNumber, rowsPage, data) => {\r\n        const iData = List(data)\r\n        const numberOfPages = Math.floor(iData.size / rowsPage);\r\n        console.log(\"numberOfPages\", numberOfPages);\r\n        const start = pageNumber * rowsPage;\r\n        let end = iData.size\r\n        if (pageNumber !== numberOfPages - 1) {\r\n            end = (pageNumber + 1) * rowsPage;\r\n        }\r\n        console.log(\"Start\", start);\r\n        console.log(\"End\", end);\r\n        return data.slice(start, end)\r\n    }\r\n\r\n    const handleChangePage = (event, newPage) => {\r\n        setDataSlice(calculateSlice(newPage, rowsPerPage, props.data));\r\n        setPage(newPage);\r\n    };\r\n    const handleChangeRowsPerPage = (event) => {\r\n        // setPage(0);\r\n        // setRowsPerPage(event.target.value);\r\n        // setDataSlice(calculateSlice(0, event.target.value, props.data));\r\n    };\r\n\r\n    useEffect(() => {\r\n        // Update the document title using the browser API\r\n        setPage(0)\r\n        setDataSlice(calculateSlice(0, rowsPP, props.data));\r\n    }, [props.data]);\r\n\r\n\r\n    const pagination = props.data.length > 0 && (\r\n        <Grid container justify = \"center\">\r\n        <TablePagination\r\n            justify=\"center\"\r\n            component=\"div\"\r\n            count={props.data.length}\r\n            page={page}\r\n            onChangePage={handleChangePage}\r\n            rowsPerPage={rowsPerPage}\r\n            onChangeRowsPerPage={handleChangeRowsPerPage}\r\n            labelRowsPerPage = '    !'\r\n        /></Grid>)\r\n\r\n\r\n    // console.log('PAGINATION')\r\n    // console.log(dataSlice)\r\n\r\n    const isAllowedToRenderTask = dataSlice[0] !== undefined\r\n    return (\r\n        <div>\r\n            {pagination}\r\n            <Grid\r\n                container\r\n                spacing={0}\r\n                direction=\"column\"\r\n                alignItems=\"center\"\r\n                justify=\"center\"\r\n                style={{minHeight: '100vh'}}>\r\n\r\n                <Grid item xs={12}>\r\n                    <Grid container justify=\"center\" direction='column' spacing={1}>\r\n                       \r\n                            {isAllowedToRenderTask\r\n                                ? <Grid item>\r\n                                    <ModeratedTask \r\n                                        task={dataSlice[0]}\r\n                                        users={props.users}                                      \r\n                                    ></ModeratedTask>\r\n                                </Grid>\r\n                                : '   !'\r\n                            }\r\n\r\n\r\n                    </Grid>\r\n                </Grid>\r\n\r\n            </Grid>\r\n            {pagination}\r\n        </div>\r\n    )\r\n\r\n}\r\n\r\nexport default PaginatedTasks","import React, { useEffect, useState, useContext } from 'react';\r\nimport firebase from '../../util/Firebase'\r\nimport { AuthContext } from \"../../util/Auth\";\r\n\r\nimport { Button, Grid } from '@material-ui/core';\r\n\r\nimport PaginatedTasks from '../Moderator/PaginatedTasks'\r\n\r\nimport Autocomplete from '@material-ui/lab/Autocomplete';\r\nimport TextField from '@material-ui/core/TextField';\r\nimport SearchIcon from '@material-ui/icons/Search';\r\n\r\nconst TasksObserver = (props) => {\r\n\r\n    const { currentUser } = useContext(AuthContext);\r\n\r\n    const [tasks, setTasks] = React.useState([]);\r\n    const [allCases, setCases] = useState([])\r\n    const [allStages, setStages] = useState({})\r\n    const [users, setUsers] = React.useState([]);\r\n\r\n    const [user, setUser] = React.useState(\"\");\r\n    const [selectedCase, setSelectedCase] = useState(null)\r\n    const [selectedStage, setSelectedStage] = React.useState(null);\r\n    const [taskId, setTaskId] = useState(\"\")\r\n\r\n    const casesPath = firebase.firestore().collection('schema').doc('structure').collection('cases')\r\n\r\n    useEffect(() => {\r\n        casesPath.get().then(docs => {\r\n            const cases = []\r\n            docs.forEach(doc => {\r\n                cases.push(doc.id)\r\n            })\r\n            return cases\r\n        }).then(cases => setCases(cases))\r\n\r\n    }, [currentUser])\r\n\r\n    useEffect(() => {\r\n        setStages(null)\r\n        if (selectedCase) {\r\n            casesPath.doc(selectedCase).collection(\"stages\").get().then(docs => {\r\n                const stages = []\r\n                docs.forEach(doc => {\r\n                    stages.push(doc.id)\r\n                })\r\n                return stages\r\n            }).then(stages => setStages(stages))\r\n        }\r\n    }, [selectedCase])\r\n\r\n\r\n    const setSelectedCaseHandler = (value) => {\r\n        setSelectedStage(null)\r\n        setSelectedCase(value);\r\n    };\r\n\r\n    const setSelectedStageHandler = (value) => {\r\n        setSelectedStage(value);\r\n    };\r\n\r\n    const setUserHandler = (value) => {\r\n        setUser(value);\r\n    }\r\n\r\n    const handleClickApplyFilters = (event) => {\r\n        getTasks()\r\n    }\r\n\r\n\r\n    const getUsers = async () => {\r\n        let usersList = []\r\n        let usersRef = firebase.firestore().collection('users')\r\n        await usersRef.get().then(docs => {\r\n            docs.forEach(doc => {\r\n                usersList.push({ id: doc.id, ...doc.data() })\r\n            })\r\n\r\n            setUsers(usersList)\r\n        })\r\n    }\r\n\r\n    const getTasks = async () => {\r\n        let tasksList = []\r\n        let tasksRef = firebase.firestore().collection('tasks').where(\"is_complete\", \"==\", true)\r\n\r\n        // console.log('USER ID')\r\n        console.log(user)\r\n        console.log(selectedCase)\r\n        console.log(selectedStage)\r\n\r\n        if (user !== \"\") {\r\n            tasksRef = tasksRef.where(\"assigned_users\", \"array-contains\", user)\r\n            console.log(\"USER FIRED\", user)\r\n        }\r\n\r\n        if (selectedCase !== null) {\r\n            tasksRef = tasksRef.where(\"case_type\", \"==\", selectedCase)\r\n            console.log(\"CASE FIRED\", selectedCase)\r\n        }\r\n\r\n        if (selectedStage !== null) {\r\n            tasksRef = tasksRef.where(\"case_stage_id\", \"==\", selectedStage)\r\n            console.log(\"STAGE FIRED\", selectedStage)\r\n\r\n        }\r\n\r\n        if (taskId !== \"\") {\r\n            firebase.firestore().collection('tasks').doc(taskId).get().then(doc => setTasks([{id:doc.id, ...doc.data()}]))\r\n        }\r\n        else {\r\n            await tasksRef.get().then(docs => {\r\n                docs.forEach(doc => {\r\n                    tasksList.push({ id: doc.id, ...doc.data() })\r\n                })\r\n    \r\n                setTasks(tasksList)\r\n            })\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        getUsers()\r\n    }, [])\r\n\r\n\r\n    return (\r\n        <div>\r\n            <Grid container justify=\"center\" style={{ padding: 15 }}>\r\n                <Autocomplete\r\n                    id=\"combo-box-demo\"\r\n                    options={allCases}\r\n                    style={{ width: 350 }}\r\n                    disabled={taskId.length > 0}\r\n                    value={selectedCase}\r\n                    onChange={(event, newValue) => setSelectedCaseHandler(newValue)}\r\n                    renderInput={(params) => <TextField {...params} fullWidth label=\"   case\" variant=\"outlined\" />}\r\n                />\r\n            </Grid>\r\n\r\n            {allStages !== null && allStages.length > 0 && <Grid container justify=\"center\" style={{ padding: 15 }}>\r\n                <Autocomplete\r\n                    id=\"combo-box-demo\"\r\n                    options={allStages}\r\n                    style={{ width: 350 }}\r\n                    disabled={taskId.length > 0}\r\n                    value={selectedStage}\r\n                    onChange={(event, newValue) => setSelectedStageHandler(newValue)}\r\n                    renderInput={(params) => <TextField {...params} fullWidth label=\"   stage\" variant=\"outlined\" />}\r\n                />\r\n            </Grid>}\r\n\r\n            <Grid container justify=\"center\" style={{ padding: 15 }}>\r\n                <Autocomplete\r\n                    id=\"combo-box-demo\"\r\n                    options={users}\r\n                    getOptionLabel={(option) => option.surname + \" \" + option.name + \" (\" + option.username + \")\"}\r\n                    style={{ width: 350 }}\r\n                    disabled={taskId.length > 0}\r\n                    value={user.value}\r\n                    onChange={(event, newValue) => {\r\n                        if (newValue) {\r\n                            setUserHandler(newValue.id)\r\n                        }\r\n                        else {\r\n                            setUserHandler(\"\")\r\n                        }\r\n                    }}\r\n                    renderInput={(params) => <TextField {...params} fullWidth label=\"   users\" variant=\"outlined\" />}\r\n                />\r\n            </Grid>\r\n\r\n            <Grid container justify=\"center\" style={{ padding: 15 }}>\r\n                <TextField\r\n                    style={{ width: 350 }}\r\n                    value={taskId}\r\n                    variant=\"outlined\"\r\n                    label=\" id \"\r\n                    onChange={(event, newValue) => setTaskId(event.target.value)}\r\n                />\r\n            </Grid>\r\n\r\n            <Grid container justify=\"center\">\r\n                <Button\r\n                    style={{ width: '350px' }}\r\n                    type='number'\r\n                    variant=\"contained\"\r\n                    onClick={handleClickApplyFilters}\r\n                    color='primary'\r\n                    //className={classes.button}\r\n                    startIcon={<SearchIcon />}\r\n                >\r\n                     \r\n                </Button>\r\n            </Grid>\r\n\r\n            <Grid container justify=\"center\">\r\n                <PaginatedTasks data={tasks} users={users}></PaginatedTasks>\r\n            </Grid>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default TasksObserver","import React, { useContext } from 'react'\r\nimport { signInWithGoogle } from '../../util/Firebase'\r\nimport { Button, Grid, Typography } from '@material-ui/core'\r\nimport { AuthContext } from '../../util/Auth';\r\nimport { Redirect } from 'react-router';\r\n\r\n\r\nconst Signin = () => {\r\n    const { currentUser } = useContext(AuthContext);\r\n    if (currentUser) {\r\n        return <Redirect to={'/'} />;\r\n    }\r\n    return (\r\n        <Grid container direction=\"column\" style={{ padding: 20 }} justify=\"center\">\r\n            <Typography align=\"center\" variant=\"h4\"></Typography>\r\n            <Typography variant=\"body1\" align=\"center\">   (  ).</Typography>\r\n            <Typography variant=\"body1\" align=\"center\">     Google,   .</Typography>\r\n            <br />\r\n            <Button size=\"large\" color=\"primary\" variant=\"contained\" onClick={signInWithGoogle}></Button>\r\n        </Grid>\r\n    )\r\n}\r\n\r\nexport default Signin","import React, { useContext } from \"react\";\r\nimport { Route, Redirect } from \"react-router-dom\";\r\nimport { AuthContext } from \"./Auth\";\r\n\r\nconst PrivateRoute = ({ component: RouteComponent, ...rest }) => {\r\n  const {currentUser} = useContext(AuthContext);\r\n  return (\r\n    <Route\r\n      {...rest}\r\n      render={routeProps =>\r\n        !!currentUser ? (\r\n          <RouteComponent {...routeProps} />\r\n        ) : (\r\n          <Redirect to={\"/signin\"} />\r\n        )\r\n      }\r\n    />\r\n  );\r\n};\r\n\r\n\r\nexport default PrivateRoute","import React, { forwardRef, useEffect, useRef, useState } from 'react';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport TextField from '@material-ui/core/TextField';\r\nimport { Typography, Box, Button, Grid } from '@material-ui/core';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    root: {\r\n        border: '2px grey solid',\r\n        padding: '0px 10px',\r\n        margin: 10,\r\n        background: 'yellow',\r\n\t\twidth: 700,\r\n        [theme.breakpoints.down(\"sm\")]: {\r\n            maxWidth: 300\r\n        }\r\n    },\r\n    button: {\r\n        background: 'orange',\r\n        margin: '10px 0'\r\n    }\r\n\r\n}));\r\n\r\n\r\nconst BasicTextFields = forwardRef((props, ref) => {\r\n    const classes = useStyles();\r\n    const [value, setValue] = React.useState('');\r\n\r\n    const { title, sendAnswer, taskId, questionId } = props\r\n\r\n    const handleChange = (event) => {\r\n        setValue(event.target.value)\r\n    };\r\n\r\n    return (\r\n        <div className={classes.root}>\r\n            <Box display=\"flex\" style={{ marginBottom: 10, marginTop: 10 }}>\r\n                <Typography variant=\"h6\" style={{ paddingRight: 8 }}>{title}</Typography>\r\n            </Box>\r\n            <TextField\r\n                label=\" \"\r\n                value={value}\r\n                style={{ background: 'white' }}\r\n                onChange={handleChange}\r\n                multiline\r\n                rows={5}\r\n                variant=\"outlined\"\r\n                fullWidth\r\n            />\r\n            <Grid container justify=\"flex-end\">\r\n                <Button className={classes.button} onClick={() => sendAnswer(taskId, questionId, value)}></Button>\r\n            </Grid>\r\n\r\n        </div>\r\n    );\r\n})\r\n\r\nexport default BasicTextFields","import React, { useEffect, useState, useContext } from 'react';\r\nimport firebase from '../../util/Firebase'\r\n\r\nimport { Button, Grid, makeStyles, Typography } from '@material-ui/core';\r\n\r\nimport NativeSelect from '@material-ui/core/NativeSelect';\r\nimport FormHelperText from '@material-ui/core/FormHelperText';\r\nimport FormControl from '@material-ui/core/FormControl';\r\n\r\nimport SearchIcon from '@material-ui/icons/Search';\r\nimport Card from './Card'\r\n\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    select: {\r\n        margin: '20px 0',\r\n        width: 500,\r\n        [theme.breakpoints.down(\"sm\")]: {\r\n            maxWidth: 300\r\n        }\r\n    },\r\n\r\n}));\r\n\r\nconst FAQ = (props) => {\r\n\r\n    // console.log('TEST FUNCT')\r\n    // console.log(props)\r\n\r\n    //TODO load from SCHEMA\r\n    const classes = useStyles();\r\n    const taskTypes = ['', '  ', 'interview']\r\n\r\n\r\n    const [tasks, setTasks] = React.useState([]);\r\n    const [taskType, setTaskType] = React.useState(taskTypes[0]);\r\n    const [questions, setQuestions] = useState([])\r\n\r\n    const setTaskTypeHandler = (event) => {\r\n        setTaskType(event.target.value);\r\n    };\r\n\r\n    const handleClickApplyFilters = async (event) => {\r\n        let tasklist = await getTasks()\r\n        getQuestions(tasklist)\r\n    }\r\n\r\n    const getTasks = async () => {\r\n        let tasksList = []\r\n        let tasksRef = firebase.firestore().collection('tasks').where('case_type', '==', 'FAQ').where('is_complete', '==', false)\r\n\r\n        if (taskType !== '') {\r\n            tasksRef = tasksRef.where(\"type\", \"==\", taskType)\r\n        }\r\n        console.log('fired')\r\n        await tasksRef.get().then(docs => {\r\n            docs.forEach(doc => {\r\n                tasksList.push({ id: doc.id, ...doc.data() })\r\n            })\r\n            tasksList.sort((a, b) => b.timestamp.toDate() - a.timestamp.toDate())\r\n            setTasks(tasksList)\r\n        })\r\n        return tasksList\r\n    }\r\n\r\n    const getQuestions = async (taskList) => {\r\n        let questionList = await taskList.map(async task => {\r\n            let arr = []\r\n            await firebase.firestore().collection('tasks').doc(task.id).collection('questions').get().then(snap => {\r\n                snap.forEach(doc => {\r\n                    arr.push({ taskId: task.id, questionId: doc.id, timestamp: task.timestamp.toDate(), ...doc.data() })\r\n                })\r\n            })\r\n            return arr\r\n        })\r\n        Promise.all(questionList).then(q => setQuestions([].concat.apply([], q)))\r\n    }\r\n\r\n    const sendAnswer = (taskId, questionId, answer) => {\r\n        firebase.firestore().collection('tasks').doc(taskId).collection('responses').doc(questionId).set({ answer: answer })\r\n        console.log(taskId, answer)\r\n    }\r\n\r\n\r\n    return (\r\n        <Grid container justify=\"center\">\r\n            <Grid container justify=\"center\">\r\n                <FormControl className={classes.select}>\r\n                    <NativeSelect\r\n                        value={taskType}\r\n                        onChange={setTaskTypeHandler}\r\n                        name=\"filterTaskType\"\r\n                    >\r\n                        {\r\n                            taskTypes.map((taskType, i) => (\r\n                                <option key={taskType} value={taskType}>{taskType}</option>\r\n                            ))\r\n                        }\r\n                    </NativeSelect>\r\n                    <FormHelperText>    </FormHelperText>\r\n                </FormControl>\r\n            </Grid>\r\n\r\n            <Grid container justify=\"center\" className={classes.select}>\r\n                <Button\r\n                    style={{ width: '350px' }}\r\n                    type='number'\r\n                    variant=\"contained\"\r\n                    onClick={handleClickApplyFilters}\r\n                    color='primary'\r\n                    //className={classes.button}\r\n                    startIcon={<SearchIcon />}\r\n                >\r\n                     \r\n                </Button>\r\n            </Grid>\r\n\r\n            <Grid container justify=\"center\">\r\n                {questions\r\n                    ? questions.map((task, i) => <Card key={'task_' + i} taskId={task.taskId} questionId={task.questionId} title={task.title} sendAnswer={sendAnswer} />)\r\n                    : <Typography style={{ padding: 30 }}>  </Typography>}\r\n            </Grid>\r\n        </Grid>\r\n    );\r\n}\r\n\r\nexport default FAQ","import React, { useState } from 'react';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport Card from '@material-ui/core/Card';\r\nimport CardActions from '@material-ui/core/CardActions';\r\nimport CardContent from '@material-ui/core/CardContent';\r\nimport Button from '@material-ui/core/Button';\r\nimport Typography from '@material-ui/core/Typography';\r\n\r\nimport { Redirect, useHistory } from 'react-router';\r\nimport { Box, Grid } from '@material-ui/core';\r\nimport firebase from \"../../util/Firebase\";\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { CircularProgress } from \"@material-ui/core\";\r\n\r\nconst useStyles = makeStyles({\r\n\troot: {\r\n\t\tminWidth: 250,\r\n\t\tmaxWidth: 400\r\n\t},\r\n\tbullet: {\r\n\t\tdisplay: 'inline-block',\r\n\t\tmargin: '0 2px',\r\n\t},\r\n\ttitle: {\r\n\t\tfontSize: 14,\r\n\t},\r\n\tpos: {\r\n\t\tmarginBottom: 12,\r\n\t},\r\n});\r\n\r\nconst JSchemaTaskCard = (props) => {\r\n\tconst classes = useStyles();\r\n\tconst history = useHistory();\r\n\tconst { complete, id, cardColor, cardType, stage, stageID, task, user, pCase } = props\r\n\r\n\tconst [waiting, setWaiting] = useState(false)\r\n\tconst [newTaskId, setNewTaskId] = useState(null)\r\n\r\n\tconst handleOpen = () => {\r\n\t\tif (cardType === \"creatable\" || cardType === \"selectable\" || cardType === \"creatableUnlim\") {\r\n\t\t\tsendCallbackRequest()\r\n\t\t} else {\r\n\t\t\thistory.push(\"/t/\" + id)\r\n\t\t\t//setRedirect(true)\r\n\t\t}\r\n\t}\r\n\r\n\tconst handleOpenOld = () => {\r\n\t\tif (cardType === \"creatable\" || cardType === \"selectable\" || cardType === \"creatableUnlim\") {\r\n\t\t\tsendCallbackRequestOld()\r\n\t\t} else {\r\n\t\t\thistory.push(\"/tasks/\" + id)\r\n\t\t\t//setRedirect(true)\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tconst sendCallbackRequest = () => {\r\n\t\tsetWaiting(true)\r\n\t\tlet callback = \"\"\r\n\t\tlet callbackType = \"\"\r\n\t\tlet callbackName = \"\"\r\n\t\tif (cardType === \"creatable\" || cardType === \"creatableUnlim\") {\r\n\t\t\tcallback = uuidv4()\r\n\t\t\tcallbackType = \"callbackId\"\r\n\t\t\tcallbackName = \"callbackId\"\r\n\t\t} else if (cardType === \"selectable\") {\r\n\t\t\tcallback = id\r\n\t\t\tcallbackName = \"taskId\"\r\n\t\t\tcallbackType = firebase.firestore.FieldPath.documentId()\r\n\t\t}\r\n\t\tfirebase.firestore()\r\n\t\t\t.collection(\"task_requests\")\r\n\t\t\t.doc(user.uid)\r\n\t\t\t.collection(\"requests\")\r\n\t\t\t.add({\r\n\t\t\t\tstatus: \"pending\",\r\n\t\t\t\tuser: user.uid,\r\n\t\t\t\tcase_type: pCase,\r\n\t\t\t\tcase_stage_id: stageID,\r\n\t\t\t\t[callbackName]: callback\r\n\t\t\t}).then((doc) => {\r\n\t\t\t\tconst unsubscribe = firebase.firestore()\r\n\t\t\t\t\t.collection(\"tasks\")\r\n\t\t\t\t\t.where(\"assigned_users\", \"array-contains\", user.uid)\r\n\t\t\t\t\t.where(callbackType, \"==\", callback)\r\n\t\t\t\t\t.onSnapshot(snapshot => {\r\n\t\t\t\t\t\tsnapshot.docChanges().forEach(change => {\r\n\t\t\t\t\t\t\tif (change.type === \"added\") {\r\n\t\t\t\t\t\t\t\tif (change.doc.id) {\r\n\t\t\t\t\t\t\t\t\t//setNewTaskId(change.doc.id)\r\n\t\t\t\t\t\t\t\t\t//setRedirect(true)\r\n\t\t\t\t\t\t\t\t\tunsubscribe()\r\n\t\t\t\t\t\t\t\t\thistory.push(\"/t/\" + change.doc.id)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\r\n\t\t\t})\r\n\t}\r\n\r\n\tconst sendCallbackRequestOld = () => {\r\n\t\tsetWaiting(true)\r\n\t\tlet callback = \"\"\r\n\t\tlet callbackType = \"\"\r\n\t\tlet callbackName = \"\"\r\n\t\tif (cardType === \"creatable\" || cardType === \"creatableUnlim\") {\r\n\t\t\tcallback = uuidv4()\r\n\t\t\tcallbackType = \"callbackId\"\r\n\t\t\tcallbackName = \"callbackId\"\r\n\t\t} else if (cardType === \"selectable\") {\r\n\t\t\tcallback = id\r\n\t\t\tcallbackName = \"taskId\"\r\n\t\t\tcallbackType = firebase.firestore.FieldPath.documentId()\r\n\t\t}\r\n\t\tfirebase.firestore()\r\n\t\t\t.collection(\"task_requests\")\r\n\t\t\t.doc(user.uid)\r\n\t\t\t.collection(\"requests\")\r\n\t\t\t.add({\r\n\t\t\t\tstatus: \"pending\",\r\n\t\t\t\tuser: user.uid,\r\n\t\t\t\tcase_type: pCase,\r\n\t\t\t\tcase_stage_id: stageID,\r\n\t\t\t\t[callbackName]: callback\r\n\t\t\t}).then((doc) => {\r\n\t\t\t\tconst unsubscribe = firebase.firestore()\r\n\t\t\t\t\t.collection(\"tasks\")\r\n\t\t\t\t\t.where(\"assigned_users\", \"array-contains\", user.uid)\r\n\t\t\t\t\t.where(callbackType, \"==\", callback)\r\n\t\t\t\t\t.onSnapshot(snapshot => {\r\n\t\t\t\t\t\tsnapshot.docChanges().forEach(change => {\r\n\t\t\t\t\t\t\tif (change.type === \"added\") {\r\n\t\t\t\t\t\t\t\tif (change.doc.id) {\r\n\t\t\t\t\t\t\t\t\t//setNewTaskId(change.doc.id)\r\n\t\t\t\t\t\t\t\t\t//setRedirect(true)\r\n\t\t\t\t\t\t\t\t\tunsubscribe()\r\n\t\t\t\t\t\t\t\t\thistory.push(\"/tasks/\" + change.doc.id)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\r\n\t\t\t})\r\n\t}\r\n\r\n\tconst displayJSON = (cardData) => {\r\n\t\treturn Object.keys(cardData).map((stgId, i) => {\r\n\t\t\t// console.log(\"STAGE: \", stage)\r\n\t\t\tif (stgId === 'message') {\r\n\t\t\t\treturn <Typography key={stgId + i}>{cardData[stgId]}</Typography>\r\n\t\t\t}\r\n\t\t\treturn Object.keys(cardData[stgId]).map(response => {\r\n\t\t\t\t// console.log(\"RESPONSE: \", response)\r\n\t\t\t\tif (stage && stage.cardData && stage.cardData[stgId] && stage.cardData[stgId].includes(response)) {\r\n\t\t\t\t\tif (response === \"attachedFiles\") {\r\n\t\t\t\t\t\t// console.log(\"FILES: \")\r\n\t\t\t\t\t\treturn <div key={stgId + response}>Files</div>\r\n\t\t\t\t\t} else return (\r\n\t\t\t\t\t\t<typography variant=\"body2\" component=\"p\" key={stgId + response}>\r\n\t\t\t\t\t\t\t{/* {console.log(\"TEXT: \", cardData[stgId][response])} */}\r\n\t\t\t\t\t\t\t{JSON.stringify(cardData[stgId][response], null, 2)}\r\n\t\t\t\t\t\t</typography>)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Box>\r\n\t\t\t<Card key={id} className={classes.root} style={{ background: cardColor }}>\r\n\t\t\t\t<CardContent>\r\n\t\t\t\t\t<Box display=\"flex\" justifyContent=\"space-between\" alignItems=\"center\">\r\n\t\t\t\t\t\t<Typography variant=\"h6\">\r\n\t\t\t\t\t\t\t{stage.title}\r\n\t\t\t\t\t\t</Typography>\r\n\t\t\t\t\t\t{complete && <Typography color=\"error\">\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t</Typography>}\r\n\t\t\t\t\t</Box>\r\n\t\t\t\t\t<Typography variant=\"subtitle1\" className={classes.pos} color=\"textSecondary\">\r\n\t\t\t\t\t\t#{id}\r\n\t\t\t\t\t</Typography>\r\n\t\t\t\t\t<Typography variant=\"body2\" component=\"p\">\r\n\t\t\t\t\t\t{(task && task.cardData && (cardType === \"selectable\" || (stage && stage.showCard))) ?\r\n\t\t\t\t\t\t\tdisplayJSON(task.cardData)\r\n\t\t\t\t\t\t\t//JSON.stringify(task.cardData, null, 2)\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t\": \" + stage.description}\r\n\t\t\t\t\t</Typography>\r\n\t\t\t\t</CardContent>\r\n\t\t\t\t<CardActions>\r\n\t\t\t\t\t{waiting ?\r\n\t\t\t\t\t\t<CircularProgress />\r\n\t\t\t\t\t\t:\r\n\t\t\t\t\t\t<Grid>\r\n\t\t\t\t\t\t\t<Button size=\"small\" onClick={handleOpen}>{(cardType === \"creatableUnlim\") ? \"  \" : \"\"}</Button>\r\n\t\t\t\t\t\t\t{stage.showOldButton && <Button size=\"small\" onClick={handleOpenOld}> (Old)</Button>}\r\n\t\t\t\t\t\t</Grid>\r\n\t\t\t\t\t}\r\n\t\t\t\t</CardActions>\r\n\t\t\t</Card>\r\n\t\t</Box>\r\n\t);\r\n}\r\n\r\nexport default JSchemaTaskCard","const complexStateFirebaseUpdate = (snapshot, setFunction, subState) => {\r\n    snapshot.docChanges().forEach(change => {\r\n        if (change.type === \"added\" || change.type === \"modified\") {\r\n            setFunction(prevState => {\r\n                const newState = Object.assign({}, prevState)\r\n                if (!newState[subState]) {\r\n                    newState[subState] = {}\r\n                }\r\n                newState[subState][change.doc.id] = change.doc.data()\r\n                // console.log(\"User stages: \", newState)\r\n                return newState\r\n            })\r\n        }\r\n        if (change.type === \"removed\") {\r\n            setFunction(prevState => {\r\n                const newState = Object.assign({}, prevState)\r\n                delete newState[subState][change.doc.id]\r\n                return newState\r\n            })\r\n        }\r\n    })\r\n}\r\n\r\nconst simpleStateFirebaseUpdate = (snapshot, setFunction) => {\r\n    snapshot.docChanges().forEach(change => {\r\n        if (change.type === \"added\" || change.type === \"modified\") {\r\n            setFunction(prevState => (\r\n                {...prevState, [change.doc.id]: change.doc.data()}\r\n            ))\r\n        }\r\n        if (change.type === \"removed\") {\r\n            setFunction(prevState => {\r\n                const newState = Object.assign({}, prevState)\r\n                delete newState[change.doc.id]\r\n                return newState\r\n            })\r\n        }\r\n    })\r\n}\r\n\r\n\r\n\r\nexport {complexStateFirebaseUpdate, simpleStateFirebaseUpdate}","import React, { useState, useEffect, useContext, useRef } from 'react'\r\nimport firebase, { signInWithGoogle } from '../../util/Firebase'\r\nimport { AuthContext } from \"../../util/Auth\";\r\nimport { Redirect, useParams } from 'react-router';\r\nimport Box from \"@material-ui/core/Box\";\r\nimport { Grid, Typography, Button } from \"@material-ui/core\";\r\nimport PropTypes from \"prop-types\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Tabs from \"@material-ui/core/Tabs\";\r\nimport Tab from \"@material-ui/core/Tab\";\r\nimport TaskCard from \"../Tasks/JSchemaCard\";\r\nimport { cloneDeep } from \"lodash\"\r\nimport CustomFileUpload from \"../form/CustomFileUpload\";\r\nimport JSchemaForm from \"@rjsf/bootstrap-4\";\r\nimport Case from '../Cases/Case'\r\n\r\nimport { complexStateFirebaseUpdate, simpleStateFirebaseUpdate } from \"../../util/Utilities\";\r\nimport Home from '../Home/Home';\r\n\r\nfunction TabPanel(props) {\r\n    const { children, value, index, ...other } = props;\r\n\r\n    return (\r\n        <div\r\n            role=\"tabpanel\"\r\n            hidden={value !== index}\r\n            id={`full-width-tabpanel-${index}`}\r\n            aria-labelledby={`full-width-tab-${index}`}\r\n            {...other}\r\n        >\r\n            {value === index && (\r\n                <Box p={3}>\r\n                    <Typography>{children}</Typography>\r\n                </Box>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nTabPanel.propTypes = {\r\n    children: PropTypes.node,\r\n    index: PropTypes.any.isRequired,\r\n    value: PropTypes.any.isRequired,\r\n};\r\n\r\nfunction a11yProps(index) {\r\n    return {\r\n        id: `full-width-tab-${index}`,\r\n        'aria-controls': `full-width-tabpanel-${index}`,\r\n    };\r\n}\r\n\r\n\r\nconst useStyles = makeStyles({\r\n    root: {\r\n        paddingTop: 30,\r\n        flexGrow: 1\r\n    },\r\n});\r\n\r\nconst Page = () => {\r\n    const { currentUser } = useContext(AuthContext);\r\n    const { id } = useParams();\r\n\r\n    const classes = useStyles()\r\n\r\n    const [pageData, setPageData] = useState({})\r\n    const [userRanks, setUserRanks] = useState([])\r\n    const [userCases, setUserCases] = useState({})\r\n    const [allCases, setAllCases] = useState({})\r\n    const [userTasks, setUserTasks] = useState({})\r\n    const [filteredStages, setFilteredStages] = useState({})\r\n    const [caseData, setCaseData] = useState({})\r\n    const [caseSelector, setCaseSelector] = useState({})\r\n    const [caseSelectorResponse, setCaseSelectorResponse] = useState({})\r\n    //const [unlimStages, setUnlimStages] = useState({})\r\n    const [tabValue, setTabValue] = useState(0)\r\n    const [availableStages, setAvailableStages] = useState({})\r\n    const [bgStages, setBgStages] = useState({})\r\n    const [filterFormData, setFilterFormData] = useState({})\r\n    const [availableTasks, setAvailableTasks] = useState({})\r\n    const [userRanksDescriptions, setUserRanksDescriptions] = useState({})\r\n    const [filterSettings, setFilterSettings] = useState(() => { })\r\n    const [availableRanks, setAvailableRanks] = useState([])\r\n\r\n\r\n    useEffect(() => {\r\n        // console.log(\"Page id: \", id)\r\n        // console.log(\"Current user: \", currentUser)\r\n        let unsubscribe = () => { }\r\n        if (currentUser) {\r\n            unsubscribe = firebase\r\n                .firestore()\r\n                .collection('pages')\r\n                .doc(id)\r\n                .onSnapshot(doc => {\r\n                    setPageData(doc.data())\r\n                    // console.log(\"Page data: \", doc.data())\r\n                })\r\n        }\r\n        return unsubscribe\r\n    }, [currentUser, id])\r\n\r\n    useEffect(() => {\r\n        // console.log(\"Page id: \", id)\r\n        // console.log(\"Current user: \", currentUser)\r\n        let unsubscribe = () => { }\r\n        if (currentUser && pageData && pageData.ranks) {\r\n            unsubscribe = firebase\r\n                .firestore()\r\n                .collection('users')\r\n                .doc(currentUser.uid)\r\n                .collection(\"user_private\")\r\n                .doc(\"private\")\r\n                .onSnapshot(doc => {\r\n                    setUserRanks(intersection(doc.data().ranks, pageData.ranks))\r\n                    // console.log(\"User ranks: \", doc.data().ranks)\r\n                })\r\n        }\r\n        return unsubscribe\r\n    }, [currentUser, id, pageData])\r\n\r\n\r\n    useEffect(() => {\r\n        if (pageData && Object.entries(pageData).length > 0 && userRanks.length > 0) {\r\n            setUserCases({})\r\n            setUserTasks({})\r\n            setAllCases({})\r\n            setAvailableStages({})\r\n            setAvailableTasks({})\r\n            setBgStages({})\r\n            const casesPath = firebase.firestore()\r\n                .collection(\"schema\")\r\n                .doc(\"structure\")\r\n                .collection(\"cases\")\r\n\r\n            pageData.cases.map(pCase => {\r\n                // console.log(\"PCASE\", pCase)\r\n                casesPath.doc(pCase).get().then(doc => {\r\n                    setCaseData(prevState => {\r\n                        const newState = Object.assign({}, prevState)\r\n                        newState[doc.id] = doc.data()\r\n                        return newState\r\n                    })\r\n                })\r\n                casesPath.doc(pCase)\r\n                    .collection(\"stages\")\r\n                    .where(\"ranks_write\", \"array-contains-any\", userRanks)\r\n                    .onSnapshot(snapshot => {\r\n                        complexStateFirebaseUpdate(snapshot, setUserCases, pCase)\r\n                    })\r\n\r\n                casesPath.doc(pCase)\r\n                    .collection(\"stages\")\r\n                    .onSnapshot(snapshot => {\r\n                        complexStateFirebaseUpdate(snapshot, setAllCases, pCase)\r\n                    })\r\n            })\r\n            // console.log(\"ALLCASES\", allCases)\r\n            firebase.firestore()\r\n                .collection(\"tasks\")\r\n                .where(\"assigned_users\", \"array-contains\", currentUser.uid)\r\n                // .where(\"case_type\", \"in\", pageData.cases)\r\n                .onSnapshot(snapshot => {\r\n                    // simpleStateFirebaseUpdate(snapshot, setUserTasks)\r\n                    snapshot.docChanges().forEach(change => {\r\n                        if (pageData.cases.includes(change.doc.data().case_type)) {\r\n                            if (change.type === \"added\" || change.type === \"modified\") {\r\n                                setUserTasks(prevState => (\r\n                                    { ...prevState, [change.doc.id]: change.doc.data() }\r\n                                ))\r\n                            }\r\n                            if (change.type === \"removed\") {\r\n                                setUserTasks(prevState => {\r\n                                    const newState = Object.assign({}, prevState)\r\n                                    delete newState[change.doc.id]\r\n                                    return newState\r\n                                })\r\n                            }\r\n                        }\r\n                    })\r\n                })\r\n\r\n            if (pageData.caseWithSelectableTasks) {\r\n                casesPath.doc(pageData.caseWithSelectableTasks)\r\n                    .collection(\"stages\")\r\n                    // .where(\"ranks_read\", \"array-contains-any\", userRanks)\r\n                    .onSnapshot(snapshot => {\r\n                        let allAvaiableStages = {}\r\n                        snapshot.forEach(doc => {\r\n                            if (doc.data().ranks_read) {\r\n                                let available = doc.data().ranks_read.some(rank => userRanks.includes(rank))\r\n                                if (available) {\r\n                                    allAvaiableStages[doc.id] = doc.data()\r\n                                }\r\n                            }\r\n                        })\r\n                        setAvailableStages(allAvaiableStages)\r\n                        // simpleStateFirebaseUpdate(snapshot, setAvailableStages)\r\n                    })\r\n\r\n                casesPath.doc(pageData.caseWithSelectableTasks)\r\n                    .collection(\"stages\")\r\n                    .onSnapshot(snapshot => {\r\n                        simpleStateFirebaseUpdate(snapshot, setBgStages)\r\n                    })\r\n\r\n                firebase.firestore()\r\n                    .collection(\"tasks\")\r\n                    .where(\"case_type\", \"==\", pageData.caseWithSelectableTasks)\r\n                    .where(\"assigned_users\", \"==\", [])\r\n                    .where(\"available\", \"==\", true)\r\n                    .where(\"is_complete\", \"==\", false)\r\n                    .where(\"ranks_read\", \"array-contains-any\", userRanks)\r\n                    .orderBy('created_date', 'desc')\r\n                    .limit(25)\r\n                    .onSnapshot(snapshot => {\r\n                        simpleStateFirebaseUpdate(snapshot, setAvailableTasks)\r\n                    })\r\n            }\r\n        }\r\n    }, [currentUser, pageData, userRanks, id])\r\n\r\n\r\n    useEffect(() => {\r\n        let fs = () => { }\r\n        if (pageData && Object.entries(pageData).length > 0 && userRanks.length > 0 && pageData.caseWithSelectableTasks) {\r\n            // console.log(\"filtersData\", filterFormData)\r\n            if (Object.keys(filterFormData).length !== 0) {\r\n                const stages = availableStages\r\n                const stageID = Object.keys(stages)[0]\r\n                const stage = stages[stageID]\r\n                const filters = stage.filters\r\n                filters.emergency_form_filling['violationType'] = { violationType: '==' }\r\n                filters.emergency_form_filling['violationTime'] = '=='\r\n                // console.log(\"filters\", filters)\r\n                // console.log(\"filtersData\", filterFormData)\r\n                setAvailableTasks({})\r\n                let collection = firebase.firestore()\r\n                    .collection(\"tasks\")\r\n                let query = collection.where(\"case_type\", \"==\", pageData.caseWithSelectableTasks)\r\n                    .where(\"assigned_users\", \"==\", [])\r\n                    .where(\"available\", \"==\", true)\r\n                    .where(\"is_complete\", \"==\", false)\r\n                    .where(\"ranks_read\", \"array-contains-any\", userRanks)\r\n\r\n                Object.keys(filters).forEach(stageFilter => {\r\n                    Object.keys(filters[stageFilter]).forEach(filterQuestion => {\r\n                        // console.log(stageFilter, filterQuestion)\r\n                        if (filterFormData[filterQuestion] && filterFormData[filterQuestion][filterQuestion]) {\r\n                            // console.log('filters3', filterFormData[filterQuestion][filterQuestion], filters[stageFilter][filterQuestion][filterQuestion])\r\n                            query = query.where(`cardData.${stageFilter}.${filterQuestion}.${filterQuestion}`, filters[stageFilter][filterQuestion][filterQuestion], filterFormData[filterQuestion][filterQuestion])\r\n                        }\r\n                        else if (filterFormData[filterQuestion] && Object.keys(filterFormData[filterQuestion]).length > 0 && !filterFormData[filterQuestion][filterQuestion]) {\r\n                            // console.log('filters4', filterFormData[filterQuestion], filters[stageFilter][filterQuestion])\r\n                            query = query.where(`cardData.${stageFilter}.${filterQuestion}`, filters[stageFilter][filterQuestion], filterFormData[filterQuestion])\r\n                        }\r\n                    })\r\n                })\r\n                // query = query.where('cardData.emergency_form_filling.violationType.violationType', '==', '    /     ')\r\n                // query = query.where('cardData.emergency_form_filling.region.region', '==', '. ')\r\n                // query = query.where('cardData.emergency_form_filling.violationTime', '==', '12:00-13:00')\r\n\r\n                query = query.orderBy('created_date', 'desc').limit(25).onSnapshot(snapshot => {\r\n                    simpleStateFirebaseUpdate(snapshot, setAvailableTasks)\r\n                })\r\n                fs = query\r\n            } else {\r\n                setAvailableTasks({})\r\n                fs = firebase.firestore()\r\n                    .collection(\"tasks\")\r\n                    .where(\"case_type\", \"==\", pageData.caseWithSelectableTasks)\r\n                    .where(\"assigned_users\", \"==\", [])\r\n                    .where(\"available\", \"==\", true)\r\n                    .where(\"is_complete\", \"==\", false)\r\n                    .where(\"ranks_read\", \"array-contains-any\", userRanks)\r\n                    .orderBy('created_date', 'desc')\r\n                    .limit(25)\r\n                    .onSnapshot(snapshot => {\r\n                        simpleStateFirebaseUpdate(snapshot, setAvailableTasks)\r\n                    })\r\n            }\r\n        }\r\n        return (fs)\r\n    }, [currentUser, pageData, userRanks, id, filterFormData])\r\n\r\n    useEffect(() => {\r\n        if (Object.keys(userCases).length > 0) {\r\n            const newFilteredStages = cloneDeep(userCases)\r\n            //let newUnlimStages = {}\r\n            Object.keys(userCases).map(caseID => {\r\n                Object.keys(userCases[caseID]).map(stageId => {\r\n                    const stage = userCases[caseID][stageId]\r\n                    if (stage.ranks_write &&\r\n                        Object.keys(stage.ranks_write).length > 0 &&\r\n                        intersection(stage.ranks_write, userRanks).length > 0 &&\r\n                        \"creatable\" in stage &&\r\n                        stage.creatable) {\r\n                        if (stage.rank_limit_number && Object.keys(stage.rank_limit_number).length > 0) {\r\n                            const setIntersection = intersection(Object.keys(stage.rank_limit_number), userRanks)\r\n                            if (setIntersection.length > 0) {\r\n                                const maxTasksPerStage = calculatemaxTasksPerStage(setIntersection, stage.rank_limit_number)\r\n                                const tasksPerStage = countTasksPerStage(stageId, userTasks, caseID, userCases[caseID][stageId])\r\n                                // console.log(\"caseID: \", caseID)\r\n                                // console.log(\"stageId: \", stageId)\r\n                                // console.log(\"maxTasksPerStage: \", maxTasksPerStage)\r\n                                // console.log(\"tasksPerStage: \", tasksPerStage)\r\n                                // if (tasksPerStage >= maxTasksPerStage) {\r\n                                //     console.log(\"newFilteredStages: \", newFilteredStages)\r\n                                //     delete newFilteredStages[caseID][stageId]\r\n                                //     console.log(\"newFilteredStages after delete: \", newFilteredStages)\r\n                                // }\r\n                                if (tasksPerStage >= maxTasksPerStage) {\r\n                                    // console.log(\"newFilteredStages: \", newFilteredStages)\r\n                                    delete newFilteredStages[caseID][stageId]\r\n                                    // console.log(\"newFilteredStages after delete: \", newFilteredStages)\r\n                                }\r\n                                // console.log(\"userCases: \", userCases)\r\n                            }\r\n                        }\r\n                    } else {\r\n                        delete newFilteredStages[caseID][stageId]\r\n                    }\r\n                })\r\n            })\r\n            setFilteredStages(newFilteredStages)\r\n            //setUnlimStages(newUnlimStages)\r\n        }\r\n    }, [currentUser, userCases, userTasks, id])\r\n\r\n\r\n    const countTasksPerStage = (stage, tasks, caseId, stageData) => {\r\n        let occurrences = 0\r\n        Object.values(tasks).map(task => {\r\n            if (task.case_stage_id === stage && caseId === task.case_type) {\r\n                // console.log('countcomplete', stage)\r\n                let countComplete = true\r\n                if (stageData && stageData.countComplete === false) {\r\n                    countComplete = false\r\n                    if (task.is_complete === countComplete) {\r\n                        occurrences++\r\n                    }\r\n                }\r\n                else {\r\n                    occurrences++\r\n                }\r\n                // console.log('countcomplete', countComplete)\r\n            }\r\n        })\r\n        return occurrences\r\n    }\r\n\r\n    const calculatemaxTasksPerStage = (rArray, limits) => {\r\n        let largestLimit = 0\r\n        rArray.map(v => {\r\n            if (limits[v] > largestLimit) {\r\n                largestLimit = limits[v]\r\n            }\r\n        })\r\n        return largestLimit\r\n    }\r\n\r\n    const intersection = (arrA, arrB) => {\r\n        const setA = new Set(arrA)\r\n        const setB = new Set(arrB)\r\n        let _intersection = new Set()\r\n        for (let elem of setB) {\r\n            if (setA.has(elem)) {\r\n                _intersection.add(elem)\r\n            }\r\n        }\r\n        return [..._intersection]\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (userRanks.length > 0) {\r\n            firebase.firestore()\r\n                .collection(\"schema\")\r\n                .doc(\"structure\")\r\n                .collection(\"ranks\")\r\n                .where(firebase.firestore.FieldPath.documentId(), \"in\", userRanks)\r\n                .onSnapshot(snapshot => {\r\n                    snapshot.docChanges().forEach(change => {\r\n                        if (change.type === \"added\" || change.type === \"modified\") {\r\n                            setUserRanksDescriptions(prevState => {\r\n                                return { ...prevState, [change.doc.id]: change.doc.data() }\r\n                            })\r\n                        }\r\n                        if (change.type === \"removed\") {\r\n                            setUserRanksDescriptions(prevState => {\r\n                                const newState = Object.assign({}, prevState)\r\n                                delete newState[change.doc.id]\r\n                                return newState\r\n                            })\r\n                        }\r\n                    })\r\n                })\r\n        }\r\n    }, [userRanks])\r\n\r\n    useEffect(() => {\r\n        if (Object.keys(userCases).length > 0) {\r\n            createCaseSelectorForm()\r\n        }\r\n        else {\r\n            setCaseSelector({})\r\n        }\r\n    }, [userCases])\r\n\r\n    const displayTasks = (tasks, stages, cases, cardType, complete) => {\r\n        const displayedTasks = Object.keys(tasks).map(taskId => {\r\n            const caseType = tasks[taskId].case_type\r\n            const stageId = tasks[taskId].case_stage_id\r\n\r\n            let stage = false\r\n\r\n            if (stages) {\r\n                if (stages[stageId]) {\r\n                    stage = stages[stageId]\r\n                }\r\n            } else if (cases && cases[caseType] && cases[caseType][stageId]) {\r\n                stage = cases[caseType][stageId]\r\n            }\r\n\r\n            if (stage && tasks[taskId].is_complete === complete) {\r\n                // console.log(\"TASKS: \", tasks[taskId])\r\n                // console.log(\"userStages: \", userCases)\r\n                return <Grid key={taskId} style={{ padding: 10 }}>\r\n                    <TaskCard\r\n                        stage={stage}\r\n                        stageID={stageId}\r\n                        cardType={cardType}\r\n                        task={tasks[taskId]}\r\n                        user={currentUser}\r\n                        pCase={caseType}\r\n                        id={taskId} />\r\n                </Grid>\r\n            }\r\n        })\r\n        return displayedTasks\r\n    }\r\n\r\n    const showFilters = (stages, bgStages, formData, handleFormChange) => {\r\n        if (Object.keys(stages).length === 1 &&\r\n            stages[Object.keys(stages)[0]] &&\r\n            stages[Object.keys(stages)[0]].filters &&\r\n            Object.keys(stages[Object.keys(stages)[0]].filters).length > 0 &&\r\n            Object.keys(bgStages).length > 0\r\n        ) {\r\n            const stageID = Object.keys(stages)[0]\r\n            const stage = stages[stageID]\r\n            const filters = stage.filters\r\n            filters.emergency_form_filling['violationType'] = { violationType: '==' }\r\n            filters.emergency_form_filling['violationTime'] = '=='\r\n            const formQuestions = { properties: {} }\r\n            let formUI = {}\r\n            Object.keys(filters).forEach(stageFilter => {\r\n                Object.keys(filters[stageFilter]).forEach(filterQuestion => {\r\n                    let endProps = bgStages[stageFilter].end.properties[filterQuestion]\r\n                    if (endProps) {\r\n                        delete endProps.dependencies\r\n                        formQuestions.properties[filterQuestion] = endProps\r\n                        // console.log(\"bgStages: \", bgStages)\r\n                        formUI[filterQuestion] = { \"ui:widget\": \"select\" }\r\n                    }\r\n                })\r\n            })\r\n            return (\r\n                <JSchemaForm\r\n                    schema={formQuestions}\r\n                    uiSchema={formUI}\r\n                    formData={formData}\r\n                    onChange={e => {\r\n                        handleFormChange(e)\r\n                    }}\r\n                > </JSchemaForm>\r\n            )\r\n        } else return null\r\n    }\r\n\r\n    const handleFilterFormChange = (e) => {\r\n        setFilterFormData(e.formData)\r\n        // console.log(\"FilterFormChange: \", e.formData)\r\n    }\r\n\r\n\r\n    const handleTabChange = (event, newValue) => {\r\n        setTabValue(newValue);\r\n    };\r\n\r\n\r\n    const createCaseSelectorForm = () => {\r\n        let schema = {\r\n            type: \"object\",\r\n            properties: {\r\n                request: {\r\n                    title: \" \",\r\n                    $ref: \"#/definitions/cases\"\r\n                }\r\n            },\r\n            definitions: {\r\n                cases: {\r\n                    type: \"object\",\r\n                    properties: {\r\n                        case: {\r\n                            type: \"string\",\r\n                            enum: [\"none\", ...Object.keys(userCases)],\r\n                            default: \"none\"\r\n                        }\r\n                    },\r\n                    required: ['case'],\r\n                    dependencies: {\r\n                        case: {\r\n                            oneOf: [\r\n                                {\r\n                                    properties: {\r\n                                        case: {\r\n                                            enum: [\r\n                                                \"none\"\r\n                                            ]\r\n                                        }\r\n                                    }\r\n                                }\r\n                            ]\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        Object.keys(userCases).forEach((k, i) => {\r\n            let c = userCases[k]\r\n            if (pageData.cases.includes(k)) {\r\n                schema.definitions.cases.dependencies.case.oneOf.push(\r\n                    {\r\n                        properties: {\r\n                            case: {\r\n                                enum: [\r\n                                    k\r\n                                ]\r\n                            },\r\n                            task: {\r\n                                type: \"string\",\r\n                                enum: ['none', ...Object.keys(c)],\r\n                                default: 'none'\r\n                            }\r\n                        },\r\n                        required: [\r\n                            'task'\r\n                        ]\r\n                    }\r\n                )\r\n            }\r\n        })\r\n\r\n        // console.log('schema', schema)\r\n        // console.log('schema', JSON.stringify(schema))\r\n        setCaseSelector(schema)\r\n    }\r\n\r\n    const handleFormChange = e => {\r\n        setCaseSelectorResponse(e.formData)\r\n    };\r\n\r\n    const requestTask = () => {\r\n\r\n        if (caseSelectorResponse.request.case !== 'none' && caseSelectorResponse.request.task !== 'none') {\r\n            firebase.firestore().collection(\"task_requests\").doc(currentUser.uid).collection(\"requests\").add({\r\n                status: \"pending\",\r\n                user: currentUser.uid,\r\n                case_type: caseSelectorResponse.request.case,\r\n                case_stage_id: caseSelectorResponse.request.task\r\n            })\r\n        }\r\n        else {\r\n            alert(' case  task!')\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        const checkRank = async () => {\r\n            let assignableRanks = []\r\n            await firebase.firestore().collection('schema').doc('structure').collection('ranks').get().then(snap => {\r\n                snap.forEach(doc => {\r\n                    if (pageData.ranks.includes(doc.id) && doc.data().assign_without_moderator) {\r\n                        // console.log(\"RANK_ID\", doc.id)\r\n                        assignableRanks.push(doc.id)\r\n                    }\r\n                })\r\n            })\r\n            return assignableRanks\r\n        }\r\n\r\n        const notInUserRanks = (ranks) => {\r\n            return ranks.filter(rank => userRanks && !userRanks.includes(rank))\r\n        }\r\n\r\n        if (pageData && pageData.ranks) {\r\n            let assignableRanks = checkRank()\r\n            assignableRanks.then(ranks => setAvailableRanks(notInUserRanks(ranks)))\r\n        }\r\n\r\n    }, [pageData, userRanks])\r\n\r\n    const requestRank = (rank) => {\r\n        // console.log(\" \")\r\n        firebase.firestore().collection('rank_requests').add({\r\n            timestamp: firebase.firestore.FieldValue.serverTimestamp(),\r\n            user_id: currentUser.uid,\r\n            processed: false,\r\n            rank: rank\r\n        })\r\n    }\r\n\r\n\r\n\r\n    return (<Grid container justify=\"center\" alignItems=\"center\" direction=\"column\">\r\n        {/* {console.log(\"pageData: \", pageData)}\r\n        {console.log(\"userRanks: \", userRanks)}\r\n        {console.log(\"userCases: \", userCases)}\r\n        {console.log(\"userTasks: \", userTasks)}\r\n        {console.log(\"filteredStages: \", filteredStages)}\r\n        {console.log(\"availableStages: \", availableStages)}\r\n        {console.log(\"availableTasks: \", availableTasks)}\r\n        {console.log(\"caseData\", caseData)}\r\n        {console.log(\"availableRanks: \", availableRanks)} */}\r\n\r\n        <Home />\r\n\r\n        {availableRanks.length > 0 && <Grid container justify=\"center\" alignItems=\"center\" direction=\"column\" style={{ paddingBottom: 20 }}>\r\n            <Typography variant=\"h5\">{pageData.message}</Typography>\r\n            {availableRanks.map((rank, i) => <Button key={i} variant=\"contained\" color=\"primary\" onClick={() => requestRank(rank)} style={{ margin: 15 }}>  {rank}</Button>)}\r\n        </Grid>}\r\n\r\n        {pageData.showTaskSelector && <Grid style={{ paddingBottom: 30 }}>\r\n            <JSchemaForm\r\n                schema={caseSelector}\r\n                // uiSchema={formUI}\r\n                formData={caseSelectorResponse}\r\n                onChange={e => {\r\n                    handleFormChange(e)\r\n                }}\r\n                onSubmit={requestTask}\r\n            >\r\n                <button type=\"submit\" className='btn btn-info'></button>\r\n            </JSchemaForm>\r\n        </Grid>}\r\n\r\n        {/* <Grid>\r\n            {Object.keys(userCases).map((k, i) => {\r\n                let c = caseData[k]\r\n                console.log(c)\r\n                if (pageData.cases.includes(k) && c) {\r\n                    return (\r\n                        <Case key={i} title={c.title} description={c.description} caseId={k} userRanks={userRanks} />\r\n                    )\r\n                }\r\n            })}\r\n        </Grid> */}\r\n\r\n        {/* <Grid>\r\n\t\t\t\t<Button onClick={requestTask}> </Button>\r\n\t\t\t</Grid> */}\r\n        {Object.keys(userRanksDescriptions).length > 0 ? userRanks.map(rank => {\r\n            if (userRanksDescriptions[rank] && userRanksDescriptions[rank].description) {\r\n                return (\r\n                    <Typography variant=\"h5\" key={rank}>{userRanksDescriptions[rank].description}</Typography>\r\n                )\r\n            }\r\n        })\r\n            : null}\r\n        <div className={classes.root}>\r\n            {/*{Object.keys(unlimStages).map(pCase => (*/}\r\n            {/*    Object.keys(unlimStages[pCase]).map(stage => (*/}\r\n            {/*        <Grid key={pCase + stage} style={{padding: 10}}>*/}\r\n            {/*            <TaskCard complete={false}*/}\r\n            {/*                      stage={unlimStages[pCase][stage]}*/}\r\n            {/*                      stageID={stage}*/}\r\n            {/*                      user={currentUser}*/}\r\n            {/*                      pCase={pCase}*/}\r\n            {/*                      cardType = \"creatableUnlim\"/>*/}\r\n            {/*        </Grid>*/}\r\n            {/*    ))*/}\r\n            {/*))}*/}\r\n            <Grid container>\r\n                <Grid container flex justify=\"center\"><Typography variant=\"h5\">  </Typography></Grid>\r\n                <Grid container>\r\n                    {Object.keys(filteredStages).map(pCase => (\r\n                        Object.keys(filteredStages[pCase]).map(stage => {\r\n                            return filteredStages[pCase][stage].hasOwnProperty('countComplete') && filteredStages[pCase][stage].countComplete === false ? <Grid item key={pCase + stage} style={{ padding: 10 }}>\r\n                                <TaskCard complete={false}\r\n                                    stage={filteredStages[pCase][stage]}\r\n                                    stageID={stage}\r\n                                    user={currentUser}\r\n                                    pCase={pCase}\r\n                                    cardType=\"creatable\" />\r\n                            </Grid> : null\r\n                        })\r\n                    ))}\r\n                </Grid>\r\n            </Grid>\r\n            <Paper position=\"static\" color=\"default\">\r\n\r\n                <Tabs value={tabValue} onChange={handleTabChange} variant=\"fullWidth\" centered\r\n                    aria-label=\"simple tabs example\">\r\n                    <Tab label=\"\" {...a11yProps(0)} />\r\n                    <Tab label=\"\" {...a11yProps(1)} />\r\n                    {(Object.keys(availableTasks).length > 0 && Object.keys(availableStages).length > 0) ?\r\n                        <Tab label=\"\" {...a11yProps(2)} />\r\n                        :\r\n                        null}\r\n\r\n                    {/*<Tab label=\" \" {...a11yProps(3)}/>*/}\r\n                </Tabs>\r\n            </Paper>\r\n        </div>\r\n\r\n        <TabPanel value={tabValue} index={0}>\r\n            {Object.keys(filteredStages).map(pCase => (\r\n                Object.keys(filteredStages[pCase]).map(stage => {\r\n                    return !filteredStages[pCase][stage].hasOwnProperty('countComplete') || filteredStages[pCase][stage].countComplete === true ? <Grid item key={pCase + stage} style={{ padding: 10 }}>\r\n                        <TaskCard complete={false}\r\n                            stage={filteredStages[pCase][stage]}\r\n                            stageID={stage}\r\n                            user={currentUser}\r\n                            pCase={pCase}\r\n                            cardType=\"creatable\" />\r\n                    </Grid> : null\r\n                })\r\n            ))}\r\n            {displayTasks(userTasks, false, allCases, \"selected\", false)}\r\n        </TabPanel>\r\n\r\n        <TabPanel value={tabValue} index={1}>\r\n            {displayTasks(userTasks, false, allCases, \"selected\", true)}\r\n        </TabPanel>\r\n\r\n        {(Object.keys(availableTasks).length > 0 && Object.keys(availableStages).length > 0) ?\r\n            <TabPanel value={tabValue} index={2}>\r\n                {/* {console.log(\"availableTasks: \", availableTasks)} */}\r\n                {showFilters(availableStages, bgStages, filterFormData, handleFilterFormChange)}\r\n                {displayTasks(availableTasks, availableStages, false, \"selectable\", false)}\r\n            </TabPanel>\r\n            :\r\n            null}\r\n        {/* <TabPanel value={value} index={2}>\r\n                 \r\n            </TabPanel>*/}\r\n    </Grid>)\r\n}\r\n\r\nexport default Page","import React, { useContext, useEffect, useState } from 'react'\r\nimport firebase from '../../util/Firebase'\r\nimport { AuthContext } from \"../../util/Auth\";\r\nimport JSchemaForm from \"@rjsf/bootstrap-4\";\r\n\r\n\r\nconst CustomUIKField = (props) => {\r\n\r\n    const { formContext } = props\r\n    const [JSchema, setJSchema] = useState({})\r\n    const [ready, setReady] = useState(false)\r\n    const [UIKS, setUIKS] = useState({})\r\n    const { currentUser } = useContext(AuthContext);\r\n\r\n    const uiksRef = firebase.firestore().collection('UIKS1')\r\n\r\n    const taskRef = firebase\r\n        .firestore()\r\n        .collection(\"tasks\")\r\n        .doc(props.taskID)\r\n        .collection(\"responses\")\r\n        .doc(props.name)\r\n\r\n    const uikDataRef = firebase\r\n        .firestore()\r\n        .collection(\"tasks\")\r\n        .doc(props.taskID)\r\n        .collection(\"responses\")\r\n        .doc(\"uikData\")\r\n\r\n    useEffect(() => {\r\n        if (formContext && formContext.conditional && formContext.role) {\r\n            let uikRef = firebase.firestore().collection('UIKS1')\r\n            let unsubscribe = {}\r\n            let locality = formContext.conditional\r\n            console.log(\"DEBUG PROPS\", props)\r\n            if (props.prevResp.conditional && !props.metadata.is_complete) {\r\n                if (props.prevResp.conditional.region !== locality.region\r\n                    || props.prevResp.conditional.subregion !== locality.subregion\r\n                    || props.prevResp.conditional.locality !== locality.locality\r\n                    || props.prevResp.conditional.district !== locality.district) {\r\n                        if (formContext.role === '  /  ') {\r\n                            taskRef.set({ contents: \"\" })\r\n                        }\r\n                        else {\r\n                            taskRef.set({ contents: \"mobile\" })\r\n                        }\r\n                    uikDataRef.set({})\r\n                    uiksRef.where('observers', 'array-contains', currentUser.uid).get().then(async snap => {\r\n                        snap.forEach(async doc => {\r\n                            await doc.ref.update({ observers: firebase.firestore.FieldValue.arrayRemove(currentUser.uid) })\r\n                        })\r\n                    })\r\n                }\r\n            }\r\n            if (formContext.role === '  /  ') {\r\n                setReady(true)\r\n                if (formContext.uik === \"mobile\" && !props.metadata.is_complete) {\r\n                    taskRef.set({ contents: \"\" })\r\n                    uikDataRef.set({})\r\n                    uiksRef.where('observers', 'array-contains', currentUser.uid).get().then(async snap => {\r\n                        snap.forEach(async doc => {\r\n                            await doc.ref.update({ observers: firebase.firestore.FieldValue.arrayRemove(currentUser.uid) })\r\n                        })\r\n                    })\r\n                }\r\n            }\r\n            else {\r\n                if (formContext.uik !== \"mobile\" && !props.metadata.is_complete) {\r\n                    setReady(false)\r\n                    taskRef.set({ contents: \"mobile\" })\r\n                    uikDataRef.set({})\r\n                    uiksRef.where('observers', 'array-contains', currentUser.uid).get().then(async snap => {\r\n                        snap.forEach(async doc => {\r\n                            await doc.ref.update({ observers: firebase.firestore.FieldValue.arrayRemove(currentUser.uid) })\r\n                        })\r\n                    })\r\n                }\r\n            }\r\n\r\n            if (locality.region) {\r\n                uikRef = uikRef.where('region', '==', locality.region)\r\n            }\r\n            if (locality.subregion) {\r\n                uikRef = uikRef.where('subregion', '==', locality.subregion)\r\n            }\r\n            if (locality.locality) {\r\n                uikRef = uikRef.where('locality', '==', locality.locality)\r\n            }\r\n            if (locality.district) {\r\n                uikRef = uikRef.where('district', '==', locality.district)\r\n            }\r\n            unsubscribe = uikRef.onSnapshot(snap => {\r\n                let allUiks = {}\r\n                snap.forEach(doc => {\r\n                    allUiks[doc.id] = doc.data()\r\n                })\r\n                setUIKS(allUiks)\r\n                createUIKSelectorForm(allUiks)\r\n            })\r\n            return () => unsubscribe()\r\n        }\r\n    }, [formContext])\r\n\r\n    const getAvailableUIKS = (allUiks) => {\r\n        let disabled = []\r\n        let available = Object.keys(allUiks)\r\n        let customLabels = []\r\n        Object.keys(allUiks).forEach(uik => {\r\n            if (allUiks[uik].address) {\r\n                customLabels.push(uik + \" \" + allUiks[uik].address)\r\n            }\r\n            else {\r\n                customLabels.push(uik)\r\n            }\r\n            if (allUiks[uik].observers.length >= 2) {\r\n                disabled.push(uik)\r\n            }\r\n        })\r\n        console.log(\"DISABLED\", disabled)\r\n        return ({ available: available, customLabels: customLabels, disabled: disabled })\r\n    }\r\n\r\n    const uikChangeHandler = async (e) => {\r\n        console.log(\"DEBUG FORMDATA\", e.formData)\r\n        if (e.formData === \"\" || e.formData === undefined || e.formData === null) {\r\n            if (!props.metadata.is_complete) {\r\n                taskRef.set({ contents: \"\" })\r\n                uikDataRef.set({})\r\n                await uiksRef.where('observers', 'array-contains', currentUser.uid).get().then(async snap => {\r\n                    snap.forEach(async doc => {\r\n                        await doc.ref.update({ observers: firebase.firestore.FieldValue.arrayRemove(currentUser.uid) })\r\n                    })\r\n                })\r\n            }\r\n        }\r\n        else {\r\n            if (!props.metadata.is_complete) {\r\n                taskRef.set({ contents: e.formData })\r\n                uikDataRef.set({ ...UIKS[e.formData], uikNumber: e.formData })\r\n                await uiksRef.where('observers', 'array-contains', currentUser.uid).get().then(async snap => {\r\n                    snap.forEach(async doc => {\r\n                        await doc.ref.update({ observers: firebase.firestore.FieldValue.arrayRemove(currentUser.uid) })\r\n                    })\r\n                })\r\n                uiksRef.doc(e.formData).update({ observers: firebase.firestore.FieldValue.arrayUnion(currentUser.uid) })\r\n            }\r\n        }\r\n    }\r\n\r\n    const createUIKSelectorForm = (allUiks) => {\r\n        let schema = {\r\n            title: props.schema.title,\r\n            enum: [],\r\n            type: \"string\",\r\n            enumNames: []\r\n        }\r\n\r\n        let uiSchema = {\r\n            \"ui:enumDisabled\": []\r\n        }\r\n\r\n        let uikTypes = getAvailableUIKS(allUiks)\r\n        schema.enum = uikTypes.available\r\n        schema.enumNames = uikTypes.customLabels\r\n        uiSchema['ui:enumDisabled'] = uikTypes.disabled\r\n        console.log('schema', schema)\r\n\r\n        setJSchema({ schema: schema, uiSchema: uiSchema })\r\n    }\r\n\r\n\r\n    return (\r\n        ready && <JSchemaForm\r\n            schema={JSchema.schema ? JSchema.schema : {}}\r\n            uiSchema={JSchema.uiSchema ? JSchema.uiSchema : {}}\r\n            formData={props.formData}\r\n            disabled={props.metadata.is_complete}\r\n            noHtml5Validate\r\n            onChange={e => uikChangeHandler(e)} > </JSchemaForm>\r\n    )\r\n}\r\n\r\nexport default CustomUIKField","import React, { useState, useEffect, useContext } from 'react'\r\nimport firebase, { signInWithGoogle } from '../../util/Firebase'\r\nimport { AuthContext } from \"../../util/Auth\";\r\n\r\n//import Form from \"../form/form\"\r\nimport Dialog from \"../Dialog/Dialog\"\r\nimport DefaultDialog from '@material-ui/core/Dialog';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport DialogActions from '@material-ui/core/DialogActions';\r\nimport { complexStateFirebaseUpdate, simpleStateFirebaseUpdate } from \"../../util/Utilities\"\r\n\r\nimport CustomFileUpload from \"../form/CustomFileUpload\";\r\nimport CustomUIKField from \"../form/CustomUIKField\"\r\nimport { Button, DialogContentText, DialogTitle, Grid, Typography } from '@material-ui/core';\r\n\r\nimport JSchemaForm from \"@rjsf/fluent-ui\";\r\nimport { cloneDeep, isEqual } from 'lodash'\r\nimport ReactMarkdown from 'react-markdown'\r\n\r\nimport { Redirect, useParams, useHistory } from 'react-router';\r\n\r\n// import 'semantic-ui-css/semantic.min.css'\r\nvar breaks = require('remark-breaks')\r\n\r\nconst JSchemaTask = () => {\r\n\tconst [formResponses, setFormResponses] = useState({})\r\n\tconst [taskForm, setTaskForm] = useState({})\r\n\tconst [mergedForm, setMergedForm] = useState({})\r\n\tconst [taskMetadata, setTaskMetadata] = useState({})\r\n\tconst [caseStages, setCaseStages] = useState({})\r\n\tconst [backgroundTasks, setBackgroundTasks] = useState({})\r\n\tconst [backgroundTaskForms, setBackgroundTaskForms] = useState({})\r\n\tconst [mergedBackgroundForms, setMergedBackgroundForms] = useState({})\r\n\tconst [backgroundResponses, setBackgroundResponses] = useState({})\r\n\tconst [currentFocus, setCurrentFocus] = useState(\"\")\r\n\tconst [gRef, setGRef] = useState(null)\r\n\tconst [formStatus, setFormStatus] = useState(\"loading\")\r\n\tconst [focusedField, setFocusedField] = useState(null)\r\n\r\n\tconst [prevFormResponses, setPrevResponses] = useState({})\r\n\tconst [initialResponses, setInitialResponses] = useState({})\r\n\r\n\tconst [dialogState, setDialog] = useState(false)\r\n\tconst [dialogType, setDialogType] = useState(null)\r\n\tconst [feedbackValue, setFeedback] = useState({})\r\n\tconst [enableButton, setEnableButton] = useState(false)\r\n\r\n\tconst { currentUser } = useContext(AuthContext);\r\n\tconst { id } = useParams();\r\n\tconst history = useHistory();\r\n\r\n\tuseEffect(() => {\r\n\t\tif (currentUser && id) {\r\n\r\n\t\t\tconst ref = firebase\r\n\t\t\t\t.firestore()\r\n\t\t\t\t.collection(\"tasks\")\r\n\t\t\t\t.doc(id)\r\n\r\n\t\t\tsetGRef(ref)\r\n\r\n\t\t\tref.onSnapshot(doc => {\r\n\t\t\t\tsetTaskMetadata(doc.data())\r\n\t\t\t\tif (doc.data().is_complete) {\r\n\t\t\t\t\tsetFormStatus(\"sent\")\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!doc.data().assigned_users.includes(currentUser.uid)) {\r\n\t\t\t\t\tsetFormStatus(\"released\")\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log(\"Task Metadata: \", doc.data());\r\n\t\t\t});\r\n\r\n\t\t\tref.collection(\"responses\")\r\n\t\t\t\t.onSnapshot(snapshot => {\r\n\t\t\t\t\tconst changes = {}\r\n\t\t\t\t\tconst deletes = []\r\n\t\t\t\t\tlet modifyResponses = false\r\n\t\t\t\t\tsnapshot.docChanges().forEach(change => {\r\n\t\t\t\t\t\tif (change.type === \"added\" || change.type === \"modified\") {\r\n\t\t\t\t\t\t\tconst contents = change.doc.data().contents\r\n\t\t\t\t\t\t\tchanges[change.doc.id] = contents\r\n\t\t\t\t\t\t\tmodifyResponses = true\r\n\t\t\t\t\t\t\t//}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (change.type === \"removed\") {\r\n\t\t\t\t\t\t\t//if (formResponses.hasOwnProperty(change.doc.id)) {\r\n\t\t\t\t\t\t\tconsole.log(\"Response Removed: \", change.doc.data());\r\n\t\t\t\t\t\t\tdeletes.push(change.doc.id)\r\n\t\t\t\t\t\t\tmodifyResponses = true\r\n\t\t\t\t\t\t\t//}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (modifyResponses) {\r\n\t\t\t\t\t\tsetFormResponses(prevState => {\r\n\t\t\t\t\t\t\tconst newState = cloneDeep(prevState)\r\n\t\t\t\t\t\t\tsetPrevResponses(newState)\r\n\t\t\t\t\t\t\tdeletes.forEach(d => delete newState[d])\r\n\t\t\t\t\t\t\tObject.keys(changes).forEach(key => newState[key] = changes[key])\r\n\t\t\t\t\t\t\treturn newState\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\tref.collection(\"questions\")\r\n\t\t\t\t.onSnapshot(snapshot => {\r\n\t\t\t\t\tsnapshot.docChanges().forEach(change => {\r\n\t\t\t\t\t\tif (change.type === \"added\" || change.type === \"modified\") {\r\n\t\t\t\t\t\t\tsetTaskForm(prevState => {\r\n\t\t\t\t\t\t\t\treturn { ...prevState, [change.doc.id]: change.doc.data() }\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t}\r\n\r\n\t}, [id, currentUser])\r\n\r\n\tuseEffect(() => {\r\n\t\tconst unsubscribe = firebase.firestore().collection('tasks').doc(id).collection('responses').onSnapshot(snap => {\r\n\t\t\tlet initState = {}\r\n\t\t\tsnap.forEach(doc => {\r\n\t\t\t\tinitState[doc.id] = doc.data()\r\n\t\t\t})\r\n\t\t\tsetInitialResponses(initState)\r\n\t\t})\r\n\t\treturn () => unsubscribe()\r\n\t}, [])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (Object.entries(taskMetadata).length > 0 && taskMetadata.case_type) {\r\n\t\t\tfirebase.firestore()\r\n\t\t\t\t.collection(\"schema\")\r\n\t\t\t\t.doc(\"structure\")\r\n\t\t\t\t.collection(\"cases\")\r\n\t\t\t\t.doc(taskMetadata.case_type)\r\n\t\t\t\t.collection(\"stages\")\r\n\t\t\t\t.onSnapshot(snapshot => {\r\n\t\t\t\t\tsnapshot.docChanges().forEach(change => {\r\n\t\t\t\t\t\tif (change.type === \"added\" || change.type === \"modified\") {\r\n\t\t\t\t\t\t\tsetCaseStages(prevState => {\r\n\t\t\t\t\t\t\t\treturn { ...prevState, [change.doc.id]: change.doc.data() }\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (change.type === \"removed\") {\r\n\t\t\t\t\t\t\tsetCaseStages(prevState => {\r\n\t\t\t\t\t\t\t\tconst newState = Object.assign({}, prevState)\r\n\t\t\t\t\t\t\t\tdelete newState[change.doc.id]\r\n\t\t\t\t\t\t\t\treturn newState\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t}\r\n\t}, [taskMetadata])\r\n\r\n\tuseEffect(() => {\r\n\t\tconst mergedBgForms = {}\r\n\t\tObject.keys(backgroundTasks).map(taskId => {\r\n\t\t\tif (taskId !== id) {\r\n\t\t\t\tconst stage = backgroundTasks[taskId].case_stage_id\r\n\t\t\t\tif (!mergedBgForms[stage]) {\r\n\t\t\t\t\tmergedBgForms[stage] = {}\r\n\t\t\t\t}\r\n\t\t\t\tmergedBgForms[stage][taskId] = mergeForm(backgroundTaskForms[taskId],\r\n\t\t\t\t\tcaseStages[stage])\r\n\t\t\t}\r\n\r\n\t\t})\r\n\t\tsetMergedBackgroundForms(mergedBgForms)\r\n\t}, [backgroundTasks, backgroundTaskForms, caseStages])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (Object.keys(mergedForm).length > 0 && formStatus === \"loading\") {\r\n\t\t\tsetFormStatus(\"ready\")\r\n\t\t}\r\n\t\tif (mergedForm && mergedForm.form_questions && mergedForm.form_questions.required && formResponses) {\r\n\t\t\tlet requirementsSatisfied = mergedForm.form_questions.required.every(checker)\r\n\t\t\tsetEnableButton(requirementsSatisfied)\r\n\t\t}\r\n\r\n\t}, [formResponses, mergedForm])\r\n\r\n\tuseEffect(() => {\r\n\t\tsetMergedForm(mergeForm(taskForm, caseStages[taskMetadata.case_stage_id]))\r\n\t}, [taskForm, taskMetadata, caseStages])\r\n\r\n\tuseEffect(() => {\r\n\r\n\t\tif (Object.keys(caseStages).length > 0 && Object.keys(taskMetadata).length > 0 && caseStages[taskMetadata.case_stage_id]) {\r\n\t\t\tconst backgroundTasksList = caseStages[taskMetadata.case_stage_id].backgroundStages\r\n\t\t\tif (backgroundTasksList && backgroundTasksList.length > 0) {\r\n\t\t\t\tfirebase.firestore()\r\n\t\t\t\t\t.collection(\"tasks\")\r\n\t\t\t\t\t.where(\"case_id\", \"==\", taskMetadata.case_id)\r\n\t\t\t\t\t.where(\"case_stage_id\", \"in\", backgroundTasksList)\r\n\t\t\t\t\t.orderBy(\"created_date\")\r\n\t\t\t\t\t.onSnapshot(snapshot => {\r\n\t\t\t\t\t\tsnapshot.docChanges().forEach(change => {\r\n\t\t\t\t\t\t\tif (change.type === \"added\" || change.type === \"modified\") {\r\n\t\t\t\t\t\t\t\tsetBackgroundTasks(prevState => {\r\n\t\t\t\t\t\t\t\t\treturn { ...prevState, [change.doc.id]: change.doc.data() }\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (change.type === \"removed\") {\r\n\t\t\t\t\t\t\t\tsetBackgroundTasks(prevState => {\r\n\t\t\t\t\t\t\t\t\tconst newState = Object.assign({}, prevState)\r\n\t\t\t\t\t\t\t\t\tdelete newState[change.doc.id]\r\n\t\t\t\t\t\t\t\t\treturn newState\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}, [caseStages, taskMetadata])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (Object.entries(backgroundTasks).length > 0) {\r\n\t\t\tObject.keys(backgroundTasks).map(key => {\r\n\t\t\t\tfirebase.firestore()\r\n\t\t\t\t\t.collection(\"tasks\")\r\n\t\t\t\t\t.doc(key)\r\n\t\t\t\t\t.collection(\"questions\")\r\n\t\t\t\t\t.onSnapshot(snapshot => {\r\n\t\t\t\t\t\tcomplexStateFirebaseUpdate(snapshot, setBackgroundTaskForms, key)\r\n\t\t\t\t\t})\r\n\t\t\t\tfirebase.firestore()\r\n\t\t\t\t\t.collection(\"tasks\")\r\n\t\t\t\t\t.doc(key)\r\n\t\t\t\t\t.collection(\"responses\")\r\n\t\t\t\t\t.onSnapshot(snapshot => {\r\n\t\t\t\t\t\tsnapshot.docChanges().forEach(change => {\r\n\t\t\t\t\t\t\tif (change.type === \"added\" || change.type === \"modified\") {\r\n\t\t\t\t\t\t\t\tsetBackgroundResponses(prevState => {\r\n\t\t\t\t\t\t\t\t\tconst newState = Object.assign({}, prevState)\r\n\t\t\t\t\t\t\t\t\tif (!newState[key]) {\r\n\t\t\t\t\t\t\t\t\t\tnewState[key] = {}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tnewState[key][change.doc.id] = change.doc.data().contents\r\n\t\t\t\t\t\t\t\t\treturn newState\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (change.type === \"removed\") {\r\n\t\t\t\t\t\t\t\tsetBackgroundResponses(prevState => {\r\n\t\t\t\t\t\t\t\t\tconst newState = Object.assign({}, prevState)\r\n\t\t\t\t\t\t\t\t\tdelete newState[key][change.doc.id]\r\n\t\t\t\t\t\t\t\t\treturn newState\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\t\t\t})\r\n\t\t}\r\n\t}, [backgroundTasks])\r\n\r\n\tconst handleFormChange = e => {\r\n\t\tObject.keys(e.formData).forEach(k => {\r\n\t\t\tlet changedValues = {}\r\n\t\t\tif (!isEqual(e.formData[k], formResponses[k])) {\r\n\t\t\t\tchangedValues = e.formData[k]\r\n\t\t\t\tsetFocusedField(k)\r\n\t\t\t\tsetFormResponses(prevState => ({ ...prevState, [k]: changedValues }))\r\n\t\t\t\tif (formResponses.hasOwnProperty(k) && typeof changedValues === 'object' && changedValues !== null) {\r\n\t\t\t\t\tObject.keys(changedValues).forEach(key => {\r\n\t\t\t\t\t\tif (!isEqual(e.formData[k][key], formResponses[k][key])) {\r\n\t\t\t\t\t\t\tif (mergedForm.ui_schema.hasOwnProperty(k) && mergedForm.ui_schema[k].hasOwnProperty(key) && mergedForm.ui_schema[k][key].hasOwnProperty(\"ui:field\") && mergedForm.ui_schema[k][key][\"ui:field\"] === \"customFileUpload\") {\r\n\t\t\t\t\t\t\t\t// pass\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (mergedForm.ui_schema.hasOwnProperty(k) && mergedForm.ui_schema[k].hasOwnProperty(key) && mergedForm.ui_schema[k][key].hasOwnProperty(\"sendOnBlur\") && mergedForm.ui_schema[k][key].sendOnBlur) {\r\n\t\t\t\t\t\t\t\t// pass\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tgRef.collection(\"responses\")\r\n\t\t\t\t\t\t\t\t\t.doc(k)\r\n\t\t\t\t\t\t\t\t\t.set({ contents: changedValues }).then(() => console.log(\"changed value object k: \", k, \" response:\", { [key]: changedValues[key] }))\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (mergedForm.ui_schema.hasOwnProperty(k) && mergedForm.ui_schema[k].hasOwnProperty(\"ui:field\") && mergedForm.ui_schema[k][\"ui:field\"] === \"customFileUpload\") {\r\n\t\t\t\t\t\t// pass\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (mergedForm.ui_schema.hasOwnProperty(k) && mergedForm.ui_schema[k].hasOwnProperty(\"sendOnBlur\") && mergedForm.ui_schema[k].sendOnBlur) {\r\n\t\t\t\t\t\t// pass\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tgRef.collection(\"responses\")\r\n\t\t\t\t\t\t\t.doc(k)\r\n\t\t\t\t\t\t\t.set({ contents: changedValues }).then(() => console.log(\"changed value k: \", k, \" response:\", changedValues))\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t};\r\n\r\n\tconst handleBlur = (e, v) => {\r\n\t\tif (gRef) {\r\n\t\t\tconsole.log(\"Responses: \", formResponses)\r\n\t\t\tconsole.log(\"That is what was blured\", e)\r\n\r\n\t\t\tObject.keys(formResponses).forEach(k => {\r\n\t\t\t\tif (typeof formResponses[k] === 'object' && formResponses[k] !== null) {\r\n\t\t\t\t\tObject.keys(formResponses[k]).forEach(key => {\r\n\t\t\t\t\t\tif (mergedForm.ui_schema.hasOwnProperty(k) && mergedForm.ui_schema[k].hasOwnProperty(key) && mergedForm.ui_schema[k][key].hasOwnProperty(\"sendOnBlur\") && mergedForm.ui_schema[k][key].sendOnBlur && k === focusedField) {\r\n\t\t\t\t\t\t\tgRef.collection(\"responses\")\r\n\t\t\t\t\t\t\t\t.doc(k)\r\n\t\t\t\t\t\t\t\t.set({ contents: { [key]: formResponses[k][key] } }, { merge: true }).then(() => console.log(\"changed value object k: \", k, \" response:\", { [key]: formResponses[k][key] }))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (mergedForm.ui_schema.hasOwnProperty(k) && mergedForm.ui_schema[k].hasOwnProperty(\"sendOnBlur\") && mergedForm.ui_schema[k].sendOnBlur && k === focusedField) {\r\n\t\t\t\t\t\tgRef.collection(\"responses\")\r\n\t\t\t\t\t\t\t.doc(k)\r\n\t\t\t\t\t\t\t.set({ contents: formResponses[k] }).then(() => console.log(\"changed value k: \", k, \" response:\", formResponses[k]))\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tconst mergeForm = (taskForm, caseForms) => {\r\n\t\tconst tForm = Object.assign({}, taskForm)\r\n\t\tconst cForms = Object.assign({}, caseForms)\r\n\r\n\t\tcForms.start = cForms.start ? cForms.start : {}\r\n\t\tcForms.end = cForms.end ? cForms.end : {}\r\n\t\tcForms.start_ui_schema = cForms.start_ui_schema ? cForms.start_ui_schema : {}\r\n\t\tcForms.end_ui_schema = cForms.end_ui_schema ? cForms.end_ui_schema : {}\r\n\r\n\t\ttForm.form_questions = tForm.form_questions ? tForm.form_questions : {}\r\n\t\ttForm.ui_schema = tForm.ui_schema ? tForm.ui_schema : {}\r\n\r\n\r\n\t\tconst properties = {\r\n\t\t\t...(cForms.start.properties ? cForms.start.properties : {}),\r\n\t\t\t...(cForms.end.properties ? cForms.end.properties : {}),\r\n\t\t\t...(tForm.form_questions.properties ? tForm.form_questions.properties : {})\r\n\t\t}\r\n\r\n\t\tconst definitions = {\r\n\t\t\t...(cForms.start.definitions ? cForms.start.definitions : {}),\r\n\t\t\t...(cForms.end.definitions ? cForms.end.definitions : {}),\r\n\t\t\t...(tForm.form_questions.definitions ? tForm.form_questions.definitions : {})\r\n\t\t}\r\n\r\n\t\tlet title = \"\"\r\n\t\tif (tForm.form_questions.title) {\r\n\t\t\ttitle = tForm.form_questions.title\r\n\t\t} else if (cForms.end.title) {\r\n\t\t\ttitle = cForms.end.title\r\n\t\t} else if (cForms.start.title) {\r\n\t\t\ttitle = cForms.start.title\r\n\t\t}\r\n\r\n\t\tlet description = \"\"\r\n\t\tif (tForm.form_questions.description) {\r\n\t\t\tdescription = tForm.form_questions.description\r\n\t\t} else if (cForms.end.description) {\r\n\t\t\tdescription = cForms.end.description\r\n\t\t} else if (cForms.start.description) {\r\n\t\t\tdescription = cForms.start.description\r\n\t\t}\r\n\r\n\t\tconst required = [...new Set([\r\n\t\t\t...(cForms.start.required ? cForms.start.required : []),\r\n\t\t\t...(tForm.form_questions.required ? tForm.form_questions.required : []),\r\n\t\t\t...(cForms.end.required ? cForms.end.required : [])\r\n\t\t])]\r\n\r\n\t\tconst uiOrder = [...new Set([\r\n\t\t\t...(cForms.start_ui_schema[\"ui:order\"] ? cForms.start_ui_schema[\"ui:order\"] : []),\r\n\t\t\t...(tForm.ui_schema[\"ui:order\"] ? tForm.ui_schema[\"ui:order\"] : []),\r\n\t\t\t...(cForms.end_ui_schema[\"ui:order\"] ? cForms.end_ui_schema[\"ui:order\"] : [])\r\n\t\t])]\r\n\r\n\t\tlet uiSchema = {\r\n\t\t\t...(cForms.start_ui_schema ? cForms.start_ui_schema : {}),\r\n\t\t\t...(cForms.end_ui_schema ? cForms.end_ui_schema : {}),\r\n\t\t\t...(tForm.ui_schema ? tForm.ui_schema : {})\r\n\t\t}\r\n\r\n\t\tuiSchema = { ...uiSchema, ...{ \"ui:order\": uiOrder } }\r\n\r\n\t\tif (taskMetadata.case_type === 'FAQ' && taskMetadata.case_stage_id === 'answer_the_question') {\r\n\t\t\tuiSchema['answer'] = { ...uiSchema['answer'], sendOnBlur: true }\r\n\t\t}\r\n\r\n\t\tconst form = {\r\n\t\t\tproperties: properties,\r\n\t\t\tdefinitions: definitions,\r\n\t\t\ttitle: title,\r\n\t\t\tdescription: description,\r\n\t\t\trequired: required\r\n\t\t}\r\n\t\treturn { form_questions: form, ui_schema: uiSchema }\r\n\r\n\t}\r\n\r\n\tconst handleDialogClose = () => {\r\n\t\tsetDialog(false);\r\n\t\t//setFeedback({})\r\n\t};\r\n\r\n\tconst handleOk = () => {\r\n\t\tsetDialog(false)\r\n\t\thistory.goBack()\r\n\t};\r\n\r\n\tconst checker = (q) => {\r\n\t\tif (typeof formResponses[q] === 'object' && formResponses[q] !== null && Object.values(formResponses[q]).length > 0) {\r\n\t\t\t// console.log(q, \"object not empty\")\r\n\t\t\treturn true\r\n\t\t}\r\n\t\telse if (typeof formResponses[q] !== 'object' && formResponses[q] !== null && formResponses[q] !== \"\" && formResponses[q] !== {} && formResponses[q] !== undefined) {\r\n\t\t\t// console.log(q, \"primitive not empty\")\r\n\t\t\treturn true\r\n\t\t}\r\n\t\telse if (mergedForm.ui_schema.hasOwnProperty(q) && mergedForm.ui_schema[q].hasOwnProperty(\"ui:field\") && mergedForm.ui_schema[q][\"ui:field\"] === \"customFileUpload\") {\r\n\t\t\tif (initialResponses[q] && initialResponses[q].contents && Object.keys(initialResponses[q].contents).length > 0) {\r\n\t\t\t\t// console.log(q, \"file not empty\", initialResponses[q])\r\n\t\t\t\treturn true\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// console.log(q, \"empty\")\r\n\t\t\treturn false\r\n\t\t}\r\n\t}\r\n\r\n\tconst handleSubmit = () => {\r\n\t\tObject.keys(formResponses).forEach(k => {\r\n\t\t\tif (mergedForm.ui_schema.hasOwnProperty(k) && mergedForm.ui_schema[k].hasOwnProperty(\"ui:field\") && mergedForm.ui_schema[k][\"ui:field\"] === \"customFileUpload\") {\r\n\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tgRef.collection(\"responses\")\r\n\t\t\t\t\t.doc(k)\r\n\t\t\t\t\t.set({ contents: formResponses[k] ? formResponses[k] : \"\" })\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tconst handleDialogOpen = (type) => {\r\n\t\tconsole.log(\"Dialog open\")\r\n\t\tif (type === 'send') {\r\n\t\t\tsetDialogType('send')\r\n\t\t\tsetDialog(true)\r\n\t\t\thandleSubmit()\r\n\t\t}\r\n\t\tif (type === 'release') {\r\n\t\t\tsetDialogType('release')\r\n\t\t\tsetDialog(true)\r\n\t\t}\r\n\t}\r\n\r\n\tconst handleFeedbackSave = (event) => {\r\n\t\tsetFeedback(event.formData)\r\n\t\tconsole.log('event', event.formData)\r\n\t}\r\n\r\n\tconst changeTaskStatus = (status) => {\r\n\t\tlet root = firebase.firestore()\r\n\t\t\t.collection(\"tasks\")\r\n\t\t\t.doc(id)\r\n\t\t\t.collection(\"user_editable\")\r\n\t\t\t.doc(\"user_editable\")\r\n\r\n\t\troot.set({ status: status })\r\n\t\tif (status === 'released') {\r\n\t\t\tif (feedbackValue.reasons) {\r\n\t\t\t\tif (feedbackValue.extra) {\r\n\t\t\t\t\troot.update({ status: status, release_status: feedbackValue.reasons, release_description: feedbackValue.extra })\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\troot.update({ status: status, release_status: feedbackValue.reasons, release_description: \"\" })\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tconst customImageWidget = (props) => {\r\n\t\treturn (\r\n\t\t\t<img src={props.value} alt={props.schema.title}\r\n\t\t\t\tstyle={{\r\n\t\t\t\t\tmaxWidth: \"100%\",\r\n\t\t\t\t\theight: \"auto\"\r\n\t\t\t\t}}></img>\r\n\t\t);\r\n\t};\r\n\r\n\tconst customVideoWidget = (props) => {\r\n\t\treturn (\r\n\t\t\t<video title={props.schema.title}\r\n\t\t\t\tstyle={{\r\n\t\t\t\t\tmaxWidth: \"100%\",\r\n\t\t\t\t\theight: \"auto\"\r\n\t\t\t\t}}\r\n\t\t\t\tcontrols\r\n\t\t\t>\r\n\t\t\t\t<source src={props.value} type=\"video/mp4\"></source>\r\n\t\t\t</video>\r\n\t\t)\r\n\t}\r\n\r\n\tconst customIframeWidget = (props) => {\r\n\t\treturn (\r\n\t\t\t<iframe\r\n\t\t\t\ttitle={props.schema.title}\r\n\t\t\t\tsrc={props.value}\r\n\t\t\t\tframeBorder=\"0\"\r\n\t\t\t\tallow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\r\n\t\t\t\tallowFullScreen></iframe>\r\n\t\t)\r\n\t}\r\n\r\n\tconst widgets = {\r\n\t\tcustomImageWidget: customImageWidget,\r\n\t\tcustomVideoWidget: customVideoWidget,\r\n\t\tcustomIframeWidget: customIframeWidget\r\n\t};\r\n\r\n\treturn (\r\n\t\tcurrentUser ?\r\n\t\t\t<Grid style={{ wordBreak: 'break-word' }}>\r\n\t\t\t\t{dialogType === 'send' && <Dialog\r\n\t\t\t\t\tstate={dialogState}\r\n\t\t\t\t\thandleClose={handleDialogClose}\r\n\t\t\t\t\thandleOk={handleOk}\r\n\t\t\t\t\tshowOk={formStatus === \"sent\"}\r\n\t\t\t\t\t// title={formStatus === \"sent\" ? caseStages[taskMetadata.case_stage_id].releaseTitle ? <ReactMarkdown allowDangerousHtml plugins={[breaks]} children={caseStages[taskMetadata.case_stage_id].releaseTitle} /> : \"  .\" : \" ?\"}\r\n\t\t\t\t\t// content={formStatus === \"sent\" ? caseStages[taskMetadata.case_stage_id].releaseMessage ? <ReactMarkdown allowDangerousHtml plugins={[breaks]} children={caseStages[taskMetadata.case_stage_id].releaseMessage} /> : \"\" : \"   .  ,       .\"}\r\n\t\t\t\t\ttitle={formStatus === \"sent\" ? \"  .\" : \" ?\"}\r\n\t\t\t\t\tcontent={formStatus === \"sent\" ? \"\" : \"   .  ,       .\"}\r\n\t\t\t\t\tdialogFunction={() => { changeTaskStatus('complete') }} />}\r\n\r\n\t\t\t\t{dialogType === 'release' && <DefaultDialog\r\n\t\t\t\t\topen={dialogState}\r\n\t\t\t\t\tonClose={handleDialogClose}\r\n\t\t\t\t>\r\n\t\t\t\t\t{formStatus === \"released\" &&\r\n\t\t\t\t\t\t<DialogTitle id=\"alert-dialog-title\">  .     - .</DialogTitle>\r\n\t\t\t\t\t}\r\n\t\t\t\t\t<DialogContent>\r\n\t\t\t\t\t\t{formStatus === \"released\" ?\r\n\t\t\t\t\t\t\t<DialogContentText></DialogContentText>\r\n\t\t\t\t\t\t\t: <JSchemaForm\r\n\t\t\t\t\t\t\t\tschema={caseStages[taskMetadata.case_stage_id].releaseFeedback_schema}\r\n\t\t\t\t\t\t\t\tuiSchema={caseStages[taskMetadata.case_stage_id].releaseFeedback_ui}\r\n\t\t\t\t\t\t\t\tformData={feedbackValue}\r\n\t\t\t\t\t\t\t\twidgets={widgets}\r\n\t\t\t\t\t\t\t\tonChange={e => {\r\n\t\t\t\t\t\t\t\t\thandleFeedbackSave(e)\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\tonSubmit={() => changeTaskStatus('released')}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<DialogActions>\r\n\t\t\t\t\t\t\t\t\t<Button onClick={handleDialogClose} color=\"primary\">\r\n\t\t\t\t\t\t\t\t\t\t\r\n                      \t\t\t\t</Button>\r\n\t\t\t\t\t\t\t\t\t<Button type=\"submit\" color=\"primary\" autoFocus>\r\n\t\t\t\t\t\t\t\t\t\t\r\n                      \t\t\t\t</Button>\r\n\t\t\t\t\t\t\t\t</DialogActions>\r\n\t\t\t\t\t\t\t</JSchemaForm>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</DialogContent>\r\n\t\t\t\t\t{formStatus === \"released\" && <DialogActions>\r\n\t\t\t\t\t\t<Button onClick={handleOk} color=\"primary\">\r\n\t\t\t\t\t\t\tOk\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t</DialogActions>}\r\n\t\t\t\t</DefaultDialog>}\r\n\r\n\t\t\t\t{(Object.keys(caseStages).length > 0 &&\r\n\t\t\t\t\tObject.keys(taskMetadata).length > 0 &&\r\n\t\t\t\t\tcaseStages[taskMetadata.case_stage_id] &&\r\n\t\t\t\t\tcaseStages[taskMetadata.case_stage_id].backgroundStages &&\r\n\t\t\t\t\tcaseStages[taskMetadata.case_stage_id].backgroundStages.length > 0 &&\r\n\t\t\t\t\tObject.keys(mergedBackgroundForms).length > 0) ?\r\n\t\t\t\t\t<Grid style={{ paddingBottom: 30 }}>\r\n\t\t\t\t\t\t{caseStages[taskMetadata.case_stage_id].backgroundStages.map(stage => {\r\n\t\t\t\t\t\t\treturn <div key={stage}>\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tmergedBackgroundForms[stage] ?\r\n\t\t\t\t\t\t\t\t\t\t(Object.keys(mergedBackgroundForms[stage]).map(taskId => (\r\n\t\t\t\t\t\t\t\t\t\t\t<Grid style={{ paddingBottom: 30 }} key={taskId}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<JSchemaForm\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tschema={mergedBackgroundForms[stage][taskId].form_questions}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tuiSchema={mergedBackgroundForms[stage][taskId].ui_schema}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tformData={backgroundResponses[taskId]}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\twidgets={widgets}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfields={{ customFileUpload: a => CustomFileUpload({ ...a, ...{ taskID: taskId }, ...{ \"currentUserUid\": currentUser.uid } }) }}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={true}\r\n\t\t\t\t\t\t\t\t\t\t\t\t> </JSchemaForm>\r\n\t\t\t\t\t\t\t\t\t\t\t</Grid>\r\n\t\t\t\t\t\t\t\t\t\t)))\r\n\t\t\t\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t\t\t\tnull\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t\t</Grid>\r\n\t\t\t\t\t:\r\n\t\t\t\t\tnull\r\n\t\t\t\t}\r\n\t\t\t\t{mergedForm && gRef && caseStages && taskMetadata && taskMetadata.case_stage_id && caseStages[taskMetadata.case_stage_id] ?\r\n\t\t\t\t\t<JSchemaForm\r\n\t\t\t\t\t\tschema={mergedForm.form_questions}\r\n\t\t\t\t\t\tuiSchema={mergedForm.ui_schema}\r\n\t\t\t\t\t\tformData={formResponses}\r\n\t\t\t\t\t\tfields={{\r\n\t\t\t\t\t\t\tCustomUIKField: a => CustomUIKField({ ...a, ...{ metadata: taskMetadata }, ...{ prevResp: prevFormResponses }, ...{ taskID: id } }),\r\n\t\t\t\t\t\t\tcustomFileUpload: a => CustomFileUpload({ ...a, ...{ taskID: id }, ...{ initResp: initialResponses }, ...{ \"currentUserUid\": currentUser.uid }, ...{ metadata: taskMetadata }, ...{ stage: caseStages[taskMetadata.case_stage_id] } })\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tdisabled={formStatus === \"loading\" || formStatus === \"sent\" || formStatus === \"released\"}\r\n\t\t\t\t\t\twidgets={widgets}\r\n\t\t\t\t\t\tomitExtraData={true}\r\n\t\t\t\t\t\tliveOmit={true}\r\n\t\t\t\t\t\tformContext={formResponses}\r\n\t\t\t\t\t\tnoHtml5Validate\r\n\t\t\t\t\t\tonChange={e => {\r\n\t\t\t\t\t\t\thandleFormChange(e)\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tonFocus={e => {\r\n\t\t\t\t\t\t\tconsole.log(\"That is what was focused\", e)\r\n\t\t\t\t\t\t\tsetCurrentFocus(e.split(\"_\")[1])\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tonSubmit={() => handleDialogOpen('send')}\r\n\t\t\t\t\t\tonBlur={(e, v) => {\r\n\t\t\t\t\t\t\thandleBlur(e, v)\r\n\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t{formStatus === \"sent\" ?\r\n\t\t\t\t\t\t\t<div>  </div>\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\tnull}\r\n\r\n\t\t\t\t\t\t{formStatus === \"ready\" ? <div>\r\n\t\t\t\t\t\t\t{caseStages[taskMetadata.case_stage_id].additionalButtons && caseStages[taskMetadata.case_stage_id].additionalButtons.includes(\"release\") ?\r\n\t\t\t\t\t\t\t\t<Button variant=\"outlined\" disabled={formStatus === \"loading\" || formStatus === \"sent\" || formStatus === \"released\"} style={{\r\n\t\t\t\t\t\t\t\t\tborderWidth: 2,\r\n\t\t\t\t\t\t\t\t\tborderColor: \"#003366\",\r\n\t\t\t\t\t\t\t\t\tcolor: \"#003366\",\r\n\t\t\t\t\t\t\t\t\tmargin: 5\r\n\t\t\t\t\t\t\t\t}} onClick={() => handleDialogOpen('release')}></Button>\r\n\t\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t\tnull}\r\n\t\t\t\t\t\t\t{!enableButton && <Typography color=\"error\">   ,     </Typography>}\r\n\t\t\t\t\t\t\t<Button type=\"submit\" variant=\"outlined\" disabled={formStatus === \"loading\" || formStatus === \"sent\" || formStatus === \"released\" || !enableButton}\r\n\t\t\t\t\t\t\t\tstyle={enableButton ? {\r\n\t\t\t\t\t\t\t\t\tborderWidth: 2,\r\n\t\t\t\t\t\t\t\t\tborderColor: \"red\",\r\n\t\t\t\t\t\t\t\t\tcolor: \"red\",\r\n\t\t\t\t\t\t\t\t\tmargin: 5\r\n\t\t\t\t\t\t\t\t} : null}\r\n\t\t\t\t\t\t\t></Button>\r\n\r\n\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\tnull\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{formStatus === \"released\" ?\r\n\t\t\t\t\t\t\t<div>         .</div>\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\tnull}\r\n\t\t\t\t\t</JSchemaForm>\r\n\t\t\t\t\t:\r\n\t\t\t\t\tnull}\r\n\r\n\t\t\t</Grid>\r\n\t\t\t:\r\n\t\t\t<Grid container direction=\"column\" style={{ padding: 20 }} justify=\"center\">\r\n\t\t\t\t<Typography align=\"center\" variant=\"h3\"></Typography>\r\n\t\t\t\t<br />\r\n\t\t\t\t<Button variant=\"contained\" onClick={signInWithGoogle}>    Google</Button>\r\n\t\t\t</Grid>\r\n\t)\r\n\r\n}\r\n\r\nexport default JSchemaTask","import { Grid, Typography } from '@material-ui/core';\r\nimport React, { useState, useEffect } from 'react'\r\nimport { useParams } from 'react-router';\r\nimport firebase from '../../util/Firebase'\r\n\r\n\r\nconst Badge = (props) => {\r\n    const { prefix, id } = useParams();\r\n    const [badges, setBadges] = useState([])\r\n\r\n    // console.log('id', typeof id, 'type', prefix)\r\n    useEffect(() => {\r\n        if (id && prefix) {\r\n            firebase.firestore().collection('badges').where('prefix', '==', prefix).where('number', '==', parseInt(id)).get().then(snap => {\r\n                let tmp = []\r\n                snap.forEach(doc => {\r\n                    if (doc.data().file_url) {\r\n                        tmp.push(<Grid container item justify=\"center\" key={doc.id}><img style={{ maxWidth: '100%' }} src={doc.data().file_url} alt={doc.data().file_url} /></Grid>)\r\n                    }\r\n                })\r\n                return tmp\r\n            }).then(tmp => {\r\n                console.log(\"TMP\", tmp)\r\n                setBadges(tmp)\r\n            })\r\n        }\r\n    }, [id, prefix])\r\n\r\n    return (\r\n        badges.length > 0 ?\r\n            <Grid container direction=\"column\" justify=\"center\" spacing={1}>\r\n                <Grid item>\r\n                    <Typography align=\"center\" variant=\"h6\">   16.04.2021.  ,        .</Typography>\r\n                </Grid>\r\n                <Grid item>\r\n                    <Typography align=\"center\" variant=\"h6\"> 16.04.21  .          .</Typography>\r\n                </Grid>\r\n                {badges[0]}\r\n            </Grid>\r\n            :\r\n            <Grid container direction=\"column\" justify=\"center\" spacing={1}>\r\n                <Grid item>\r\n                    <Typography align=\"center\" variant=\"h5\">      ,      ,    .</Typography>\r\n                </Grid>\r\n                <Grid item>\r\n                    <Typography align=\"center\" variant=\"h5\">   ,       .    .</Typography>\r\n                </Grid>\r\n            </Grid>\r\n    )\r\n}\r\n\r\nexport default Badge","import { Button, Grid, Typography } from '@material-ui/core';\r\nimport React, { useState, useEffect, useContext } from 'react'\r\nimport firebase from '../../util/Firebase'\r\nimport { AuthContext } from \"../../util/Auth\";\r\nimport { jsPDF } from \"jspdf\";\r\n\r\n\r\nconst UserBadges = (props) => {\r\n    const { currentUser } = useContext(AuthContext);\r\n    const [badges, setBadges] = useState([])\r\n\r\n    const fetchImage = async (blob) => {\r\n        let dataUrl = await new Promise(resolve => {\r\n            let reader = new FileReader();\r\n            reader.onload = () => resolve(reader.result);\r\n            reader.readAsDataURL(blob);\r\n        });\r\n        return dataUrl\r\n    }\r\n\r\n    const downloadUrlAsPromise = (url) => {\r\n        return new Promise((resolve, reject) => {\r\n            var xhr = new XMLHttpRequest();\r\n            xhr.open('GET', url);\r\n            xhr.responseType = \"blob\";\r\n            xhr.onreadystatechange = (evt) => {\r\n                if (xhr.readyState === 4) {\r\n                    if (xhr.status === 200) {\r\n                        resolve(xhr.response);\r\n                    } else {\r\n                        reject(new Error(\"Ajax error for \" + url + \": \" + xhr.status));\r\n                    }\r\n                }\r\n            }\r\n            xhr.send();\r\n        })\r\n    }\r\n\r\n    const getPdfFromImage = async (url, filename) => {\r\n        let blob = await downloadUrlAsPromise(url)\r\n        let dataUrl = await fetchImage(blob)\r\n        const pdfDoc = new jsPDF();\r\n        pdfDoc.addImage(dataUrl, \"JPEG\", 0, 0, 70, 105);\r\n        pdfDoc.save(filename)\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (currentUser) {\r\n            firebase.firestore().collection('badges').where('user_id', '==', currentUser.uid).get().then(snap => {\r\n                let tmp = []\r\n                snap.forEach(doc => {\r\n                    if (doc.data().file_url) {\r\n                        tmp.push(\r\n                            <Grid container item justify=\"center\" style={{ paddingTop: 10 }}>\r\n                                <Grid container item justify=\"center\">\r\n                                    <Button variant=\"contained\" color=\"primary\" onClick={() => getPdfFromImage(doc.data().file_url, doc.id)}> PDF</Button>\r\n                                </Grid>\r\n                                <Grid container item justify=\"center\" key={doc.id}>\r\n                                    <img style={{ maxWidth: '100%' }} src={doc.data().file_url} alt={doc.data().file_url} />\r\n                                </Grid>\r\n                            </Grid>\r\n                        )\r\n                    }\r\n                })\r\n                return tmp\r\n            }).then(tmp => {\r\n                console.log(\"TMP\", tmp)\r\n                setBadges(tmp)\r\n            })\r\n        }\r\n    }, [currentUser])\r\n\r\n    return (\r\n        badges.length > 0 ?\r\n            <Grid container direction=\"column\" justify=\"center\" spacing={1}>\r\n                <Grid item>\r\n                    <Typography align=\"center\" variant=\"h6\">   16.04.2021.  ,        .</Typography>\r\n                </Grid>\r\n                <Grid item>\r\n                    <Typography align=\"center\" variant=\"h6\"> 16.04.21  .          .</Typography>\r\n                </Grid>\r\n                {badges}\r\n            </Grid>\r\n            :\r\n            <Grid container direction=\"column\" justify=\"center\" spacing={1}>\r\n                <Grid item>\r\n                    <Typography align=\"center\" variant=\"h6\">    .</Typography>\r\n                </Grid>\r\n                <Grid item>\r\n                    <Typography align=\"center\" variant=\"h6\">   .</Typography>\r\n                </Grid>\r\n            </Grid>\r\n    )\r\n}\r\n\r\nexport default UserBadges","import React, { useState, useContext, useEffect } from 'react'\r\nimport { AuthProvider } from \"./util/Auth\";\r\nimport firebase from './util/Firebase'\r\nimport {\r\n  HashRouter as Router,\r\n  Switch,\r\n  Route,\r\n  Link,\r\n  Redirect\r\n} from \"react-router-dom\";\r\nimport { AuthContext } from \"./util/Auth\";\r\n\r\nimport Grid from '@material-ui/core/Grid'\r\n\r\n// import Appbar from './Components/Appbar/Appbar'\r\n// import Appbar from './Components/Appbar/oldAppBar'\r\nimport Appbar from './Components/Appbar/newAppBar'\r\nimport Profile from './Components/Profile/Profile'\r\nimport Tasks from './Components/Tasks/Tasks'\r\nimport Task from './Components/Tasks/Task'\r\nimport Cases from './Components/Cases/Cases';\r\nimport Notifications from './Components/Notifications/Notifications'\r\nimport Home from './Components/Home/Home'\r\nimport TasksObserver from './Components/Moderator/TasksObserver'\r\nimport Signin from './Components/Auth/Signin';\r\nimport PrivateRoute from './util/PrivateRoute';\r\nimport FAQ from './Components/FAQ/FAQ';\r\nimport Page from \"./Components/Page/Page\";\r\nimport JSchemaTask from \"./Components/Tasks/JSchemaTask\";\r\nimport Badge from './Components/Badges/Badge'\r\nimport UserBadges from './Components/Badges/userBadges'\r\n\r\n\r\nconst App = () => {\r\n  const { currentUser } = useContext(AuthContext);\r\n\r\n  const [tgId, setTgId] = useState(\"\")\r\n\r\n  useEffect(() => {\r\n    let unsubscribeUserPrivate = () => { }\r\n    if (currentUser) {\r\n      unsubscribeUserPrivate = firebase.firestore()\r\n        .collection('users')\r\n        .doc(currentUser.uid)\r\n        .collection(\"user_private\")\r\n        .doc(\"private\")\r\n        .onSnapshot(doc => {\r\n          if (doc.exists && \"tg_id\" in doc.data()) {\r\n            console.log(\"APP TGID: \", doc.data().tg_id)\r\n            setTgId(doc.data().tg_id)\r\n          }\r\n        })\r\n    }\r\n    return () => {\r\n      unsubscribeUserPrivate()\r\n    }\r\n  }, [currentUser])\r\n\r\n\r\n  return (\r\n    <Router>\r\n      <Grid container justify=\"center\">\r\n        <Appbar>\r\n          {tgId !== \"\" ? <Switch>\r\n            <Route exact path=\"/profile\">\r\n              <Profile />\r\n            </Route>\r\n            <Route exact path=\"/request\">\r\n              <Cases />\r\n            </Route>\r\n            <Route exact path=\"/tasks\">\r\n              <Tasks />\r\n            </Route>\r\n            <Route path=\"/tasks/:id\">\r\n              <Task />\r\n            </Route>\r\n            <Route path=\"/t/:id\">\r\n              <JSchemaTask />\r\n            </Route>\r\n            <Route exact path=\"/tasksObserver\">\r\n              <TasksObserver />\r\n            </Route>\r\n            <Route exact path=\"/notifications\">\r\n              <Notifications />\r\n            </Route>\r\n            <Route exact path=\"/signin\">\r\n              <Signin />\r\n            </Route>\r\n            <Route exact path=\"/faq\">\r\n              <FAQ />\r\n            </Route>\r\n            <Route exact path=\"/badges/:prefix/:id\">\r\n              <Badge />\r\n            </Route>\r\n            <Route exact path=\"/mybadges\">\r\n              <UserBadges />\r\n            </Route>\r\n            <Route path=\"/p/:id\">\r\n              {currentUser ?\r\n                <Page />\r\n                :\r\n                <Signin />}\r\n            </Route>\r\n            <PrivateRoute path=\"/\" component={Home} />\r\n          </Switch>\r\n            :\r\n            <Switch>\r\n              <Route exact path=\"/badges/:prefix/:id\">\r\n                <Badge />\r\n              </Route>\r\n              <Route>\r\n                <Home />\r\n              </Route>\r\n            </Switch>\r\n          }\r\n        </Appbar>\r\n      </Grid>\r\n    </Router>\r\n  )\r\n}\r\n\r\nexport default App;\r\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import 'bootstrap/dist/css/bootstrap.css';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport {AuthProvider} from './util/Auth'\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <AuthProvider>\r\n      <App />\r\n    </AuthProvider>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}